{"version":3,"sources":["../src/types.ts","../src/editor/base.ts","../src/editor/writer.ts","../src/editor/calc.ts","../src/editor/impress.ts","../src/editor/draw.ts","../src/editor/index.ts","../src/lok-bindings.ts","../src/browser.ts"],"names":["DEFAULT_WASM_BASE_URL","createWasmPaths","baseUrl","base","ConversionErrorCode","ConversionError","code","message","details","FORMAT_FILTERS","FORMAT_MIME_TYPES","EXTENSION_TO_FORMAT","OUTPUT_FORMAT_TO_LOK","FORMAT_FILTER_OPTIONS","OfficeEditor","lok","docPtr","options","error","path","format","afterMode","text","searchArgs","selection","hasMatch","find","replace","states","_selection","data","suggestion","truncation","content","maxChars","limit","original","truncated","lastSpace","items","itemToString","charCount","includedCount","item","itemStr","a1","match","colStr","rowStr","col","row","c","remainder","ref","WriterEditor","paragraphs","paragraphInfos","index","truncResult","p","structure","w","start","count","end","result","insertIndex","textArgs","styleName","styleArgs","oldText","findReplaceArgs","deletedText","_position","_start","_end","command","_range","args","boldState","italicState","underlineState","fontSizeState","size","fontNameState","existingStates","allText","CalcEditor","_options","numSheets","sheets","i","name","dataArea","names","cell","sheet","address","value","formula","range","startRow","startCol","endRow","endCol","cells","r","rowData","cellData","cellStr","sum","oldValue","valueStr","newValue","expectedStr","calculatedValue","values","cellsUpdated","rowValues","rangeStr","cellsCleared","afterRow","afterCol","colNum","newName","num","parts","hex","ImpressEditor","numSlides","slides","slideData","textFrames","f","newIndex","fromIndex","toIndex","title","oldTitle","body","oldBody","notes","layout","frames","titleFrame","para","idx","type","layoutId","DrawEditor","numPages","pages","pageInfo","shapes","pageData","pageIndex","shapeType","bounds","shapeCommand","boundsArgs","colorArgs","widthArgs","shapeIndex","newPosition","newSize","LOK_DOCTYPE_TEXT","LOK_DOCTYPE_SPREADSHEET","LOK_DOCTYPE_PRESENTATION","LOK_DOCTYPE_DRAWING","createEditor","docType","isWriterEditor","editor","isCalcEditor","isImpressEditor","isDrawEditor","getCallbackTypeName","LOK_CLASS","DOC_CLASS","textEncoder","textDecoder","LOKBindings","module","verbose","str","bytes","ptr","heap","slice","addr","installPath","pathPtr","hook","errPtr","lokClassPtr","getErrorPtr","fileUrl","startTime","documentLoadPtr","optsPtr","loadWithOptsPtr","outputPath","filterOptions","urlPtr","formatPtr","docClassPtr","saveAsPtr","destroyPtr","part","sizePtr","width","height","canvasWidth","canvasHeight","tilePosX","tilePosY","tileWidth","tileHeight","bufferSize","bufferPtr","editMode","currentPart","docSize","pageRectsStr","pageRect","aspectRatio","outputWidth","outputHeight","dpi","maxDimension","TWIPS_PER_INCH","effectiveDpi","scale","mimeType","mimePtr","usedMimePtr","resultPtr","x","y","buttons","modifier","charCode","keyCode","notifyWhenFinished","cmdPtr","argsPtr","dataPtr","dataSize","tilePixelWidth","tilePixelHeight","tileTwipWidth","tileTwipHeight","viewId","enabled","colPtr","rowPtr","mode","optionsPtr","payloadBuffer","payloadLengthPtr","eventType","payloadLength","payload","len","events","event","hasShim","eqIndex","key","rectanglesStr","s","rect","BrowserConverter","defaultPaths","resolve","err","sofficeJs","sofficeWasm","sofficeData","sofficeWorkerJs","win","reject","what","script","fs","input","filename","inputData","ext","outputExt","inPath","outPath","lokFormat","pdfOpts","levelMap","baseName","file","buffer","url","res","blob","a","phase","percent","WorkerBrowserConverter","timeout","handler","msg","progress","pending","id","copy","isZip","isImageFormat","maxWidth","editOptions","BrowserEditorProxy","sessionId","method","renderOptions","converter","documentType","pageCount","createDropZone","element","el","handleDrop","e","files","handleDragOver","handleDragLeave","quickConvert","outputFormat"],"mappings":"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","file":"browser.js","sourcesContent":["/**\n * LibreOffice WASM Document Conversion Types\n * Headless document format conversion toolkit\n */\n\n/**\n * Supported input document formats\n */\nexport type InputFormat =\n  // Microsoft Office formats\n  | 'doc'\n  | 'docx'\n  | 'xls'\n  | 'xlsx'\n  | 'ppt'\n  | 'pptx'\n  // OpenDocument formats\n  | 'odt'\n  | 'ods'\n  | 'odp'\n  | 'odg'\n  | 'odf'\n  // Other formats\n  | 'rtf'\n  | 'txt'\n  | 'html'\n  | 'htm'\n  | 'csv'\n  | 'xml'\n  | 'epub'\n  | 'pdf';\n\n/**\n * Supported output document formats\n */\nexport type OutputFormat =\n  | 'pdf'\n  | 'docx'\n  | 'doc'\n  | 'odt'\n  | 'rtf'\n  | 'txt'\n  | 'html'\n  | 'xlsx'\n  | 'xls'\n  | 'ods'\n  | 'csv'\n  | 'pptx'\n  | 'ppt'\n  | 'odp'\n  | 'png'\n  | 'jpg'\n  | 'svg';\n\n/**\n * Document conversion options\n */\nexport interface ConversionOptions {\n  /**\n   * Output format for the conversion\n   */\n  outputFormat: OutputFormat;\n\n  /**\n   * Input format hint (auto-detected if not provided)\n   */\n  inputFormat?: InputFormat;\n\n  /**\n   * PDF-specific options\n   */\n  pdf?: PdfOptions;\n\n  /**\n   * Image output options (for png, jpg, svg)\n   */\n  image?: ImageOptions;\n\n  /**\n   * Password for encrypted documents\n   */\n  password?: string;\n}\n\n/**\n * PDF-specific conversion options\n */\nexport interface PdfOptions {\n  /**\n   * PDF/A conformance level\n   */\n  pdfaLevel?: 'PDF/A-1b' | 'PDF/A-2b' | 'PDF/A-3b';\n\n  /**\n   * PDF quality (0-100, affects image compression)\n   * @default 90\n   */\n  quality?: number;\n}\n\n/**\n * Image output options\n */\nexport interface ImageOptions {\n  /**\n   * Image width in pixels\n   */\n  width?: number;\n\n  /**\n   * Image height in pixels\n   */\n  height?: number;\n\n  /**\n   * DPI for rendering\n   * @default 150\n   */\n  dpi?: number;\n\n  /**\n   * Page index to export (0-based). Only exports this single page.\n   * If not specified, exports the first page (page 0).\n   * Cannot be used together with `pages`.\n   */\n  pageIndex?: number;\n\n  /**\n   * Array of page indices to export (0-based).\n   * If specified, returns an array of results (one per page).\n   * Cannot be used together with `pageIndex`.\n   */\n  pages?: number[];\n}\n\n/**\n * Result of a document conversion\n */\nexport interface ConversionResult {\n  /**\n   * The converted document data\n   */\n  data: Uint8Array;\n\n  /**\n   * MIME type of the output\n   */\n  mimeType: string;\n\n  /**\n   * Suggested filename with new extension\n   */\n  filename: string;\n\n  /**\n   * Conversion duration in milliseconds\n   */\n  duration: number;\n}\n\n/**\n * WASM loader module interface\n * This is the interface for the loader.cjs module that creates the Emscripten module\n */\nexport interface WasmLoaderModule {\n  createModule: (config: Record<string, unknown>) => Promise<EmscriptenModule>;\n}\n\n/**\n * LibreOffice WASM module initialization options (Node.js)\n */\nexport interface LibreOfficeWasmOptions {\n  /**\n   * Path to WASM files directory\n   * @default './wasm'\n   */\n  wasmPath?: string;\n\n  /**\n   * Path to the worker script (for WorkerConverter)\n   * When not specified, auto-detected based on module location\n   */\n  workerPath?: string;\n\n  /**\n   * Pre-loaded WASM loader module\n   * When provided, bypasses dynamic require of loader.cjs\n   * This is useful for bundlers like Turbopack that can't handle dynamic requires\n   *\n   * @example\n   * ```typescript\n   * // In your code, import the loader statically\n   * import * as wasmLoader from '@matbee/libreoffice-converter/wasm/loader.cjs';\n   *\n   * const converter = new LibreOfficeConverter({\n   *   wasmPath: './wasm',\n   *   wasmLoader,\n   * });\n   * ```\n   */\n  wasmLoader?: WasmLoaderModule;\n\n  /**\n   * Enable verbose logging\n   * @default false\n   */\n  verbose?: boolean;\n\n  /**\n   * Called when WASM module is ready\n   */\n  onReady?: () => void;\n\n  /**\n   * Called on initialization error\n   */\n  onError?: (error: Error) => void;\n\n  /**\n   * Called with progress updates during initialization\n   */\n  onProgress?: (progress: ProgressInfo) => void;\n}\n\n/**\n * Explicit paths to WASM files (Browser)\n * All paths are required when specified explicitly\n */\nexport interface BrowserWasmPaths {\n  /** URL to soffice.js - the main Emscripten loader script */\n  sofficeJs: string;\n  /** URL to soffice.wasm - the WebAssembly binary (~112MB) */\n  sofficeWasm: string;\n  /** URL to soffice.data - the virtual filesystem image (~80MB) */\n  sofficeData: string;\n  /** URL to soffice.worker.js - the Emscripten pthread worker */\n  sofficeWorkerJs: string;\n}\n\n/**\n * Browser converter initialization options\n * All WASM paths are optional and default to /wasm/ via createWasmPaths()\n */\nexport interface BrowserConverterOptions {\n  /** URL to soffice.js - defaults to /wasm/soffice.js */\n  sofficeJs?: string;\n  /** URL to soffice.wasm - defaults to /wasm/soffice.wasm */\n  sofficeWasm?: string;\n  /** URL to soffice.data - defaults to /wasm/soffice.data */\n  sofficeData?: string;\n  /** URL to soffice.worker.js - defaults to /wasm/soffice.worker.js */\n  sofficeWorkerJs?: string;\n\n  /**\n   * Enable verbose logging\n   * @default false\n   */\n  verbose?: boolean;\n\n  /**\n   * Called when WASM module is ready\n   */\n  onReady?: () => void;\n\n  /**\n   * Called on initialization error\n   */\n  onError?: (error: Error) => void;\n\n  /**\n   * Called with progress updates during initialization\n   */\n  onProgress?: (progress: WasmLoadProgress) => void;\n}\n\n/**\n * Worker browser converter initialization options\n * All WASM paths are optional and default to /wasm/ via createWasmPaths()\n */\nexport interface WorkerBrowserConverterOptions extends BrowserConverterOptions {\n  /** URL to browser.worker.js - defaults to /dist/browser.worker.global.js */\n  browserWorkerJs?: string;\n  /**\n   * Enable download progress tracking during WASM initialization\n   * When enabled, intercepts fetch/XHR to track download progress for soffice.wasm and soffice.data\n   * \n   * **WARNING**: This is disabled by default because the fetch interceptor can break\n   * WebAssembly streaming compilation in some environments. Only enable if you need\n   * detailed download progress and have tested it works in your target browsers.\n   * \n   * @default false\n   */\n  enableProgressTracking?: boolean;\n}\n\n/**\n * Internal type for BrowserConverterOptions after defaults are applied\n * All WASM paths are guaranteed to be defined\n */\nexport type ResolvedBrowserConverterOptions = BrowserConverterOptions & BrowserWasmPaths;\n\n/**\n * Internal type for WorkerBrowserConverterOptions after defaults are applied\n * All WASM paths and browserWorkerJs are guaranteed to be defined\n */\nexport type ResolvedWorkerBrowserConverterOptions = WorkerBrowserConverterOptions & BrowserWasmPaths & {\n  browserWorkerJs: string;\n};\n\n/**\n * Default URL for WASM files - relative path for same-origin hosting\n * Users typically serve WASM files from their own server at /wasm/\n */\nexport const DEFAULT_WASM_BASE_URL = '/wasm/';\n\n/**\n * Create WASM file paths from a base URL\n * Convenience helper for users who keep all WASM files in one directory\n *\n * @param baseUrl - Base URL ending with '/' (e.g., '/wasm/', 'https://cdn.example.com/wasm/')\n *                  Defaults to '/wasm/' for same-origin hosting\n * @returns Object with all WASM file paths\n *\n * @example\n * ```typescript\n * // Use default /wasm/ path (same-origin)\n * const converter = new WorkerBrowserConverter({\n *   ...createWasmPaths(),\n *   browserWorkerJs: '/dist/browser.worker.js',\n * });\n *\n * // Or use your own CDN\n * const converter = new WorkerBrowserConverter({\n *   ...createWasmPaths('https://cdn.example.com/wasm/'),\n *   browserWorkerJs: '/dist/browser.worker.js',\n * });\n * ```\n */\nexport function createWasmPaths(baseUrl: string = DEFAULT_WASM_BASE_URL): BrowserWasmPaths {\n  // Ensure baseUrl ends with /\n  const base = baseUrl.endsWith('/') ? baseUrl : `${baseUrl}/`;\n  return {\n    sofficeJs: `${base}soffice.js`,\n    sofficeWasm: `${base}soffice.wasm`,\n    sofficeData: `${base}soffice.data`,\n    sofficeWorkerJs: `${base}soffice.worker.js`,\n  };\n}\n\n/**\n * Loading phases for WASM initialization\n * Used to track detailed progress during the ~80 second browser startup\n */\nexport type WasmLoadPhase =\n  | 'download-wasm'    // Downloading soffice.wasm (~142MB)\n  | 'download-data'    // Downloading soffice.data (~96MB)\n  | 'compile'          // WebAssembly compilation\n  | 'filesystem'       // Emscripten filesystem setup\n  | 'lok-init'         // LibreOfficeKit initialization\n  | 'ready' | 'starting' | 'loading' | 'initializing' | 'converting' | 'complete';           // Complete\n\n/**\n * Extended progress information with download details\n * Backward compatible - existing code using percent/message continues to work\n */\nexport interface WasmLoadProgress {\n  /** Overall progress 0-100 */\n  percent: number;\n  /** Human-readable status message */\n  message: string;\n  /** Current loading phase */\n  phase: WasmLoadPhase;\n  /** Bytes downloaded (present during download phases) */\n  bytesLoaded?: number;\n  /** Total bytes to download (present during download phases) */\n  bytesTotal?: number;\n}\n\n/**\n * Progress information\n * @deprecated Use WasmLoadProgress for richer progress data\n */\nexport interface ProgressInfo {\n  phase: 'loading' | 'initializing' | 'converting' | 'complete';\n  percent: number;\n  message: string;\n}\n\n/**\n * Error codes for conversion failures\n */\nexport enum ConversionErrorCode {\n  UNKNOWN = 'UNKNOWN',\n  INVALID_INPUT = 'INVALID_INPUT',\n  UNSUPPORTED_FORMAT = 'UNSUPPORTED_FORMAT',\n  CORRUPTED_DOCUMENT = 'CORRUPTED_DOCUMENT',\n  PASSWORD_REQUIRED = 'PASSWORD_REQUIRED',\n  WASM_NOT_INITIALIZED = 'WASM_NOT_INITIALIZED',\n  CONVERSION_FAILED = 'CONVERSION_FAILED',\n  LOAD_FAILED = 'LOAD_FAILED',\n}\n\n/**\n * Custom error class for conversion errors\n */\nexport class ConversionError extends Error {\n  public readonly code: ConversionErrorCode;\n  public readonly details?: string;\n\n  constructor(code: ConversionErrorCode, message: string, details?: string) {\n    super(message);\n    this.name = 'ConversionError';\n    this.code = code;\n    this.details = details;\n  }\n}\n\n/**\n * Emscripten Module interface\n */\nexport interface EmscriptenModule {\n  // Core Emscripten functions\n  ccall: (\n    name: string,\n    returnType: string | null,\n    argTypes: string[],\n    args: unknown[]\n  ) => unknown;\n  cwrap: (\n    name: string,\n    returnType: string | null,\n    argTypes: string[]\n  ) => (...args: unknown[]) => unknown;\n\n  // Memory management\n  _malloc: (size: number) => number;\n  _free: (ptr: number) => void;\n  HEAPU8: Uint8Array;\n  HEAP32: Int32Array;\n  HEAPU32: Uint32Array;\n\n  // File system\n  FS: EmscriptenFS;\n\n  // Lifecycle\n  onRuntimeInitialized?: () => void;\n  calledRun?: boolean;\n\n  // LibreOfficeKit hooks (exported C functions)\n  _lok_preinit?: (path: number, args: number) => number;\n  _lok_preinit_2?: (path: number, args: number, callback: number) => number;\n  _libreofficekit_hook?: (path: number) => number;\n  _libreofficekit_hook_2?: (path: number, userProfile: number) => number;\n  _main?: (argc: number, argv: number) => number;\n\n  // WebAssembly function table for indirect calls\n  wasmTable?: WebAssembly.Table;\n\n  // Module locator\n  locateFile?: (path: string) => string;\n  print?: (text: string) => void;\n  printErr?: (text: string) => void;\n\n  // Runtime ready promise (some builds)\n  ready?: Promise<EmscriptenModule>;\n}\n\n/**\n * Emscripten virtual filesystem\n */\nexport interface EmscriptenFS {\n  mkdir: (path: string) => void;\n  writeFile: (path: string, data: Uint8Array | string, opts?: { encoding?: string }) => void;\n  readFile: (path: string, opts?: { encoding?: string }) => Uint8Array | string;\n  unlink: (path: string) => void;\n  readdir: (path: string) => string[];\n  stat: (path: string) => { size: number; isDirectory: () => boolean };\n  rmdir: (path: string) => void;\n  rename: (oldPath: string, newPath: string) => void;\n  open: (path: string, flags: unknown, mode?: unknown) => unknown;\n}\n\n/**\n * Filter name mapping for LibreOffice export\n * Note: For image exports, use getFilterForDocType() instead as filters are document-type specific\n */\nexport const FORMAT_FILTERS: Record<OutputFormat, string> = {\n  pdf: 'writer_pdf_Export',\n  docx: 'MS Word 2007 XML',\n  doc: 'MS Word 97',\n  odt: 'writer8',\n  rtf: 'Rich Text Format',\n  txt: 'Text',\n  html: 'HTML (StarWriter)',\n  xlsx: 'Calc MS Excel 2007 XML',\n  xls: 'MS Excel 97',\n  ods: 'calc8',\n  csv: 'Text - txt - csv (StarCalc)',\n  pptx: 'Impress MS PowerPoint 2007 XML',\n  ppt: 'MS PowerPoint 97',\n  odp: 'impress8',\n  png: 'writer_png_Export',\n  jpg: 'writer_jpg_Export',\n  svg: 'writer_svg_Export',\n};\n\n/**\n * LibreOfficeKit document types (from LibreOfficeKitEnums.h)\n */\nexport enum LOKDocumentType {\n  TEXT = 0,\n  SPREADSHEET = 1,\n  PRESENTATION = 2,\n  DRAWING = 3,\n  OTHER = 4,\n}\n\n/**\n * Document-type-specific filters for image and PDF exports\n * Each document type (Writer, Calc, Impress, Draw) has its own export filters\n */\nexport const DOC_TYPE_FILTERS: Record<LOKDocumentType, Partial<Record<OutputFormat, string>>> = {\n  [LOKDocumentType.TEXT]: {\n    pdf: 'writer_pdf_Export',\n    png: 'writer_png_Export',\n    jpg: 'writer_jpg_Export',\n    svg: 'writer_svg_Export',\n    html: 'HTML (StarWriter)',\n  },\n  [LOKDocumentType.SPREADSHEET]: {\n    pdf: 'calc_pdf_Export',\n    png: 'calc_png_Export',\n    jpg: 'calc_jpg_Export',\n    svg: 'calc_svg_Export',\n    html: 'HTML (StarCalc)',\n  },\n  [LOKDocumentType.PRESENTATION]: {\n    pdf: 'impress_pdf_Export',\n    png: 'impress_png_Export',\n    jpg: 'impress_jpg_Export',\n    svg: 'impress_svg_Export',\n    html: 'impress_html_Export',\n  },\n  [LOKDocumentType.DRAWING]: {\n    pdf: 'draw_pdf_Export',\n    png: 'draw_png_Export',\n    jpg: 'draw_jpg_Export',\n    svg: 'draw_svg_Export',\n    html: 'draw_html_Export',\n  },\n  [LOKDocumentType.OTHER]: {\n    pdf: 'writer_pdf_Export',\n    png: 'writer_png_Export',\n    jpg: 'writer_jpg_Export',\n    svg: 'writer_svg_Export',\n  },\n};\n\n/**\n * Get the correct export filter for a given output format and document type\n * @param outputFormat The desired output format\n * @param docType The LibreOfficeKit document type (use documentGetDocumentType())\n * @returns The filter name to use for saveAs\n */\nexport function getFilterForDocType(outputFormat: OutputFormat, docType: LOKDocumentType | number): string {\n  // Check if there's a document-type-specific filter\n  const docTypeFilters = DOC_TYPE_FILTERS[docType as LOKDocumentType];\n  if (docTypeFilters && docTypeFilters[outputFormat]) {\n    return docTypeFilters[outputFormat];\n  }\n\n  // Fall back to the default filter\n  return FORMAT_FILTERS[outputFormat];\n}\n\n/**\n * MIME types for output formats\n */\nexport const FORMAT_MIME_TYPES: Record<OutputFormat, string> = {\n  pdf: 'application/pdf',\n  docx: 'application/vnd.openxmlformats-officedocument.wordprocessingml.document',\n  doc: 'application/msword',\n  odt: 'application/vnd.oasis.opendocument.text',\n  rtf: 'application/rtf',\n  txt: 'text/plain',\n  html: 'text/html',\n  xlsx: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',\n  xls: 'application/vnd.ms-excel',\n  ods: 'application/vnd.oasis.opendocument.spreadsheet',\n  csv: 'text/csv',\n  pptx: 'application/vnd.openxmlformats-officedocument.presentationml.presentation',\n  ppt: 'application/vnd.ms-powerpoint',\n  odp: 'application/vnd.oasis.opendocument.presentation',\n  png: 'image/png',\n  jpg: 'image/jpeg',\n  svg: 'image/svg+xml',\n};\n\n/**\n * File extension to format mapping\n */\nexport const EXTENSION_TO_FORMAT: Record<string, InputFormat> = {\n  doc: 'doc',\n  docx: 'docx',\n  xls: 'xls',\n  xlsx: 'xlsx',\n  ppt: 'ppt',\n  pptx: 'pptx',\n  odt: 'odt',\n  ods: 'ods',\n  odp: 'odp',\n  odg: 'odg',\n  odf: 'odf',\n  rtf: 'rtf',\n  txt: 'txt',\n  html: 'html',\n  htm: 'html',\n  csv: 'csv',\n  xml: 'xml',\n  epub: 'epub',\n  pdf: 'pdf',\n};\n\n/**\n * Map LOK document type to valid output formats\n * This is based on LibreOffice's actual extension maps in desktop/source/lib/init.cxx\n * \n * IMPORTANT: These are the formats that LibreOffice's saveAs() actually supports.\n * The extension maps in init.cxx determine what filters are available per document type.\n * \n * Writer (TEXT): doc, docx, odt, pdf, rtf, txt, html, png, epub\n * Calc (SPREADSHEET): csv, ods, pdf, xls, xlsx, html, png\n * Impress (PRESENTATION): odp, pdf, ppt, pptx, svg, html, png\n * Draw (DRAWING): odg, pdf, svg, html, png\n * \n * NOTE: jpg is NOT in any extension map! Only png is supported for image export.\n * NOTE: svg is only supported for Impress and Draw, not Writer or Calc.\n */\nexport const LOK_DOCTYPE_OUTPUT_FORMATS: Record<LOKDocumentType, OutputFormat[]> = {\n  [LOKDocumentType.TEXT]: ['pdf', 'docx', 'doc', 'odt', 'rtf', 'txt', 'html', 'png'],\n  [LOKDocumentType.SPREADSHEET]: ['pdf', 'xlsx', 'xls', 'ods', 'csv', 'html', 'png'],\n  [LOKDocumentType.PRESENTATION]: ['pdf', 'pptx', 'ppt', 'odp', 'png', 'svg', 'html'],\n  [LOKDocumentType.DRAWING]: ['pdf', 'png', 'svg', 'html'],\n  [LOKDocumentType.OTHER]: ['pdf'],\n};\n\n/**\n * Get valid output formats for a LOK document type\n * Use this after loading a document to get accurate conversion options\n * @param docType The LOK document type (from documentGetDocumentType)\n * @returns Array of valid output formats\n */\nexport function getOutputFormatsForDocType(docType: LOKDocumentType | number): OutputFormat[] {\n  return LOK_DOCTYPE_OUTPUT_FORMATS[docType as LOKDocumentType] || ['pdf'];\n}\n\n/**\n * Map output format to LOK format string\n * These are the format names used by LibreOfficeKit's saveAs\n */\nexport const OUTPUT_FORMAT_TO_LOK: Record<OutputFormat, string> = {\n  pdf: 'pdf',\n  docx: 'docx',\n  doc: 'doc',\n  odt: 'odt',\n  rtf: 'rtf',\n  txt: 'txt',\n  html: 'html',\n  xlsx: 'xlsx',\n  xls: 'xls',\n  ods: 'ods',\n  csv: 'csv',\n  pptx: 'pptx',\n  ppt: 'ppt',\n  odp: 'odp',\n  png: 'png',\n  jpg: 'jpg',\n  svg: 'svg',\n};\n\n/**\n * Filter options for specific format conversions\n * These are passed to LibreOfficeKit's saveAs as the filterOptions parameter\n */\nexport const FORMAT_FILTER_OPTIONS: Partial<Record<OutputFormat, string>> = {\n  // PDF options can include things like:\n  // - SelectPdfVersion (0=PDF 1.4, 1=PDF/A-1, 2=PDF/A-2, 3=PDF/A-3)\n  // - UseLosslessCompression\n  // - Quality\n  pdf: '',\n  // CSV can specify separator, encoding, etc.\n  csv: '44,34,76,1,,0,false,true,false,false,false,-1',\n  // Text encoding\n  txt: 'UTF8',\n};\n\n/**\n * CSV Import filter options for loading CSV files as spreadsheets.\n * \n * The FilterOptions token format (15 tokens, comma-separated):\n * Token 0: Field separator ASCII code (44 = comma, 9 = tab, 59 = semicolon)\n * Token 1: Text delimiter ASCII code (34 = double quote)\n * Token 2: Character set (76 = UTF-8)\n * Token 3: Start row (1 = first row)\n * Token 4: Column format info (empty = auto-detect)\n * Token 5: Language ID (1033 = English US, 0 = system)\n * Token 6: Quoted field as text (true/false)\n * Token 7: Detect special numbers (true/false)\n * Token 8: Save as shown - export only (false)\n * Token 9: Save formulas - export only (false)\n * Token 10: Trim spaces (false)\n * Token 11: Sheet to export - export only (0)\n * Token 12: Evaluate formulas (true)\n * Token 13: Include BOM - export only (false)\n * Token 14: Detect scientific numbers (true)\n * \n * This ensures LibreOffice loads CSV files as Calc spreadsheet documents\n * in headless mode without triggering dialogs.\n */\nexport const CSV_IMPORT_FILTER_OPTIONS = 'FilterName=Text - txt - csv (StarCalc),FilterOptions=44,34,76,1,,1033,false,true,false,false,false,0,true,false,true';\n\n/**\n * Build load options for a document based on format and other options\n * @param inputFormat The input document format\n * @param password Optional password for encrypted documents\n * @returns Load options string for documentLoadWithOptions, or empty string for documentLoad\n */\nexport function buildLoadOptions(inputFormat?: string, password?: string): string {\n  const options: string[] = [];\n  \n  // CSV files need explicit import filter to be recognized as spreadsheets\n  if (inputFormat?.toLowerCase() === 'csv') {\n    options.push(CSV_IMPORT_FILTER_OPTIONS);\n  }\n  \n  // Password-protected documents\n  if (password) {\n    options.push(`Password=${password}`);\n  }\n  \n  return options.join(',');\n}\n\n/**\n * Document type categories for determining valid conversions\n */\nexport type DocumentCategory = 'text' | 'spreadsheet' | 'presentation' | 'drawing' | 'other';\n\n/**\n * Map input formats to their document category\n * This determines which output formats are valid\n */\nexport const INPUT_FORMAT_CATEGORY: Record<InputFormat, DocumentCategory> = {\n  // Text/Writer documents\n  doc: 'text',\n  docx: 'text',\n  odt: 'text',\n  rtf: 'text',\n  txt: 'text',\n  html: 'text',\n  htm: 'text',\n  epub: 'text',\n  xml: 'text',\n  // Spreadsheet/Calc documents\n  xls: 'spreadsheet',\n  xlsx: 'spreadsheet',\n  ods: 'spreadsheet',\n  csv: 'spreadsheet',\n  // Presentation/Impress documents\n  ppt: 'presentation',\n  pptx: 'presentation',\n  odp: 'presentation',\n  // Drawing/Draw documents (PDF imports as Draw)\n  odg: 'drawing',\n  odf: 'drawing',\n  pdf: 'drawing', // PDFs are imported as Draw documents\n};\n\n/**\n * Valid output formats for each document category\n * Based on LibreOffice's actual filter capabilities\n */\nexport const CATEGORY_OUTPUT_FORMATS: Record<DocumentCategory, OutputFormat[]> = {\n  // Writer documents can export to (based on aWriterExtensionMap in init.cxx):\n  // NOTE: jpg and svg are NOT supported for Writer - only png for images\n  text: ['pdf', 'docx', 'doc', 'odt', 'rtf', 'txt', 'html', 'png'],\n  // Calc documents can export to (based on aCalcExtensionMap in init.cxx):\n  // NOTE: jpg and svg are NOT supported for Calc - only png for images\n  spreadsheet: ['pdf', 'xlsx', 'xls', 'ods', 'csv', 'html', 'png'],\n  // Impress documents can export to (based on aImpressExtensionMap in init.cxx):\n  // NOTE: jpg is NOT supported - only png and svg for images\n  presentation: ['pdf', 'pptx', 'ppt', 'odp', 'png', 'svg', 'html'],\n  // Draw documents (including imported PDFs) can export to (based on aDrawExtensionMap in init.cxx):\n  // NOTE: jpg is NOT supported - only png and svg for images\n  drawing: ['pdf', 'png', 'svg', 'html'],\n  // Other/unknown - try PDF only\n  other: ['pdf'],\n};\n\n/**\n * Get valid output formats for a given input format\n * @param inputFormat The input document format\n * @returns Array of valid output formats\n */\nexport function getValidOutputFormats(inputFormat: InputFormat | string): OutputFormat[] {\n  const format = inputFormat.toLowerCase() as InputFormat;\n  const category = INPUT_FORMAT_CATEGORY[format];\n\n  if (!category) {\n    // Unknown format - allow PDF as a safe default\n    return ['pdf'];\n  }\n\n  return CATEGORY_OUTPUT_FORMATS[category];\n}\n\n/**\n * Check if a conversion from input format to output format is valid\n * @param inputFormat The input document format\n * @param outputFormat The desired output format\n * @returns true if the conversion is supported\n */\nexport function isConversionValid(\n  inputFormat: InputFormat | string,\n  outputFormat: OutputFormat | string\n): boolean {\n  const validOutputs = getValidOutputFormats(inputFormat);\n  return validOutputs.includes(outputFormat.toLowerCase() as OutputFormat);\n}\n\n/**\n * Get a human-readable error message for invalid conversions\n * @param inputFormat The input document format\n * @param outputFormat The desired output format\n * @returns Error message explaining why the conversion is not supported\n */\nexport function getConversionErrorMessage(\n  inputFormat: InputFormat | string,\n  outputFormat: OutputFormat | string\n): string {\n  const input = inputFormat.toLowerCase();\n  const output = outputFormat.toLowerCase();\n  const validOutputs = getValidOutputFormats(input as InputFormat);\n\n  const category = INPUT_FORMAT_CATEGORY[input as InputFormat] || 'unknown';\n\n  let reason = '';\n  if (category === 'drawing' && ['docx', 'doc', 'xlsx', 'xls', 'pptx', 'ppt'].includes(output)) {\n    reason = `PDF files are imported as Draw documents and cannot be exported to Office formats. `;\n  } else if (category === 'spreadsheet' && ['docx', 'doc', 'pptx', 'ppt'].includes(output)) {\n    reason = `Spreadsheet documents cannot be converted to word processing or presentation formats. `;\n  } else if (category === 'presentation' && ['docx', 'doc', 'xlsx', 'xls'].includes(output)) {\n    reason = `Presentation documents cannot be converted to word processing or spreadsheet formats. `;\n  } else if (category === 'text' && ['xlsx', 'xls', 'pptx', 'ppt'].includes(output)) {\n    reason = `Text documents cannot be converted to spreadsheet or presentation formats. `;\n  }\n\n  return `Cannot convert ${input.toUpperCase()} to ${output.toUpperCase()}. ${reason}Valid output formats for ${input.toUpperCase()}: ${validOutputs.join(', ')}`;\n}\n\n// ============================================\n// Shared Converter Interface\n// ============================================\n\n/**\n * Page preview data returned by renderPage/renderPagePreviews\n */\nexport interface PagePreview {\n  page: number;\n  data: Uint8Array;\n  width: number;\n  height: number;\n}\n\n/**\n * Document information returned by getDocumentInfo\n */\nexport interface DocumentInfo {\n  documentType: LOKDocumentType | number;\n  documentTypeName: string;\n  validOutputFormats: OutputFormat[];\n  pageCount: number;\n}\n\n/**\n * Options for rendering page previews\n */\nexport interface RenderOptions {\n  /** Width of rendered image in pixels */\n  width?: number;\n  /** Height of rendered image in pixels (0 = auto based on aspect ratio) */\n  height?: number;\n  /** Specific page indices to render (0-based). If empty, renders all pages */\n  pageIndices?: number[];\n  /**\n   * Render in edit mode (shows text input boxes, cursors, etc.)\n   * Default is false - presentations render in view/read mode for clean output\n   */\n  editMode?: boolean;\n}\n\n/**\n * Options for full quality page rendering\n */\nexport interface FullQualityRenderOptions {\n  /** DPI for rendering (default 150, use 300 for print quality) */\n  dpi?: number;\n  /** Maximum dimension (width or height) to prevent memory issues */\n  maxDimension?: number;\n  /**\n   * Render in edit mode (shows text input boxes, cursors, etc.)\n   * Default is false - presentations render in view/read mode for clean output\n   */\n  editMode?: boolean;\n}\n\n/**\n * Full quality page preview with DPI information\n */\nexport interface FullQualityPagePreview extends PagePreview {\n  /** Effective DPI (may differ from requested if capped) */\n  dpi: number;\n}\n\n/**\n * Editor session returned from openDocument\n */\nexport interface EditorSession {\n  sessionId: string;\n  documentType: string;\n  pageCount: number;\n}\n\n/**\n * Result from editor operations\n */\nexport interface EditorOperationResult<T = unknown> {\n  success: boolean;\n  verified?: boolean;\n  data?: T;\n  error?: string;\n  suggestion?: string;\n}\n\n/**\n * Options containing input format for document operations.\n */\nexport type InputFormatOptions = Pick<ConversionOptions, 'inputFormat'>;\n\n/**\n * Common interface for all LibreOffice converter implementations.\n * Ensures consistent API across different threading models (main thread, workers, child processes).\n *\n * All methods returning Promise are async in the interface to allow implementations\n * flexibility in whether they need actual async operations.\n */\nexport interface ILibreOfficeConverter {\n  // ============================================\n  // Lifecycle\n  // ============================================\n\n  /** Initialize the converter. Must be called before any other operations. */\n  initialize(): Promise<void>;\n\n  /** Destroy the converter and release all resources. */\n  destroy(): Promise<void>;\n\n  /** Check if the converter is ready for operations. */\n  isReady(): boolean;\n\n  // ============================================\n  // Core Conversion\n  // ============================================\n\n  /** Convert a document to a different format. */\n  convert(\n    input: Uint8Array | ArrayBuffer,\n    options: ConversionOptions,\n    filename?: string\n  ): Promise<ConversionResult>;\n\n  // ============================================\n  // Document Inspection\n  // ============================================\n\n  /** Get the number of pages in a document. */\n  getPageCount(\n    input: Uint8Array | ArrayBuffer,\n    options: InputFormatOptions\n  ): Promise<number>;\n\n  /** Get document information including type and valid output formats. */\n  getDocumentInfo(\n    input: Uint8Array | ArrayBuffer,\n    options: InputFormatOptions\n  ): Promise<DocumentInfo>;\n\n  // ============================================\n  // Page Rendering\n  // ============================================\n\n  /** Render a single page as an image. */\n  renderPage(\n    input: Uint8Array | ArrayBuffer,\n    options: InputFormatOptions,\n    pageIndex: number,\n    width: number,\n    height?: number\n  ): Promise<PagePreview>;\n\n  /** Render multiple pages as images. */\n  renderPagePreviews(\n    input: Uint8Array | ArrayBuffer,\n    options: InputFormatOptions,\n    renderOptions?: RenderOptions\n  ): Promise<PagePreview[]>;\n\n  /**\n   * Render a page at full quality (native resolution based on DPI).\n   * Unlike renderPage which scales to a fixed width, this renders at the\n   * document's native resolution converted to pixels at the specified DPI.\n   */\n  renderPageFullQuality(\n    input: Uint8Array | ArrayBuffer,\n    options: InputFormatOptions,\n    pageIndex: number,\n    renderOptions?: FullQualityRenderOptions\n  ): Promise<FullQualityPagePreview>;\n\n  // ============================================\n  // Editor Operations\n  // ============================================\n\n  /** Open a document for editing and return a session. */\n  openDocument(\n    input: Uint8Array | ArrayBuffer,\n    options: InputFormatOptions\n  ): Promise<EditorSession>;\n\n  /** Execute an editor operation on an open document. */\n  editorOperation<T = unknown>(\n    sessionId: string,\n    method: string,\n    args?: unknown[]\n  ): Promise<EditorOperationResult<T>>;\n\n  /** Close an editor session and optionally get the modified document. */\n  closeDocument(sessionId: string): Promise<Uint8Array | undefined>;\n}\n","// src/editor/base.ts\nimport type { LOKBindings } from '../lok-bindings.js';\nimport type { OutputFormat } from '../types.js';\nimport type {\n  OperationResult,\n  DocumentStructure,\n  OpenDocumentOptions,\n  SelectionRange,\n  FindOptions,\n  Position,\n  TruncationInfo,\n  CellRef,\n} from './types.js';\n\n/**\n * Abstract base class for all document editors\n */\nexport abstract class OfficeEditor {\n  protected lok: LOKBindings;\n  protected docPtr: number;\n  protected options: Required<Pick<OpenDocumentOptions, 'maxResponseChars'>> & OpenDocumentOptions;\n  protected inputPath: string = '';\n\n  constructor(lok: LOKBindings, docPtr: number, options: OpenDocumentOptions = {}) {\n    this.lok = lok;\n    this.docPtr = docPtr;\n    this.options = {\n      maxResponseChars: options.maxResponseChars ?? 8000,\n      ...options,\n    };\n  }\n\n  // ============================================\n  // Abstract methods (implemented by subclasses)\n  // ============================================\n\n  abstract getStructure(options?: { maxResponseChars?: number }): OperationResult<DocumentStructure>;\n  abstract getDocumentType(): 'writer' | 'calc' | 'impress' | 'draw';\n\n  // ============================================\n  // Accessor methods\n  // ============================================\n\n  /**\n   * Get the document pointer for low-level LOK operations\n   */\n  getDocPtr(): number {\n    return this.docPtr;\n  }\n\n  /**\n   * Get the LOK bindings for low-level operations\n   */\n  getLokBindings(): LOKBindings {\n    return this.lok;\n  }\n\n  // ============================================\n  // Lifecycle methods\n  // ============================================\n\n  save(): OperationResult<{ path: string }> {\n    try {\n      // Save to the original path\n      if (!this.inputPath) {\n        return this.createErrorResult('No input path set', 'Use saveAs() to specify a path');\n      }\n      // LibreOffice auto-saves on document operations, but we can force it\n      this.lok.postUnoCommand(this.docPtr, '.uno:Save');\n      return this.createResult({ path: this.inputPath });\n    } catch (error) {\n      return this.createErrorResult(`Save failed: ${String(error)}`);\n    }\n  }\n\n  saveAs(path: string, format: OutputFormat): OperationResult<{ path: string }> {\n    try {\n      this.lok.documentSaveAs(this.docPtr, path, format, '');\n      return this.createResult({ path });\n    } catch (error) {\n      return this.createErrorResult(`SaveAs failed: ${String(error)}`);\n    }\n  }\n\n  close(): OperationResult<void> {\n    try {\n      this.lok.documentDestroy(this.docPtr);\n      this.docPtr = 0;\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Close failed: ${String(error)}`);\n    }\n  }\n\n  /**\n   * Get the current edit mode of the document\n   * @returns 0 = view mode, 1 = edit mode\n   */\n  getEditMode(): number {\n    return this.lok.getEditMode(this.docPtr);\n  }\n\n  /**\n   * Attempt to enable edit mode for the document\n   * @returns OperationResult with success and verified fields\n   */\n  enableEditMode(): OperationResult<{ editMode: number }> {\n    try {\n      const beforeMode = this.lok.getEditMode(this.docPtr);\n      if (beforeMode === 1) {\n        // Already in edit mode\n        return this.createResult({ editMode: 1 });\n      }\n\n      // Try .uno:Edit command to switch to edit mode\n      this.lok.postUnoCommand(this.docPtr, '.uno:Edit');\n\n      const afterMode = this.lok.getEditMode(this.docPtr);\n      return {\n        success: true,\n        verified: afterMode === 1,\n        data: { editMode: afterMode },\n      };\n    } catch (error) {\n      return this.createErrorResult(`Failed to enable edit mode: ${String(error)}`);\n    }\n  }\n\n  // ============================================\n  // History methods\n  // ============================================\n\n  undo(): OperationResult<void> {\n    try {\n      this.lok.postUnoCommand(this.docPtr, '.uno:Undo');\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Undo failed: ${String(error)}`);\n    }\n  }\n\n  redo(): OperationResult<void> {\n    try {\n      this.lok.postUnoCommand(this.docPtr, '.uno:Redo');\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Redo failed: ${String(error)}`);\n    }\n  }\n\n  // ============================================\n  // Search methods\n  // ============================================\n\n  find(text: string, options?: FindOptions): OperationResult<{ matches: number; firstMatch?: Position }> {\n    try {\n      const searchArgs = JSON.stringify({\n        'SearchItem.SearchString': { type: 'string', value: text },\n        'SearchItem.Backward': { type: 'boolean', value: false },\n        'SearchItem.SearchAll': { type: 'boolean', value: true },\n        'SearchItem.MatchCase': { type: 'boolean', value: options?.caseSensitive ?? false },\n        'SearchItem.WordOnly': { type: 'boolean', value: options?.wholeWord ?? false },\n      });\n\n      this.lok.postUnoCommand(this.docPtr, '.uno:ExecuteSearch', searchArgs);\n\n      // Get search results - this is approximate as LOK doesn't return match count directly\n      const selection = this.lok.getTextSelection(this.docPtr, 'text/plain');\n      const hasMatch = selection !== null && selection.length > 0;\n\n      return this.createResult({\n        matches: hasMatch ? 1 : 0, // LOK doesn't provide count, we report if found\n        firstMatch: hasMatch ? { x: 0, y: 0 } : undefined,\n      });\n    } catch (error) {\n      return this.createErrorResult(`Find failed: ${String(error)}`);\n    }\n  }\n\n  findAndReplaceAll(find: string, replace: string, options?: FindOptions): OperationResult<{ replacements: number }> {\n    try {\n      const searchArgs = JSON.stringify({\n        'SearchItem.SearchString': { type: 'string', value: find },\n        'SearchItem.ReplaceString': { type: 'string', value: replace },\n        'SearchItem.Command': { type: 'long', value: 3 }, // Replace All\n        'SearchItem.MatchCase': { type: 'boolean', value: options?.caseSensitive ?? false },\n        'SearchItem.WordOnly': { type: 'boolean', value: options?.wholeWord ?? false },\n      });\n\n      this.lok.postUnoCommand(this.docPtr, '.uno:ExecuteSearch', searchArgs);\n\n      // LOK doesn't return replacement count, we assume success\n      return this.createResult({ replacements: -1 }); // -1 indicates unknown count\n    } catch (error) {\n      return this.createErrorResult(`Replace failed: ${String(error)}`);\n    }\n  }\n\n  // ============================================\n  // Callback-based state retrieval\n  // ============================================\n\n  /**\n   * Poll all STATE_CHANGED callback events and return as a map.\n   *\n   * LOK sends STATE_CHANGED events when formatting state changes (e.g., when\n   * the cursor moves over bold text, `.uno:Bold=true` is emitted).\n   *\n   * Pattern for getting current format state:\n   * 1. clearCallbackQueue() - clear any stale events\n   * 2. Perform action that triggers state change (e.g., SelectWord)\n   * 3. flushCallbacks(docPtr) - force LOK to process callbacks\n   * 4. pollStateChanges() - retrieve the events\n   *\n   * @returns Map of UNO command names to their state values\n   *          e.g., Map { '.uno:Bold' => 'true', '.uno:Italic' => 'false' }\n   */\n  getStateChanges(): OperationResult<Map<string, string>> {\n    try {\n      const states = this.lok.pollStateChanges();\n      return this.createResult(states);\n    } catch (error) {\n      return this.createErrorResult(`Failed to poll state changes: ${String(error)}`);\n    }\n  }\n\n  /**\n   * Flush pending LOK callbacks and then poll for state changes.\n   * Convenience method that combines flushCallbacks + pollStateChanges.\n   *\n   * @returns Map of UNO command names to their state values\n   */\n  flushAndPollState(): OperationResult<Map<string, string>> {\n    try {\n      this.lok.flushCallbacks(this.docPtr);\n      const states = this.lok.pollStateChanges();\n      return this.createResult(states);\n    } catch (error) {\n      return this.createErrorResult(`Failed to flush and poll state: ${String(error)}`);\n    }\n  }\n\n  /**\n   * Clear the callback queue, useful before performing operations\n   * where you want to capture only new state changes.\n   */\n  clearCallbackQueue(): void {\n    this.lok.clearCallbackQueue();\n  }\n\n  // ============================================\n  // Selection methods\n  // ============================================\n\n  select(_selection: SelectionRange): OperationResult<{ selected: string }> {\n    try {\n      // Implementation depends on selection type - subclasses may override\n      // Base implementation just returns current selection\n      const text = this.lok.getTextSelection(this.docPtr, 'text/plain');\n      return this.createResult({ selected: text || '' });\n    } catch (error) {\n      return this.createErrorResult(`Select failed: ${String(error)}`);\n    }\n  }\n\n  getSelection(): OperationResult<{ text: string; range: SelectionRange }> {\n    try {\n      const text = this.lok.getTextSelection(this.docPtr, 'text/plain');\n      return this.createResult({\n        text: text || '',\n        range: { type: 'text', start: { paragraph: 0, character: 0 } },\n      });\n    } catch (error) {\n      return this.createErrorResult(`GetSelection failed: ${String(error)}`);\n    }\n  }\n\n  clearSelection(): OperationResult<void> {\n    try {\n      this.lok.resetSelection(this.docPtr);\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`ClearSelection failed: ${String(error)}`);\n    }\n  }\n\n  // ============================================\n  // Protected helper methods\n  // ============================================\n\n  protected createResult<T>(data: T): OperationResult<T> {\n    return {\n      success: true,\n      verified: true,\n      data,\n    };\n  }\n\n  protected createErrorResult<T>(error: string, suggestion?: string): OperationResult<T> {\n    return {\n      success: false,\n      verified: false,\n      error,\n      suggestion,\n    };\n  }\n\n  protected createResultWithTruncation<T>(data: T, truncation?: TruncationInfo): OperationResult<T> {\n    return {\n      success: true,\n      verified: true,\n      data,\n      truncated: truncation,\n    };\n  }\n\n  protected truncateContent(content: string, maxChars?: number): {\n    content: string;\n    truncated: boolean;\n    original: number;\n    returned: number;\n  } {\n    const limit = maxChars ?? this.options.maxResponseChars;\n    const original = content.length;\n\n    if (original <= limit) {\n      return { content, truncated: false, original, returned: original };\n    }\n\n    // Truncate at a word boundary if possible\n    let truncated = content.slice(0, limit);\n    const lastSpace = truncated.lastIndexOf(' ');\n    if (lastSpace > limit * 0.8) {\n      truncated = truncated.slice(0, lastSpace);\n    }\n\n    return {\n      content: truncated,\n      truncated: true,\n      original,\n      returned: truncated.length,\n    };\n  }\n\n  protected truncateArray<T>(items: T[], maxChars: number, itemToString: (item: T) => string): {\n    items: T[];\n    truncated: boolean;\n    original: number;\n    returned: number;\n  } {\n    const original = items.length;\n    let charCount = 0;\n    let includedCount = 0;\n\n    for (const item of items) {\n      const itemStr = itemToString(item);\n      if (charCount + itemStr.length > maxChars) {\n        break;\n      }\n      charCount += itemStr.length;\n      includedCount++;\n    }\n\n    return {\n      items: items.slice(0, includedCount),\n      truncated: includedCount < original,\n      original,\n      returned: includedCount,\n    };\n  }\n\n  // ============================================\n  // Cell address helpers\n  // ============================================\n\n  protected a1ToRowCol(a1: string): { row: number; col: number } {\n    const match = a1.match(/^([A-Z]+)(\\d+)$/i);\n    if (!match) {\n      throw new Error(`Invalid A1 notation: ${a1}`);\n    }\n\n    const colStr = match[1]!.toUpperCase();\n    const rowStr = match[2]!;\n\n    let col = 0;\n    for (let i = 0; i < colStr.length; i++) {\n      col = col * 26 + (colStr.charCodeAt(i) - 64);\n    }\n    col -= 1; // 0-indexed\n\n    const row = parseInt(rowStr, 10) - 1; // 0-indexed\n\n    return { row, col };\n  }\n\n  protected rowColToA1(row: number, col: number): string {\n    let colStr = '';\n    let c = col + 1; // 1-indexed for conversion\n\n    while (c > 0) {\n      const remainder = (c - 1) % 26;\n      colStr = String.fromCharCode(65 + remainder) + colStr;\n      c = Math.floor((c - 1) / 26);\n    }\n\n    return `${colStr}${row + 1}`;\n  }\n\n  protected normalizeCellRef(ref: CellRef): { row: number; col: number } {\n    if (typeof ref === 'string') {\n      return this.a1ToRowCol(ref);\n    }\n    return ref;\n  }\n\n  // ============================================\n  // Internal state\n  // ============================================\n\n  setInputPath(path: string): void {\n    this.inputPath = path;\n  }\n\n  isOpen(): boolean {\n    return this.docPtr !== 0;\n  }\n}\n","// src/editor/writer.ts\nimport { OfficeEditor } from './base.js';\nimport type {\n  OperationResult,\n  WriterStructure,\n  Paragraph,\n  TextPosition,\n  TextRange,\n  TextFormat,\n} from './types.js';\n\n/**\n * Editor for Writer (text) documents\n */\nexport class WriterEditor extends OfficeEditor {\n  private cachedParagraphs: string[] | null = null;\n\n  getDocumentType(): 'writer' {\n    return 'writer';\n  }\n\n  getStructure(options?: { maxResponseChars?: number }): OperationResult<WriterStructure> {\n    try {\n      const paragraphs = this.getParagraphsInternal();\n      const maxChars = options?.maxResponseChars ?? this.options.maxResponseChars;\n\n      const paragraphInfos = paragraphs.map((text, index) => ({\n        index,\n        preview: text.slice(0, 100) + (text.length > 100 ? '...' : ''),\n        style: 'Normal', // Would need UNO query to get actual style\n        charCount: text.length,\n      }));\n\n      // Truncate if needed\n      const truncResult = this.truncateArray(\n        paragraphInfos,\n        maxChars,\n        (p) => JSON.stringify(p)\n      );\n\n      const structure: WriterStructure = {\n        type: 'writer',\n        paragraphs: truncResult.items,\n        pageCount: this.lok.documentGetParts(this.docPtr),\n        wordCount: paragraphs.join(' ').split(/\\s+/).filter(w => w.length > 0).length,\n      };\n\n      if (truncResult.truncated) {\n        return this.createResultWithTruncation(structure, {\n          original: truncResult.original,\n          returned: truncResult.returned,\n          message: `Showing ${truncResult.returned} of ${truncResult.original} paragraphs. Use getParagraphs(start, count) to paginate.`,\n        });\n      }\n\n      return this.createResult(structure);\n    } catch (error) {\n      return this.createErrorResult(`Failed to get structure: ${String(error)}`);\n    }\n  }\n\n  getParagraph(index: number): OperationResult<Paragraph> {\n    try {\n      const paragraphs = this.getParagraphsInternal();\n\n      if (index < 0 || index >= paragraphs.length) {\n        return this.createErrorResult(\n          `Paragraph index ${index} out of range (0-${paragraphs.length - 1})`,\n          `Use getStructure() to see available paragraphs`\n        );\n      }\n\n      const text = paragraphs[index]!;\n      return this.createResult({\n        index,\n        text,\n        style: 'Normal',\n        charCount: text.length,\n      });\n    } catch (error) {\n      return this.createErrorResult(`Failed to get paragraph: ${String(error)}`);\n    }\n  }\n\n  getParagraphs(start: number, count: number): OperationResult<Paragraph[]> {\n    try {\n      const paragraphs = this.getParagraphsInternal();\n\n      if (start < 0 || start >= paragraphs.length) {\n        return this.createErrorResult(\n          `Start index ${start} out of range`,\n          `Valid range: 0-${paragraphs.length - 1}`\n        );\n      }\n\n      const end = Math.min(start + count, paragraphs.length);\n      const result = paragraphs.slice(start, end).map((text, i) => ({\n        index: start + i,\n        text,\n        style: 'Normal',\n        charCount: text.length,\n      }));\n\n      return this.createResult(result);\n    } catch (error) {\n      return this.createErrorResult(`Failed to get paragraphs: ${String(error)}`);\n    }\n  }\n\n  insertParagraph(text: string, options?: {\n    afterIndex?: number;\n    style?: 'Normal' | 'Heading 1' | 'Heading 2' | 'Heading 3' | 'List';\n  }): OperationResult<{ index: number }> {\n    try {\n      const paragraphs = this.getParagraphsInternal();\n      const insertIndex = options?.afterIndex !== undefined\n        ? options.afterIndex + 1\n        : paragraphs.length;\n\n      // Move to end of target paragraph or document end\n      if (insertIndex > 0 && insertIndex <= paragraphs.length) {\n        // Navigate to position\n        this.lok.postUnoCommand(this.docPtr, '.uno:GoToEndOfDoc');\n      }\n\n      // Insert paragraph break and text\n      this.lok.postUnoCommand(this.docPtr, '.uno:InsertPara');\n\n      // Insert the text\n      const textArgs = JSON.stringify({\n        Text: { type: 'string', value: text },\n      });\n      this.lok.postUnoCommand(this.docPtr, '.uno:InsertText', textArgs);\n\n      // Apply style if specified\n      if (options?.style && options.style !== 'Normal') {\n        const styleMap: Record<string, string> = {\n          'Heading 1': 'Heading 1',\n          'Heading 2': 'Heading 2',\n          'Heading 3': 'Heading 3',\n          'List': 'List',\n        };\n        const styleName = styleMap[options.style];\n        if (styleName) {\n          const styleArgs = JSON.stringify({\n            Template: { type: 'string', value: styleName },\n            Family: { type: 'short', value: 2 }, // Paragraph styles\n          });\n          this.lok.postUnoCommand(this.docPtr, '.uno:StyleApply', styleArgs);\n        }\n      }\n\n      // Invalidate cache\n      this.cachedParagraphs = null;\n\n      // Verify by re-reading\n      const newParagraphs = this.getParagraphsInternal();\n      const verified = newParagraphs.length > paragraphs.length;\n\n      return {\n        success: true,\n        verified,\n        data: { index: insertIndex },\n      };\n    } catch (error) {\n      return this.createErrorResult(`Failed to insert paragraph: ${String(error)}`);\n    }\n  }\n\n  replaceParagraph(index: number, text: string): OperationResult<{ oldText: string }> {\n    try {\n      const paragraphs = this.getParagraphsInternal();\n\n      if (index < 0 || index >= paragraphs.length) {\n        return this.createErrorResult(\n          `Paragraph index ${index} out of range`,\n          `Valid range: 0-${paragraphs.length - 1}`\n        );\n      }\n\n      const oldText = paragraphs[index]!;\n\n      // Select the paragraph and replace\n      // This is a simplified implementation - full implementation would use cursor positioning\n      const findReplaceArgs = JSON.stringify({\n        'SearchItem.SearchString': { type: 'string', value: oldText },\n        'SearchItem.ReplaceString': { type: 'string', value: text },\n        'SearchItem.Command': { type: 'long', value: 2 }, // Replace\n      });\n      this.lok.postUnoCommand(this.docPtr, '.uno:ExecuteSearch', findReplaceArgs);\n\n      // Invalidate cache\n      this.cachedParagraphs = null;\n\n      return this.createResult({ oldText });\n    } catch (error) {\n      return this.createErrorResult(`Failed to replace paragraph: ${String(error)}`);\n    }\n  }\n\n  deleteParagraph(index: number): OperationResult<{ deletedText: string }> {\n    try {\n      const paragraphs = this.getParagraphsInternal();\n\n      if (index < 0 || index >= paragraphs.length) {\n        return this.createErrorResult(\n          `Paragraph index ${index} out of range`,\n          `Valid range: 0-${paragraphs.length - 1}`\n        );\n      }\n\n      const deletedText = paragraphs[index]!;\n\n      // Replace with empty string\n      const result = this.replaceParagraph(index, '');\n      if (!result.success) {\n        return this.createErrorResult(result.error || 'Failed to delete');\n      }\n\n      return this.createResult({ deletedText });\n    } catch (error) {\n      return this.createErrorResult(`Failed to delete paragraph: ${String(error)}`);\n    }\n  }\n\n  insertText(text: string, _position: TextPosition): OperationResult<void> {\n    try {\n      // TODO: Navigate to position using cursor before inserting\n      const textArgs = JSON.stringify({\n        Text: { type: 'string', value: text },\n      });\n      this.lok.postUnoCommand(this.docPtr, '.uno:InsertText', textArgs);\n\n      this.cachedParagraphs = null;\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Failed to insert text: ${String(error)}`);\n    }\n  }\n\n  deleteText(_start: TextPosition, _end: TextPosition): OperationResult<{ deleted: string }> {\n    try {\n      // TODO: Use start/end to select text range before deleting\n      // Get current selection\n      const selection = this.lok.getTextSelection(this.docPtr, 'text/plain');\n\n      // Delete selection\n      this.lok.postUnoCommand(this.docPtr, '.uno:Delete');\n\n      this.cachedParagraphs = null;\n      return this.createResult({ deleted: selection || '' });\n    } catch (error) {\n      return this.createErrorResult(`Failed to delete text: ${String(error)}`);\n    }\n  }\n\n  replaceText(find: string, replace: string, options?: {\n    paragraph?: number;\n    all?: boolean;\n  }): OperationResult<{ replacements: number }> {\n    try {\n      const command = options?.all ? 3 : 2; // 3 = Replace All, 2 = Replace\n\n      const searchArgs = JSON.stringify({\n        'SearchItem.SearchString': { type: 'string', value: find },\n        'SearchItem.ReplaceString': { type: 'string', value: replace },\n        'SearchItem.Command': { type: 'long', value: command },\n      });\n\n      this.lok.postUnoCommand(this.docPtr, '.uno:ExecuteSearch', searchArgs);\n\n      this.cachedParagraphs = null;\n\n      // LOK doesn't return count, we indicate success\n      return this.createResult({ replacements: -1 });\n    } catch (error) {\n      return this.createErrorResult(`Failed to replace text: ${String(error)}`);\n    }\n  }\n\n  formatText(_range: TextRange, format: TextFormat): OperationResult<void> {\n    try {\n      // TODO: Use range to select text before applying format\n      // Apply formatting commands\n      if (format.bold !== undefined) {\n        this.lok.postUnoCommand(this.docPtr, '.uno:Bold');\n      }\n      if (format.italic !== undefined) {\n        this.lok.postUnoCommand(this.docPtr, '.uno:Italic');\n      }\n      if (format.underline !== undefined) {\n        this.lok.postUnoCommand(this.docPtr, '.uno:Underline');\n      }\n      if (format.fontSize !== undefined) {\n        const args = JSON.stringify({\n          FontHeight: { type: 'float', value: format.fontSize },\n        });\n        this.lok.postUnoCommand(this.docPtr, '.uno:FontHeight', args);\n      }\n      if (format.fontName !== undefined) {\n        const args = JSON.stringify({\n          CharFontName: { type: 'string', value: format.fontName },\n        });\n        this.lok.postUnoCommand(this.docPtr, '.uno:CharFontName', args);\n      }\n\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Failed to format text: ${String(error)}`);\n    }\n  }\n\n  /**\n   * Get the text formatting at the current selection or cursor position.\n   *\n   * Uses LOK callback mechanism to retrieve STATE_CHANGED events which contain\n   * formatting state like `.uno:Bold=true`, `.uno:Italic=false`, etc.\n   *\n   * @param _position - Text position (currently unused, uses current selection)\n   * @returns TextFormat with bold, italic, underline, fontSize, fontName properties\n   */\n  getFormat(_position?: TextPosition): OperationResult<TextFormat> {\n    try {\n      // Clear any existing callback events\n      this.lok.clearCallbackQueue();\n\n      // Trigger a selection change to get current formatting state\n      // Moving cursor slightly and back triggers STATE_CHANGED callbacks\n      this.lok.postUnoCommand(this.docPtr, '.uno:CharRightSel');\n      this.lok.flushCallbacks(this.docPtr);\n      this.lok.postUnoCommand(this.docPtr, '.uno:CharLeft');\n      this.lok.flushCallbacks(this.docPtr);\n\n      // Poll STATE_CHANGED events to get formatting state\n      const states = this.lok.pollStateChanges();\n\n      // Parse the state values into TextFormat\n      const format: TextFormat = {};\n\n      // Bold: .uno:Bold=true or .uno:Bold=false\n      const boldState = states.get('.uno:Bold');\n      if (boldState !== undefined) {\n        format.bold = boldState === 'true';\n      }\n\n      // Italic: .uno:Italic=true or .uno:Italic=false\n      const italicState = states.get('.uno:Italic');\n      if (italicState !== undefined) {\n        format.italic = italicState === 'true';\n      }\n\n      // Underline: .uno:Underline=true or .uno:Underline=false\n      const underlineState = states.get('.uno:Underline');\n      if (underlineState !== undefined) {\n        format.underline = underlineState === 'true';\n      }\n\n      // Font size: .uno:FontHeight=12\n      const fontSizeState = states.get('.uno:FontHeight');\n      if (fontSizeState !== undefined) {\n        const size = parseFloat(fontSizeState);\n        if (!isNaN(size)) {\n          format.fontSize = size;\n        }\n      }\n\n      // Font name: .uno:CharFontName=Arial\n      const fontNameState = states.get('.uno:CharFontName');\n      if (fontNameState !== undefined && fontNameState.length > 0) {\n        format.fontName = fontNameState;\n      }\n\n      return this.createResult(format);\n    } catch (error) {\n      return this.createErrorResult(`Failed to get format: ${String(error)}`);\n    }\n  }\n\n  /**\n   * Get formatting state for the current selection using the callback mechanism.\n   * This is the preferred way to get character formatting as it uses LOK's\n   * STATE_CHANGED callback events.\n   *\n   * @returns Map of UNO command names to their state values\n   */\n  getSelectionFormat(): OperationResult<Map<string, string>> {\n    try {\n      // Poll any existing STATE_CHANGED events (from previous operations)\n      const existingStates = this.lok.pollStateChanges();\n\n      if (existingStates.size === 0) {\n        // No existing states, trigger a selection to get current format\n        this.lok.clearCallbackQueue();\n        this.lok.postUnoCommand(this.docPtr, '.uno:SelectWord');\n        this.lok.flushCallbacks(this.docPtr);\n        const states = this.lok.pollStateChanges();\n        return this.createResult(states);\n      }\n\n      return this.createResult(existingStates);\n    } catch (error) {\n      return this.createErrorResult(`Failed to get selection format: ${String(error)}`);\n    }\n  }\n\n  // ============================================\n  // Private helpers\n  // ============================================\n\n  private getParagraphsInternal(): string[] {\n    if (this.cachedParagraphs) {\n      return this.cachedParagraphs;\n    }\n\n    const allText = this.lok.getAllText(this.docPtr);\n    if (!allText) {\n      return [];\n    }\n\n    // Split by double newlines (paragraph breaks) or single newlines\n    this.cachedParagraphs = allText\n      .split(/\\n\\n|\\r\\n\\r\\n/)\n      .map(p => p.trim())\n      .filter(p => p.length > 0);\n\n    return this.cachedParagraphs;\n  }\n}\n","// src/editor/calc.ts\nimport { OfficeEditor } from './base.js';\nimport type {\n  OperationResult,\n  CalcStructure,\n  CellRef,\n  RangeRef,\n  SheetRef,\n  ColRef,\n  CellData,\n  CellValue,\n  CellFormat,\n  SheetInfo,\n} from './types.js';\n\n/**\n * Editor for Calc (spreadsheet) documents\n */\nexport class CalcEditor extends OfficeEditor {\n  getDocumentType(): 'calc' {\n    return 'calc';\n  }\n\n  getStructure(_options?: { maxResponseChars?: number }): OperationResult<CalcStructure> {\n    try {\n      const numSheets = this.lok.documentGetParts(this.docPtr);\n      const sheets: SheetInfo[] = [];\n\n      for (let i = 0; i < numSheets; i++) {\n        const name = this.lok.getPartName(this.docPtr, i) || `Sheet${i + 1}`;\n        const dataArea = this.lok.getDataArea(this.docPtr, i);\n\n        sheets.push({\n          index: i,\n          name,\n          usedRange: dataArea.col > 0 && dataArea.row > 0\n            ? `A1:${this.rowColToA1(dataArea.row - 1, dataArea.col - 1)}`\n            : 'A1',\n          rowCount: dataArea.row,\n          colCount: dataArea.col,\n        });\n      }\n\n      const structure: CalcStructure = {\n        type: 'calc',\n        sheets,\n      };\n\n      return this.createResult(structure);\n    } catch (error) {\n      return this.createErrorResult(`Failed to get structure: ${String(error)}`);\n    }\n  }\n\n  getSheetNames(): OperationResult<string[]> {\n    try {\n      const numSheets = this.lok.documentGetParts(this.docPtr);\n      const names: string[] = [];\n\n      for (let i = 0; i < numSheets; i++) {\n        const name = this.lok.getPartName(this.docPtr, i) || `Sheet${i + 1}`;\n        names.push(name);\n      }\n\n      return this.createResult(names);\n    } catch (error) {\n      return this.createErrorResult(`Failed to get sheet names: ${String(error)}`);\n    }\n  }\n\n  // ============================================\n  // Cell reading\n  // ============================================\n\n  getCell(cell: CellRef, sheet?: SheetRef): OperationResult<CellData> {\n    try {\n      this.selectSheet(sheet);\n      const { row, col } = this.normalizeCellRef(cell);\n      const address = this.rowColToA1(row, col);\n\n      // Navigate to cell\n      this.goToCell(address);\n\n      // Get value\n      const value = this.getCellValueInternal();\n      const formula = this.getCellFormulaInternal();\n\n      return this.createResult({\n        address,\n        value,\n        formula: formula || undefined,\n      });\n    } catch (error) {\n      return this.createErrorResult(`Failed to get cell: ${String(error)}`);\n    }\n  }\n\n  getCells(range: RangeRef, sheet?: SheetRef, options?: {\n    maxResponseChars?: number;\n  }): OperationResult<CellData[][]> {\n    try {\n      this.selectSheet(sheet);\n      const { startRow, startCol, endRow, endCol } = this.normalizeRangeRef(range);\n      const maxChars = options?.maxResponseChars ?? this.options.maxResponseChars;\n\n      const cells: CellData[][] = [];\n      let charCount = 0;\n      let truncated = false;\n\n      for (let r = startRow; r <= endRow && !truncated; r++) {\n        const rowData: CellData[] = [];\n\n        for (let c = startCol; c <= endCol && !truncated; c++) {\n          const address = this.rowColToA1(r, c);\n          this.goToCell(address);\n\n          const value = this.getCellValueInternal();\n          const cellData: CellData = { address, value };\n\n          const cellStr = JSON.stringify(cellData);\n          if (charCount + cellStr.length > maxChars) {\n            truncated = true;\n            break;\n          }\n\n          charCount += cellStr.length;\n          rowData.push(cellData);\n        }\n\n        if (rowData.length > 0) {\n          cells.push(rowData);\n        }\n      }\n\n      if (truncated) {\n        return this.createResultWithTruncation(cells, {\n          original: (endRow - startRow + 1) * (endCol - startCol + 1),\n          returned: cells.reduce((sum, row) => sum + row.length, 0),\n          message: 'Range truncated due to size. Use smaller ranges to paginate.',\n        });\n      }\n\n      return this.createResult(cells);\n    } catch (error) {\n      return this.createErrorResult(`Failed to get cells: ${String(error)}`);\n    }\n  }\n\n  // ============================================\n  // Cell writing\n  // ============================================\n\n  setCellValue(cell: CellRef, value: string | number, sheet?: SheetRef): OperationResult<{\n    oldValue: CellValue;\n    newValue: CellValue;\n  }> {\n    try {\n      this.selectSheet(sheet);\n      const { row, col } = this.normalizeCellRef(cell);\n      const address = this.rowColToA1(row, col);\n\n      // Get old value first\n      this.goToCell(address);\n      const oldValue = this.getCellValueInternal();\n\n      // Enter the new value\n      const valueStr = typeof value === 'number' ? value.toString() : value;\n      const args = JSON.stringify({\n        StringName: { type: 'string', value: valueStr },\n      });\n      this.lok.postUnoCommand(this.docPtr, '.uno:EnterString', args);\n\n      // Verify by re-reading the cell\n      const newValue = this.getCellValueInternal();\n      const expectedStr = typeof value === 'number' ? value.toString() : value;\n      const verified = newValue === expectedStr || newValue === value;\n\n      return {\n        success: true,\n        verified,\n        data: { oldValue, newValue },\n      };\n    } catch (error) {\n      return this.createErrorResult(`Failed to set cell value: ${String(error)}`);\n    }\n  }\n\n  setCellFormula(cell: CellRef, formula: string, sheet?: SheetRef): OperationResult<{\n    calculatedValue: CellValue;\n  }> {\n    try {\n      this.selectSheet(sheet);\n      const { row, col } = this.normalizeCellRef(cell);\n      const address = this.rowColToA1(row, col);\n\n      // Navigate and enter formula\n      this.goToCell(address);\n\n      const args = JSON.stringify({\n        StringName: { type: 'string', value: formula },\n      });\n      this.lok.postUnoCommand(this.docPtr, '.uno:EnterString', args);\n\n      // Get calculated value\n      const calculatedValue = this.getCellValueInternal();\n\n      return this.createResult({ calculatedValue });\n    } catch (error) {\n      return this.createErrorResult(`Failed to set formula: ${String(error)}`);\n    }\n  }\n\n  setCells(range: RangeRef, values: CellValue[][], sheet?: SheetRef): OperationResult<{\n    cellsUpdated: number;\n  }> {\n    try {\n      this.selectSheet(sheet);\n      const { startRow, startCol } = this.normalizeRangeRef(range);\n      let cellsUpdated = 0;\n\n      for (let r = 0; r < values.length; r++) {\n        const rowValues = values[r];\n        if (!rowValues) continue;\n\n        for (let c = 0; c < rowValues.length; c++) {\n          const value = rowValues[c];\n          if (value === null || value === undefined) continue;\n\n          const address = this.rowColToA1(startRow + r, startCol + c);\n          this.goToCell(address);\n\n          const valueStr = typeof value === 'number' ? value.toString() : String(value);\n          const args = JSON.stringify({\n            StringName: { type: 'string', value: valueStr },\n          });\n          this.lok.postUnoCommand(this.docPtr, '.uno:EnterString', args);\n          cellsUpdated++;\n        }\n      }\n\n      return this.createResult({ cellsUpdated });\n    } catch (error) {\n      return this.createErrorResult(`Failed to set cells: ${String(error)}`);\n    }\n  }\n\n  // ============================================\n  // Clear operations\n  // ============================================\n\n  clearCell(cell: CellRef, sheet?: SheetRef): OperationResult<{ oldValue: CellValue }> {\n    try {\n      this.selectSheet(sheet);\n      const { row, col } = this.normalizeCellRef(cell);\n      const address = this.rowColToA1(row, col);\n\n      this.goToCell(address);\n      const oldValue = this.getCellValueInternal();\n\n      this.lok.postUnoCommand(this.docPtr, '.uno:ClearContents');\n\n      return this.createResult({ oldValue });\n    } catch (error) {\n      return this.createErrorResult(`Failed to clear cell: ${String(error)}`);\n    }\n  }\n\n  clearRange(range: RangeRef, sheet?: SheetRef): OperationResult<{ cellsCleared: number }> {\n    try {\n      this.selectSheet(sheet);\n      const rangeStr = this.normalizeRangeToString(range);\n\n      // Select range and clear\n      this.goToCell(rangeStr);\n      this.lok.postUnoCommand(this.docPtr, '.uno:ClearContents');\n\n      // Count is approximate\n      const { startRow, startCol, endRow, endCol } = this.normalizeRangeRef(range);\n      const cellsCleared = (endRow - startRow + 1) * (endCol - startCol + 1);\n\n      return this.createResult({ cellsCleared });\n    } catch (error) {\n      return this.createErrorResult(`Failed to clear range: ${String(error)}`);\n    }\n  }\n\n  // ============================================\n  // Row/Column operations\n  // ============================================\n\n  insertRow(afterRow: number, sheet?: SheetRef): OperationResult<void> {\n    try {\n      this.selectSheet(sheet);\n      this.goToCell(this.rowColToA1(afterRow + 1, 0));\n      this.lok.postUnoCommand(this.docPtr, '.uno:InsertRows');\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Failed to insert row: ${String(error)}`);\n    }\n  }\n\n  insertColumn(afterCol: ColRef, sheet?: SheetRef): OperationResult<void> {\n    try {\n      this.selectSheet(sheet);\n      const colNum = typeof afterCol === 'string'\n        ? this.a1ToRowCol(afterCol + '1').col + 1\n        : afterCol + 1;\n\n      this.goToCell(this.rowColToA1(0, colNum));\n      this.lok.postUnoCommand(this.docPtr, '.uno:InsertColumns');\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Failed to insert column: ${String(error)}`);\n    }\n  }\n\n  deleteRow(row: number, sheet?: SheetRef): OperationResult<void> {\n    try {\n      this.selectSheet(sheet);\n      this.goToCell(this.rowColToA1(row, 0));\n      this.lok.postUnoCommand(this.docPtr, '.uno:DeleteRows');\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Failed to delete row: ${String(error)}`);\n    }\n  }\n\n  deleteColumn(col: ColRef, sheet?: SheetRef): OperationResult<void> {\n    try {\n      this.selectSheet(sheet);\n      const colNum = typeof col === 'string'\n        ? this.a1ToRowCol(col + '1').col\n        : col;\n\n      this.goToCell(this.rowColToA1(0, colNum));\n      this.lok.postUnoCommand(this.docPtr, '.uno:DeleteColumns');\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Failed to delete column: ${String(error)}`);\n    }\n  }\n\n  // ============================================\n  // Formatting\n  // ============================================\n\n  formatCells(range: RangeRef, format: CellFormat, sheet?: SheetRef): OperationResult<void> {\n    try {\n      this.selectSheet(sheet);\n      const rangeStr = this.normalizeRangeToString(range);\n      this.goToCell(rangeStr);\n\n      if (format.bold !== undefined) {\n        this.lok.postUnoCommand(this.docPtr, '.uno:Bold');\n      }\n      if (format.numberFormat !== undefined) {\n        const args = JSON.stringify({\n          NumberFormatValue: { type: 'string', value: format.numberFormat },\n        });\n        this.lok.postUnoCommand(this.docPtr, '.uno:NumberFormatValue', args);\n      }\n      if (format.backgroundColor !== undefined) {\n        const args = JSON.stringify({\n          BackgroundColor: { type: 'long', value: this.hexToNumber(format.backgroundColor) },\n        });\n        this.lok.postUnoCommand(this.docPtr, '.uno:BackgroundColor', args);\n      }\n\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Failed to format cells: ${String(error)}`);\n    }\n  }\n\n  // ============================================\n  // Sheet management\n  // ============================================\n\n  addSheet(name: string): OperationResult<{ index: number }> {\n    try {\n      const args = JSON.stringify({\n        Name: { type: 'string', value: name },\n      });\n      this.lok.postUnoCommand(this.docPtr, '.uno:Insert', args);\n\n      const numSheets = this.lok.documentGetParts(this.docPtr);\n      return this.createResult({ index: numSheets - 1 });\n    } catch (error) {\n      return this.createErrorResult(`Failed to add sheet: ${String(error)}`);\n    }\n  }\n\n  renameSheet(sheet: SheetRef, newName: string): OperationResult<void> {\n    try {\n      this.selectSheet(sheet);\n      const args = JSON.stringify({\n        Name: { type: 'string', value: newName },\n      });\n      this.lok.postUnoCommand(this.docPtr, '.uno:RenameTable', args);\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Failed to rename sheet: ${String(error)}`);\n    }\n  }\n\n  deleteSheet(sheet: SheetRef): OperationResult<void> {\n    try {\n      this.selectSheet(sheet);\n      this.lok.postUnoCommand(this.docPtr, '.uno:Remove');\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Failed to delete sheet: ${String(error)}`);\n    }\n  }\n\n  // ============================================\n  // Private helpers\n  // ============================================\n\n  private selectSheet(sheet?: SheetRef): void {\n    if (sheet === undefined) return;\n\n    const index = typeof sheet === 'number'\n      ? sheet\n      : this.getSheetIndexByName(sheet);\n\n    if (index >= 0) {\n      this.lok.documentSetPart(this.docPtr, index);\n    }\n  }\n\n  private getSheetIndexByName(name: string): number {\n    const numSheets = this.lok.documentGetParts(this.docPtr);\n    for (let i = 0; i < numSheets; i++) {\n      if (this.lok.getPartName(this.docPtr, i) === name) {\n        return i;\n      }\n    }\n    return -1;\n  }\n\n  private goToCell(address: string): void {\n    const args = JSON.stringify({\n      ToPoint: { type: 'string', value: address },\n    });\n    this.lok.postUnoCommand(this.docPtr, '.uno:GoToCell', args);\n  }\n\n  private getCellValueInternal(): CellValue {\n    const text = this.lok.getTextSelection(this.docPtr, 'text/plain');\n    if (!text) return null;\n\n    // Try to parse as number\n    const num = parseFloat(text);\n    if (!isNaN(num) && text.trim() === num.toString()) {\n      return num;\n    }\n\n    // Check for boolean\n    if (text.toLowerCase() === 'true') return true;\n    if (text.toLowerCase() === 'false') return false;\n\n    return text;\n  }\n\n  private getCellFormulaInternal(): string | null {\n    const result = this.lok.getCommandValues(this.docPtr, '.uno:GetFormulaBarText');\n    if (!result) return null;\n\n    try {\n      const parsed = JSON.parse(result) as { value?: string };\n      return parsed.value ?? null;\n    } catch {\n      return null;\n    }\n  }\n\n  private normalizeRangeRef(range: RangeRef): {\n    startRow: number;\n    startCol: number;\n    endRow: number;\n    endCol: number;\n  } {\n    if (typeof range === 'string') {\n      const parts = range.split(':');\n      const start = this.a1ToRowCol(parts[0]!);\n      const end = parts[1] ? this.a1ToRowCol(parts[1]) : start;\n      return {\n        startRow: start.row,\n        startCol: start.col,\n        endRow: end.row,\n        endCol: end.col,\n      };\n    }\n\n    const start = this.normalizeCellRef(range.start);\n    const end = this.normalizeCellRef(range.end);\n    return {\n      startRow: start.row,\n      startCol: start.col,\n      endRow: end.row,\n      endCol: end.col,\n    };\n  }\n\n  private normalizeRangeToString(range: RangeRef): string {\n    if (typeof range === 'string') return range;\n\n    const start = this.normalizeCellRef(range.start);\n    const end = this.normalizeCellRef(range.end);\n    return `${this.rowColToA1(start.row, start.col)}:${this.rowColToA1(end.row, end.col)}`;\n  }\n\n  private hexToNumber(hex: string): number {\n    return parseInt(hex.replace('#', ''), 16);\n  }\n}\n","// src/editor/impress.ts\nimport { OfficeEditor } from './base.js';\nimport type {\n  OperationResult,\n  ImpressStructure,\n  SlideData,\n  SlideInfo,\n  SlideLayout,\n  TextFrame,\n} from './types.js';\n\n/**\n * Editor for Impress (presentation) documents\n */\nexport class ImpressEditor extends OfficeEditor {\n  getDocumentType(): 'impress' {\n    return 'impress';\n  }\n\n  getStructure(_options?: { maxResponseChars?: number }): OperationResult<ImpressStructure> {\n    try {\n      const numSlides = this.lok.documentGetParts(this.docPtr);\n      const slides: SlideInfo[] = [];\n\n      for (let i = 0; i < numSlides; i++) {\n        const slideData = this.getSlideInfoInternal(i);\n        slides.push(slideData);\n      }\n\n      const structure: ImpressStructure = {\n        type: 'impress',\n        slides,\n        slideCount: numSlides,\n      };\n\n      return this.createResult(structure);\n    } catch (error) {\n      return this.createErrorResult(`Failed to get structure: ${String(error)}`);\n    }\n  }\n\n  // ============================================\n  // Slide reading\n  // ============================================\n\n  getSlide(index: number): OperationResult<SlideData> {\n    try {\n      const numSlides = this.lok.documentGetParts(this.docPtr);\n\n      if (index < 0 || index >= numSlides) {\n        return this.createErrorResult(\n          `Invalid slide index: ${index}. Valid range: 0-${numSlides - 1}`,\n          'Use getStructure() to see available slides'\n        );\n      }\n\n      this.lok.documentSetPart(this.docPtr, index);\n      const text = this.lok.getAllText(this.docPtr) || '';\n      const textFrames = this.parseTextFrames(text);\n\n      const slideData: SlideData = {\n        index,\n        title: textFrames.find(f => f.type === 'title')?.text,\n        textFrames,\n        hasNotes: false, // Could detect from LOK if available\n      };\n\n      return this.createResult(slideData);\n    } catch (error) {\n      return this.createErrorResult(`Failed to get slide: ${String(error)}`);\n    }\n  }\n\n  getSlideCount(): OperationResult<number> {\n    try {\n      const count = this.lok.documentGetParts(this.docPtr);\n      return this.createResult(count);\n    } catch (error) {\n      return this.createErrorResult(`Failed to get slide count: ${String(error)}`);\n    }\n  }\n\n  // ============================================\n  // Slide management\n  // ============================================\n\n  addSlide(options?: { afterSlide?: number; layout?: SlideLayout }): OperationResult<{ index: number }> {\n    try {\n      const numSlides = this.lok.documentGetParts(this.docPtr);\n\n      // Navigate to position if specified\n      if (options?.afterSlide !== undefined) {\n        this.lok.documentSetPart(this.docPtr, options.afterSlide);\n      } else {\n        // Go to last slide\n        this.lok.documentSetPart(this.docPtr, numSlides - 1);\n      }\n\n      // Insert new slide\n      this.lok.postUnoCommand(this.docPtr, '.uno:InsertPage');\n\n      // Apply layout if specified\n      if (options?.layout) {\n        this.applySlideLayout(options.layout);\n      }\n\n      const newIndex = options?.afterSlide !== undefined\n        ? options.afterSlide + 1\n        : numSlides;\n\n      // Verify by checking slide count increased\n      const newNumSlides = this.lok.documentGetParts(this.docPtr);\n      const verified = newNumSlides > numSlides;\n\n      return {\n        success: true,\n        verified,\n        data: { index: newIndex },\n      };\n    } catch (error) {\n      return this.createErrorResult(`Failed to add slide: ${String(error)}`);\n    }\n  }\n\n  deleteSlide(index: number): OperationResult<void> {\n    try {\n      const numSlides = this.lok.documentGetParts(this.docPtr);\n\n      if (numSlides <= 1) {\n        return this.createErrorResult(\n          'Cannot delete the last slide',\n          'A presentation must have at least one slide'\n        );\n      }\n\n      if (index < 0 || index >= numSlides) {\n        return this.createErrorResult(\n          `Invalid slide index: ${index}`,\n          `Valid range: 0-${numSlides - 1}`\n        );\n      }\n\n      this.lok.documentSetPart(this.docPtr, index);\n      this.lok.postUnoCommand(this.docPtr, '.uno:DeletePage');\n\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Failed to delete slide: ${String(error)}`);\n    }\n  }\n\n  duplicateSlide(index: number): OperationResult<{ newIndex: number }> {\n    try {\n      const numSlides = this.lok.documentGetParts(this.docPtr);\n\n      if (index < 0 || index >= numSlides) {\n        return this.createErrorResult(\n          `Invalid slide index: ${index}`,\n          `Valid range: 0-${numSlides - 1}`\n        );\n      }\n\n      this.lok.documentSetPart(this.docPtr, index);\n      this.lok.postUnoCommand(this.docPtr, '.uno:DuplicatePage');\n\n      return this.createResult({ newIndex: index + 1 });\n    } catch (error) {\n      return this.createErrorResult(`Failed to duplicate slide: ${String(error)}`);\n    }\n  }\n\n  moveSlide(fromIndex: number, toIndex: number): OperationResult<void> {\n    try {\n      const numSlides = this.lok.documentGetParts(this.docPtr);\n\n      if (fromIndex < 0 || fromIndex >= numSlides || toIndex < 0 || toIndex >= numSlides) {\n        return this.createErrorResult(\n          `Invalid slide indices. Valid range: 0-${numSlides - 1}`,\n          'Check slide indices are within bounds'\n        );\n      }\n\n      if (fromIndex === toIndex) {\n        return this.createErrorResult(\n          'Source and destination are the same',\n          'Provide different indices to move'\n        );\n      }\n\n      // LOK doesn't have direct slide move - we simulate via cut/paste\n      this.lok.documentSetPart(this.docPtr, fromIndex);\n\n      const args = JSON.stringify({\n        Position: { type: 'long', value: toIndex },\n      });\n      this.lok.postUnoCommand(this.docPtr, '.uno:MovePageFirst', args);\n\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Failed to move slide: ${String(error)}`);\n    }\n  }\n\n  // ============================================\n  // Slide content editing\n  // ============================================\n\n  setSlideTitle(index: number, title: string): OperationResult<{ oldTitle?: string }> {\n    try {\n      const numSlides = this.lok.documentGetParts(this.docPtr);\n\n      if (index < 0 || index >= numSlides) {\n        return this.createErrorResult(`Invalid slide index: ${index}`);\n      }\n\n      this.lok.documentSetPart(this.docPtr, index);\n\n      // Get current title\n      const text = this.lok.getAllText(this.docPtr) || '';\n      const frames = this.parseTextFrames(text);\n      const oldTitle = frames.find(f => f.type === 'title')?.text;\n\n      // Select title placeholder and replace\n      this.lok.postUnoCommand(this.docPtr, '.uno:SelectAll');\n\n      // Enter title text (this replaces first text frame typically)\n      const args = JSON.stringify({\n        Text: { type: 'string', value: title },\n      });\n      this.lok.postUnoCommand(this.docPtr, '.uno:InsertText', args);\n\n      return this.createResult({ oldTitle });\n    } catch (error) {\n      return this.createErrorResult(`Failed to set slide title: ${String(error)}`);\n    }\n  }\n\n  setSlideBody(index: number, body: string): OperationResult<{ oldBody?: string }> {\n    try {\n      const numSlides = this.lok.documentGetParts(this.docPtr);\n\n      if (index < 0 || index >= numSlides) {\n        return this.createErrorResult(`Invalid slide index: ${index}`);\n      }\n\n      this.lok.documentSetPart(this.docPtr, index);\n\n      // Get current body\n      const text = this.lok.getAllText(this.docPtr) || '';\n      const frames = this.parseTextFrames(text);\n      const oldBody = frames.find(f => f.type === 'body')?.text;\n\n      // Navigate to body and replace\n      // Using Tab to move from title to body placeholder\n      this.lok.postUnoCommand(this.docPtr, '.uno:NextObject');\n\n      const args = JSON.stringify({\n        Text: { type: 'string', value: body },\n      });\n      this.lok.postUnoCommand(this.docPtr, '.uno:InsertText', args);\n\n      return this.createResult({ oldBody });\n    } catch (error) {\n      return this.createErrorResult(`Failed to set slide body: ${String(error)}`);\n    }\n  }\n\n  setSlideNotes(index: number, notes: string): OperationResult<void> {\n    try {\n      const numSlides = this.lok.documentGetParts(this.docPtr);\n\n      if (index < 0 || index >= numSlides) {\n        return this.createErrorResult(`Invalid slide index: ${index}`);\n      }\n\n      this.lok.documentSetPart(this.docPtr, index);\n\n      // Switch to notes view and insert text\n      this.lok.postUnoCommand(this.docPtr, '.uno:NotesMode');\n\n      const args = JSON.stringify({\n        Text: { type: 'string', value: notes },\n      });\n      this.lok.postUnoCommand(this.docPtr, '.uno:InsertText', args);\n\n      // Switch back to normal view\n      this.lok.postUnoCommand(this.docPtr, '.uno:NormalViewMode');\n\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Failed to set slide notes: ${String(error)}`);\n    }\n  }\n\n  // ============================================\n  // Slide layout\n  // ============================================\n\n  setSlideLayout(index: number, layout: SlideLayout): OperationResult<void> {\n    try {\n      const numSlides = this.lok.documentGetParts(this.docPtr);\n\n      if (index < 0 || index >= numSlides) {\n        return this.createErrorResult(`Invalid slide index: ${index}`);\n      }\n\n      this.lok.documentSetPart(this.docPtr, index);\n      this.applySlideLayout(layout);\n\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Failed to set slide layout: ${String(error)}`);\n    }\n  }\n\n  // ============================================\n  // Private helpers\n  // ============================================\n\n  private getSlideInfoInternal(index: number): SlideInfo {\n    this.lok.documentSetPart(this.docPtr, index);\n\n    const text = this.lok.getAllText(this.docPtr) || '';\n    const frames = this.parseTextFrames(text);\n    const titleFrame = frames.find(f => f.type === 'title');\n\n    return {\n      index,\n      title: titleFrame?.text,\n      layout: this.detectLayout(frames),\n      textFrameCount: frames.length,\n    };\n  }\n\n  private parseTextFrames(text: string): TextFrame[] {\n    // Parse text content into frames\n    // In Impress, text is typically separated by paragraph breaks\n    const paragraphs = text.split(/\\n\\n+/).filter(p => p.trim());\n    const frames: TextFrame[] = [];\n\n    paragraphs.forEach((para, idx) => {\n      const type = idx === 0 ? 'title' : (idx === 1 ? 'body' : 'other');\n      frames.push({\n        index: idx,\n        type: type as TextFrame['type'],\n        text: para.trim(),\n        bounds: { x: 0, y: 0, width: 0, height: 0 }, // Would need LOK API for actual bounds\n      });\n    });\n\n    return frames;\n  }\n\n  private detectLayout(frames: TextFrame[]): SlideLayout {\n    if (frames.length === 0) return 'blank';\n    if (frames.length === 1 && frames[0]?.type === 'title') return 'title';\n    if (frames.length >= 2) return 'titleContent';\n    return 'blank';\n  }\n\n  private applySlideLayout(layout: SlideLayout): void {\n    // Map layout names to LOK layout IDs\n    const layoutMap: Record<SlideLayout, number> = {\n      blank: 0,\n      title: 1,\n      titleContent: 2,\n      twoColumn: 3,\n    };\n\n    const layoutId = layoutMap[layout] ?? 0;\n    const args = JSON.stringify({\n      WhatLayout: { type: 'long', value: layoutId },\n    });\n    this.lok.postUnoCommand(this.docPtr, '.uno:AssignLayout', args);\n  }\n}\n","// src/editor/draw.ts\nimport { OfficeEditor } from './base.js';\nimport type {\n  OperationResult,\n  DrawStructure,\n  PageData,\n  PageInfo,\n  ShapeData,\n  ShapeType,\n  Rectangle,\n  Size,\n  Position,\n} from './types.js';\n\n/**\n * Editor for Draw (vector graphics) documents\n * Also handles imported PDFs opened for editing\n */\nexport class DrawEditor extends OfficeEditor {\n  private isImportedPdf: boolean = false;\n\n  getDocumentType(): 'draw' {\n    return 'draw';\n  }\n\n  setImportedPdf(value: boolean): void {\n    this.isImportedPdf = value;\n  }\n\n  getStructure(_options?: { maxResponseChars?: number }): OperationResult<DrawStructure> {\n    try {\n      const numPages = this.lok.documentGetParts(this.docPtr);\n      const pages: PageInfo[] = [];\n\n      for (let i = 0; i < numPages; i++) {\n        const pageInfo = this.getPageInfoInternal(i);\n        pages.push(pageInfo);\n      }\n\n      const structure: DrawStructure = {\n        type: 'draw',\n        pages,\n        pageCount: numPages,\n        isImportedPdf: this.isImportedPdf,\n      };\n\n      return this.createResult(structure);\n    } catch (error) {\n      return this.createErrorResult(`Failed to get structure: ${String(error)}`);\n    }\n  }\n\n  // ============================================\n  // Page reading\n  // ============================================\n\n  getPage(index: number): OperationResult<PageData> {\n    try {\n      const numPages = this.lok.documentGetParts(this.docPtr);\n\n      if (index < 0 || index >= numPages) {\n        return this.createErrorResult(\n          `Invalid page index: ${index}. Valid range: 0-${numPages - 1}`,\n          'Use getStructure() to see available pages'\n        );\n      }\n\n      this.lok.documentSetPart(this.docPtr, index);\n      const size = this.lok.documentGetDocumentSize(this.docPtr);\n      const shapes = this.getShapesOnPage();\n\n      const pageData: PageData = {\n        index,\n        shapes,\n        size: { width: size.width, height: size.height },\n      };\n\n      return this.createResult(pageData);\n    } catch (error) {\n      return this.createErrorResult(`Failed to get page: ${String(error)}`);\n    }\n  }\n\n  getPageCount(): OperationResult<number> {\n    try {\n      const count = this.lok.documentGetParts(this.docPtr);\n      return this.createResult(count);\n    } catch (error) {\n      return this.createErrorResult(`Failed to get page count: ${String(error)}`);\n    }\n  }\n\n  // ============================================\n  // Page management\n  // ============================================\n\n  addPage(options?: { afterPage?: number }): OperationResult<{ index: number }> {\n    try {\n      const numPages = this.lok.documentGetParts(this.docPtr);\n\n      // Navigate to position\n      if (options?.afterPage !== undefined) {\n        this.lok.documentSetPart(this.docPtr, options.afterPage);\n      } else {\n        this.lok.documentSetPart(this.docPtr, numPages - 1);\n      }\n\n      // Insert new page\n      this.lok.postUnoCommand(this.docPtr, '.uno:InsertPage');\n\n      const newIndex = options?.afterPage !== undefined\n        ? options.afterPage + 1\n        : numPages;\n\n      return this.createResult({ index: newIndex });\n    } catch (error) {\n      return this.createErrorResult(`Failed to add page: ${String(error)}`);\n    }\n  }\n\n  deletePage(index: number): OperationResult<void> {\n    try {\n      const numPages = this.lok.documentGetParts(this.docPtr);\n\n      if (numPages <= 1) {\n        return this.createErrorResult(\n          'Cannot delete the last page',\n          'A drawing document must have at least one page'\n        );\n      }\n\n      if (index < 0 || index >= numPages) {\n        return this.createErrorResult(\n          `Invalid page index: ${index}`,\n          `Valid range: 0-${numPages - 1}`\n        );\n      }\n\n      this.lok.documentSetPart(this.docPtr, index);\n      this.lok.postUnoCommand(this.docPtr, '.uno:DeletePage');\n\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Failed to delete page: ${String(error)}`);\n    }\n  }\n\n  duplicatePage(index: number): OperationResult<{ newIndex: number }> {\n    try {\n      const numPages = this.lok.documentGetParts(this.docPtr);\n\n      if (index < 0 || index >= numPages) {\n        return this.createErrorResult(\n          `Invalid page index: ${index}`,\n          `Valid range: 0-${numPages - 1}`\n        );\n      }\n\n      this.lok.documentSetPart(this.docPtr, index);\n      this.lok.postUnoCommand(this.docPtr, '.uno:DuplicatePage');\n\n      return this.createResult({ newIndex: index + 1 });\n    } catch (error) {\n      return this.createErrorResult(`Failed to duplicate page: ${String(error)}`);\n    }\n  }\n\n  // ============================================\n  // Shape operations\n  // ============================================\n\n  addShape(\n    pageIndex: number,\n    shapeType: ShapeType,\n    bounds: Rectangle,\n    options?: { text?: string; fillColor?: string; lineColor?: string }\n  ): OperationResult<{ shapeIndex: number }> {\n    try {\n      const numPages = this.lok.documentGetParts(this.docPtr);\n\n      if (pageIndex < 0 || pageIndex >= numPages) {\n        return this.createErrorResult(`Invalid page index: ${pageIndex}`);\n      }\n\n      this.lok.documentSetPart(this.docPtr, pageIndex);\n\n      // Map shape type to UNO command\n      const shapeCommand = this.getShapeCommand(shapeType);\n\n      // Set shape bounds\n      const boundsArgs = JSON.stringify({\n        X: { type: 'long', value: bounds.x },\n        Y: { type: 'long', value: bounds.y },\n        Width: { type: 'long', value: bounds.width },\n        Height: { type: 'long', value: bounds.height },\n      });\n\n      this.lok.postUnoCommand(this.docPtr, shapeCommand, boundsArgs);\n\n      // Set optional properties\n      if (options?.text) {\n        const textArgs = JSON.stringify({\n          Text: { type: 'string', value: options.text },\n        });\n        this.lok.postUnoCommand(this.docPtr, '.uno:InsertText', textArgs);\n      }\n\n      if (options?.fillColor) {\n        const colorArgs = JSON.stringify({\n          FillColor: { type: 'long', value: this.hexToNumber(options.fillColor) },\n        });\n        this.lok.postUnoCommand(this.docPtr, '.uno:FillColor', colorArgs);\n      }\n\n      if (options?.lineColor) {\n        const colorArgs = JSON.stringify({\n          LineColor: { type: 'long', value: this.hexToNumber(options.lineColor) },\n        });\n        this.lok.postUnoCommand(this.docPtr, '.uno:XLineColor', colorArgs);\n      }\n\n      // Return approximate index (would need LOK API to get actual)\n      return this.createResult({ shapeIndex: 0 });\n    } catch (error) {\n      return this.createErrorResult(`Failed to add shape: ${String(error)}`);\n    }\n  }\n\n  addLine(\n    pageIndex: number,\n    start: Position,\n    end: Position,\n    options?: { lineColor?: string; lineWidth?: number }\n  ): OperationResult<{ shapeIndex: number }> {\n    try {\n      const numPages = this.lok.documentGetParts(this.docPtr);\n\n      if (pageIndex < 0 || pageIndex >= numPages) {\n        return this.createErrorResult(`Invalid page index: ${pageIndex}`);\n      }\n\n      this.lok.documentSetPart(this.docPtr, pageIndex);\n\n      const args = JSON.stringify({\n        StartX: { type: 'long', value: start.x },\n        StartY: { type: 'long', value: start.y },\n        EndX: { type: 'long', value: end.x },\n        EndY: { type: 'long', value: end.y },\n      });\n\n      this.lok.postUnoCommand(this.docPtr, '.uno:Line', args);\n\n      if (options?.lineColor) {\n        const colorArgs = JSON.stringify({\n          LineColor: { type: 'long', value: this.hexToNumber(options.lineColor) },\n        });\n        this.lok.postUnoCommand(this.docPtr, '.uno:XLineColor', colorArgs);\n      }\n\n      if (options?.lineWidth) {\n        const widthArgs = JSON.stringify({\n          LineWidth: { type: 'long', value: options.lineWidth },\n        });\n        this.lok.postUnoCommand(this.docPtr, '.uno:LineWidth', widthArgs);\n      }\n\n      return this.createResult({ shapeIndex: 0 });\n    } catch (error) {\n      return this.createErrorResult(`Failed to add line: ${String(error)}`);\n    }\n  }\n\n  deleteShape(pageIndex: number, shapeIndex: number): OperationResult<void> {\n    try {\n      this.lok.documentSetPart(this.docPtr, pageIndex);\n\n      // Select shape by index (simplified - real impl would use object selection)\n      this.selectShape(shapeIndex);\n      this.lok.postUnoCommand(this.docPtr, '.uno:Delete');\n\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Failed to delete shape: ${String(error)}`);\n    }\n  }\n\n  setShapeText(pageIndex: number, shapeIndex: number, text: string): OperationResult<void> {\n    try {\n      this.lok.documentSetPart(this.docPtr, pageIndex);\n      this.selectShape(shapeIndex);\n\n      // Enter edit mode for the shape\n      this.lok.postUnoCommand(this.docPtr, '.uno:EnterGroup');\n\n      // Replace text\n      this.lok.postUnoCommand(this.docPtr, '.uno:SelectAll');\n      const args = JSON.stringify({\n        Text: { type: 'string', value: text },\n      });\n      this.lok.postUnoCommand(this.docPtr, '.uno:InsertText', args);\n\n      // Exit edit mode\n      this.lok.postUnoCommand(this.docPtr, '.uno:LeaveGroup');\n\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Failed to set shape text: ${String(error)}`);\n    }\n  }\n\n  moveShape(pageIndex: number, shapeIndex: number, newPosition: Position): OperationResult<void> {\n    try {\n      this.lok.documentSetPart(this.docPtr, pageIndex);\n      this.selectShape(shapeIndex);\n\n      const args = JSON.stringify({\n        X: { type: 'long', value: newPosition.x },\n        Y: { type: 'long', value: newPosition.y },\n      });\n      this.lok.postUnoCommand(this.docPtr, '.uno:SetObjectPosition', args);\n\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Failed to move shape: ${String(error)}`);\n    }\n  }\n\n  resizeShape(pageIndex: number, shapeIndex: number, newSize: Size): OperationResult<void> {\n    try {\n      this.lok.documentSetPart(this.docPtr, pageIndex);\n      this.selectShape(shapeIndex);\n\n      const args = JSON.stringify({\n        Width: { type: 'long', value: newSize.width },\n        Height: { type: 'long', value: newSize.height },\n      });\n      this.lok.postUnoCommand(this.docPtr, '.uno:Size', args);\n\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Failed to resize shape: ${String(error)}`);\n    }\n  }\n\n  // ============================================\n  // Private helpers\n  // ============================================\n\n  private getPageInfoInternal(index: number): PageInfo {\n    this.lok.documentSetPart(this.docPtr, index);\n    const size = this.lok.documentGetDocumentSize(this.docPtr);\n    const shapes = this.getShapesOnPage();\n\n    return {\n      index,\n      shapeCount: shapes.length,\n      size: { width: size.width, height: size.height },\n    };\n  }\n\n  private getShapesOnPage(): ShapeData[] {\n    // In a real implementation, we'd enumerate shapes via LOK\n    // For now, we parse text content as a simple proxy\n    const text = this.lok.getAllText(this.docPtr) || '';\n\n    if (!text.trim()) {\n      return [];\n    }\n\n    // Return a single text shape if there's content\n    return [{\n      index: 0,\n      type: 'text',\n      text,\n      bounds: { x: 0, y: 0, width: 0, height: 0 },\n    }];\n  }\n\n  private selectShape(shapeIndex: number): void {\n    // Navigate to shape - simplified implementation\n    // Real implementation would use object enumeration\n    const args = JSON.stringify({\n      Index: { type: 'long', value: shapeIndex },\n    });\n    this.lok.postUnoCommand(this.docPtr, '.uno:SelectObject', args);\n  }\n\n  private getShapeCommand(shapeType: ShapeType): string {\n    const commands: Record<ShapeType, string> = {\n      rectangle: '.uno:Rect',\n      ellipse: '.uno:Ellipse',\n      line: '.uno:Line',\n      text: '.uno:Text',\n      image: '.uno:InsertGraphic',\n      group: '.uno:FormatGroup',\n      other: '.uno:Rect', // Default to rectangle\n    };\n    return commands[shapeType];\n  }\n\n  private hexToNumber(hex: string): number {\n    return parseInt(hex.replace('#', ''), 16);\n  }\n}\n","// src/editor/index.ts\nimport type { LOKBindings } from '../lok-bindings.js';\nimport { OfficeEditor } from './base.js';\nimport { WriterEditor } from './writer.js';\nimport { CalcEditor } from './calc.js';\nimport { ImpressEditor } from './impress.js';\nimport { DrawEditor } from './draw.js';\nimport type { OpenDocumentOptions } from './types.js';\n\n// LOK document type constants (from LibreOfficeKit)\nconst LOK_DOCTYPE_TEXT = 0;\nconst LOK_DOCTYPE_SPREADSHEET = 1;\nconst LOK_DOCTYPE_PRESENTATION = 2;\nconst LOK_DOCTYPE_DRAWING = 3;\n\n/**\n * Factory function to create the appropriate editor based on document type\n *\n * @param lok - LibreOfficeKit bindings instance\n * @param docPtr - Document pointer from lok.documentLoad()\n * @param options - Editor options (maxResponseChars, etc.)\n * @returns Typed editor instance (WriterEditor, CalcEditor, ImpressEditor, or DrawEditor)\n * @throws Error if document type is unsupported\n *\n * @example\n * ```typescript\n * const docPtr = lok.documentLoad('/tmp/document.docx');\n * const editor = createEditor(lok, docPtr);\n *\n * if (isWriterEditor(editor)) {\n *   // TypeScript knows editor has WriterEditor methods\n *   const result = editor.insertParagraph('Hello World');\n * }\n * ```\n */\nexport function createEditor(\n  lok: LOKBindings,\n  docPtr: number,\n  options?: OpenDocumentOptions\n): OfficeEditor {\n  const docType = lok.documentGetDocumentType(docPtr);\n\n  switch (docType) {\n    case LOK_DOCTYPE_TEXT:\n      return new WriterEditor(lok, docPtr, options);\n\n    case LOK_DOCTYPE_SPREADSHEET:\n      return new CalcEditor(lok, docPtr, options);\n\n    case LOK_DOCTYPE_PRESENTATION:\n      return new ImpressEditor(lok, docPtr, options);\n\n    case LOK_DOCTYPE_DRAWING:\n      return new DrawEditor(lok, docPtr, options);\n\n    default:\n      throw new Error(`Unsupported document type: ${docType}`);\n  }\n}\n\n// ============================================\n// Type Guards\n// ============================================\n\n/**\n * Type guard for WriterEditor\n */\nexport function isWriterEditor(editor: OfficeEditor): editor is WriterEditor {\n  return editor.getDocumentType() === 'writer';\n}\n\n/**\n * Type guard for CalcEditor\n */\nexport function isCalcEditor(editor: OfficeEditor): editor is CalcEditor {\n  return editor.getDocumentType() === 'calc';\n}\n\n/**\n * Type guard for ImpressEditor\n */\nexport function isImpressEditor(editor: OfficeEditor): editor is ImpressEditor {\n  return editor.getDocumentType() === 'impress';\n}\n\n/**\n * Type guard for DrawEditor\n */\nexport function isDrawEditor(editor: OfficeEditor): editor is DrawEditor {\n  return editor.getDocumentType() === 'draw';\n}\n\n// ============================================\n// Re-exports\n// ============================================\n\n// Export all types\nexport type {\n  OperationResult,\n  TruncationInfo,\n  OpenDocumentOptions,\n  TextPosition,\n  TextRange,\n  TextFormat,\n  Paragraph,\n  WriterStructure,\n  CellRef,\n  RangeRef,\n  ColRef,\n  SheetRef,\n  CellValue,\n  CellData,\n  CellFormat,\n  SheetInfo,\n  CalcStructure,\n  SlideLayout,\n  TextFrame,\n  SlideData,\n  SlideInfo,\n  ImpressStructure,\n  ShapeType,\n  ShapeData,\n  PageData,\n  PageInfo,\n  DrawStructure,\n  Rectangle,\n  Size,\n  Position,\n  DocumentMetadata,\n  DocumentStructure,\n  DocumentType,\n  SelectionRange,\n  FindOptions,\n} from './types.js';\n\n// Export all editor classes\nexport { OfficeEditor } from './base.js';\nexport { WriterEditor } from './writer.js';\nexport { CalcEditor } from './calc.js';\nexport { ImpressEditor } from './impress.js';\nexport { DrawEditor } from './draw.js';\n\n// Export LLM tool definitions\nexport {\n  // Tool collections\n  allTools,\n  toolsByName,\n  commonTools,\n  writerTools,\n  calcTools,\n  impressTools,\n  drawTools,\n  documentTools,\n  // Utility functions\n  getToolsForDocumentType,\n  toOpenAIFunction,\n  toAnthropicTool,\n  getOpenAIFunctions,\n  getAnthropicTools,\n} from './tools.js';\n\nexport type {\n  ToolDefinition,\n  CommonToolName,\n  WriterToolName,\n  CalcToolName,\n  ImpressToolName,\n  DrawToolName,\n  DocumentToolName,\n  AllToolName,\n  ToolParameters,\n} from './tools.js';\n","/**\n * LibreOfficeKit Low-Level Bindings\n *\n * This module provides direct access to the LibreOfficeKit C API\n * through the WASM module using the stable lok_* shim exports.\n *\n * Shim functions (C side) should be defined as:\n *   - lok_documentLoad(pKit, pPath)\n *   - lok_documentLoadWithOptions(pKit, pPath, pOptions)\n *   - lok_documentSaveAs(pDoc, pUrl, pFormat, pFilterOptions)\n *   - lok_documentDestroy(pDoc)\n *   - lok_getError(pKit)\n *   - lok_destroy(pKit)          <-- RECOMMENDED to add\n */\n\nimport type { EmscriptenModule } from './types.js';\n\n// Extended module type with our LOK shim exports\ninterface LOKModule extends EmscriptenModule {\n  _lok_documentLoad?: (lok: number, path: number) => number;\n  _lok_documentLoadWithOptions?: (lok: number, path: number, options: number) => number;\n  _lok_documentSaveAs?: (doc: number, url: number, format: number, opts: number) => number;\n  _lok_documentDestroy?: (doc: number) => void;\n  _lok_getError?: (lok: number) => number;\n  _lok_destroy?: (lok: number) => void;\n  // Page rendering shims\n  _lok_documentGetParts?: (doc: number) => number;\n  _lok_documentGetPart?: (doc: number) => number;\n  _lok_documentSetPart?: (doc: number, part: number) => void;\n  _lok_documentGetDocumentType?: (doc: number) => number;\n  _lok_documentGetDocumentSize?: (doc: number, widthPtr: number, heightPtr: number) => void;\n  _lok_documentInitializeForRendering?: (doc: number, args: number) => void;\n  _lok_documentPaintTile?: (\n    doc: number,\n    buffer: number,\n    canvasWidth: number,\n    canvasHeight: number,\n    tilePosX: number,\n    tilePosY: number,\n    tileWidth: number,\n    tileHeight: number\n  ) => void;\n  _lok_documentGetTileMode?: (doc: number) => number;\n  // Text selection and content shims\n  _lok_documentGetTextSelection?: (doc: number, mimeType: number, usedMimeType: number) => number;\n  _lok_documentSetTextSelection?: (doc: number, type: number, x: number, y: number) => void;\n  _lok_documentGetSelectionType?: (doc: number) => number;\n  _lok_documentResetSelection?: (doc: number) => void;\n  // Mouse and keyboard event shims\n  _lok_documentPostMouseEvent?: (doc: number, type: number, x: number, y: number, count: number, buttons: number, modifier: number) => void;\n  _lok_documentPostKeyEvent?: (doc: number, type: number, charCode: number, keyCode: number) => void;\n  // UNO command shims\n  _lok_documentPostUnoCommand?: (doc: number, command: number, args: number, notifyWhenFinished: number) => void;\n  _lok_documentGetCommandValues?: (doc: number, command: number) => number;\n  // Page/Part information shims\n  _lok_documentGetPartPageRectangles?: (doc: number) => number;\n  _lok_documentGetPartInfo?: (doc: number, part: number) => number;\n  _lok_documentGetPartName?: (doc: number, part: number) => number;\n  // Clipboard shims\n  _lok_documentPaste?: (doc: number, mimeType: number, data: number, size: number) => number;\n  // View and zoom shims\n  _lok_documentSetClientZoom?: (doc: number, tilePixelWidth: number, tilePixelHeight: number, tileTwipWidth: number, tileTwipHeight: number) => void;\n  _lok_documentSetClientVisibleArea?: (doc: number, x: number, y: number, width: number, height: number) => void;\n  // Accessibility shims\n  _lok_documentGetA11yFocusedParagraph?: (doc: number) => number;\n  _lok_documentGetA11yCaretPosition?: (doc: number) => number;\n  _lok_documentSetAccessibilityState?: (doc: number, viewId: number, enabled: number) => void;\n  // Spreadsheet-specific shims\n  _lok_documentGetDataArea?: (doc: number, part: number, colPtr: number, rowPtr: number) => void;\n  // Edit mode shim\n  _lok_documentGetEditMode?: (doc: number) => number;\n  _lok_documentSetEditMode?: (doc: number, mode: number) => void;\n  // View management shims\n  _lok_documentCreateView?: (doc: number) => number;\n  _lok_documentCreateViewWithOptions?: (doc: number, options: number) => number;\n  _lok_documentDestroyView?: (doc: number, viewId: number) => void;\n  _lok_documentSetView?: (doc: number, viewId: number) => void;\n  _lok_documentGetView?: (doc: number) => number;\n  _lok_documentGetViewsCount?: (doc: number) => number;\n  // Event loop and callback shims\n  _lok_enableSyncEvents?: () => void;\n  _lok_disableSyncEvents?: () => void;\n  _lok_runLoop?: (lok: number, pollCallback: number, wakeCallback: number, data: number) => void;\n  // Callback queue shims\n  _lok_documentRegisterCallback?: (doc: number) => void;\n  _lok_documentUnregisterCallback?: (doc: number) => void;\n  _lok_hasCallbackEvents?: () => number;\n  _lok_getCallbackEventCount?: () => number;\n  _lok_pollCallback?: (payloadBuffer: number, bufferSize: number, payloadLengthPtr: number) => number;\n  _lok_clearCallbackQueue?: () => void;\n  _lok_flushCallbacks?: (doc: number) => void;\n}\n\n// LOK Mouse Event Types\nexport const LOK_MOUSEEVENT_BUTTONDOWN = 0;\nexport const LOK_MOUSEEVENT_BUTTONUP = 1;\nexport const LOK_MOUSEEVENT_MOVE = 2;\n\n// LOK Key Event Types\nexport const LOK_KEYEVENT_KEYINPUT = 0;\nexport const LOK_KEYEVENT_KEYUP = 1;\n\n// LOK Selection Types\nexport const LOK_SELTYPE_NONE = 0;\nexport const LOK_SELTYPE_TEXT = 1;\nexport const LOK_SELTYPE_CELL = 2;\n\n// LOK Text Selection Types\nexport const LOK_SETTEXTSELECTION_START = 0;\nexport const LOK_SETTEXTSELECTION_END = 1;\nexport const LOK_SETTEXTSELECTION_RESET = 2;\n\n// LOK Document Types\nexport const LOK_DOCTYPE_TEXT = 0;\nexport const LOK_DOCTYPE_SPREADSHEET = 1;\nexport const LOK_DOCTYPE_PRESENTATION = 2;\nexport const LOK_DOCTYPE_DRAWING = 3;\nexport const LOK_DOCTYPE_OTHER = 4;\n\n// LOK Callback Types (from LibreOfficeKitEnums.h)\nexport const LOK_CALLBACK_INVALIDATE_TILES = 0;\nexport const LOK_CALLBACK_INVALIDATE_VISIBLE_CURSOR = 1;\nexport const LOK_CALLBACK_TEXT_SELECTION = 2;\nexport const LOK_CALLBACK_TEXT_SELECTION_START = 3;\nexport const LOK_CALLBACK_TEXT_SELECTION_END = 4;\nexport const LOK_CALLBACK_CURSOR_VISIBLE = 5;\nexport const LOK_CALLBACK_GRAPHIC_SELECTION = 6;\nexport const LOK_CALLBACK_HYPERLINK_CLICKED = 7;\nexport const LOK_CALLBACK_STATE_CHANGED = 8;\nexport const LOK_CALLBACK_STATUS_INDICATOR_START = 9;\nexport const LOK_CALLBACK_STATUS_INDICATOR_SET_VALUE = 10;\nexport const LOK_CALLBACK_STATUS_INDICATOR_FINISH = 11;\nexport const LOK_CALLBACK_SEARCH_NOT_FOUND = 12;\nexport const LOK_CALLBACK_DOCUMENT_SIZE_CHANGED = 13;\nexport const LOK_CALLBACK_SET_PART = 14;\nexport const LOK_CALLBACK_SEARCH_RESULT_SELECTION = 15;\nexport const LOK_CALLBACK_UNO_COMMAND_RESULT = 16;\nexport const LOK_CALLBACK_CELL_CURSOR = 17;\nexport const LOK_CALLBACK_MOUSE_POINTER = 18;\nexport const LOK_CALLBACK_CELL_FORMULA = 19;\nexport const LOK_CALLBACK_DOCUMENT_PASSWORD = 20;\nexport const LOK_CALLBACK_DOCUMENT_PASSWORD_TO_MODIFY = 21;\nexport const LOK_CALLBACK_CONTEXT_MENU = 22;\nexport const LOK_CALLBACK_INVALIDATE_VIEW_CURSOR = 23;\nexport const LOK_CALLBACK_TEXT_VIEW_SELECTION = 24;\nexport const LOK_CALLBACK_CELL_VIEW_CURSOR = 25;\nexport const LOK_CALLBACK_GRAPHIC_VIEW_SELECTION = 26;\nexport const LOK_CALLBACK_VIEW_CURSOR_VISIBLE = 27;\nexport const LOK_CALLBACK_VIEW_LOCK = 28;\nexport const LOK_CALLBACK_REDLINE_TABLE_SIZE_CHANGED = 29;\nexport const LOK_CALLBACK_REDLINE_TABLE_ENTRY_MODIFIED = 30;\nexport const LOK_CALLBACK_COMMENT = 31;\nexport const LOK_CALLBACK_INVALIDATE_HEADER = 32;\nexport const LOK_CALLBACK_CELL_ADDRESS = 33;\n\n// Callback event interface\nexport interface LOKCallbackEvent {\n  type: number;\n  typeName: string;\n  payload: string;\n}\n\n// Map callback type to name\nexport function getCallbackTypeName(type: number): string {\n  const names: Record<number, string> = {\n    [LOK_CALLBACK_INVALIDATE_TILES]: 'INVALIDATE_TILES',\n    [LOK_CALLBACK_INVALIDATE_VISIBLE_CURSOR]: 'INVALIDATE_VISIBLE_CURSOR',\n    [LOK_CALLBACK_TEXT_SELECTION]: 'TEXT_SELECTION',\n    [LOK_CALLBACK_TEXT_SELECTION_START]: 'TEXT_SELECTION_START',\n    [LOK_CALLBACK_TEXT_SELECTION_END]: 'TEXT_SELECTION_END',\n    [LOK_CALLBACK_CURSOR_VISIBLE]: 'CURSOR_VISIBLE',\n    [LOK_CALLBACK_GRAPHIC_SELECTION]: 'GRAPHIC_SELECTION',\n    [LOK_CALLBACK_HYPERLINK_CLICKED]: 'HYPERLINK_CLICKED',\n    [LOK_CALLBACK_STATE_CHANGED]: 'STATE_CHANGED',\n    [LOK_CALLBACK_STATUS_INDICATOR_START]: 'STATUS_INDICATOR_START',\n    [LOK_CALLBACK_STATUS_INDICATOR_SET_VALUE]: 'STATUS_INDICATOR_SET_VALUE',\n    [LOK_CALLBACK_STATUS_INDICATOR_FINISH]: 'STATUS_INDICATOR_FINISH',\n    [LOK_CALLBACK_SEARCH_NOT_FOUND]: 'SEARCH_NOT_FOUND',\n    [LOK_CALLBACK_DOCUMENT_SIZE_CHANGED]: 'DOCUMENT_SIZE_CHANGED',\n    [LOK_CALLBACK_SET_PART]: 'SET_PART',\n    [LOK_CALLBACK_SEARCH_RESULT_SELECTION]: 'SEARCH_RESULT_SELECTION',\n    [LOK_CALLBACK_UNO_COMMAND_RESULT]: 'UNO_COMMAND_RESULT',\n    [LOK_CALLBACK_CELL_CURSOR]: 'CELL_CURSOR',\n    [LOK_CALLBACK_MOUSE_POINTER]: 'MOUSE_POINTER',\n    [LOK_CALLBACK_CELL_FORMULA]: 'CELL_FORMULA',\n    [LOK_CALLBACK_DOCUMENT_PASSWORD]: 'DOCUMENT_PASSWORD',\n    [LOK_CALLBACK_DOCUMENT_PASSWORD_TO_MODIFY]: 'DOCUMENT_PASSWORD_TO_MODIFY',\n    [LOK_CALLBACK_CONTEXT_MENU]: 'CONTEXT_MENU',\n    [LOK_CALLBACK_INVALIDATE_VIEW_CURSOR]: 'INVALIDATE_VIEW_CURSOR',\n    [LOK_CALLBACK_TEXT_VIEW_SELECTION]: 'TEXT_VIEW_SELECTION',\n    [LOK_CALLBACK_CELL_VIEW_CURSOR]: 'CELL_VIEW_CURSOR',\n    [LOK_CALLBACK_GRAPHIC_VIEW_SELECTION]: 'GRAPHIC_VIEW_SELECTION',\n    [LOK_CALLBACK_VIEW_CURSOR_VISIBLE]: 'VIEW_CURSOR_VISIBLE',\n    [LOK_CALLBACK_VIEW_LOCK]: 'VIEW_LOCK',\n    [LOK_CALLBACK_REDLINE_TABLE_SIZE_CHANGED]: 'REDLINE_TABLE_SIZE_CHANGED',\n    [LOK_CALLBACK_REDLINE_TABLE_ENTRY_MODIFIED]: 'REDLINE_TABLE_ENTRY_MODIFIED',\n    [LOK_CALLBACK_COMMENT]: 'COMMENT',\n    [LOK_CALLBACK_INVALIDATE_HEADER]: 'INVALIDATE_HEADER',\n    [LOK_CALLBACK_CELL_ADDRESS]: 'CELL_ADDRESS',\n  };\n  return names[type] || `UNKNOWN(${type})`;\n}\n\n// Fallback offsets for WASM32 (4-byte pointers) if shims not available\nconst LOK_CLASS = {\n  nSize: 0,\n  destroy: 4,\n  documentLoad: 8,\n  getError: 12,\n  documentLoadWithOptions: 16,\n  freeError: 20,\n};\n\nconst DOC_CLASS = {\n  nSize: 0,\n  destroy: 4,\n  saveAs: 8,\n};\n\n// Reuse encoder/decoder\nconst textEncoder = new TextEncoder();\nconst textDecoder = new TextDecoder();\n\nexport class LOKBindings {\n  private module: LOKModule;\n  private lokPtr = 0;\n  private verbose: boolean;\n  private useShims: boolean;\n\n  constructor(module: EmscriptenModule, verbose = false) {\n    this.module = module as LOKModule;\n    this.verbose = verbose;\n\n    this.useShims = typeof this.module._lok_documentLoad === 'function';\n    if (this.useShims) {\n      this.log('Using direct LOK shim exports');\n    } else {\n      this.log('Using vtable traversal (shims not available)');\n    }\n  }\n\n  private log(...args: unknown[]): void {\n    if (this.verbose) {\n      console.log('[LOK]', ...args);\n    }\n  }\n\n  /**\n   * Get fresh heap views (important after memory growth!)\n   */\n  private get HEAPU8(): Uint8Array {\n    return this.module.HEAPU8;\n  }\n\n  private get HEAPU32(): Uint32Array {\n    return this.module.HEAPU32;\n  }\n\n  private get HEAP32(): Int32Array {\n    return this.module.HEAP32;\n  }\n\n  /**\n   * Allocate a null-terminated string in WASM memory\n   */\n  allocString(str: string): number {\n    const bytes = textEncoder.encode(str + '\\0');\n    const ptr = this.module._malloc(bytes.length);\n    // Always get fresh heap view after malloc (might have grown memory)\n    this.HEAPU8.set(bytes, ptr);\n    return ptr;\n  }\n\n  /**\n   * Read a null-terminated string from WASM memory\n   */\n  readString(ptr: number): string | null {\n    if (ptr === 0) return null;\n    // Always get fresh heap view\n    const heap = this.HEAPU8;\n    let end = ptr;\n    while (heap[end] !== 0) end++;\n    // Copy the data to avoid SharedArrayBuffer issues in browsers\n    // TextDecoder.decode() doesn't accept SharedArrayBuffer views in some browsers\n    const slice = heap.slice(ptr, end);\n    return textDecoder.decode(slice);\n  }\n\n  /**\n   * Read a 32-bit pointer from memory (unsigned)\n   */\n  readPtr(addr: number): number {\n    // Always get fresh heap view\n    return this.HEAPU32[addr >> 2] || 0;\n  }\n\n  /**\n   * Get a function from the WASM table (fallback for vtable traversal)\n   */\n  private getFunc<T>(ptr: number): T {\n    const wasmTable = this.module.wasmTable as WebAssembly.Table;\n    return wasmTable.get(ptr) as T;\n  }\n\n  /**\n   * Initialize LibreOfficeKit\n   */\n  initialize(installPath: string = '/instdir/program'): void {\n    this.log('Initializing with path:', installPath);\n    const pathPtr = this.allocString(installPath);\n\n    try {\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any, @typescript-eslint/no-unsafe-member-access\n      const hook = (this.module as any)._libreofficekit_hook as\n        | ((pathPtr: number) => number)\n        | undefined;\n\n      if (typeof hook !== 'function') {\n        throw new Error('libreofficekit_hook export not found on module');\n      }\n\n      this.lokPtr = hook(pathPtr);\n\n      if (this.lokPtr === 0) {\n        throw new Error('Failed to initialize LibreOfficeKit');\n      }\n\n      this.log('LOK initialized, ptr:', this.lokPtr);\n    } finally {\n      this.module._free(pathPtr);\n    }\n  }\n\n  /**\n   * Get the last error message\n   */\n  getError(): string | null {\n    if (this.lokPtr === 0) return null;\n\n    // Prefer shim\n    if (this.useShims && this.module._lok_getError) {\n      const errPtr = this.module._lok_getError(this.lokPtr);\n      return this.readString(errPtr);\n    }\n\n    // Fallback: vtable traversal\n    const lokClassPtr = this.readPtr(this.lokPtr);\n    const getErrorPtr = this.readPtr(lokClassPtr + LOK_CLASS.getError);\n    if (getErrorPtr === 0) return null;\n\n    const getError = this.getFunc<(lok: number) => number>(getErrorPtr);\n    const errPtr = getError(this.lokPtr);\n    return this.readString(errPtr);\n  }\n\n  /**\n   * Get version info\n   */\n  getVersionInfo(): string | null {\n    return 'LibreOffice WASM';\n  }\n\n  /**\n   * Convert a filesystem path to a file:// URL\n   * Required by LibreOffice's getAbsoluteURL() which uses rtl::Uri::convertRelToAbs()\n   */\n  private toFileUrl(path: string): string {\n    if (path.startsWith('file://')) return path;\n    const absolutePath = path.startsWith('/') ? path : '/' + path;\n    return 'file://' + absolutePath;\n  }\n\n  /**\n   * Load a document from the virtual filesystem\n   */\n  documentLoad(path: string): number {\n    if (this.lokPtr === 0) {\n      throw new Error('LOK not initialized');\n    }\n\n    const fileUrl = this.toFileUrl(path);\n    this.log('Loading document:', path, '->', fileUrl);\n    const pathPtr = this.allocString(fileUrl);\n\n    try {\n      const startTime = Date.now();\n      let docPtr: number;\n\n      if (this.useShims && this.module._lok_documentLoad) {\n        // Use direct shim export\n        docPtr = this.module._lok_documentLoad(this.lokPtr, pathPtr);\n      } else {\n        // Fallback: vtable traversal\n        const lokClassPtr = this.readPtr(this.lokPtr);\n        const documentLoadPtr = this.readPtr(lokClassPtr + LOK_CLASS.documentLoad);\n        const documentLoad = this.getFunc<(lok: number, path: number) => number>(documentLoadPtr);\n        docPtr = documentLoad(this.lokPtr, pathPtr);\n      }\n\n      this.log('Document loaded in', Date.now() - startTime, 'ms, ptr:', docPtr);\n\n      if (docPtr === 0) {\n        const error = this.getError();\n        throw new Error(`Failed to load document: ${error || 'unknown error'}`);\n      }\n\n      return docPtr;\n    } finally {\n      this.module._free(pathPtr);\n    }\n  }\n\n  /**\n   * Load a document with options\n   */\n  documentLoadWithOptions(path: string, options: string): number {\n    if (this.lokPtr === 0) {\n      throw new Error('LOK not initialized');\n    }\n\n    const fileUrl = this.toFileUrl(path);\n    this.log('Loading document with options:', path, '->', fileUrl, options);\n    const pathPtr = this.allocString(fileUrl);\n    const optsPtr = this.allocString(options);\n\n    try {\n      let docPtr: number;\n\n      if (this.useShims && this.module._lok_documentLoadWithOptions) {\n        // Use direct shim export\n        docPtr = this.module._lok_documentLoadWithOptions(this.lokPtr, pathPtr, optsPtr);\n      } else {\n        // Fallback: vtable traversal\n        const lokClassPtr = this.readPtr(this.lokPtr);\n        const loadWithOptsPtr = this.readPtr(lokClassPtr + LOK_CLASS.documentLoadWithOptions);\n\n        if (loadWithOptsPtr === 0) {\n          // No special method - fall back to plain load\n          return this.documentLoad(path);\n        }\n\n        const loadWithOpts = this.getFunc<\n          (lok: number, path: number, opts: number) => number\n        >(loadWithOptsPtr);\n        docPtr = loadWithOpts(this.lokPtr, pathPtr, optsPtr);\n      }\n\n      if (docPtr === 0) {\n        const error = this.getError();\n        throw new Error(`Failed to load document: ${error || 'unknown error'}`);\n      }\n\n      this.log('Document loaded, ptr:', docPtr);\n      return docPtr;\n    } finally {\n      this.module._free(pathPtr);\n      this.module._free(optsPtr);\n    }\n  }\n\n  /**\n   * Save a document to a different format\n   */\n  documentSaveAs(\n    docPtr: number,\n    outputPath: string,\n    format: string,\n    filterOptions: string = ''\n  ): void {\n    if (docPtr === 0) {\n      throw new Error('Invalid document pointer');\n    }\n\n    const fileUrl = this.toFileUrl(outputPath);\n    this.log('Saving document to:', outputPath, '->', fileUrl, 'format:', format);\n\n    const urlPtr = this.allocString(fileUrl);\n    const formatPtr = this.allocString(format);\n    const optsPtr = this.allocString(filterOptions);\n\n    try {\n      let result: number;\n\n      if (this.useShims && this.module._lok_documentSaveAs) {\n        // Use direct shim export\n        result = this.module._lok_documentSaveAs(docPtr, urlPtr, formatPtr, optsPtr);\n      } else {\n        // Fallback: vtable traversal\n        const docClassPtr = this.readPtr(docPtr);\n        const saveAsPtr = this.readPtr(docClassPtr + DOC_CLASS.saveAs);\n        const saveAs = this.getFunc<\n          (doc: number, url: number, format: number, opts: number) => number\n        >(saveAsPtr);\n        result = saveAs(docPtr, urlPtr, formatPtr, optsPtr);\n      }\n\n      this.log('Save result:', result);\n\n      if (result === 0) {\n        throw new Error('Failed to save document');\n      }\n    } finally {\n      this.module._free(urlPtr);\n      this.module._free(formatPtr);\n      this.module._free(optsPtr);\n    }\n  }\n\n  /**\n   * Destroy a document\n   */\n  documentDestroy(docPtr: number): void {\n    if (docPtr === 0) return;\n\n    if (this.useShims && this.module._lok_documentDestroy) {\n      // Use direct shim export\n      this.module._lok_documentDestroy(docPtr);\n      this.log('Document destroyed (via shim)');\n      return;\n    }\n\n    // Fallback: vtable traversal\n    const docClassPtr = this.readPtr(docPtr);\n    const destroyPtr = this.readPtr(docClassPtr + DOC_CLASS.destroy);\n\n    if (destroyPtr !== 0) {\n      const destroy = this.getFunc<(doc: number) => void>(destroyPtr);\n      destroy(docPtr);\n      this.log('Document destroyed (via vtable)');\n    }\n  }\n\n  /**\n   * Destroy the LOK instance\n   */\n  destroy(): void {\n    if (this.lokPtr === 0) return;\n\n    try {\n      // Prefer C shim if available\n      if (this.useShims && this.module._lok_destroy) {\n        this.module._lok_destroy(this.lokPtr);\n        this.log('LOK destroyed (via shim)');\n      } else {\n        // Fallback: vtable traversal\n        const lokClassPtr = this.readPtr(this.lokPtr);\n        const destroyPtr = this.readPtr(lokClassPtr + LOK_CLASS.destroy);\n\n        if (destroyPtr !== 0) {\n          const destroy = this.getFunc<(lok: number) => void>(destroyPtr);\n          destroy(this.lokPtr);\n          this.log('LOK destroyed (via vtable)');\n        }\n      }\n    } catch (error) {\n      this.log('LOK destroy error (ignored):', error);\n    }\n\n    this.lokPtr = 0;\n  }\n\n  /**\n   * Check if LOK is initialized\n   */\n  isInitialized(): boolean {\n    return this.lokPtr !== 0;\n  }\n\n  /**\n   * Check if using direct shim exports\n   */\n  isUsingShims(): boolean {\n    return this.useShims;\n  }\n\n  // ==========================================\n  // Page Rendering Methods\n  // ==========================================\n\n  /**\n   * Get the number of parts (pages/slides) in a document\n   */\n  documentGetParts(docPtr: number): number {\n    if (docPtr === 0) {\n      throw new Error('Invalid document pointer');\n    }\n\n    if (this.useShims && this.module._lok_documentGetParts) {\n      return this.module._lok_documentGetParts(docPtr);\n    }\n\n    // Fallback not implemented - would need vtable offsets\n    this.log('documentGetParts: shim not available');\n    return 0;\n  }\n\n  /**\n   * Get the current part (page/slide) index\n   */\n  documentGetPart(docPtr: number): number {\n    if (docPtr === 0) {\n      throw new Error('Invalid document pointer');\n    }\n\n    if (this.useShims && this.module._lok_documentGetPart) {\n      return this.module._lok_documentGetPart(docPtr);\n    }\n\n    this.log('documentGetPart: shim not available');\n    return 0;\n  }\n\n  /**\n   * Set the current part (page/slide) index\n   */\n  documentSetPart(docPtr: number, part: number): void {\n    if (docPtr === 0) {\n      throw new Error('Invalid document pointer');\n    }\n\n    if (this.useShims && this.module._lok_documentSetPart) {\n      this.module._lok_documentSetPart(docPtr, part);\n      return;\n    }\n\n    this.log('documentSetPart: shim not available');\n  }\n\n  /**\n   * Get document type (0=text, 1=spreadsheet, 2=presentation, 3=drawing)\n   */\n  documentGetDocumentType(docPtr: number): number {\n    if (docPtr === 0) {\n      throw new Error('Invalid document pointer');\n    }\n\n    if (this.useShims && this.module._lok_documentGetDocumentType) {\n      return this.module._lok_documentGetDocumentType(docPtr);\n    }\n\n    this.log('documentGetDocumentType: shim not available');\n    return 0;\n  }\n\n  /**\n   * Get document size in twips (1/1440 inch)\n   */\n  documentGetDocumentSize(docPtr: number): { width: number; height: number } {\n    this.log(`documentGetDocumentSize called with docPtr: ${docPtr}`);\n    if (docPtr === 0) {\n      throw new Error('Invalid document pointer');\n    }\n\n    if (this.useShims && this.module._lok_documentGetDocumentSize) {\n      // Allocate space for two longs (32-bit on WASM)\n      const sizePtr = this.module._malloc(8);\n      try {\n        this.module._lok_documentGetDocumentSize(docPtr, sizePtr, sizePtr + 4);\n        const width = this.HEAP32[sizePtr >> 2] ?? 0;\n        const height = this.HEAP32[(sizePtr + 4) >> 2] ?? 0;\n        this.log(`documentGetDocumentSize: ${width}x${height} twips`);\n        return { width, height };\n      } finally {\n        this.module._free(sizePtr);\n      }\n    }\n\n    this.log('documentGetDocumentSize: shim not available');\n    return { width: 0, height: 0 };\n  }\n\n  /**\n   * Initialize document for rendering\n   */\n  documentInitializeForRendering(docPtr: number, options: string = ''): void {\n    if (docPtr === 0) {\n      throw new Error('Invalid document pointer');\n    }\n\n    if (this.useShims && this.module._lok_documentInitializeForRendering) {\n      const optsPtr = this.allocString(options);\n      try {\n        this.module._lok_documentInitializeForRendering(docPtr, optsPtr);\n      } finally {\n        this.module._free(optsPtr);\n      }\n      return;\n    }\n\n    this.log('documentInitializeForRendering: shim not available');\n  }\n\n  /**\n   * Paint a tile of the document to a buffer\n   * @param docPtr Document pointer\n   * @param canvasWidth Output width in pixels\n   * @param canvasHeight Output height in pixels\n   * @param tilePosX X position in twips\n   * @param tilePosY Y position in twips\n   * @param tileWidth Width in twips\n   * @param tileHeight Height in twips\n   * @returns RGBA pixel data\n   */\n  documentPaintTile(\n    docPtr: number,\n    canvasWidth: number,\n    canvasHeight: number,\n    tilePosX: number,\n    tilePosY: number,\n    tileWidth: number,\n    tileHeight: number\n  ): Uint8Array {\n    if (docPtr === 0) {\n      throw new Error('Invalid document pointer');\n    }\n\n    if (this.useShims && this.module._lok_documentPaintTile) {\n      // Allocate RGBA buffer (4 bytes per pixel)\n      const bufferSize = canvasWidth * canvasHeight * 4;\n      const bufferPtr = this.module._malloc(bufferSize);\n\n      if (bufferPtr === 0) {\n        throw new Error(`Failed to allocate ${bufferSize} bytes for tile buffer`);\n      }\n\n      try {\n        this.module._lok_documentPaintTile(\n          docPtr,\n          bufferPtr,\n          canvasWidth,\n          canvasHeight,\n          tilePosX,\n          tilePosY,\n          tileWidth,\n          tileHeight\n        );\n\n        // Copy data out of WASM memory\n        const result = new Uint8Array(bufferSize);\n        result.set(this.HEAPU8.subarray(bufferPtr, bufferPtr + bufferSize));\n        return result;\n      } finally {\n        this.module._free(bufferPtr);\n      }\n    }\n\n    this.log('documentPaintTile: shim not available');\n    return new Uint8Array(0);\n  }\n\n  /**\n   * Get tile mode (0=RGBA, 1=BGRA)\n   */\n  documentGetTileMode(docPtr: number): number {\n    if (docPtr === 0) {\n      throw new Error('Invalid document pointer');\n    }\n\n    if (this.useShims && this.module._lok_documentGetTileMode) {\n      return this.module._lok_documentGetTileMode(docPtr);\n    }\n\n    this.log('documentGetTileMode: shim not available');\n    return 0; // Default to RGBA\n  }\n\n  /**\n   * Render a page/slide to an image\n   * @param docPtr Document pointer\n   * @param pageIndex Page/slide index (0-based)\n   * @param width Output width in pixels\n   * @param height Output height in pixels (0 = auto based on aspect ratio)\n   * @returns RGBA pixel data and dimensions\n   */\n  renderPage(\n    docPtr: number,\n    pageIndex: number,\n    width: number,\n    height: number = 0,\n    editMode: boolean = false\n  ): { data: Uint8Array; width: number; height: number } {\n    // Initialize for rendering if not already done\n    this.documentInitializeForRendering(docPtr);\n\n    // Get document type to determine rendering strategy\n    const docType = this.documentGetDocumentType(docPtr);\n\n    // For presentations and drawings, use setPart to select the slide/page\n    // For text documents, we need to use page rectangles\n    if (docType === 2 || docType === 3) { // PRESENTATION or DRAWING\n      console.log(`[LOK] Setting part to ${pageIndex} for presentation/drawing`);\n      this.documentSetPart(docPtr, pageIndex);\n      const currentPart = this.documentGetPart(docPtr);\n      console.log(`[LOK] Current part after setPart: ${currentPart}`);\n\n      // Set view mode (0) for presentations to avoid showing edit UI elements\n      // unless explicitly requested\n      if (!editMode) {\n        this.setEditMode(docPtr, 0);\n        console.log(`[LOK] Set edit mode to 0 (view mode) for presentation rendering`);\n      }\n    }\n\n    // Get document/page size in twips\n    const docSize = this.documentGetDocumentSize(docPtr);\n    this.log('Document size (twips):', docSize);\n\n    if (docSize.width === 0 || docSize.height === 0) {\n      throw new Error('Failed to get document size');\n    }\n\n    // For text documents, get page rectangles to find the specific page\n    let tilePosX = 0;\n    let tilePosY = 0;\n    let tileWidth = docSize.width;\n    let tileHeight = docSize.height;\n\n    if (docType === 0 || docType === 1) { // TEXT or SPREADSHEET\n      // Get page rectangles to find the Y offset for this page\n      const pageRectsStr = this.getPartPageRectangles(docPtr);\n      if (pageRectsStr) {\n        const pageRects = this.parsePageRectangles(pageRectsStr);\n        const pageRect = pageRects[pageIndex];\n        if (pageRect) {\n          tilePosX = pageRect.x;\n          tilePosY = pageRect.y;\n          tileWidth = pageRect.width;\n          tileHeight = pageRect.height;\n          this.log(`Page ${pageIndex} rectangle:`, pageRect);\n        }\n      }\n    }\n\n    // Calculate output dimensions maintaining aspect ratio\n    const aspectRatio = tileHeight / tileWidth;\n    const outputWidth = width;\n    const outputHeight = height > 0 ? height : Math.round(width * aspectRatio);\n\n    console.log(`[LOK] Calling paintTile: ${outputWidth}x${outputHeight} from tile pos (${tilePosX}, ${tilePosY}) size (${tileWidth}x${tileHeight})`);\n\n    // Paint the tile for this specific page\n    const data = this.documentPaintTile(\n      docPtr,\n      outputWidth,\n      outputHeight,\n      tilePosX,\n      tilePosY,\n      tileWidth,\n      tileHeight\n    );\n\n    console.log(`[LOK] paintTile returned ${data.length} bytes`);\n    return { data, width: outputWidth, height: outputHeight };\n  }\n\n  /**\n   * Render a page/slide at full quality (native resolution based on DPI)\n   *\n   * Unlike renderPage which scales to a fixed width, this method renders\n   * at the document's native resolution converted to pixels at the specified DPI.\n   *\n   * @param docPtr Document pointer\n   * @param pageIndex Page/slide index (0-based)\n   * @param dpi Dots per inch for rendering (default 150, use 300 for print quality)\n   * @param maxDimension Optional maximum dimension (width or height) to prevent memory issues\n   * @returns RGBA pixel data and dimensions\n   *\n   * @example\n   * // Render at 150 DPI (good for screen)\n   * const preview = lokBindings.renderPageFullQuality(docPtr, 0, 150);\n   *\n   * // Render at 300 DPI (print quality)\n   * const highRes = lokBindings.renderPageFullQuality(docPtr, 0, 300);\n   *\n   * // Render with max dimension cap to prevent memory issues\n   * const capped = lokBindings.renderPageFullQuality(docPtr, 0, 300, 4096);\n   */\n  renderPageFullQuality(\n    docPtr: number,\n    pageIndex: number,\n    dpi: number = 150,\n    maxDimension?: number,\n    editMode: boolean = false\n  ): { data: Uint8Array; width: number; height: number; dpi: number } {\n    // Initialize for rendering if not already done\n    this.documentInitializeForRendering(docPtr);\n\n    // Get document type to determine rendering strategy\n    const docType = this.documentGetDocumentType(docPtr);\n\n    // For presentations and drawings, use setPart to select the slide/page\n    if (docType === 2 || docType === 3) { // PRESENTATION or DRAWING\n      this.log(`Setting part to ${pageIndex} for presentation/drawing`);\n      this.documentSetPart(docPtr, pageIndex);\n\n      // Set view mode (0) for presentations to avoid showing edit UI elements\n      // unless explicitly requested\n      if (!editMode) {\n        this.setEditMode(docPtr, 0);\n        this.log(`Set edit mode to 0 (view mode) for presentation rendering`);\n      }\n    }\n\n    // Get document/page size in twips\n    const docSize = this.documentGetDocumentSize(docPtr);\n    this.log('Document size (twips):', docSize);\n\n    if (docSize.width === 0 || docSize.height === 0) {\n      throw new Error('Failed to get document size');\n    }\n\n    // For text documents, get page rectangles to find the specific page\n    let tilePosX = 0;\n    let tilePosY = 0;\n    let tileWidth = docSize.width;\n    let tileHeight = docSize.height;\n\n    if (docType === 0 || docType === 1) { // TEXT or SPREADSHEET\n      const pageRectsStr = this.getPartPageRectangles(docPtr);\n      if (pageRectsStr) {\n        const pageRects = this.parsePageRectangles(pageRectsStr);\n        const pageRect = pageRects[pageIndex];\n        if (pageRect) {\n          tilePosX = pageRect.x;\n          tilePosY = pageRect.y;\n          tileWidth = pageRect.width;\n          tileHeight = pageRect.height;\n          this.log(`Page ${pageIndex} rectangle:`, pageRect);\n        }\n      }\n    }\n\n    // Convert twips to pixels at the specified DPI\n    // 1 inch = 1440 twips, so pixels = twips * dpi / 1440\n    const TWIPS_PER_INCH = 1440;\n    let outputWidth = Math.round(tileWidth * dpi / TWIPS_PER_INCH);\n    let outputHeight = Math.round(tileHeight * dpi / TWIPS_PER_INCH);\n    let effectiveDpi = dpi;\n\n    // Apply max dimension cap if specified\n    if (maxDimension && (outputWidth > maxDimension || outputHeight > maxDimension)) {\n      const scale = maxDimension / Math.max(outputWidth, outputHeight);\n      outputWidth = Math.round(outputWidth * scale);\n      outputHeight = Math.round(outputHeight * scale);\n      effectiveDpi = Math.round(dpi * scale);\n      this.log(`Capped dimensions to ${outputWidth}x${outputHeight} (effective DPI: ${effectiveDpi})`);\n    }\n\n    console.log(`[LOK] renderPageFullQuality: ${outputWidth}x${outputHeight} at ${effectiveDpi} DPI from tile (${tilePosX}, ${tilePosY}) size (${tileWidth}x${tileHeight}) twips`);\n\n    // Paint the tile\n    const data = this.documentPaintTile(\n      docPtr,\n      outputWidth,\n      outputHeight,\n      tilePosX,\n      tilePosY,\n      tileWidth,\n      tileHeight\n    );\n\n    console.log(`[LOK] renderPageFullQuality returned ${data.length} bytes`);\n    return { data, width: outputWidth, height: outputHeight, dpi: effectiveDpi };\n  }\n\n  // ==========================================\n  // Text Selection and Content Methods\n  // ==========================================\n\n  /**\n   * Get currently selected text\n   * @param docPtr Document pointer\n   * @param mimeType Desired MIME type. Must include charset, e.g., 'text/plain;charset=utf-8'\n   *                 Note: 'text/plain' without charset is NOT supported by LOK\n   * @returns Selected text or null\n   */\n  getTextSelection(docPtr: number, mimeType: string = 'text/plain;charset=utf-8'): string | null {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentGetTextSelection) {\n      const mimePtr = this.allocString(mimeType);\n      const usedMimePtr = this.module._malloc(4); // pointer to char*\n      try {\n        const resultPtr = this.module._lok_documentGetTextSelection(docPtr, mimePtr, usedMimePtr);\n        if (resultPtr === 0) return null;\n        const result = this.readString(resultPtr);\n        this.module._free(resultPtr);\n        return result;\n      } finally {\n        this.module._free(mimePtr);\n        this.module._free(usedMimePtr);\n      }\n    }\n\n    this.log('getTextSelection: shim not available');\n    return null;\n  }\n\n  /**\n   * Set text selection at coordinates\n   * @param docPtr Document pointer\n   * @param type Selection type (LOK_SETTEXTSELECTION_START, END, or RESET)\n   * @param x X coordinate in twips\n   * @param y Y coordinate in twips\n   */\n  setTextSelection(docPtr: number, type: number, x: number, y: number): void {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentSetTextSelection) {\n      this.module._lok_documentSetTextSelection(docPtr, type, x, y);\n      return;\n    }\n\n    this.log('setTextSelection: shim not available');\n  }\n\n  /**\n   * Get current selection type\n   * @param docPtr Document pointer\n   * @returns Selection type (LOK_SELTYPE_NONE, TEXT, or CELL)\n   */\n  getSelectionType(docPtr: number): number {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentGetSelectionType) {\n      return this.module._lok_documentGetSelectionType(docPtr);\n    }\n\n    this.log('getSelectionType: shim not available');\n    return 0;\n  }\n\n  /**\n   * Reset/clear current selection\n   * @param docPtr Document pointer\n   */\n  resetSelection(docPtr: number): void {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentResetSelection) {\n      this.module._lok_documentResetSelection(docPtr);\n      return;\n    }\n\n    this.log('resetSelection: shim not available');\n  }\n\n  // ==========================================\n  // Mouse and Keyboard Event Methods\n  // ==========================================\n\n  /**\n   * Post a mouse event to the document\n   * @param docPtr Document pointer\n   * @param type Event type (LOK_MOUSEEVENT_BUTTONDOWN, BUTTONUP, MOVE)\n   * @param x X coordinate in twips\n   * @param y Y coordinate in twips\n   * @param count Click count (1 for single, 2 for double click)\n   * @param buttons Button mask (1=left, 2=middle, 4=right)\n   * @param modifier Modifier keys mask\n   */\n  postMouseEvent(\n    docPtr: number,\n    type: number,\n    x: number,\n    y: number,\n    count: number = 1,\n    buttons: number = 1,\n    modifier: number = 0\n  ): void {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentPostMouseEvent) {\n      this.module._lok_documentPostMouseEvent(docPtr, type, x, y, count, buttons, modifier);\n      return;\n    }\n\n    this.log('postMouseEvent: shim not available');\n  }\n\n  /**\n   * Post a keyboard event to the document\n   * @param docPtr Document pointer\n   * @param type Event type (LOK_KEYEVENT_KEYINPUT, KEYUP)\n   * @param charCode Character code\n   * @param keyCode Key code\n   */\n  postKeyEvent(docPtr: number, type: number, charCode: number, keyCode: number): void {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentPostKeyEvent) {\n      this.module._lok_documentPostKeyEvent(docPtr, type, charCode, keyCode);\n      return;\n    }\n\n    this.log('postKeyEvent: shim not available');\n  }\n\n  // ==========================================\n  // UNO Command Methods\n  // ==========================================\n\n  /**\n   * Execute a UNO command\n   * @param docPtr Document pointer\n   * @param command UNO command (e.g., '.uno:SelectAll', '.uno:Copy')\n   * @param args JSON arguments string\n   * @param notifyWhenFinished Whether to notify when command completes\n   */\n  postUnoCommand(\n    docPtr: number,\n    command: string,\n    args: string = '{}',\n    notifyWhenFinished: boolean = false\n  ): void {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentPostUnoCommand) {\n      const cmdPtr = this.allocString(command);\n      const argsPtr = this.allocString(args);\n      try {\n        this.module._lok_documentPostUnoCommand(docPtr, cmdPtr, argsPtr, notifyWhenFinished ? 1 : 0);\n      } finally {\n        this.module._free(cmdPtr);\n        this.module._free(argsPtr);\n      }\n      return;\n    }\n\n    this.log('postUnoCommand: shim not available');\n  }\n\n  /**\n   * Get command values (query document state)\n   * @param docPtr Document pointer\n   * @param command Command to query (e.g., '.uno:CharFontName')\n   * @returns JSON string with command values\n   */\n  getCommandValues(docPtr: number, command: string): string | null {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentGetCommandValues) {\n      const cmdPtr = this.allocString(command);\n      try {\n        const resultPtr = this.module._lok_documentGetCommandValues(docPtr, cmdPtr);\n        if (resultPtr === 0) return null;\n        const result = this.readString(resultPtr);\n        this.module._free(resultPtr);\n        return result;\n      } finally {\n        this.module._free(cmdPtr);\n      }\n    }\n\n    this.log('getCommandValues: shim not available');\n    return null;\n  }\n\n  // ==========================================\n  // Page/Part Information Methods\n  // ==========================================\n\n  /**\n   * Get bounding rectangles for all pages\n   * @param docPtr Document pointer\n   * @returns String with rectangles \"x,y,width,height;x,y,width,height;...\"\n   */\n  getPartPageRectangles(docPtr: number): string | null {\n    this.log(`getPartPageRectangles called with docPtr: ${docPtr}`);\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentGetPartPageRectangles) {\n      this.log('getPartPageRectangles: using shim');\n      const resultPtr = this.module._lok_documentGetPartPageRectangles(docPtr);\n      this.log(`getPartPageRectangles: resultPtr=${resultPtr}`);\n      if (resultPtr === 0) return null;\n      const result = this.readString(resultPtr);\n      this.log(`getPartPageRectangles: result=\"${result?.slice(0, 100)}...\"`);\n      this.module._free(resultPtr);\n      return result;\n    }\n\n    this.log('getPartPageRectangles: shim not available');\n    return null;\n  }\n\n  /**\n   * Get information about a page/slide\n   * @param docPtr Document pointer\n   * @param part Part index\n   * @returns JSON string with part info\n   */\n  getPartInfo(docPtr: number, part: number): string | null {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentGetPartInfo) {\n      const resultPtr = this.module._lok_documentGetPartInfo(docPtr, part);\n      if (resultPtr === 0) return null;\n      const result = this.readString(resultPtr);\n      this.module._free(resultPtr);\n      return result;\n    }\n\n    this.log('getPartInfo: shim not available');\n    return null;\n  }\n\n  /**\n   * Get name of a page/slide\n   * @param docPtr Document pointer\n   * @param part Part index\n   * @returns Part name\n   */\n  getPartName(docPtr: number, part: number): string | null {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentGetPartName) {\n      const resultPtr = this.module._lok_documentGetPartName(docPtr, part);\n      if (resultPtr === 0) return null;\n      const result = this.readString(resultPtr);\n      this.module._free(resultPtr);\n      return result;\n    }\n\n    this.log('getPartName: shim not available');\n    return null;\n  }\n\n  // ==========================================\n  // Clipboard Methods\n  // ==========================================\n\n  /**\n   * Paste content at current cursor position\n   * @param docPtr Document pointer\n   * @param mimeType MIME type of data\n   * @param data Data to paste\n   * @returns true if successful\n   */\n  paste(docPtr: number, mimeType: string, data: string | Uint8Array): boolean {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentPaste) {\n      const mimePtr = this.allocString(mimeType);\n      let dataPtr: number;\n      let dataSize: number;\n\n      if (typeof data === 'string') {\n        const bytes = new TextEncoder().encode(data);\n        dataSize = bytes.length;\n        dataPtr = this.module._malloc(dataSize);\n        this.HEAPU8.set(bytes, dataPtr);\n      } else {\n        dataSize = data.length;\n        dataPtr = this.module._malloc(dataSize);\n        this.HEAPU8.set(data, dataPtr);\n      }\n\n      try {\n        return this.module._lok_documentPaste(docPtr, mimePtr, dataPtr, dataSize) !== 0;\n      } finally {\n        this.module._free(mimePtr);\n        this.module._free(dataPtr);\n      }\n    }\n\n    this.log('paste: shim not available');\n    return false;\n  }\n\n  // ==========================================\n  // View and Zoom Methods\n  // ==========================================\n\n  /**\n   * Set client zoom level\n   * @param docPtr Document pointer\n   * @param tilePixelWidth Tile width in pixels\n   * @param tilePixelHeight Tile height in pixels\n   * @param tileTwipWidth Tile width in twips\n   * @param tileTwipHeight Tile height in twips\n   */\n  setClientZoom(\n    docPtr: number,\n    tilePixelWidth: number,\n    tilePixelHeight: number,\n    tileTwipWidth: number,\n    tileTwipHeight: number\n  ): void {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentSetClientZoom) {\n      this.module._lok_documentSetClientZoom(docPtr, tilePixelWidth, tilePixelHeight, tileTwipWidth, tileTwipHeight);\n      return;\n    }\n\n    this.log('setClientZoom: shim not available');\n  }\n\n  /**\n   * Set visible area for the client\n   * @param docPtr Document pointer\n   * @param x X position in twips\n   * @param y Y position in twips\n   * @param width Width in twips\n   * @param height Height in twips\n   */\n  setClientVisibleArea(docPtr: number, x: number, y: number, width: number, height: number): void {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentSetClientVisibleArea) {\n      this.module._lok_documentSetClientVisibleArea(docPtr, x, y, width, height);\n      return;\n    }\n\n    this.log('setClientVisibleArea: shim not available');\n  }\n\n  // ==========================================\n  // Accessibility Methods\n  // ==========================================\n\n  /**\n   * Get the currently focused paragraph text\n   * @param docPtr Document pointer\n   * @returns Focused paragraph text\n   */\n  getA11yFocusedParagraph(docPtr: number): string | null {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentGetA11yFocusedParagraph) {\n      const resultPtr = this.module._lok_documentGetA11yFocusedParagraph(docPtr);\n      if (resultPtr === 0) return null;\n      const result = this.readString(resultPtr);\n      this.module._free(resultPtr);\n      return result;\n    }\n\n    this.log('getA11yFocusedParagraph: shim not available');\n    return null;\n  }\n\n  /**\n   * Get caret position in focused paragraph\n   * @param docPtr Document pointer\n   * @returns Caret position or -1\n   */\n  getA11yCaretPosition(docPtr: number): number {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentGetA11yCaretPosition) {\n      return this.module._lok_documentGetA11yCaretPosition(docPtr);\n    }\n\n    this.log('getA11yCaretPosition: shim not available');\n    return -1;\n  }\n\n  /**\n   * Enable/disable accessibility features\n   * @param docPtr Document pointer\n   * @param viewId View ID\n   * @param enabled Whether to enable accessibility\n   */\n  setAccessibilityState(docPtr: number, viewId: number, enabled: boolean): void {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentSetAccessibilityState) {\n      this.module._lok_documentSetAccessibilityState(docPtr, viewId, enabled ? 1 : 0);\n      return;\n    }\n\n    this.log('setAccessibilityState: shim not available');\n  }\n\n  // ==========================================\n  // Spreadsheet-Specific Methods\n  // ==========================================\n\n  /**\n   * Get data area for a spreadsheet (last used row/column)\n   * @param docPtr Document pointer\n   * @param part Sheet index\n   * @returns Object with col and row counts\n   */\n  getDataArea(docPtr: number, part: number): { col: number; row: number } {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentGetDataArea) {\n      const colPtr = this.module._malloc(8);\n      const rowPtr = this.module._malloc(8);\n      try {\n        this.module._lok_documentGetDataArea(docPtr, part, colPtr, rowPtr);\n        const col = this.HEAP32[colPtr >> 2] ?? 0;\n        const row = this.HEAP32[rowPtr >> 2] ?? 0;\n        return { col, row };\n      } finally {\n        this.module._free(colPtr);\n        this.module._free(rowPtr);\n      }\n    }\n\n    this.log('getDataArea: shim not available');\n    return { col: 0, row: 0 };\n  }\n\n  // ==========================================\n  // Edit Mode Methods\n  // ==========================================\n\n  /**\n   * Get current edit mode\n   * @param docPtr Document pointer\n   * @returns Edit mode value\n   */\n  getEditMode(docPtr: number): number {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentGetEditMode) {\n      return this.module._lok_documentGetEditMode(docPtr);\n    }\n\n    this.log('getEditMode: shim not available');\n    return 0;\n  }\n\n  /**\n   * Set edit mode for the document\n   * @param docPtr Document pointer\n   * @param mode 0 for view mode, 1 for edit mode\n   */\n  setEditMode(docPtr: number, mode: number): void {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentSetEditMode) {\n      this.log(`setEditMode: setting mode to ${mode}`);\n      this.module._lok_documentSetEditMode(docPtr, mode);\n      return;\n    }\n\n    this.log('setEditMode: shim not available');\n  }\n\n  // ==========================================\n  // View Management Methods\n  // ==========================================\n\n  /**\n   * Create a new view for the document\n   * @param docPtr Document pointer\n   * @returns View ID\n   */\n  createView(docPtr: number): number {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentCreateView) {\n      const viewId = this.module._lok_documentCreateView(docPtr);\n      this.log(`createView: created view ${viewId}`);\n      return viewId;\n    }\n\n    this.log('createView: shim not available');\n    return -1;\n  }\n\n  /**\n   * Create a new view with options\n   * @param docPtr Document pointer\n   * @param options Options string (JSON)\n   * @returns View ID\n   */\n  createViewWithOptions(docPtr: number, options: string): number {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentCreateViewWithOptions) {\n      const optionsPtr = this.allocString(options);\n      try {\n        const viewId = this.module._lok_documentCreateViewWithOptions(docPtr, optionsPtr);\n        this.log(`createViewWithOptions: created view ${viewId}`);\n        return viewId;\n      } finally {\n        this.module._free(optionsPtr);\n      }\n    }\n\n    this.log('createViewWithOptions: shim not available');\n    return -1;\n  }\n\n  /**\n   * Destroy a view\n   * @param docPtr Document pointer\n   * @param viewId View ID to destroy\n   */\n  destroyView(docPtr: number, viewId: number): void {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentDestroyView) {\n      this.log(`destroyView: destroying view ${viewId}`);\n      this.module._lok_documentDestroyView(docPtr, viewId);\n      return;\n    }\n\n    this.log('destroyView: shim not available');\n  }\n\n  /**\n   * Set the current active view\n   * @param docPtr Document pointer\n   * @param viewId View ID to make active\n   */\n  setView(docPtr: number, viewId: number): void {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentSetView) {\n      this.log(`setView: setting active view to ${viewId}`);\n      this.module._lok_documentSetView(docPtr, viewId);\n      return;\n    }\n\n    this.log('setView: shim not available');\n  }\n\n  /**\n   * Get the current active view ID\n   * @param docPtr Document pointer\n   * @returns Current view ID\n   */\n  getView(docPtr: number): number {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentGetView) {\n      return this.module._lok_documentGetView(docPtr);\n    }\n\n    this.log('getView: shim not available');\n    return -1;\n  }\n\n  /**\n   * Get the number of views\n   * @param docPtr Document pointer\n   * @returns Number of views\n   */\n  getViewsCount(docPtr: number): number {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentGetViewsCount) {\n      return this.module._lok_documentGetViewsCount(docPtr);\n    }\n\n    this.log('getViewsCount: shim not available');\n    return 0;\n  }\n\n  // ==========================================\n  // Event Loop and Callback Methods\n  // ==========================================\n\n  /**\n   * Enable synchronous event dispatch (Unipoll mode).\n   * This must be called before using postKeyEvent, postMouseEvent, etc.\n   * to ensure events are processed immediately instead of being queued.\n   *\n   * Without this, events posted via postKeyEvent/postMouseEvent are queued\n   * via Application::PostUserEvent() and never processed in headless mode.\n   */\n  enableSyncEvents(): void {\n    if (this.useShims && this.module._lok_enableSyncEvents) {\n      this.module._lok_enableSyncEvents();\n      this.log('enableSyncEvents: Unipoll mode enabled');\n    } else {\n      this.log('enableSyncEvents: shim not available');\n    }\n  }\n\n  /**\n   * Disable synchronous event dispatch.\n   * Call this when done with event-based operations.\n   */\n  disableSyncEvents(): void {\n    if (this.useShims && this.module._lok_disableSyncEvents) {\n      this.module._lok_disableSyncEvents();\n      this.log('disableSyncEvents: Unipoll mode disabled');\n    } else {\n      this.log('disableSyncEvents: shim not available');\n    }\n  }\n\n  // ==========================================\n  // Callback Queue Methods\n  // ==========================================\n\n  /**\n   * Register a callback handler for the document.\n   * Events are queued and can be retrieved via pollCallback().\n   * @param docPtr Document pointer\n   */\n  registerCallback(docPtr: number): void {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentRegisterCallback) {\n      this.module._lok_documentRegisterCallback(docPtr);\n      this.log('registerCallback: callback registered');\n    } else {\n      this.log('registerCallback: shim not available');\n    }\n  }\n\n  /**\n   * Unregister the callback handler for the document.\n   * @param docPtr Document pointer\n   */\n  unregisterCallback(docPtr: number): void {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentUnregisterCallback) {\n      this.module._lok_documentUnregisterCallback(docPtr);\n      this.log('unregisterCallback: callback unregistered');\n    } else {\n      this.log('unregisterCallback: shim not available');\n    }\n  }\n\n  /**\n   * Check if there are any pending callback events.\n   * @returns true if events are pending\n   */\n  hasCallbackEvents(): boolean {\n    if (this.useShims && this.module._lok_hasCallbackEvents) {\n      return this.module._lok_hasCallbackEvents() !== 0;\n    }\n    return false;\n  }\n\n  /**\n   * Get the number of pending callback events.\n   * @returns Number of events in the queue\n   */\n  getCallbackEventCount(): number {\n    if (this.useShims && this.module._lok_getCallbackEventCount) {\n      return this.module._lok_getCallbackEventCount();\n    }\n    return 0;\n  }\n\n  /**\n   * Poll and retrieve the next callback event from the queue.\n   * @returns The next event, or null if queue is empty\n   */\n  pollCallback(): LOKCallbackEvent | null {\n    if (!this.useShims || !this.module._lok_pollCallback) {\n      return null;\n    }\n\n    const bufferSize = 4096;\n    const payloadBuffer = this.module._malloc(bufferSize);\n    const payloadLengthPtr = this.module._malloc(4);\n\n    try {\n      const eventType = this.module._lok_pollCallback(payloadBuffer, bufferSize, payloadLengthPtr);\n\n      if (eventType === -1) {\n        return null; // Queue is empty\n      }\n\n      // Read the payload length\n      const payloadLength = this.module.HEAP32[payloadLengthPtr >> 2] ?? 0;\n\n      // Read the payload string\n      let payload = '';\n      if (payloadLength > 0) {\n        // Copy bytes from HEAPU8 to avoid SharedArrayBuffer issues in browsers\n        // TextDecoder.decode() doesn't accept SharedArrayBuffer views in some browsers\n        const len = Math.min(payloadLength, bufferSize - 1);\n        const bytes = this.module.HEAPU8.slice(payloadBuffer, payloadBuffer + len);\n        payload = textDecoder.decode(bytes);\n      }\n\n      return {\n        type: eventType,\n        typeName: getCallbackTypeName(eventType),\n        payload,\n      };\n    } finally {\n      this.module._free(payloadBuffer);\n      this.module._free(payloadLengthPtr);\n    }\n  }\n\n  /**\n   * Poll all pending callback events.\n   * @returns Array of all pending events\n   */\n  pollAllCallbacks(): LOKCallbackEvent[] {\n    const events: LOKCallbackEvent[] = [];\n    let event = this.pollCallback();\n    while (event !== null) {\n      events.push(event);\n      event = this.pollCallback();\n    }\n    return events;\n  }\n\n  /**\n   * Clear all pending callback events.\n   */\n  clearCallbackQueue(): void {\n    if (this.useShims && this.module._lok_clearCallbackQueue) {\n      this.module._lok_clearCallbackQueue();\n      this.log('clearCallbackQueue: queue cleared');\n    }\n  }\n\n  /**\n   * Force flush pending LOK callbacks for a document.\n   * This is needed in WASM because callbacks are queued via PostUserEvent\n   * but the event loop doesn't run automatically.\n   * Call this after operations that trigger callbacks (e.g., postUnoCommand)\n   * to ensure the callback queue is populated.\n   * @param docPtr Document pointer\n   */\n  flushCallbacks(docPtr: number): void {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    const hasShim = !!this.module._lok_flushCallbacks;\n    this.log(`flushCallbacks: useShims=${this.useShims}, _lok_flushCallbacks exists=${hasShim}`);\n\n    if (this.useShims && this.module._lok_flushCallbacks) {\n      this.module._lok_flushCallbacks(docPtr);\n      this.log('flushCallbacks: callbacks flushed');\n    } else {\n      this.log('flushCallbacks: shim not available');\n    }\n  }\n\n  /**\n   * Poll for STATE_CHANGED callbacks and parse them into a map.\n   * STATE_CHANGED payloads are in format: \".uno:CommandName=value\"\n   * @returns Map of command names to values\n   */\n  pollStateChanges(): Map<string, string> {\n    const states = new Map<string, string>();\n    const events = this.pollAllCallbacks();\n\n    for (const event of events) {\n      if (event.type === LOK_CALLBACK_STATE_CHANGED) {\n        // Parse \".uno:Bold=true\" format\n        const eqIndex = event.payload.indexOf('=');\n        if (eqIndex !== -1) {\n          const key = event.payload.substring(0, eqIndex);\n          const value = event.payload.substring(eqIndex + 1);\n          states.set(key, value);\n        } else {\n          // Some state changes are just the command name (enabled/disabled toggle)\n          states.set(event.payload, '');\n        }\n      }\n    }\n\n    return states;\n  }\n\n  // ==========================================\n  // High-Level Convenience Methods\n  // ==========================================\n\n  /**\n   * Click at a position and get text at that location\n   * @param docPtr Document pointer\n   * @param x X coordinate in twips\n   * @param y Y coordinate in twips\n   * @returns Text at the clicked position\n   */\n  clickAndGetText(docPtr: number, x: number, y: number): string | null {\n    // Click down and up to select\n    this.postMouseEvent(docPtr, LOK_MOUSEEVENT_BUTTONDOWN, x, y, 1, 1, 0);\n    this.postMouseEvent(docPtr, LOK_MOUSEEVENT_BUTTONUP, x, y, 1, 1, 0);\n\n    // Get selected text\n    return this.getTextSelection(docPtr, 'text/plain;charset=utf-8');\n  }\n\n  /**\n   * Double-click to select a word and get it\n   * @param docPtr Document pointer\n   * @param x X coordinate in twips\n   * @param y Y coordinate in twips\n   * @returns Selected word\n   */\n  doubleClickAndGetWord(docPtr: number, x: number, y: number): string | null {\n    // Double click to select word\n    this.postMouseEvent(docPtr, LOK_MOUSEEVENT_BUTTONDOWN, x, y, 2, 1, 0);\n    this.postMouseEvent(docPtr, LOK_MOUSEEVENT_BUTTONUP, x, y, 2, 1, 0);\n\n    // Get selected text\n    return this.getTextSelection(docPtr, 'text/plain;charset=utf-8');\n  }\n\n  /**\n   * Select all content in the document\n   * @param docPtr Document pointer\n   */\n  selectAll(docPtr: number): void {\n    this.postUnoCommand(docPtr, '.uno:SelectAll');\n  }\n\n  /**\n   * Get all text content from the document\n   * @param docPtr Document pointer\n   * @returns All text content\n   */\n  getAllText(docPtr: number): string | null {\n    this.log(`getAllText called with docPtr: ${docPtr}`);\n    this.selectAll(docPtr);\n    const text = this.getTextSelection(docPtr, 'text/plain;charset=utf-8');\n    this.log(`getAllText: text=\"${text?.slice(0, 100)}...\"`);\n    this.resetSelection(docPtr);\n    return text;\n  }\n\n  /**\n   * Parse page rectangles string into array of objects\n   * @param rectanglesStr String from getPartPageRectangles\n   * @returns Array of rectangle objects\n   */\n  parsePageRectangles(rectanglesStr: string): Array<{ x: number; y: number; width: number; height: number }> {\n    if (!rectanglesStr) return [];\n    \n    return rectanglesStr.split(';').filter(s => s.trim()).map(rect => {\n      const parts = rect.split(',').map(Number);\n      return { \n        x: parts[0] ?? 0, \n        y: parts[1] ?? 0, \n        width: parts[2] ?? 0, \n        height: parts[3] ?? 0 \n      };\n    });\n  }\n}\n","/**\n * LibreOffice WASM Document Converter - Browser Module\n *\n * Browser-optimized module with utilities for file handling,\n * drag-and-drop, and downloads.\n *\n * @packageDocumentation\n */\n\nexport type {\n  ConversionOptions,\n  ConversionResult,\n  ImageOptions,\n  InputFormat,\n  LibreOfficeWasmOptions,\n  BrowserWasmPaths,\n  BrowserConverterOptions,\n  WorkerBrowserConverterOptions,\n  OutputFormat,\n  PdfOptions,\n  ProgressInfo,\n  WasmLoadPhase,\n  WasmLoadProgress,\n  EmscriptenModule,\n  EmscriptenFS,\n} from './types.js';\n\nexport {\n  ConversionError,\n  ConversionErrorCode,\n  FORMAT_FILTERS,\n  FORMAT_MIME_TYPES,\n  EXTENSION_TO_FORMAT,\n  createWasmPaths,\n  DEFAULT_WASM_BASE_URL,\n} from './types.js';\n\n// Export editor API\nexport {\n  createEditor,\n  isWriterEditor,\n  isCalcEditor,\n  isImpressEditor,\n  isDrawEditor,\n  OfficeEditor,\n  WriterEditor,\n  CalcEditor,\n  ImpressEditor,\n  DrawEditor,\n} from './editor/index.js';\n\nexport type {\n  OperationResult,\n  OpenDocumentOptions,\n  DocumentStructure,\n  WriterStructure,\n  CalcStructure,\n  ImpressStructure,\n  DrawStructure,\n} from './editor/types.js';\n\nimport {\n  ConversionError,\n  ConversionErrorCode,\n  ConversionOptions,\n  ConversionResult,\n  EmscriptenModule,\n  FORMAT_FILTERS,\n  FORMAT_MIME_TYPES,\n  FORMAT_FILTER_OPTIONS,\n  OUTPUT_FORMAT_TO_LOK,\n  BrowserConverterOptions,\n  WorkerBrowserConverterOptions,\n  ResolvedBrowserConverterOptions,\n  ResolvedWorkerBrowserConverterOptions,\n  BrowserWasmPaths,\n  OutputFormat,\n  ProgressInfo,\n  createWasmPaths,\n  ILibreOfficeConverter,\n  InputFormatOptions,\n  PagePreview,\n  DocumentInfo,\n  RenderOptions,\n  FullQualityRenderOptions,\n  FullQualityPagePreview,\n  EditorSession,\n  EditorOperationResult,\n  WasmLoadProgress,\n  WasmLoadPhase,\n} from './types.js';\n\nimport { LOKBindings } from './lok-bindings.js';\nimport { createEditor, OfficeEditor } from './editor/index.js';\nimport type { OpenDocumentOptions } from './editor/types.js';\n\n/** Window with Module property for Emscripten */\ninterface EmscriptenWindow extends Window {\n  Module?: Partial<EmscriptenModule> & {\n    locateFile?: (path: string) => string;\n    print?: (...args: unknown[]) => void;\n    printErr?: (...args: unknown[]) => void;\n    onRuntimeInitialized?: () => void;\n    onAbort?: (what: string) => void;\n  };\n}\n\n/** Internal LOK bindings with lokPtr - use unknown cast for private property access */\ninterface LOKBindingsInternal {\n  lokPtr?: number;\n}\n\n/** Editor session info (internal worker type) */\ninterface EditorSessionInfo {\n  sessionId: string;\n  documentType: 'writer' | 'calc' | 'impress' | 'draw';\n  pageCount: number;\n}\n\n/** Worker response message types */\ninterface WorkerResponse {\n  type: 'loaded' | 'ready' | 'progress' | 'result' | 'error' | 'pageCount' | 'previews' | 'singlePagePreview' | 'fullQualityPagePreview' | 'documentInfo' | 'lokInfo' | 'editResult' | 'pageRectangles' | 'testLokOperations' | 'editorSession' | 'editorOperationResult' | 'documentClosed';\n  id: number;\n  data?: Uint8Array;\n  error?: string;\n  progress?: { percent: number; message: string };\n  pageCount?: number;\n  previews?: PagePreview[];\n  preview?: PagePreview;\n  fullQualityPreview?: FullQualityPagePreview;\n  documentInfo?: DocumentInfo;\n  lokInfo?: unknown;\n  editResult?: unknown;\n  pageRectangles?: unknown[];\n  testLokOperationsResult?: unknown;\n  editorSession?: EditorSessionInfo;\n  editorOperationResult?: unknown;\n}\n\n/**\n * Browser-only LibreOffice WASM Converter\n *\n * Note: This class has a different API than ILibreOfficeConverter because it runs\n * on the main thread and can return editor objects directly. Use WorkerBrowserConverter\n * for the standard session-based API.\n */\nexport class BrowserConverter {\n  private module: EmscriptenModule | null = null;\n  private _lokInstance: number = 0;\n  private lokBindings: LOKBindings | null = null;\n  private initialized = false;\n  private initializing = false;\n  private options: ResolvedBrowserConverterOptions;\n\n  constructor(options: BrowserConverterOptions = {}) {\n    // Apply defaults for WASM paths using createWasmPaths\n    const defaultPaths = createWasmPaths();\n    this.options = {\n      verbose: false,\n      ...defaultPaths,\n      ...options,\n    };\n  }\n\n  /**\n   * Initialize the LibreOffice WASM module\n   */\n  async initialize(): Promise<void> {\n    if (this.initialized) return;\n\n    if (this.initializing) {\n      while (this.initializing) {\n        await new Promise((resolve) => setTimeout(resolve, 100));\n      }\n      return;\n    }\n\n    this.initializing = true;\n    this.emitProgress('loading', 0, 'Loading LibreOffice WASM...');\n\n    try {\n      this.module = await this.loadModule();\n      this.emitProgress('initializing', 50, 'Initializing...');\n      this.setupFileSystem();\n      this.initLOK();\n      this.initialized = true;\n      this.emitProgress('complete', 100, 'Ready');\n      this.options.onReady?.();\n    } catch (error) {\n      const err = error instanceof ConversionError ? error :\n        new ConversionError(ConversionErrorCode.WASM_NOT_INITIALIZED, String(error));\n      this.options.onError?.(err);\n      throw err;\n    } finally {\n      this.initializing = false;\n    }\n  }\n\n  private async loadModule(): Promise<EmscriptenModule> {\n    const { sofficeJs, sofficeWasm, sofficeData, sofficeWorkerJs } = this.options;\n\n    const win = window as EmscriptenWindow;\n\n    // Create a promise that resolves when the module is ready\n    return new Promise((resolve, reject) => {\n      // Pre-configure the global Module object before loading the script\n      // soffice.js checks for existing Module and merges with it\n      win.Module = {\n        locateFile: (path: string) => {\n          if (path.endsWith('.wasm')) return sofficeWasm;\n          if (path.endsWith('.data')) return sofficeData;\n          if (path.endsWith('.worker.js') || path.endsWith('.worker.cjs')) return sofficeWorkerJs;\n          // Fallback: derive from sofficeJs path for any other files\n          const baseUrl = sofficeJs.substring(0, sofficeJs.lastIndexOf('/') + 1);\n          return `${baseUrl}${path}`;\n        },\n        print: this.options.verbose ? console.log : () => { },\n        printErr: this.options.verbose ? console.error : () => { },\n        onRuntimeInitialized: () => {\n          if (this.options.verbose) console.log('[Browser] WASM runtime initialized');\n          resolve(win.Module as EmscriptenModule);\n        },\n        onAbort: (what: string) => {\n          reject(new ConversionError(ConversionErrorCode.WASM_NOT_INITIALIZED, `WASM abort: ${what}`));\n        },\n      };\n\n      // Load the script\n      const script = document.createElement('script');\n      script.src = sofficeJs;\n      script.onerror = () => reject(new Error(`Failed to load ${sofficeJs}`));\n      document.head.appendChild(script);\n\n      // Timeout after 60 seconds\n      setTimeout(() => {\n        reject(new ConversionError(ConversionErrorCode.WASM_NOT_INITIALIZED, 'WASM load timeout'));\n      }, 60000);\n    });\n  }\n\n  private setupFileSystem(): void {\n    if (!this.module?.FS) throw new ConversionError(ConversionErrorCode.WASM_NOT_INITIALIZED, 'No FS');\n    const fs = this.module.FS;\n    try { fs.mkdir('/tmp'); } catch { /* exists */ }\n    try { fs.mkdir('/tmp/input'); } catch { /* exists */ }\n    try { fs.mkdir('/tmp/output'); } catch { /* exists */ }\n  }\n\n  private initLOK(): void {\n    if (!this.module) throw new ConversionError(ConversionErrorCode.WASM_NOT_INITIALIZED, 'No module');\n\n    // Create LOKBindings and initialize\n    this.lokBindings = new LOKBindings(this.module, this.options.verbose);\n    this.lokBindings.initialize('/instdir/program');\n\n    // Store the LOK instance pointer for backwards compatibility\n    this._lokInstance = (this.lokBindings as unknown as LOKBindingsInternal).lokPtr ?? 1;\n  }\n\n  /**\n   * Convert a document\n   */\n  async convert(\n    input: Uint8Array | ArrayBuffer,\n    options: ConversionOptions,\n    filename = 'document'\n  ): Promise<ConversionResult> {\n    if (!this.initialized || !this.module || !this.lokBindings) {\n      throw new ConversionError(ConversionErrorCode.WASM_NOT_INITIALIZED, 'Not initialized');\n    }\n\n    const startTime = Date.now();\n    const inputData = input instanceof Uint8Array ? input : new Uint8Array(input);\n\n    if (inputData.length === 0) {\n      throw new ConversionError(ConversionErrorCode.INVALID_INPUT, 'Empty document');\n    }\n\n    const ext = this.getExt(filename) || options.inputFormat || 'docx';\n    const outputExt = options.outputFormat;\n\n    if (!FORMAT_FILTERS[outputExt]) {\n      throw new ConversionError(ConversionErrorCode.UNSUPPORTED_FORMAT, `Unsupported: ${outputExt}`);\n    }\n\n    const inPath = `/tmp/input/doc.${ext}`;\n    const outPath = `/tmp/output/doc.${outputExt}`;\n\n    let docPtr = 0;\n\n    try {\n      // Write input file to virtual filesystem\n      this.module.FS.writeFile(inPath, inputData);\n      this.emitProgress('converting', 30, 'Loading document...');\n\n      // Load document with LOK\n      if (options.password) {\n        docPtr = this.lokBindings.documentLoadWithOptions(inPath, `,Password=${options.password}`);\n      } else {\n        docPtr = this.lokBindings.documentLoad(inPath);\n      }\n\n      if (docPtr === 0) {\n        const error = this.lokBindings.getError();\n        throw new ConversionError(ConversionErrorCode.LOAD_FAILED, error || 'Failed to load document');\n      }\n\n      this.emitProgress('converting', 50, 'Converting...');\n\n      // Get LOK format string and filter options\n      const lokFormat = OUTPUT_FORMAT_TO_LOK[outputExt];\n      let filterOptions = FORMAT_FILTER_OPTIONS[outputExt] || '';\n\n      // Add PDF-specific options\n      if (outputExt === 'pdf' && options.pdf) {\n        const pdfOpts: string[] = [];\n        if (options.pdf.pdfaLevel) {\n          const levelMap: Record<string, number> = {\n            'PDF/A-1b': 1,\n            'PDF/A-2b': 2,\n            'PDF/A-3b': 3,\n          };\n          pdfOpts.push(`SelectPdfVersion=${levelMap[options.pdf.pdfaLevel] || 0}`);\n        }\n        if (options.pdf.quality !== undefined) {\n          pdfOpts.push(`Quality=${options.pdf.quality}`);\n        }\n        if (pdfOpts.length > 0) {\n          filterOptions = pdfOpts.join(',');\n        }\n      }\n\n      this.emitProgress('converting', 70, 'Saving...');\n\n      // Save document in target format\n      this.lokBindings.documentSaveAs(docPtr, outPath, lokFormat, filterOptions);\n\n      this.emitProgress('converting', 90, 'Reading output...');\n\n      // Read the converted output\n      const result = this.module.FS.readFile(outPath) as Uint8Array;\n\n      if (result.length === 0) {\n        throw new ConversionError(ConversionErrorCode.CONVERSION_FAILED, 'Empty output');\n      }\n\n      const baseName = filename.includes('.') ? filename.substring(0, filename.lastIndexOf('.')) : filename;\n\n      this.emitProgress('complete', 100, 'Done');\n\n      return {\n        data: result,\n        mimeType: FORMAT_MIME_TYPES[outputExt],\n        filename: `${baseName}.${outputExt}`,\n        duration: Date.now() - startTime,\n      };\n    } finally {\n      // Cleanup document\n      if (docPtr !== 0) {\n        try {\n          this.lokBindings.documentDestroy(docPtr);\n        } catch { /* ignore */ }\n      }\n      // Cleanup temp files\n      try { this.module.FS.unlink(inPath); } catch { /* ignore */ }\n      try { this.module.FS.unlink(outPath); } catch { /* ignore */ }\n    }\n  }\n\n  /**\n   * Open a document for editing without converting\n   * Returns an editor instance for the document type (WriterEditor, CalcEditor, etc.)\n   *\n   * @example\n   * ```typescript\n   * const editor = await converter.openDocument(fileData, 'document.docx');\n   * if (isWriterEditor(editor)) {\n   *   const structure = editor.getStructure();\n   *   editor.insertParagraph('Hello World');\n   *   await editor.saveAs('/tmp/output.docx', 'docx');\n   * }\n   * editor.close();\n   * ```\n   */\n  async openDocument(\n    input: Uint8Array | ArrayBuffer,\n    filename: string,\n    options?: OpenDocumentOptions\n  ): Promise<OfficeEditor> {\n    if (!this.initialized || !this.lokBindings || !this.module) {\n      throw new ConversionError(ConversionErrorCode.WASM_NOT_INITIALIZED, 'Not initialized');\n    }\n\n    const inputData = input instanceof ArrayBuffer ? new Uint8Array(input) : input;\n    const ext = this.getExt(filename) || 'docx';\n    const inPath = `/tmp/input/edit_${Date.now()}.${ext}`;\n\n    // Write input file to virtual filesystem\n    this.module.FS.writeFile(inPath, inputData);\n\n    // Load document with LOK\n    let docPtr: number;\n    if (options?.password) {\n      docPtr = this.lokBindings.documentLoadWithOptions(inPath, `,Password=${options.password}`);\n    } else {\n      docPtr = this.lokBindings.documentLoad(inPath);\n    }\n\n    if (docPtr === 0) {\n      const error = this.lokBindings.getError();\n      throw new ConversionError(ConversionErrorCode.LOAD_FAILED, error || 'Failed to load document');\n    }\n\n    // Create and return the appropriate editor\n    const editor = createEditor(this.lokBindings, docPtr, options);\n    editor.setInputPath(inPath);\n\n    return editor;\n  }\n\n  /**\n   * Get the LOK bindings for low-level operations\n   * Useful for accessing methods not exposed through the editor API\n   */\n  getLokBindings(): LOKBindings {\n    if (!this.lokBindings) {\n      throw new ConversionError(ConversionErrorCode.WASM_NOT_INITIALIZED, 'Not initialized');\n    }\n    return this.lokBindings;\n  }\n\n  /**\n   * Convert a File object\n   */\n  async convertFile(file: File, options: ConversionOptions): Promise<ConversionResult> {\n    const buffer = await file.arrayBuffer();\n    return this.convert(new Uint8Array(buffer), options, file.name);\n  }\n\n  /**\n   * Convert from a URL\n   */\n  async convertFromUrl(url: string, options: ConversionOptions): Promise<ConversionResult> {\n    const res = await fetch(url);\n    if (!res.ok) throw new Error(`Fetch failed: ${res.statusText}`);\n    const buffer = await res.arrayBuffer();\n    const filename = url.split('/').pop() || 'document';\n    return this.convert(new Uint8Array(buffer), options, filename);\n  }\n\n  /**\n   * Download converted document\n   */\n  download(result: ConversionResult, filename?: string): void {\n    // Copy to ensure we have a standard ArrayBuffer\n    const buffer = new Uint8Array(result.data).buffer;\n    const blob = new Blob([buffer], { type: result.mimeType });\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement('a');\n    a.href = url;\n    a.download = filename || result.filename;\n    a.click();\n    setTimeout(() => URL.revokeObjectURL(url), 1000);\n  }\n\n  /**\n   * Create Blob URL\n   */\n  createBlobUrl(result: ConversionResult): string {\n    const buffer = new Uint8Array(result.data).buffer;\n    const blob = new Blob([buffer], { type: result.mimeType });\n    return URL.createObjectURL(blob);\n  }\n\n  /**\n   * Preview in new tab\n   */\n  preview(result: ConversionResult): Window | null {\n    return window.open(this.createBlobUrl(result), '_blank');\n  }\n\n  /**\n   * Cleanup\n   */\n  async destroy(): Promise<void> {\n    if (this.lokBindings) {\n      try {\n        this.lokBindings.destroy();\n      } catch { /* ignore */ }\n      this.lokBindings = null;\n    }\n    this.module = null;\n    this._lokInstance = 0;\n    this.initialized = false;\n  }\n\n  isReady(): boolean {\n    return this.initialized && this._lokInstance >= 0;\n  }\n\n  static getSupportedOutputFormats(): OutputFormat[] {\n    return Object.keys(FORMAT_FILTERS) as OutputFormat[];\n  }\n\n  private getExt(filename: string): string | null {\n    const parts = filename.split('.');\n    return parts.length > 1 ? parts.pop()?.toLowerCase() || null : null;\n  }\n\n  private emitProgress(phase: WasmLoadPhase, percent: number, message: string): void {\n    this.options.onProgress?.({ phase, percent, message });\n  }\n}\n\n/**\n * Worker-based LibreOffice WASM Converter\n *\n * Runs WASM module in a Web Worker to avoid blocking the main thread.\n * Implements ILibreOfficeConverter for consistent API across platforms.\n */\nexport class WorkerBrowserConverter implements ILibreOfficeConverter {\n  private worker: Worker | null = null;\n  private initialized = false;\n  private initializing = false;\n  private messageId = 0;\n  private pendingRequests = new Map<number, { resolve: (value: unknown) => void; reject: (error: Error) => void }>();\n  private options: ResolvedWorkerBrowserConverterOptions;\n\n  constructor(options: WorkerBrowserConverterOptions = {}) {\n    // Apply defaults for WASM paths using createWasmPaths\n    const defaultPaths = createWasmPaths();\n    this.options = {\n      verbose: false,\n      browserWorkerJs: '/dist/browser.worker.global.js',\n      ...defaultPaths,\n      ...options,\n    };\n  }\n\n  /**\n   * Initialize the worker and LibreOffice WASM module\n   */\n  async initialize(): Promise<void> {\n    if (this.initialized) return;\n\n    if (this.initializing) {\n      while (this.initializing) {\n        await new Promise((resolve) => setTimeout(resolve, 100));\n      }\n      return;\n    }\n\n    this.initializing = true;\n    this.emitProgress('loading', 0, 'Starting worker...');\n\n    try {\n      // Create the worker (classic worker, not module)\n      this.worker = new Worker(this.options.browserWorkerJs);\n\n      // Set up message handling\n      this.worker.onmessage = (event) => this.handleWorkerMessage(event as MessageEvent<WorkerResponse>);\n      this.worker.onerror = (error) => {\n        console.error('[WorkerConverter] Worker error:', error);\n        this.options.onError?.(new ConversionError(ConversionErrorCode.WASM_NOT_INITIALIZED, error.message));\n      };\n\n      // Wait for worker to load\n      await new Promise<void>((resolve, reject) => {\n        const timeout = setTimeout(() => reject(new Error('Worker load timeout')), 10000);\n        const handler = (event: MessageEvent<WorkerResponse>) => {\n          if (event.data.type === 'loaded') {\n            clearTimeout(timeout);\n            this.worker?.removeEventListener('message', handler);\n            resolve();\n          }\n        };\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        this.worker!.addEventListener('message', handler);\n      });\n\n      // Initialize WASM in worker with explicit paths\n      await this.sendMessage('init', {\n        sofficeJs: this.options.sofficeJs,\n        sofficeWasm: this.options.sofficeWasm,\n        sofficeData: this.options.sofficeData,\n        sofficeWorkerJs: this.options.sofficeWorkerJs,\n        enableProgressTracking: this.options.enableProgressTracking,\n        verbose: this.options.verbose,\n      });\n\n      this.initialized = true;\n      this.emitProgress('complete', 100, 'Ready');\n      this.options.onReady?.();\n    } catch (error) {\n      const err = error instanceof ConversionError ? error :\n        new ConversionError(ConversionErrorCode.WASM_NOT_INITIALIZED, String(error));\n      this.options.onError?.(err);\n      throw err;\n    } finally {\n      this.initializing = false;\n    }\n  }\n\n  private handleWorkerMessage(event: MessageEvent<WorkerResponse>) {\n    const msg = event.data;\n\n    if (msg.type === 'progress') {\n      const progress = msg.progress;\n      if (progress) {\n        this.emitProgress('converting', progress.percent, progress.message);\n      }\n      return;\n    }\n\n    const pending = this.pendingRequests.get(msg.id);\n    if (!pending) return;\n\n    this.pendingRequests.delete(msg.id);\n\n    if (msg.type === 'error') {\n      pending.reject(new ConversionError(ConversionErrorCode.CONVERSION_FAILED, msg.error ?? 'Unknown error'));\n    } else if (msg.type === 'result') {\n      pending.resolve(msg.data);\n    } else if (msg.type === 'ready') {\n      pending.resolve(undefined);\n    } else if (msg.type === 'pageCount') {\n      pending.resolve(msg.pageCount);\n    } else if (msg.type === 'previews') {\n      pending.resolve(msg.previews);\n    } else if (msg.type === 'singlePagePreview') {\n      pending.resolve(msg.preview);\n    } else if (msg.type === 'fullQualityPagePreview') {\n      pending.resolve(msg.preview);\n    } else if (msg.type === 'documentInfo') {\n      pending.resolve(msg.documentInfo);\n    } else if (msg.type === 'lokInfo') {\n      pending.resolve(msg.lokInfo);\n    } else if (msg.type === 'editResult') {\n      pending.resolve(msg.editResult);\n    } else if (msg.type === 'pageRectangles') {\n      pending.resolve(msg.pageRectangles);\n    } else if (msg.type === 'testLokOperations') {\n      pending.resolve(msg.testLokOperationsResult);\n    } else if (msg.type === 'editorSession') {\n      pending.resolve(msg.editorSession);\n    } else if (msg.type === 'editorOperationResult') {\n      pending.resolve(msg.editorOperationResult);\n    } else if (msg.type === 'documentClosed') {\n      pending.resolve(msg.data);\n    }\n  }\n\n  private sendMessage(type: string, data: Record<string, unknown> = {}): Promise<unknown> {\n    return new Promise((resolve, reject) => {\n      if (!this.worker) {\n        reject(new Error('Worker not initialized'));\n        return;\n      }\n\n      const id = ++this.messageId;\n      this.pendingRequests.set(id, { resolve, reject });\n\n      // If sending input data, copy it first to avoid detaching the caller's buffer\n      // This allows the same buffer to be used for multiple API calls\n      if (data.inputData instanceof Uint8Array) {\n        const copy = new Uint8Array(data.inputData.length);\n        copy.set(data.inputData);\n        const message = { type, id, ...data, inputData: copy };\n        this.worker.postMessage(message, [copy.buffer]);\n      } else {\n        const message = { type, id, ...data };\n        this.worker.postMessage(message);\n      }\n    });\n  }\n\n  /**\n   * Convert a document\n   */\n  async convert(\n    input: Uint8Array | ArrayBuffer,\n    options: ConversionOptions,\n    filename = 'document'\n  ): Promise<ConversionResult> {\n    if (!this.initialized || !this.worker) {\n      throw new ConversionError(ConversionErrorCode.WASM_NOT_INITIALIZED, 'Not initialized');\n    }\n\n    const startTime = Date.now();\n    const inputData = input instanceof Uint8Array ? input : new Uint8Array(input);\n\n    if (inputData.length === 0) {\n      throw new ConversionError(ConversionErrorCode.INVALID_INPUT, 'Empty document');\n    }\n\n    const ext = this.getExt(filename) || options.inputFormat || 'docx';\n    const outputExt = options.outputFormat;\n\n    if (!FORMAT_FILTERS[outputExt]) {\n      throw new ConversionError(ConversionErrorCode.UNSUPPORTED_FORMAT, `Unsupported: ${outputExt}`);\n    }\n\n    // Build filter options\n    let filterOptions = '';\n    if (outputExt === 'pdf' && options.pdf) {\n      const pdfOpts: string[] = [];\n      if (options.pdf.pdfaLevel) {\n        const levelMap: Record<string, number> = {\n          'PDF/A-1b': 1,\n          'PDF/A-2b': 2,\n          'PDF/A-3b': 3,\n        };\n        pdfOpts.push(`SelectPdfVersion=${levelMap[options.pdf.pdfaLevel] || 0}`);\n      }\n      if (options.pdf.quality !== undefined) {\n        pdfOpts.push(`Quality=${options.pdf.quality}`);\n      }\n      filterOptions = pdfOpts.join(',');\n    }\n\n    const result = await this.sendMessage('convert', {\n      inputData,\n      inputExt: ext,\n      outputFormat: outputExt,\n      filterOptions,\n      password: options.password,\n    }) as Uint8Array;\n\n    const baseName = filename.includes('.') ? filename.substring(0, filename.lastIndexOf('.')) : filename;\n\n    // Check if result is a ZIP file (multi-page image export)\n    // ZIP files start with PK (0x50, 0x4B)\n    const isZip = result.length >= 2 && result[0] === 0x50 && result[1] === 0x4B;\n    const IMAGE_FORMATS = ['png', 'jpg', 'jpeg', 'svg'];\n    const isImageFormat = IMAGE_FORMATS.includes(outputExt.toLowerCase());\n\n    if (isZip && isImageFormat) {\n      // Multi-page image export returns a ZIP\n      return {\n        data: result,\n        mimeType: 'application/zip',\n        filename: `${baseName}_pages.zip`,\n        duration: Date.now() - startTime,\n      };\n    }\n\n    return {\n      data: result,\n      mimeType: FORMAT_MIME_TYPES[outputExt],\n      filename: `${baseName}.${outputExt}`,\n      duration: Date.now() - startTime,\n    };\n  }\n\n  /**\n   * Convert a File object\n   */\n  async convertFile(file: File, options: ConversionOptions): Promise<ConversionResult> {\n    const buffer = await file.arrayBuffer();\n    return this.convert(new Uint8Array(buffer), options, file.name);\n  }\n\n  /**\n   * Convert from a URL\n   */\n  async convertFromUrl(url: string, options: ConversionOptions): Promise<ConversionResult> {\n    const res = await fetch(url);\n    if (!res.ok) throw new Error(`Fetch failed: ${res.statusText}`);\n    const buffer = await res.arrayBuffer();\n    const filename = url.split('/').pop() || 'document';\n    return this.convert(new Uint8Array(buffer), options, filename);\n  }\n\n  /**\n   * Download converted document\n   */\n  download(result: ConversionResult, filename?: string): void {\n    const buffer = new Uint8Array(result.data).buffer;\n    const blob = new Blob([buffer], { type: result.mimeType });\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement('a');\n    a.href = url;\n    a.download = filename || result.filename;\n    a.click();\n    setTimeout(() => URL.revokeObjectURL(url), 1000);\n  }\n\n  /**\n   * Create Blob URL\n   */\n  createBlobUrl(result: ConversionResult): string {\n    const buffer = new Uint8Array(result.data).buffer;\n    const blob = new Blob([buffer], { type: result.mimeType });\n    return URL.createObjectURL(blob);\n  }\n\n  /**\n   * Preview in new tab\n   */\n  preview(result: ConversionResult): Window | null {\n    return window.open(this.createBlobUrl(result), '_blank');\n  }\n\n  /**\n   * Get the number of pages/slides in a document\n   */\n  async getPageCount(\n    input: Uint8Array | ArrayBuffer,\n    options: Pick<ConversionOptions, 'inputFormat'>\n  ): Promise<number> {\n    if (!this.initialized || !this.worker) {\n      throw new ConversionError(ConversionErrorCode.WASM_NOT_INITIALIZED, 'Not initialized');\n    }\n\n    const inputData = input instanceof Uint8Array ? input : new Uint8Array(input);\n    const ext = options.inputFormat || 'docx';\n\n    const result = await this.sendMessage('getPageCount', {\n      inputData,\n      inputExt: ext,\n    });\n\n    return result as number;\n  }\n\n  /**\n   * Render page previews as RGBA image data\n   * @param input Document data\n   * @param options Must include inputFormat\n   * @param maxWidth Maximum width for rendered pages (height scales proportionally)\n   * @returns Array of page previews with RGBA data\n   */\n  async renderPreviews(\n    input: Uint8Array | ArrayBuffer,\n    options: Pick<ConversionOptions, 'inputFormat'>,\n    maxWidth = 256\n  ): Promise<Array<{ page: number; data: Uint8Array; width: number; height: number }>> {\n    if (!this.initialized || !this.worker) {\n      throw new ConversionError(ConversionErrorCode.WASM_NOT_INITIALIZED, 'Not initialized');\n    }\n\n    const inputData = input instanceof Uint8Array ? input : new Uint8Array(input);\n    const ext = options.inputFormat || 'docx';\n\n    const result = await this.sendMessage('renderPreviews', {\n      inputData,\n      inputExt: ext,\n      maxWidth,\n    });\n\n    return result as Array<{ page: number; data: Uint8Array; width: number; height: number }>;\n  }\n\n  /**\n   * Render a single page preview - useful for lazy loading pages one at a time\n   * @param input Document data\n   * @param options Must include inputFormat\n   * @param pageIndex Zero-based page index to render\n   * @param maxWidth Maximum width for rendered page (height scales proportionally)\n   * @returns Single page preview with RGBA data\n   */\n  async renderSinglePage(\n    input: Uint8Array | ArrayBuffer,\n    options: Pick<ConversionOptions, 'inputFormat'>,\n    pageIndex: number,\n    maxWidth = 256\n  ): Promise<{ page: number; data: Uint8Array; width: number; height: number }> {\n    if (!this.initialized || !this.worker) {\n      throw new ConversionError(ConversionErrorCode.WASM_NOT_INITIALIZED, 'Not initialized');\n    }\n\n    const inputData = input instanceof Uint8Array ? input : new Uint8Array(input);\n    const ext = options.inputFormat || 'docx';\n\n    const result = await this.sendMessage('renderSinglePage', {\n      inputData,\n      inputExt: ext,\n      pageIndex,\n      maxWidth,\n    });\n\n    return result as { page: number; data: Uint8Array; width: number; height: number };\n  }\n\n  /**\n   * Render a single page preview using conversion (PDF->PNG)\n   * This is a fallback for Chrome/Edge where paintTile hangs for Drawing documents\n   * @param input Document data\n   * @param options Must include inputFormat\n   * @param pageIndex Zero-based page index to render\n   * @param maxWidth Maximum width for rendered page\n   * @returns Single page preview with PNG data (not RGBA)\n   */\n  async renderPageViaConvert(\n    input: Uint8Array | ArrayBuffer,\n    options: Pick<ConversionOptions, 'inputFormat'>,\n    pageIndex: number,\n    maxWidth = 256\n  ): Promise<{ page: number; data: Uint8Array; width: number; height: number; isPng: boolean }> {\n    if (!this.initialized || !this.worker) {\n      throw new ConversionError(ConversionErrorCode.WASM_NOT_INITIALIZED, 'Not initialized');\n    }\n\n    const inputData = input instanceof Uint8Array ? input : new Uint8Array(input);\n    const ext = options.inputFormat || 'pdf';\n\n    const result = await this.sendMessage('renderPageViaConvert', {\n      inputData,\n      inputExt: ext,\n      pageIndex,\n      maxWidth,\n    });\n\n    return result as { page: number; data: Uint8Array; width: number; height: number; isPng: boolean };\n  }\n\n  /**\n   * Get document info including type and valid output formats\n   * This dynamically queries LibreOffice to determine what conversions are supported\n   * @param input Document data\n   * @param options Must include inputFormat\n   * @returns Document info with type, name, valid outputs, and page count\n   */\n  async getDocumentInfo(\n    input: Uint8Array | ArrayBuffer,\n    options: InputFormatOptions\n  ): Promise<DocumentInfo> {\n    if (!this.initialized || !this.worker) {\n      throw new ConversionError(ConversionErrorCode.WASM_NOT_INITIALIZED, 'Not initialized');\n    }\n\n    const inputData = input instanceof Uint8Array ? input : new Uint8Array(input);\n    const ext = options.inputFormat || 'docx';\n\n    const result = await this.sendMessage('getDocumentInfo', {\n      inputData,\n      inputExt: ext,\n    });\n\n    return result as DocumentInfo;\n  }\n\n  /**\n   * Get low-level LOK information about a document\n   * Includes bounding boxes, text content, positions, and edit mode\n   * @param input Document data\n   * @param options Must include inputFormat\n   * @returns LOK info with rectangles, sizes, text, and positions\n   */\n  async getLokInfo(\n    input: Uint8Array | ArrayBuffer,\n    options: Pick<ConversionOptions, 'inputFormat'>\n  ): Promise<{\n    pageRectangles: string | null;\n    documentSize: { width: number; height: number };\n    partInfo: {\n      visible: string;\n      selected: string;\n      masterPageCount?: string;\n      mode: string;\n    } | null;\n    a11yFocusedParagraph: {\n      content: string;\n      position: string;\n      start: string;\n      end: string;\n    } | null;\n    a11yCaretPosition: number;\n    editMode: number;\n    allText: string | null;\n  }> {\n    if (!this.initialized || !this.worker) {\n      throw new ConversionError(ConversionErrorCode.WASM_NOT_INITIALIZED, 'Not initialized');\n    }\n\n    const inputData = input instanceof Uint8Array ? input : new Uint8Array(input);\n    const ext = options.inputFormat || 'docx';\n\n    const result = await this.sendMessage('getLokInfo', {\n      inputData,\n      inputExt: ext,\n    });\n\n    return result as {\n      pageRectangles: string | null;\n      documentSize: { width: number; height: number };\n      partInfo: {\n        visible: string;\n        selected: string;\n        masterPageCount?: string;\n        mode: string;\n      } | null;\n      a11yFocusedParagraph: {\n        content: string;\n        position: string;\n        start: string;\n        end: string;\n      } | null;\n      a11yCaretPosition: number;\n      editMode: number;\n      allText: string | null;\n    };\n  }\n\n  /**\n   * Render all page rectangles as individual screenshots\n   * Returns each page's bounding box (in twips) with rendered RGBA image data\n   * @param input Document data\n   * @param options Must include inputFormat\n   * @param maxWidth Maximum width for rendered pages (height scales proportionally)\n   * @returns Array of page rectangles with their rendered images\n   */\n  async renderPageRectangles(\n    input: Uint8Array | ArrayBuffer,\n    options: Pick<ConversionOptions, 'inputFormat'>,\n    maxWidth = 256\n  ): Promise<Array<{\n    index: number;\n    x: number;      // X position in twips\n    y: number;      // Y position in twips\n    width: number;  // Width in twips\n    height: number; // Height in twips\n    imageData: Uint8Array;  // RGBA pixel data\n    imageWidth: number;     // Rendered width in pixels\n    imageHeight: number;    // Rendered height in pixels\n  }>> {\n    if (!this.initialized || !this.worker) {\n      throw new ConversionError(ConversionErrorCode.WASM_NOT_INITIALIZED, 'Not initialized');\n    }\n\n    const inputData = input instanceof Uint8Array ? input : new Uint8Array(input);\n    const ext = options.inputFormat || 'docx';\n\n    const result = await this.sendMessage('renderPageRectangles', {\n      inputData,\n      inputExt: ext,\n      maxWidth,\n    });\n\n    return result as Array<{\n      index: number;\n      x: number;\n      y: number;\n      width: number;\n      height: number;\n      imageData: Uint8Array;\n      imageWidth: number;\n      imageHeight: number;\n    }>;\n  }\n\n  /**\n   * Edit text in a document - find/replace or insert text\n   * @param input Document data\n   * @param options Must include inputFormat\n   * @param editOptions Either findText+replaceText or insertText\n   * @returns Edit result with success status and optionally the modified document\n   */\n  async editText(\n    input: Uint8Array | ArrayBuffer,\n    options: Pick<ConversionOptions, 'inputFormat'>,\n    editOptions: {\n      findText?: string;\n      replaceText?: string;\n      insertText?: string;\n    }\n  ): Promise<{\n    success: boolean;\n    editMode: number;\n    message: string;\n    modifiedDocument?: Uint8Array;\n  }> {\n    if (!this.initialized || !this.worker) {\n      throw new ConversionError(ConversionErrorCode.WASM_NOT_INITIALIZED, 'Not initialized');\n    }\n\n    const inputData = input instanceof Uint8Array ? input : new Uint8Array(input);\n    const ext = options.inputFormat || 'docx';\n\n    const result = await this.sendMessage('editText', {\n      inputData,\n      inputExt: ext,\n      findText: editOptions.findText,\n      replaceText: editOptions.replaceText,\n      insertText: editOptions.insertText,\n    });\n\n    return result as {\n      success: boolean;\n      editMode: number;\n      message: string;\n      modifiedDocument?: Uint8Array;\n    };\n  }\n\n  /**\n   * Test various LOK operations on a document\n   * Tests: SelectAll, getTextSelection, getSelectionType, resetSelection,\n   *        Delete, Undo, Redo, Bold, Italic, setTextSelection, save\n   * @param input Document data\n   * @param options Must include inputFormat\n   * @returns Test results for each operation\n   */\n  async testLokOperations(\n    input: Uint8Array | ArrayBuffer,\n    options: Pick<ConversionOptions, 'inputFormat'>\n  ): Promise<{\n    operations: Array<{\n      operation: string;\n      success: boolean;\n      result?: unknown;\n      error?: string;\n    }>;\n    summary: string;\n  }> {\n    if (!this.initialized || !this.worker) {\n      throw new ConversionError(ConversionErrorCode.WASM_NOT_INITIALIZED, 'Not initialized');\n    }\n\n    const inputData = input instanceof Uint8Array ? input : new Uint8Array(input);\n    const ext = options.inputFormat || 'docx';\n\n    const result = await this.sendMessage('testLokOperations', {\n      inputData,\n      inputExt: ext,\n    });\n\n    return result as {\n      operations: Array<{\n        operation: string;\n        success: boolean;\n        result?: unknown;\n        error?: string;\n      }>;\n      summary: string;\n    };\n  }\n\n  /**\n   * Open a document for editing and return a proxy editor\n   *\n   * @param input Document data as Uint8Array or ArrayBuffer\n   * @param options Must include inputFormat\n   * @returns BrowserEditorProxy for interacting with the document\n   *\n   * @example\n   * ```typescript\n   * const editor = await converter.openDocument(docxData, { inputFormat: 'docx' });\n   * console.log(editor.documentType); // 'writer'\n   *\n   * // Get formatting at cursor\n   * const format = await editor.getFormat();\n   * console.log(format); // { bold: true, italic: false, ... }\n   *\n   * // Apply formatting\n   * await editor.selectAll();\n   * await editor.formatText({ bold: true });\n   *\n   * // Save and close\n   * const savedDoc = await editor.save();\n   * await editor.close();\n   * ```\n   */\n  async openDocument(\n    input: Uint8Array | ArrayBuffer,\n    options: InputFormatOptions\n  ): Promise<EditorSession> {\n    if (!this.initialized || !this.worker) {\n      throw new ConversionError(ConversionErrorCode.WASM_NOT_INITIALIZED, 'Not initialized');\n    }\n\n    const inputData = input instanceof Uint8Array ? input : new Uint8Array(input);\n    const ext = options.inputFormat || 'docx';\n\n    const result = await this.sendMessage('openDocument', {\n      inputData,\n      inputExt: ext,\n    }) as { sessionId: string; documentType: 'writer' | 'calc' | 'impress' | 'draw'; pageCount: number };\n\n    return new BrowserEditorProxy(this, result.sessionId, result.documentType, result.pageCount);\n  }\n\n  /**\n   * Internal method to send editor operation to worker\n   * @internal\n   */\n  async _sendEditorOperation(\n    sessionId: string,\n    method: string,\n    args: unknown[] = []\n  ): Promise<{ success: boolean; verified?: boolean; data?: unknown; error?: string; suggestion?: string }> {\n    const result = await this.sendMessage('editorOperation', {\n      sessionId,\n      editorMethod: method,\n      editorArgs: args,\n    });\n    return result as { success: boolean; verified?: boolean; data?: unknown; error?: string; suggestion?: string };\n  }\n\n  /**\n   * Internal method to close an editor session\n   * @internal\n   */\n  async _closeDocument(sessionId: string): Promise<Uint8Array | undefined> {\n    const result = await this.sendMessage('closeDocument', { sessionId });\n    return result as Uint8Array | undefined;\n  }\n\n  // ============================================\n  // ILibreOfficeConverter Interface Methods\n  // ============================================\n\n  /**\n   * Render a single page as an image (ILibreOfficeConverter interface)\n   * @param input Document data\n   * @param options Must include inputFormat\n   * @param pageIndex Zero-based page index to render\n   * @param width Target width for rendered page\n   * @param height Optional target height (scales proportionally if not provided)\n   * @returns Page preview with RGBA data\n   */\n  async renderPage(\n    input: Uint8Array | ArrayBuffer,\n    options: InputFormatOptions,\n    pageIndex: number,\n    width: number,\n    height?: number\n  ): Promise<PagePreview> {\n    // Use the existing renderSinglePage implementation, adapting the signature\n    // height is ignored - renderSinglePage scales proportionally based on maxWidth\n    void height; // Acknowledge unused parameter\n    return this.renderSinglePage(input, options, pageIndex, width);\n  }\n\n  /**\n   * Render multiple pages as images (ILibreOfficeConverter interface)\n   * @param input Document data\n   * @param options Must include inputFormat\n   * @param renderOptions Optional render settings (maxWidth, pages)\n   * @returns Array of page previews with RGBA data\n   */\n  async renderPagePreviews(\n    input: Uint8Array | ArrayBuffer,\n    options: InputFormatOptions,\n    renderOptions?: RenderOptions\n  ): Promise<PagePreview[]> {\n    const width = renderOptions?.width ?? 256;\n    // Note: renderOptions.pageIndices is not currently used by the underlying implementation\n    // which renders all pages. This could be enhanced in the future.\n    return this.renderPreviews(input, options, width);\n  }\n\n  /**\n   * Render a page at full quality (native resolution based on DPI)\n   * @param input Document data\n   * @param options Must include inputFormat\n   * @param pageIndex Zero-based page index to render\n   * @param renderOptions DPI and max dimension settings\n   * @returns Full quality page preview with RGBA data and DPI info\n   */\n  async renderPageFullQuality(\n    input: Uint8Array | ArrayBuffer,\n    options: InputFormatOptions,\n    pageIndex: number,\n    renderOptions?: FullQualityRenderOptions\n  ): Promise<FullQualityPagePreview> {\n    if (!this.initialized || !this.worker) {\n      throw new ConversionError(ConversionErrorCode.WASM_NOT_INITIALIZED, 'Not initialized');\n    }\n\n    const inputData = input instanceof Uint8Array ? input : new Uint8Array(input);\n    const ext = options.inputFormat || 'docx';\n\n    const result = await this.sendMessage('renderPageFullQuality', {\n      inputData,\n      inputExt: ext,\n      pageIndex,\n      dpi: renderOptions?.dpi ?? 150,\n      maxDimension: renderOptions?.maxDimension,\n      editMode: renderOptions?.editMode ?? false,\n    });\n\n    return result as FullQualityPagePreview;\n  }\n\n  /**\n   * Execute an editor operation on an open document (ILibreOfficeConverter interface)\n   * @param sessionId The editor session ID\n   * @param method The editor method to call\n   * @param args Arguments to pass to the method\n   * @returns Operation result\n   */\n  async editorOperation<T = unknown>(\n    sessionId: string,\n    method: string,\n    args?: unknown[]\n  ): Promise<EditorOperationResult<T>> {\n    const result = await this._sendEditorOperation(sessionId, method, args ?? []);\n    return result as EditorOperationResult<T>;\n  }\n\n  /**\n   * Close an editor session and optionally get the modified document (ILibreOfficeConverter interface)\n   * @param sessionId The editor session ID\n   * @returns The modified document data, or undefined if no changes\n   */\n  async closeDocument(sessionId: string): Promise<Uint8Array | undefined> {\n    return this._closeDocument(sessionId);\n  }\n\n  /**\n   * Cleanup\n   */\n  async destroy(): Promise<void> {\n    if (this.worker) {\n      try {\n        await this.sendMessage('destroy');\n      } catch { /* ignore */ }\n      this.worker.terminate();\n      this.worker = null;\n    }\n    this.initialized = false;\n    this.pendingRequests.clear();\n  }\n\n  isReady(): boolean {\n    return this.initialized && this.worker !== null;\n  }\n\n  static getSupportedOutputFormats(): OutputFormat[] {\n    return Object.keys(FORMAT_FILTERS) as OutputFormat[];\n  }\n\n  private getExt(filename: string): string | null {\n    const parts = filename.split('.');\n    return parts.length > 1 ? parts.pop()?.toLowerCase() || null : null;\n  }\n\n  private emitProgress(phase: ProgressInfo['phase'], percent: number, message: string): void {\n    this.options.onProgress?.({ phase, percent, message });\n  }\n}\n\n/**\n * Proxy class for editing documents in the browser via Web Worker\n *\n * This class provides a clean API that mirrors the server-side editor classes\n * but communicates through the worker message protocol.\n */\nexport class BrowserEditorProxy implements EditorSession {\n  private converter: WorkerBrowserConverter;\n  private _sessionId: string;\n  private _documentType: 'writer' | 'calc' | 'impress' | 'draw';\n  private _pageCount: number;\n  private _closed = false;\n\n  constructor(\n    converter: WorkerBrowserConverter,\n    sessionId: string,\n    documentType: 'writer' | 'calc' | 'impress' | 'draw',\n    pageCount: number\n  ) {\n    this.converter = converter;\n    this._sessionId = sessionId;\n    this._documentType = documentType;\n    this._pageCount = pageCount;\n  }\n\n  /** Get the session ID */\n  get sessionId(): string { return this._sessionId; }\n\n  /** Get the document type (writer, calc, impress, draw) */\n  get documentType(): 'writer' | 'calc' | 'impress' | 'draw' { return this._documentType; }\n\n  /** Get the page count */\n  get pageCount(): number { return this._pageCount; }\n\n  /** Check if the document is still open */\n  get isOpen(): boolean { return !this._closed; }\n\n  // ============================================\n  // Common Editor Methods\n  // ============================================\n\n  /** Get document structure */\n  async getStructure(): Promise<EditorOperationResult> {\n    this.assertOpen();\n    return this.converter._sendEditorOperation(this._sessionId, 'getStructure');\n  }\n\n  /** Undo last operation */\n  async undo(): Promise<EditorOperationResult> {\n    this.assertOpen();\n    return this.converter._sendEditorOperation(this._sessionId, 'undo');\n  }\n\n  /** Redo last undone operation */\n  async redo(): Promise<EditorOperationResult> {\n    this.assertOpen();\n    return this.converter._sendEditorOperation(this._sessionId, 'redo');\n  }\n\n  /** Find text in document */\n  async find(text: string, options?: { caseSensitive?: boolean; wholeWord?: boolean }): Promise<EditorOperationResult> {\n    this.assertOpen();\n    return this.converter._sendEditorOperation(this._sessionId, 'find', [text, options]);\n  }\n\n  /** Find and replace all occurrences */\n  async findAndReplaceAll(find: string, replace: string, options?: { caseSensitive?: boolean; wholeWord?: boolean }): Promise<EditorOperationResult> {\n    this.assertOpen();\n    return this.converter._sendEditorOperation(this._sessionId, 'findAndReplaceAll', [find, replace, options]);\n  }\n\n  /** Get current selection */\n  async getSelection(): Promise<EditorOperationResult> {\n    this.assertOpen();\n    return this.converter._sendEditorOperation(this._sessionId, 'getSelection');\n  }\n\n  /** Clear current selection */\n  async clearSelection(): Promise<EditorOperationResult> {\n    this.assertOpen();\n    return this.converter._sendEditorOperation(this._sessionId, 'clearSelection');\n  }\n\n  /** Get STATE_CHANGED events as a map */\n  async getStateChanges(): Promise<EditorOperationResult> {\n    this.assertOpen();\n    return this.converter._sendEditorOperation(this._sessionId, 'getStateChanges');\n  }\n\n  /** Flush callbacks and poll state changes */\n  async flushAndPollState(): Promise<EditorOperationResult> {\n    this.assertOpen();\n    return this.converter._sendEditorOperation(this._sessionId, 'flushAndPollState');\n  }\n\n  // ============================================\n  // Writer-specific Methods\n  // ============================================\n\n  /**\n   * Get text formatting at current cursor/selection position\n   * Uses callback mechanism to retrieve STATE_CHANGED events\n   * @returns TextFormat with bold, italic, underline, fontSize, fontName\n   */\n  async getFormat(): Promise<EditorOperationResult> {\n    this.assertOpen();\n    return this.converter._sendEditorOperation(this._sessionId, 'getFormat');\n  }\n\n  /** Get raw formatting state from callbacks */\n  async getSelectionFormat(): Promise<EditorOperationResult> {\n    this.assertOpen();\n    return this.converter._sendEditorOperation(this._sessionId, 'getSelectionFormat');\n  }\n\n  /** Get a specific paragraph by index */\n  async getParagraph(index: number): Promise<EditorOperationResult> {\n    this.assertOpen();\n    return this.converter._sendEditorOperation(this._sessionId, 'getParagraph', [index]);\n  }\n\n  /** Get multiple paragraphs */\n  async getParagraphs(start: number, count: number): Promise<EditorOperationResult> {\n    this.assertOpen();\n    return this.converter._sendEditorOperation(this._sessionId, 'getParagraphs', [start, count]);\n  }\n\n  /** Insert a new paragraph */\n  async insertParagraph(text: string, options?: { afterIndex?: number; style?: string }): Promise<EditorOperationResult> {\n    this.assertOpen();\n    return this.converter._sendEditorOperation(this._sessionId, 'insertParagraph', [text, options]);\n  }\n\n  /** Replace a paragraph */\n  async replaceParagraph(index: number, text: string): Promise<EditorOperationResult> {\n    this.assertOpen();\n    return this.converter._sendEditorOperation(this._sessionId, 'replaceParagraph', [index, text]);\n  }\n\n  /** Delete a paragraph */\n  async deleteParagraph(index: number): Promise<EditorOperationResult> {\n    this.assertOpen();\n    return this.converter._sendEditorOperation(this._sessionId, 'deleteParagraph', [index]);\n  }\n\n  /** Format text in a range */\n  async formatText(range: { start: { paragraph: number; character: number }; end: { paragraph: number; character: number } }, format: { bold?: boolean; italic?: boolean; underline?: boolean; fontSize?: number; fontName?: string }): Promise<EditorOperationResult> {\n    this.assertOpen();\n    return this.converter._sendEditorOperation(this._sessionId, 'formatText', [range, format]);\n  }\n\n  /** Replace text in document */\n  async replaceText(find: string, replace: string, options?: { paragraph?: number; all?: boolean }): Promise<EditorOperationResult> {\n    this.assertOpen();\n    return this.converter._sendEditorOperation(this._sessionId, 'replaceText', [find, replace, options]);\n  }\n\n  // ============================================\n  // Lifecycle Methods\n  // ============================================\n\n  /**\n   * Save and close the document, returning the modified data\n   * @returns The modified document as Uint8Array\n   */\n  async close(): Promise<Uint8Array | undefined> {\n    this.assertOpen();\n    this._closed = true;\n    return this.converter._closeDocument(this._sessionId);\n  }\n\n  private assertOpen(): void {\n    if (this._closed) {\n      throw new Error('Document session is closed');\n    }\n  }\n}\n\n/**\n * Create drop zone for file conversion\n */\nexport function createDropZone(\n  element: HTMLElement | string,\n  options: BrowserWasmPaths & {\n    outputFormat: OutputFormat;\n    onConvert?: (result: ConversionResult) => void;\n    onError?: (error: Error) => void;\n    onProgress?: (progress: { percent: number; message: string }) => void;\n    autoDownload?: boolean;\n  }\n): { destroy: () => void } {\n  const el = typeof element === 'string' ? document.querySelector<HTMLElement>(element) : element;\n  if (!el) throw new Error('Element not found');\n\n  let converter: BrowserConverter | null = null;\n\n  const handleDrop = async (e: DragEvent): Promise<void> => {\n    e.preventDefault();\n    el.classList.remove('dragover');\n    const files = e.dataTransfer?.files;\n    if (!files?.length) return Promise.resolve();\n\n    try {\n      if (!converter) {\n        converter = new BrowserConverter({\n          sofficeJs: options.sofficeJs,\n          sofficeWasm: options.sofficeWasm,\n          sofficeData: options.sofficeData,\n          sofficeWorkerJs: options.sofficeWorkerJs,\n          onProgress: options.onProgress ? (p: WasmLoadProgress) => options.onProgress!({ percent: p.percent, message: p.message }) : undefined,\n        });\n        await converter.initialize();\n      }\n\n      for (const file of Array.from(files)) {\n        const result = await converter.convertFile(file, { outputFormat: options.outputFormat });\n        options.onConvert?.(result);\n        if (options.autoDownload !== false) converter.download(result);\n      }\n    } catch (err) {\n      options.onError?.(err as Error);\n    }\n  };\n\n  const handleDragOver = (e: DragEvent) => { e.preventDefault(); el.classList.add('dragover'); };\n  const handleDragLeave = (e: DragEvent) => { e.preventDefault(); el.classList.remove('dragover'); };\n\n  el.addEventListener('drop', handleDrop);\n  el.addEventListener('dragover', handleDragOver);\n  el.addEventListener('dragleave', handleDragLeave);\n\n  return {\n    destroy: () => {\n      el.removeEventListener('drop', handleDrop);\n      el.removeEventListener('dragover', handleDragOver);\n      el.removeEventListener('dragleave', handleDragLeave);\n      converter?.destroy();\n    },\n  };\n}\n\n/**\n * Quick convert with auto-download\n */\nexport async function quickConvert(\n  file: File,\n  outputFormat: OutputFormat,\n  options: BrowserWasmPaths & { download?: boolean }\n): Promise<ConversionResult> {\n  const converter = new BrowserConverter({\n    sofficeJs: options.sofficeJs,\n    sofficeWasm: options.sofficeWasm,\n    sofficeData: options.sofficeData,\n    sofficeWorkerJs: options.sofficeWorkerJs,\n  });\n  try {\n    await converter.initialize();\n    const result = await converter.convertFile(file, { outputFormat });\n    if (options.download !== false) converter.download(result);\n    return result;\n  } finally {\n    await converter.destroy();\n  }\n}\n"]}