{"version":3,"sources":["../src/types.ts","../src/editor/base.ts","../src/editor/writer.ts","../src/editor/calc.ts","../src/editor/impress.ts","../src/editor/draw.ts","../src/editor/index.ts","../src/lok-bindings.ts","../src/converter.ts","../src/browser.worker.ts"],"names":["ConversionError","code","message","details","FORMAT_FILTERS","FORMAT_MIME_TYPES","EXTENSION_TO_FORMAT","LOK_DOCTYPE_OUTPUT_FORMATS","getOutputFormatsForDocType","docType","OUTPUT_FORMAT_TO_LOK","FORMAT_FILTER_OPTIONS","CSV_IMPORT_FILTER_OPTIONS","buildLoadOptions","inputFormat","password","options","INPUT_FORMAT_CATEGORY","CATEGORY_OUTPUT_FORMATS","getValidOutputFormats","format","category","isConversionValid","outputFormat","getConversionErrorMessage","input","output","validOutputs","reason","OfficeEditor","lok","docPtr","error","path","afterMode","text","searchArgs","selection","hasMatch","find","replace","states","_selection","data","suggestion","truncation","content","maxChars","limit","original","truncated","lastSpace","items","itemToString","charCount","includedCount","item","itemStr","a1","match","colStr","rowStr","col","row","c","remainder","ref","WriterEditor","paragraphs","paragraphInfos","index","truncResult","p","structure","w","start","count","end","result","insertIndex","textArgs","styleName","styleArgs","oldText","findReplaceArgs","deletedText","_position","_start","_end","command","_range","args","boldState","italicState","underlineState","fontSizeState","size","fontNameState","existingStates","allText","CalcEditor","_options","numSheets","sheets","i","name","dataArea","names","cell","sheet","address","value","formula","range","startRow","startCol","endRow","endCol","cells","r","rowData","cellData","cellStr","sum","oldValue","valueStr","newValue","expectedStr","calculatedValue","values","cellsUpdated","rowValues","rangeStr","cellsCleared","afterRow","afterCol","colNum","newName","num","parts","hex","ImpressEditor","numSlides","slides","slideData","textFrames","f","newIndex","fromIndex","toIndex","title","oldTitle","body","oldBody","notes","layout","frames","titleFrame","para","idx","type","layoutId","DrawEditor","numPages","pages","pageInfo","shapes","pageData","pageIndex","shapeType","bounds","shapeCommand","boundsArgs","colorArgs","widthArgs","shapeIndex","newPosition","newSize","LOK_DOCTYPE_TEXT","LOK_DOCTYPE_SPREADSHEET","LOK_DOCTYPE_PRESENTATION","LOK_DOCTYPE_DRAWING","createEditor","getCallbackTypeName","LOK_CLASS","DOC_CLASS","textEncoder","textDecoder","LOKBindings","module","verbose","str","bytes","ptr","heap","slice","addr","installPath","pathPtr","hook","errPtr","lokClassPtr","getErrorPtr","fileUrl","startTime","documentLoadPtr","optsPtr","loadWithOptsPtr","outputPath","filterOptions","urlPtr","formatPtr","docClassPtr","saveAsPtr","destroyPtr","part","sizePtr","width","height","canvasWidth","canvasHeight","tilePosX","tilePosY","tileWidth","tileHeight","bufferSize","bufferPtr","editMode","currentPart","docSize","pageRectsStr","pageRect","aspectRatio","outputWidth","outputHeight","dpi","maxDimension","TWIPS_PER_INCH","effectiveDpi","scale","mimeType","mimePtr","usedMimePtr","resultPtr","x","y","buttons","modifier","charCode","keyCode","notifyWhenFinished","cmdPtr","argsPtr","dataPtr","dataSize","tilePixelWidth","tilePixelHeight","tileTwipWidth","tileTwipHeight","viewId","enabled","colPtr","rowPtr","mode","optionsPtr","payloadBuffer","payloadLengthPtr","eventType","payloadLength","payload","len","events","event","hasShim","eqIndex","key","rectanglesStr","s","rect","LibreOfficeConverter","msg","resolve","convError","wasmPath","moduleUrl","config","script","reject","createModule","moduleWithCallback","fs","tryMkdir","originalOpen","flags","err","logDir","label","e","versionInfo","filename","inputData","inputExt","outputExt","inputPath","outputFilename","loadOptions","stat","lokFormat","pdfOpts","levelMap","pageNum","outputData","fsError","renderOptions","pageIndices","numParts","pagesToRender","_","results","preview","pageCount","validOutputFormats","docTypeNames","rectsStr","sheetIndex","_input","_sessionId","_method","_args","mod","worker","lastDot","phase","percent","PHASE_WEIGHTS","phaseProgress","currentInitRequestId","lastEmittedPercent","calculateTotalProgress","total","formatBytes","emitDownloadProgress","loaded","weight","phasePercent","newProgress","emitProgress","emitPhaseProgress","progress","installProgressInterceptors","originalFetch","init","url","response","contentLength","reader","stream","controller","done","OriginalXHR","ProgressXMLHttpRequest","xhr","requestUrl","method","async","username","originalSend","downloadPhase","lokBindings","converter","initialized","cachedDoc","editorSessions","sessionCounter","hashInput","hash","step","byte","getDocumentPageCount","pageRects","getOrLoadDocument","inputHash","closeCachedDocument","filePath","postResponse","postProgress","id","handleInit","sofficeJs","sofficeWasm","sofficeData","sofficeWorkerJs","_scriptDir","checkReady","orig","IMAGE_FORMATS","handleConvert","isImageFormat","inPath","outPath","outputFiles","baseOpts","pageFiles","docWidth","docHeight","exportWidth","exportHeight","pageOutPath","pageOpts","pageCopy","zipData","createSimpleZip","opts","sharedResult","files","chunks","centralDirectory","offset","file","nameBytes","localHeader","view","crc32","cdEntry","cdView","cdOffset","cdSize","entry","eocd","eocdView","totalSize","chunk","pos","crc","j","handleGetPageCount","handleRenderPreviews","maxWidth","previews","rendered","dataCopy","transfers","handleRenderSinglePage","errorMsg","handleRenderPageViaConvert","filterOpts","pngData","pngCopy","handleRenderPageFullQuality","handleGetDocumentInfo","docTypeOutputFormats","documentInfo","handleGetLokInfo","pageRectangles","documentSize","partInfo","a11yFocusedParagraph","a11yCaretPosition","newViewId","parsedPartInfo","parsedA11yParagraph","lokInfo","handleEditText","findText","replaceText","insertText","operationResult","searchErr","pasteResult","insertArgs","ext","saveFormat","modifiedData","modifiedCopy","editResult","saveError","errorObj","moduleAny","exMsg","handleRenderPageRectangles","parsedRects","transferBuffers","handleTestLokOperations","selectedText","textLength","selType","selTypeAfterReset","selectedBeforeDelete","textAfterUndo","textAfterRedo","selectedForBold","selectedForItalic","existingCount","countAfterSel","hasEvents","stateChanges","formatInfo","bold","italic","underline","fontName","fontSize","color","coordSelectedText","summary","handleOpenDocument","sessionId","editor","documentType","handleEditorOperation","editorMethod","editorArgs","session","serializedData","handleCloseDocument","handleDestroy"],"mappings":"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","file":"browser.worker.global.js","sourcesContent":["/**\n * LibreOffice WASM Document Conversion Types\n * Headless document format conversion toolkit\n */\n\n/**\n * Supported input document formats\n */\nexport type InputFormat =\n  // Microsoft Office formats\n  | 'doc'\n  | 'docx'\n  | 'xls'\n  | 'xlsx'\n  | 'ppt'\n  | 'pptx'\n  // OpenDocument formats\n  | 'odt'\n  | 'ods'\n  | 'odp'\n  | 'odg'\n  | 'odf'\n  // Other formats\n  | 'rtf'\n  | 'txt'\n  | 'html'\n  | 'htm'\n  | 'csv'\n  | 'xml'\n  | 'epub'\n  | 'pdf';\n\n/**\n * Supported output document formats\n */\nexport type OutputFormat =\n  | 'pdf'\n  | 'docx'\n  | 'doc'\n  | 'odt'\n  | 'rtf'\n  | 'txt'\n  | 'html'\n  | 'xlsx'\n  | 'xls'\n  | 'ods'\n  | 'csv'\n  | 'pptx'\n  | 'ppt'\n  | 'odp'\n  | 'png'\n  | 'jpg'\n  | 'svg';\n\n/**\n * Document conversion options\n */\nexport interface ConversionOptions {\n  /**\n   * Output format for the conversion\n   */\n  outputFormat: OutputFormat;\n\n  /**\n   * Input format hint (auto-detected if not provided)\n   */\n  inputFormat?: InputFormat;\n\n  /**\n   * PDF-specific options\n   */\n  pdf?: PdfOptions;\n\n  /**\n   * Image output options (for png, jpg, svg)\n   */\n  image?: ImageOptions;\n\n  /**\n   * Password for encrypted documents\n   */\n  password?: string;\n}\n\n/**\n * PDF-specific conversion options\n */\nexport interface PdfOptions {\n  /**\n   * PDF/A conformance level\n   */\n  pdfaLevel?: 'PDF/A-1b' | 'PDF/A-2b' | 'PDF/A-3b';\n\n  /**\n   * PDF quality (0-100, affects image compression)\n   * @default 90\n   */\n  quality?: number;\n}\n\n/**\n * Image output options\n */\nexport interface ImageOptions {\n  /**\n   * Image width in pixels\n   */\n  width?: number;\n\n  /**\n   * Image height in pixels\n   */\n  height?: number;\n\n  /**\n   * DPI for rendering\n   * @default 150\n   */\n  dpi?: number;\n\n  /**\n   * Page index to export (0-based). Only exports this single page.\n   * If not specified, exports the first page (page 0).\n   * Cannot be used together with `pages`.\n   */\n  pageIndex?: number;\n\n  /**\n   * Array of page indices to export (0-based).\n   * If specified, returns an array of results (one per page).\n   * Cannot be used together with `pageIndex`.\n   */\n  pages?: number[];\n}\n\n/**\n * Result of a document conversion\n */\nexport interface ConversionResult {\n  /**\n   * The converted document data\n   */\n  data: Uint8Array;\n\n  /**\n   * MIME type of the output\n   */\n  mimeType: string;\n\n  /**\n   * Suggested filename with new extension\n   */\n  filename: string;\n\n  /**\n   * Conversion duration in milliseconds\n   */\n  duration: number;\n}\n\n/**\n * WASM loader module interface\n * This is the interface for the loader.cjs module that creates the Emscripten module\n */\nexport interface WasmLoaderModule {\n  createModule: (config: Record<string, unknown>) => Promise<EmscriptenModule>;\n}\n\n/**\n * LibreOffice WASM module initialization options (Node.js)\n */\nexport interface LibreOfficeWasmOptions {\n  /**\n   * Path to WASM files directory\n   * @default './wasm'\n   */\n  wasmPath?: string;\n\n  /**\n   * Path to the worker script (for WorkerConverter)\n   * When not specified, auto-detected based on module location\n   */\n  workerPath?: string;\n\n  /**\n   * Pre-loaded WASM loader module\n   * When provided, bypasses dynamic require of loader.cjs\n   * This is useful for bundlers like Turbopack that can't handle dynamic requires\n   *\n   * @example\n   * ```typescript\n   * // In your code, import the loader statically\n   * import * as wasmLoader from '@matbee/libreoffice-converter/wasm/loader.cjs';\n   *\n   * const converter = new LibreOfficeConverter({\n   *   wasmPath: './wasm',\n   *   wasmLoader,\n   * });\n   * ```\n   */\n  wasmLoader?: WasmLoaderModule;\n\n  /**\n   * Enable verbose logging\n   * @default false\n   */\n  verbose?: boolean;\n\n  /**\n   * Called when WASM module is ready\n   */\n  onReady?: () => void;\n\n  /**\n   * Called on initialization error\n   */\n  onError?: (error: Error) => void;\n\n  /**\n   * Called with progress updates during initialization\n   */\n  onProgress?: (progress: ProgressInfo) => void;\n}\n\n/**\n * Explicit paths to WASM files (Browser)\n * All paths are required when specified explicitly\n */\nexport interface BrowserWasmPaths {\n  /** URL to soffice.js - the main Emscripten loader script */\n  sofficeJs: string;\n  /** URL to soffice.wasm - the WebAssembly binary (~112MB) */\n  sofficeWasm: string;\n  /** URL to soffice.data - the virtual filesystem image (~80MB) */\n  sofficeData: string;\n  /** URL to soffice.worker.js - the Emscripten pthread worker */\n  sofficeWorkerJs: string;\n}\n\n/**\n * Browser converter initialization options\n * All WASM paths are optional and default to /wasm/ via createWasmPaths()\n */\nexport interface BrowserConverterOptions {\n  /** URL to soffice.js - defaults to /wasm/soffice.js */\n  sofficeJs?: string;\n  /** URL to soffice.wasm - defaults to /wasm/soffice.wasm */\n  sofficeWasm?: string;\n  /** URL to soffice.data - defaults to /wasm/soffice.data */\n  sofficeData?: string;\n  /** URL to soffice.worker.js - defaults to /wasm/soffice.worker.js */\n  sofficeWorkerJs?: string;\n\n  /**\n   * Enable verbose logging\n   * @default false\n   */\n  verbose?: boolean;\n\n  /**\n   * Called when WASM module is ready\n   */\n  onReady?: () => void;\n\n  /**\n   * Called on initialization error\n   */\n  onError?: (error: Error) => void;\n\n  /**\n   * Called with progress updates during initialization\n   */\n  onProgress?: (progress: WasmLoadProgress) => void;\n}\n\n/**\n * Worker browser converter initialization options\n * All WASM paths are optional and default to /wasm/ via createWasmPaths()\n */\nexport interface WorkerBrowserConverterOptions extends BrowserConverterOptions {\n  /** URL to browser.worker.js - defaults to /dist/browser.worker.global.js */\n  browserWorkerJs?: string;\n  /**\n   * Enable download progress tracking during WASM initialization\n   * When enabled, intercepts fetch/XHR to track download progress for soffice.wasm and soffice.data\n   * \n   * **WARNING**: This is disabled by default because the fetch interceptor can break\n   * WebAssembly streaming compilation in some environments. Only enable if you need\n   * detailed download progress and have tested it works in your target browsers.\n   * \n   * @default false\n   */\n  enableProgressTracking?: boolean;\n}\n\n/**\n * Internal type for BrowserConverterOptions after defaults are applied\n * All WASM paths are guaranteed to be defined\n */\nexport type ResolvedBrowserConverterOptions = BrowserConverterOptions & BrowserWasmPaths;\n\n/**\n * Internal type for WorkerBrowserConverterOptions after defaults are applied\n * All WASM paths and browserWorkerJs are guaranteed to be defined\n */\nexport type ResolvedWorkerBrowserConverterOptions = WorkerBrowserConverterOptions & BrowserWasmPaths & {\n  browserWorkerJs: string;\n};\n\n/**\n * Default URL for WASM files - relative path for same-origin hosting\n * Users typically serve WASM files from their own server at /wasm/\n */\nexport const DEFAULT_WASM_BASE_URL = '/wasm/';\n\n/**\n * Create WASM file paths from a base URL\n * Convenience helper for users who keep all WASM files in one directory\n *\n * @param baseUrl - Base URL ending with '/' (e.g., '/wasm/', 'https://cdn.example.com/wasm/')\n *                  Defaults to '/wasm/' for same-origin hosting\n * @returns Object with all WASM file paths\n *\n * @example\n * ```typescript\n * // Use default /wasm/ path (same-origin)\n * const converter = new WorkerBrowserConverter({\n *   ...createWasmPaths(),\n *   browserWorkerJs: '/dist/browser.worker.js',\n * });\n *\n * // Or use your own CDN\n * const converter = new WorkerBrowserConverter({\n *   ...createWasmPaths('https://cdn.example.com/wasm/'),\n *   browserWorkerJs: '/dist/browser.worker.js',\n * });\n * ```\n */\nexport function createWasmPaths(baseUrl: string = DEFAULT_WASM_BASE_URL): BrowserWasmPaths {\n  // Ensure baseUrl ends with /\n  const base = baseUrl.endsWith('/') ? baseUrl : `${baseUrl}/`;\n  return {\n    sofficeJs: `${base}soffice.js`,\n    sofficeWasm: `${base}soffice.wasm`,\n    sofficeData: `${base}soffice.data`,\n    sofficeWorkerJs: `${base}soffice.worker.js`,\n  };\n}\n\n/**\n * Loading phases for WASM initialization\n * Used to track detailed progress during the ~80 second browser startup\n */\nexport type WasmLoadPhase =\n  | 'download-wasm'    // Downloading soffice.wasm (~142MB)\n  | 'download-data'    // Downloading soffice.data (~96MB)\n  | 'compile'          // WebAssembly compilation\n  | 'filesystem'       // Emscripten filesystem setup\n  | 'lok-init'         // LibreOfficeKit initialization\n  | 'ready' | 'starting' | 'loading' | 'initializing' | 'converting' | 'complete';           // Complete\n\n/**\n * Extended progress information with download details\n * Backward compatible - existing code using percent/message continues to work\n */\nexport interface WasmLoadProgress {\n  /** Overall progress 0-100 */\n  percent: number;\n  /** Human-readable status message */\n  message: string;\n  /** Current loading phase */\n  phase: WasmLoadPhase;\n  /** Bytes downloaded (present during download phases) */\n  bytesLoaded?: number;\n  /** Total bytes to download (present during download phases) */\n  bytesTotal?: number;\n}\n\n/**\n * Progress information\n * @deprecated Use WasmLoadProgress for richer progress data\n */\nexport interface ProgressInfo {\n  phase: 'loading' | 'initializing' | 'converting' | 'complete';\n  percent: number;\n  message: string;\n}\n\n/**\n * Error codes for conversion failures\n */\nexport enum ConversionErrorCode {\n  UNKNOWN = 'UNKNOWN',\n  INVALID_INPUT = 'INVALID_INPUT',\n  UNSUPPORTED_FORMAT = 'UNSUPPORTED_FORMAT',\n  CORRUPTED_DOCUMENT = 'CORRUPTED_DOCUMENT',\n  PASSWORD_REQUIRED = 'PASSWORD_REQUIRED',\n  WASM_NOT_INITIALIZED = 'WASM_NOT_INITIALIZED',\n  CONVERSION_FAILED = 'CONVERSION_FAILED',\n  LOAD_FAILED = 'LOAD_FAILED',\n}\n\n/**\n * Custom error class for conversion errors\n */\nexport class ConversionError extends Error {\n  public readonly code: ConversionErrorCode;\n  public readonly details?: string;\n\n  constructor(code: ConversionErrorCode, message: string, details?: string) {\n    super(message);\n    this.name = 'ConversionError';\n    this.code = code;\n    this.details = details;\n  }\n}\n\n/**\n * Emscripten Module interface\n */\nexport interface EmscriptenModule {\n  // Core Emscripten functions\n  ccall: (\n    name: string,\n    returnType: string | null,\n    argTypes: string[],\n    args: unknown[]\n  ) => unknown;\n  cwrap: (\n    name: string,\n    returnType: string | null,\n    argTypes: string[]\n  ) => (...args: unknown[]) => unknown;\n\n  // Memory management\n  _malloc: (size: number) => number;\n  _free: (ptr: number) => void;\n  HEAPU8: Uint8Array;\n  HEAP32: Int32Array;\n  HEAPU32: Uint32Array;\n\n  // File system\n  FS: EmscriptenFS;\n\n  // Lifecycle\n  onRuntimeInitialized?: () => void;\n  calledRun?: boolean;\n\n  // LibreOfficeKit hooks (exported C functions)\n  _lok_preinit?: (path: number, args: number) => number;\n  _lok_preinit_2?: (path: number, args: number, callback: number) => number;\n  _libreofficekit_hook?: (path: number) => number;\n  _libreofficekit_hook_2?: (path: number, userProfile: number) => number;\n  _main?: (argc: number, argv: number) => number;\n\n  // WebAssembly function table for indirect calls\n  wasmTable?: WebAssembly.Table;\n\n  // Module locator\n  locateFile?: (path: string) => string;\n  print?: (text: string) => void;\n  printErr?: (text: string) => void;\n\n  // Runtime ready promise (some builds)\n  ready?: Promise<EmscriptenModule>;\n}\n\n/**\n * Emscripten virtual filesystem\n */\nexport interface EmscriptenFS {\n  mkdir: (path: string) => void;\n  writeFile: (path: string, data: Uint8Array | string, opts?: { encoding?: string }) => void;\n  readFile: (path: string, opts?: { encoding?: string }) => Uint8Array | string;\n  unlink: (path: string) => void;\n  readdir: (path: string) => string[];\n  stat: (path: string) => { size: number; isDirectory: () => boolean };\n  rmdir: (path: string) => void;\n  rename: (oldPath: string, newPath: string) => void;\n  open: (path: string, flags: unknown, mode?: unknown) => unknown;\n}\n\n/**\n * Filter name mapping for LibreOffice export\n * Note: For image exports, use getFilterForDocType() instead as filters are document-type specific\n */\nexport const FORMAT_FILTERS: Record<OutputFormat, string> = {\n  pdf: 'writer_pdf_Export',\n  docx: 'MS Word 2007 XML',\n  doc: 'MS Word 97',\n  odt: 'writer8',\n  rtf: 'Rich Text Format',\n  txt: 'Text',\n  html: 'HTML (StarWriter)',\n  xlsx: 'Calc MS Excel 2007 XML',\n  xls: 'MS Excel 97',\n  ods: 'calc8',\n  csv: 'Text - txt - csv (StarCalc)',\n  pptx: 'Impress MS PowerPoint 2007 XML',\n  ppt: 'MS PowerPoint 97',\n  odp: 'impress8',\n  png: 'writer_png_Export',\n  jpg: 'writer_jpg_Export',\n  svg: 'writer_svg_Export',\n};\n\n/**\n * LibreOfficeKit document types (from LibreOfficeKitEnums.h)\n */\nexport enum LOKDocumentType {\n  TEXT = 0,\n  SPREADSHEET = 1,\n  PRESENTATION = 2,\n  DRAWING = 3,\n  OTHER = 4,\n}\n\n/**\n * Document-type-specific filters for image and PDF exports\n * Each document type (Writer, Calc, Impress, Draw) has its own export filters\n */\nexport const DOC_TYPE_FILTERS: Record<LOKDocumentType, Partial<Record<OutputFormat, string>>> = {\n  [LOKDocumentType.TEXT]: {\n    pdf: 'writer_pdf_Export',\n    png: 'writer_png_Export',\n    jpg: 'writer_jpg_Export',\n    svg: 'writer_svg_Export',\n    html: 'HTML (StarWriter)',\n  },\n  [LOKDocumentType.SPREADSHEET]: {\n    pdf: 'calc_pdf_Export',\n    png: 'calc_png_Export',\n    jpg: 'calc_jpg_Export',\n    svg: 'calc_svg_Export',\n    html: 'HTML (StarCalc)',\n  },\n  [LOKDocumentType.PRESENTATION]: {\n    pdf: 'impress_pdf_Export',\n    png: 'impress_png_Export',\n    jpg: 'impress_jpg_Export',\n    svg: 'impress_svg_Export',\n    html: 'impress_html_Export',\n  },\n  [LOKDocumentType.DRAWING]: {\n    pdf: 'draw_pdf_Export',\n    png: 'draw_png_Export',\n    jpg: 'draw_jpg_Export',\n    svg: 'draw_svg_Export',\n    html: 'draw_html_Export',\n  },\n  [LOKDocumentType.OTHER]: {\n    pdf: 'writer_pdf_Export',\n    png: 'writer_png_Export',\n    jpg: 'writer_jpg_Export',\n    svg: 'writer_svg_Export',\n  },\n};\n\n/**\n * Get the correct export filter for a given output format and document type\n * @param outputFormat The desired output format\n * @param docType The LibreOfficeKit document type (use documentGetDocumentType())\n * @returns The filter name to use for saveAs\n */\nexport function getFilterForDocType(outputFormat: OutputFormat, docType: LOKDocumentType | number): string {\n  // Check if there's a document-type-specific filter\n  const docTypeFilters = DOC_TYPE_FILTERS[docType as LOKDocumentType];\n  if (docTypeFilters && docTypeFilters[outputFormat]) {\n    return docTypeFilters[outputFormat];\n  }\n\n  // Fall back to the default filter\n  return FORMAT_FILTERS[outputFormat];\n}\n\n/**\n * MIME types for output formats\n */\nexport const FORMAT_MIME_TYPES: Record<OutputFormat, string> = {\n  pdf: 'application/pdf',\n  docx: 'application/vnd.openxmlformats-officedocument.wordprocessingml.document',\n  doc: 'application/msword',\n  odt: 'application/vnd.oasis.opendocument.text',\n  rtf: 'application/rtf',\n  txt: 'text/plain',\n  html: 'text/html',\n  xlsx: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',\n  xls: 'application/vnd.ms-excel',\n  ods: 'application/vnd.oasis.opendocument.spreadsheet',\n  csv: 'text/csv',\n  pptx: 'application/vnd.openxmlformats-officedocument.presentationml.presentation',\n  ppt: 'application/vnd.ms-powerpoint',\n  odp: 'application/vnd.oasis.opendocument.presentation',\n  png: 'image/png',\n  jpg: 'image/jpeg',\n  svg: 'image/svg+xml',\n};\n\n/**\n * File extension to format mapping\n */\nexport const EXTENSION_TO_FORMAT: Record<string, InputFormat> = {\n  doc: 'doc',\n  docx: 'docx',\n  xls: 'xls',\n  xlsx: 'xlsx',\n  ppt: 'ppt',\n  pptx: 'pptx',\n  odt: 'odt',\n  ods: 'ods',\n  odp: 'odp',\n  odg: 'odg',\n  odf: 'odf',\n  rtf: 'rtf',\n  txt: 'txt',\n  html: 'html',\n  htm: 'html',\n  csv: 'csv',\n  xml: 'xml',\n  epub: 'epub',\n  pdf: 'pdf',\n};\n\n/**\n * Map LOK document type to valid output formats\n * This is based on LibreOffice's actual extension maps in desktop/source/lib/init.cxx\n * \n * IMPORTANT: These are the formats that LibreOffice's saveAs() actually supports.\n * The extension maps in init.cxx determine what filters are available per document type.\n * \n * Writer (TEXT): doc, docx, odt, pdf, rtf, txt, html, png, epub\n * Calc (SPREADSHEET): csv, ods, pdf, xls, xlsx, html, png\n * Impress (PRESENTATION): odp, pdf, ppt, pptx, svg, html, png\n * Draw (DRAWING): odg, pdf, svg, html, png\n * \n * NOTE: jpg is NOT in any extension map! Only png is supported for image export.\n * NOTE: svg is only supported for Impress and Draw, not Writer or Calc.\n */\nexport const LOK_DOCTYPE_OUTPUT_FORMATS: Record<LOKDocumentType, OutputFormat[]> = {\n  [LOKDocumentType.TEXT]: ['pdf', 'docx', 'doc', 'odt', 'rtf', 'txt', 'html', 'png'],\n  [LOKDocumentType.SPREADSHEET]: ['pdf', 'xlsx', 'xls', 'ods', 'csv', 'html', 'png'],\n  [LOKDocumentType.PRESENTATION]: ['pdf', 'pptx', 'ppt', 'odp', 'png', 'svg', 'html'],\n  [LOKDocumentType.DRAWING]: ['pdf', 'png', 'svg', 'html'],\n  [LOKDocumentType.OTHER]: ['pdf'],\n};\n\n/**\n * Get valid output formats for a LOK document type\n * Use this after loading a document to get accurate conversion options\n * @param docType The LOK document type (from documentGetDocumentType)\n * @returns Array of valid output formats\n */\nexport function getOutputFormatsForDocType(docType: LOKDocumentType | number): OutputFormat[] {\n  return LOK_DOCTYPE_OUTPUT_FORMATS[docType as LOKDocumentType] || ['pdf'];\n}\n\n/**\n * Map output format to LOK format string\n * These are the format names used by LibreOfficeKit's saveAs\n */\nexport const OUTPUT_FORMAT_TO_LOK: Record<OutputFormat, string> = {\n  pdf: 'pdf',\n  docx: 'docx',\n  doc: 'doc',\n  odt: 'odt',\n  rtf: 'rtf',\n  txt: 'txt',\n  html: 'html',\n  xlsx: 'xlsx',\n  xls: 'xls',\n  ods: 'ods',\n  csv: 'csv',\n  pptx: 'pptx',\n  ppt: 'ppt',\n  odp: 'odp',\n  png: 'png',\n  jpg: 'jpg',\n  svg: 'svg',\n};\n\n/**\n * Filter options for specific format conversions\n * These are passed to LibreOfficeKit's saveAs as the filterOptions parameter\n */\nexport const FORMAT_FILTER_OPTIONS: Partial<Record<OutputFormat, string>> = {\n  // PDF options can include things like:\n  // - SelectPdfVersion (0=PDF 1.4, 1=PDF/A-1, 2=PDF/A-2, 3=PDF/A-3)\n  // - UseLosslessCompression\n  // - Quality\n  pdf: '',\n  // CSV can specify separator, encoding, etc.\n  csv: '44,34,76,1,,0,false,true,false,false,false,-1',\n  // Text encoding\n  txt: 'UTF8',\n};\n\n/**\n * CSV Import filter options for loading CSV files as spreadsheets.\n * \n * The FilterOptions token format (15 tokens, comma-separated):\n * Token 0: Field separator ASCII code (44 = comma, 9 = tab, 59 = semicolon)\n * Token 1: Text delimiter ASCII code (34 = double quote)\n * Token 2: Character set (76 = UTF-8)\n * Token 3: Start row (1 = first row)\n * Token 4: Column format info (empty = auto-detect)\n * Token 5: Language ID (1033 = English US, 0 = system)\n * Token 6: Quoted field as text (true/false)\n * Token 7: Detect special numbers (true/false)\n * Token 8: Save as shown - export only (false)\n * Token 9: Save formulas - export only (false)\n * Token 10: Trim spaces (false)\n * Token 11: Sheet to export - export only (0)\n * Token 12: Evaluate formulas (true)\n * Token 13: Include BOM - export only (false)\n * Token 14: Detect scientific numbers (true)\n * \n * This ensures LibreOffice loads CSV files as Calc spreadsheet documents\n * in headless mode without triggering dialogs.\n */\nexport const CSV_IMPORT_FILTER_OPTIONS = 'FilterName=Text - txt - csv (StarCalc),FilterOptions=44,34,76,1,,1033,false,true,false,false,false,0,true,false,true';\n\n/**\n * Build load options for a document based on format and other options\n * @param inputFormat The input document format\n * @param password Optional password for encrypted documents\n * @returns Load options string for documentLoadWithOptions, or empty string for documentLoad\n */\nexport function buildLoadOptions(inputFormat?: string, password?: string): string {\n  const options: string[] = [];\n  \n  // CSV files need explicit import filter to be recognized as spreadsheets\n  if (inputFormat?.toLowerCase() === 'csv') {\n    options.push(CSV_IMPORT_FILTER_OPTIONS);\n  }\n  \n  // Password-protected documents\n  if (password) {\n    options.push(`Password=${password}`);\n  }\n  \n  return options.join(',');\n}\n\n/**\n * Document type categories for determining valid conversions\n */\nexport type DocumentCategory = 'text' | 'spreadsheet' | 'presentation' | 'drawing' | 'other';\n\n/**\n * Map input formats to their document category\n * This determines which output formats are valid\n */\nexport const INPUT_FORMAT_CATEGORY: Record<InputFormat, DocumentCategory> = {\n  // Text/Writer documents\n  doc: 'text',\n  docx: 'text',\n  odt: 'text',\n  rtf: 'text',\n  txt: 'text',\n  html: 'text',\n  htm: 'text',\n  epub: 'text',\n  xml: 'text',\n  // Spreadsheet/Calc documents\n  xls: 'spreadsheet',\n  xlsx: 'spreadsheet',\n  ods: 'spreadsheet',\n  csv: 'spreadsheet',\n  // Presentation/Impress documents\n  ppt: 'presentation',\n  pptx: 'presentation',\n  odp: 'presentation',\n  // Drawing/Draw documents (PDF imports as Draw)\n  odg: 'drawing',\n  odf: 'drawing',\n  pdf: 'drawing', // PDFs are imported as Draw documents\n};\n\n/**\n * Valid output formats for each document category\n * Based on LibreOffice's actual filter capabilities\n */\nexport const CATEGORY_OUTPUT_FORMATS: Record<DocumentCategory, OutputFormat[]> = {\n  // Writer documents can export to (based on aWriterExtensionMap in init.cxx):\n  // NOTE: jpg and svg are NOT supported for Writer - only png for images\n  text: ['pdf', 'docx', 'doc', 'odt', 'rtf', 'txt', 'html', 'png'],\n  // Calc documents can export to (based on aCalcExtensionMap in init.cxx):\n  // NOTE: jpg and svg are NOT supported for Calc - only png for images\n  spreadsheet: ['pdf', 'xlsx', 'xls', 'ods', 'csv', 'html', 'png'],\n  // Impress documents can export to (based on aImpressExtensionMap in init.cxx):\n  // NOTE: jpg is NOT supported - only png and svg for images\n  presentation: ['pdf', 'pptx', 'ppt', 'odp', 'png', 'svg', 'html'],\n  // Draw documents (including imported PDFs) can export to (based on aDrawExtensionMap in init.cxx):\n  // NOTE: jpg is NOT supported - only png and svg for images\n  drawing: ['pdf', 'png', 'svg', 'html'],\n  // Other/unknown - try PDF only\n  other: ['pdf'],\n};\n\n/**\n * Get valid output formats for a given input format\n * @param inputFormat The input document format\n * @returns Array of valid output formats\n */\nexport function getValidOutputFormats(inputFormat: InputFormat | string): OutputFormat[] {\n  const format = inputFormat.toLowerCase() as InputFormat;\n  const category = INPUT_FORMAT_CATEGORY[format];\n\n  if (!category) {\n    // Unknown format - allow PDF as a safe default\n    return ['pdf'];\n  }\n\n  return CATEGORY_OUTPUT_FORMATS[category];\n}\n\n/**\n * Check if a conversion from input format to output format is valid\n * @param inputFormat The input document format\n * @param outputFormat The desired output format\n * @returns true if the conversion is supported\n */\nexport function isConversionValid(\n  inputFormat: InputFormat | string,\n  outputFormat: OutputFormat | string\n): boolean {\n  const validOutputs = getValidOutputFormats(inputFormat);\n  return validOutputs.includes(outputFormat.toLowerCase() as OutputFormat);\n}\n\n/**\n * Get a human-readable error message for invalid conversions\n * @param inputFormat The input document format\n * @param outputFormat The desired output format\n * @returns Error message explaining why the conversion is not supported\n */\nexport function getConversionErrorMessage(\n  inputFormat: InputFormat | string,\n  outputFormat: OutputFormat | string\n): string {\n  const input = inputFormat.toLowerCase();\n  const output = outputFormat.toLowerCase();\n  const validOutputs = getValidOutputFormats(input as InputFormat);\n\n  const category = INPUT_FORMAT_CATEGORY[input as InputFormat] || 'unknown';\n\n  let reason = '';\n  if (category === 'drawing' && ['docx', 'doc', 'xlsx', 'xls', 'pptx', 'ppt'].includes(output)) {\n    reason = `PDF files are imported as Draw documents and cannot be exported to Office formats. `;\n  } else if (category === 'spreadsheet' && ['docx', 'doc', 'pptx', 'ppt'].includes(output)) {\n    reason = `Spreadsheet documents cannot be converted to word processing or presentation formats. `;\n  } else if (category === 'presentation' && ['docx', 'doc', 'xlsx', 'xls'].includes(output)) {\n    reason = `Presentation documents cannot be converted to word processing or spreadsheet formats. `;\n  } else if (category === 'text' && ['xlsx', 'xls', 'pptx', 'ppt'].includes(output)) {\n    reason = `Text documents cannot be converted to spreadsheet or presentation formats. `;\n  }\n\n  return `Cannot convert ${input.toUpperCase()} to ${output.toUpperCase()}. ${reason}Valid output formats for ${input.toUpperCase()}: ${validOutputs.join(', ')}`;\n}\n\n// ============================================\n// Shared Converter Interface\n// ============================================\n\n/**\n * Page preview data returned by renderPage/renderPagePreviews\n */\nexport interface PagePreview {\n  page: number;\n  data: Uint8Array;\n  width: number;\n  height: number;\n}\n\n/**\n * Document information returned by getDocumentInfo\n */\nexport interface DocumentInfo {\n  documentType: LOKDocumentType | number;\n  documentTypeName: string;\n  validOutputFormats: OutputFormat[];\n  pageCount: number;\n}\n\n/**\n * Options for rendering page previews\n */\nexport interface RenderOptions {\n  /** Width of rendered image in pixels */\n  width?: number;\n  /** Height of rendered image in pixels (0 = auto based on aspect ratio) */\n  height?: number;\n  /** Specific page indices to render (0-based). If empty, renders all pages */\n  pageIndices?: number[];\n  /**\n   * Render in edit mode (shows text input boxes, cursors, etc.)\n   * Default is false - presentations render in view/read mode for clean output\n   */\n  editMode?: boolean;\n}\n\n/**\n * Options for full quality page rendering\n */\nexport interface FullQualityRenderOptions {\n  /** DPI for rendering (default 150, use 300 for print quality) */\n  dpi?: number;\n  /** Maximum dimension (width or height) to prevent memory issues */\n  maxDimension?: number;\n  /**\n   * Render in edit mode (shows text input boxes, cursors, etc.)\n   * Default is false - presentations render in view/read mode for clean output\n   */\n  editMode?: boolean;\n}\n\n/**\n * Full quality page preview with DPI information\n */\nexport interface FullQualityPagePreview extends PagePreview {\n  /** Effective DPI (may differ from requested if capped) */\n  dpi: number;\n}\n\n/**\n * Editor session returned from openDocument\n */\nexport interface EditorSession {\n  sessionId: string;\n  documentType: string;\n  pageCount: number;\n}\n\n/**\n * Result from editor operations\n */\nexport interface EditorOperationResult<T = unknown> {\n  success: boolean;\n  verified?: boolean;\n  data?: T;\n  error?: string;\n  suggestion?: string;\n}\n\n/**\n * Options containing input format for document operations.\n */\nexport type InputFormatOptions = Pick<ConversionOptions, 'inputFormat'>;\n\n/**\n * Common interface for all LibreOffice converter implementations.\n * Ensures consistent API across different threading models (main thread, workers, child processes).\n *\n * All methods returning Promise are async in the interface to allow implementations\n * flexibility in whether they need actual async operations.\n */\nexport interface ILibreOfficeConverter {\n  // ============================================\n  // Lifecycle\n  // ============================================\n\n  /** Initialize the converter. Must be called before any other operations. */\n  initialize(): Promise<void>;\n\n  /** Destroy the converter and release all resources. */\n  destroy(): Promise<void>;\n\n  /** Check if the converter is ready for operations. */\n  isReady(): boolean;\n\n  // ============================================\n  // Core Conversion\n  // ============================================\n\n  /** Convert a document to a different format. */\n  convert(\n    input: Uint8Array | ArrayBuffer,\n    options: ConversionOptions,\n    filename?: string\n  ): Promise<ConversionResult>;\n\n  // ============================================\n  // Document Inspection\n  // ============================================\n\n  /** Get the number of pages in a document. */\n  getPageCount(\n    input: Uint8Array | ArrayBuffer,\n    options: InputFormatOptions\n  ): Promise<number>;\n\n  /** Get document information including type and valid output formats. */\n  getDocumentInfo(\n    input: Uint8Array | ArrayBuffer,\n    options: InputFormatOptions\n  ): Promise<DocumentInfo>;\n\n  // ============================================\n  // Page Rendering\n  // ============================================\n\n  /** Render a single page as an image. */\n  renderPage(\n    input: Uint8Array | ArrayBuffer,\n    options: InputFormatOptions,\n    pageIndex: number,\n    width: number,\n    height?: number\n  ): Promise<PagePreview>;\n\n  /** Render multiple pages as images. */\n  renderPagePreviews(\n    input: Uint8Array | ArrayBuffer,\n    options: InputFormatOptions,\n    renderOptions?: RenderOptions\n  ): Promise<PagePreview[]>;\n\n  /**\n   * Render a page at full quality (native resolution based on DPI).\n   * Unlike renderPage which scales to a fixed width, this renders at the\n   * document's native resolution converted to pixels at the specified DPI.\n   */\n  renderPageFullQuality(\n    input: Uint8Array | ArrayBuffer,\n    options: InputFormatOptions,\n    pageIndex: number,\n    renderOptions?: FullQualityRenderOptions\n  ): Promise<FullQualityPagePreview>;\n\n  // ============================================\n  // Editor Operations\n  // ============================================\n\n  /** Open a document for editing and return a session. */\n  openDocument(\n    input: Uint8Array | ArrayBuffer,\n    options: InputFormatOptions\n  ): Promise<EditorSession>;\n\n  /** Execute an editor operation on an open document. */\n  editorOperation<T = unknown>(\n    sessionId: string,\n    method: string,\n    args?: unknown[]\n  ): Promise<EditorOperationResult<T>>;\n\n  /** Close an editor session and optionally get the modified document. */\n  closeDocument(sessionId: string): Promise<Uint8Array | undefined>;\n}\n","// src/editor/base.ts\nimport type { LOKBindings } from '../lok-bindings.js';\nimport type { OutputFormat } from '../types.js';\nimport type {\n  OperationResult,\n  DocumentStructure,\n  OpenDocumentOptions,\n  SelectionRange,\n  FindOptions,\n  Position,\n  TruncationInfo,\n  CellRef,\n} from './types.js';\n\n/**\n * Abstract base class for all document editors\n */\nexport abstract class OfficeEditor {\n  protected lok: LOKBindings;\n  protected docPtr: number;\n  protected options: Required<Pick<OpenDocumentOptions, 'maxResponseChars'>> & OpenDocumentOptions;\n  protected inputPath: string = '';\n\n  constructor(lok: LOKBindings, docPtr: number, options: OpenDocumentOptions = {}) {\n    this.lok = lok;\n    this.docPtr = docPtr;\n    this.options = {\n      maxResponseChars: options.maxResponseChars ?? 8000,\n      ...options,\n    };\n  }\n\n  // ============================================\n  // Abstract methods (implemented by subclasses)\n  // ============================================\n\n  abstract getStructure(options?: { maxResponseChars?: number }): OperationResult<DocumentStructure>;\n  abstract getDocumentType(): 'writer' | 'calc' | 'impress' | 'draw';\n\n  // ============================================\n  // Accessor methods\n  // ============================================\n\n  /**\n   * Get the document pointer for low-level LOK operations\n   */\n  getDocPtr(): number {\n    return this.docPtr;\n  }\n\n  /**\n   * Get the LOK bindings for low-level operations\n   */\n  getLokBindings(): LOKBindings {\n    return this.lok;\n  }\n\n  // ============================================\n  // Lifecycle methods\n  // ============================================\n\n  save(): OperationResult<{ path: string }> {\n    try {\n      // Save to the original path\n      if (!this.inputPath) {\n        return this.createErrorResult('No input path set', 'Use saveAs() to specify a path');\n      }\n      // LibreOffice auto-saves on document operations, but we can force it\n      this.lok.postUnoCommand(this.docPtr, '.uno:Save');\n      return this.createResult({ path: this.inputPath });\n    } catch (error) {\n      return this.createErrorResult(`Save failed: ${String(error)}`);\n    }\n  }\n\n  saveAs(path: string, format: OutputFormat): OperationResult<{ path: string }> {\n    try {\n      this.lok.documentSaveAs(this.docPtr, path, format, '');\n      return this.createResult({ path });\n    } catch (error) {\n      return this.createErrorResult(`SaveAs failed: ${String(error)}`);\n    }\n  }\n\n  close(): OperationResult<void> {\n    try {\n      this.lok.documentDestroy(this.docPtr);\n      this.docPtr = 0;\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Close failed: ${String(error)}`);\n    }\n  }\n\n  /**\n   * Get the current edit mode of the document\n   * @returns 0 = view mode, 1 = edit mode\n   */\n  getEditMode(): number {\n    return this.lok.getEditMode(this.docPtr);\n  }\n\n  /**\n   * Attempt to enable edit mode for the document\n   * @returns OperationResult with success and verified fields\n   */\n  enableEditMode(): OperationResult<{ editMode: number }> {\n    try {\n      const beforeMode = this.lok.getEditMode(this.docPtr);\n      if (beforeMode === 1) {\n        // Already in edit mode\n        return this.createResult({ editMode: 1 });\n      }\n\n      // Try .uno:Edit command to switch to edit mode\n      this.lok.postUnoCommand(this.docPtr, '.uno:Edit');\n\n      const afterMode = this.lok.getEditMode(this.docPtr);\n      return {\n        success: true,\n        verified: afterMode === 1,\n        data: { editMode: afterMode },\n      };\n    } catch (error) {\n      return this.createErrorResult(`Failed to enable edit mode: ${String(error)}`);\n    }\n  }\n\n  // ============================================\n  // History methods\n  // ============================================\n\n  undo(): OperationResult<void> {\n    try {\n      this.lok.postUnoCommand(this.docPtr, '.uno:Undo');\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Undo failed: ${String(error)}`);\n    }\n  }\n\n  redo(): OperationResult<void> {\n    try {\n      this.lok.postUnoCommand(this.docPtr, '.uno:Redo');\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Redo failed: ${String(error)}`);\n    }\n  }\n\n  // ============================================\n  // Search methods\n  // ============================================\n\n  find(text: string, options?: FindOptions): OperationResult<{ matches: number; firstMatch?: Position }> {\n    try {\n      const searchArgs = JSON.stringify({\n        'SearchItem.SearchString': { type: 'string', value: text },\n        'SearchItem.Backward': { type: 'boolean', value: false },\n        'SearchItem.SearchAll': { type: 'boolean', value: true },\n        'SearchItem.MatchCase': { type: 'boolean', value: options?.caseSensitive ?? false },\n        'SearchItem.WordOnly': { type: 'boolean', value: options?.wholeWord ?? false },\n      });\n\n      this.lok.postUnoCommand(this.docPtr, '.uno:ExecuteSearch', searchArgs);\n\n      // Get search results - this is approximate as LOK doesn't return match count directly\n      const selection = this.lok.getTextSelection(this.docPtr, 'text/plain');\n      const hasMatch = selection !== null && selection.length > 0;\n\n      return this.createResult({\n        matches: hasMatch ? 1 : 0, // LOK doesn't provide count, we report if found\n        firstMatch: hasMatch ? { x: 0, y: 0 } : undefined,\n      });\n    } catch (error) {\n      return this.createErrorResult(`Find failed: ${String(error)}`);\n    }\n  }\n\n  findAndReplaceAll(find: string, replace: string, options?: FindOptions): OperationResult<{ replacements: number }> {\n    try {\n      const searchArgs = JSON.stringify({\n        'SearchItem.SearchString': { type: 'string', value: find },\n        'SearchItem.ReplaceString': { type: 'string', value: replace },\n        'SearchItem.Command': { type: 'long', value: 3 }, // Replace All\n        'SearchItem.MatchCase': { type: 'boolean', value: options?.caseSensitive ?? false },\n        'SearchItem.WordOnly': { type: 'boolean', value: options?.wholeWord ?? false },\n      });\n\n      this.lok.postUnoCommand(this.docPtr, '.uno:ExecuteSearch', searchArgs);\n\n      // LOK doesn't return replacement count, we assume success\n      return this.createResult({ replacements: -1 }); // -1 indicates unknown count\n    } catch (error) {\n      return this.createErrorResult(`Replace failed: ${String(error)}`);\n    }\n  }\n\n  // ============================================\n  // Callback-based state retrieval\n  // ============================================\n\n  /**\n   * Poll all STATE_CHANGED callback events and return as a map.\n   *\n   * LOK sends STATE_CHANGED events when formatting state changes (e.g., when\n   * the cursor moves over bold text, `.uno:Bold=true` is emitted).\n   *\n   * Pattern for getting current format state:\n   * 1. clearCallbackQueue() - clear any stale events\n   * 2. Perform action that triggers state change (e.g., SelectWord)\n   * 3. flushCallbacks(docPtr) - force LOK to process callbacks\n   * 4. pollStateChanges() - retrieve the events\n   *\n   * @returns Map of UNO command names to their state values\n   *          e.g., Map { '.uno:Bold' => 'true', '.uno:Italic' => 'false' }\n   */\n  getStateChanges(): OperationResult<Map<string, string>> {\n    try {\n      const states = this.lok.pollStateChanges();\n      return this.createResult(states);\n    } catch (error) {\n      return this.createErrorResult(`Failed to poll state changes: ${String(error)}`);\n    }\n  }\n\n  /**\n   * Flush pending LOK callbacks and then poll for state changes.\n   * Convenience method that combines flushCallbacks + pollStateChanges.\n   *\n   * @returns Map of UNO command names to their state values\n   */\n  flushAndPollState(): OperationResult<Map<string, string>> {\n    try {\n      this.lok.flushCallbacks(this.docPtr);\n      const states = this.lok.pollStateChanges();\n      return this.createResult(states);\n    } catch (error) {\n      return this.createErrorResult(`Failed to flush and poll state: ${String(error)}`);\n    }\n  }\n\n  /**\n   * Clear the callback queue, useful before performing operations\n   * where you want to capture only new state changes.\n   */\n  clearCallbackQueue(): void {\n    this.lok.clearCallbackQueue();\n  }\n\n  // ============================================\n  // Selection methods\n  // ============================================\n\n  select(_selection: SelectionRange): OperationResult<{ selected: string }> {\n    try {\n      // Implementation depends on selection type - subclasses may override\n      // Base implementation just returns current selection\n      const text = this.lok.getTextSelection(this.docPtr, 'text/plain');\n      return this.createResult({ selected: text || '' });\n    } catch (error) {\n      return this.createErrorResult(`Select failed: ${String(error)}`);\n    }\n  }\n\n  getSelection(): OperationResult<{ text: string; range: SelectionRange }> {\n    try {\n      const text = this.lok.getTextSelection(this.docPtr, 'text/plain');\n      return this.createResult({\n        text: text || '',\n        range: { type: 'text', start: { paragraph: 0, character: 0 } },\n      });\n    } catch (error) {\n      return this.createErrorResult(`GetSelection failed: ${String(error)}`);\n    }\n  }\n\n  clearSelection(): OperationResult<void> {\n    try {\n      this.lok.resetSelection(this.docPtr);\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`ClearSelection failed: ${String(error)}`);\n    }\n  }\n\n  // ============================================\n  // Protected helper methods\n  // ============================================\n\n  protected createResult<T>(data: T): OperationResult<T> {\n    return {\n      success: true,\n      verified: true,\n      data,\n    };\n  }\n\n  protected createErrorResult<T>(error: string, suggestion?: string): OperationResult<T> {\n    return {\n      success: false,\n      verified: false,\n      error,\n      suggestion,\n    };\n  }\n\n  protected createResultWithTruncation<T>(data: T, truncation?: TruncationInfo): OperationResult<T> {\n    return {\n      success: true,\n      verified: true,\n      data,\n      truncated: truncation,\n    };\n  }\n\n  protected truncateContent(content: string, maxChars?: number): {\n    content: string;\n    truncated: boolean;\n    original: number;\n    returned: number;\n  } {\n    const limit = maxChars ?? this.options.maxResponseChars;\n    const original = content.length;\n\n    if (original <= limit) {\n      return { content, truncated: false, original, returned: original };\n    }\n\n    // Truncate at a word boundary if possible\n    let truncated = content.slice(0, limit);\n    const lastSpace = truncated.lastIndexOf(' ');\n    if (lastSpace > limit * 0.8) {\n      truncated = truncated.slice(0, lastSpace);\n    }\n\n    return {\n      content: truncated,\n      truncated: true,\n      original,\n      returned: truncated.length,\n    };\n  }\n\n  protected truncateArray<T>(items: T[], maxChars: number, itemToString: (item: T) => string): {\n    items: T[];\n    truncated: boolean;\n    original: number;\n    returned: number;\n  } {\n    const original = items.length;\n    let charCount = 0;\n    let includedCount = 0;\n\n    for (const item of items) {\n      const itemStr = itemToString(item);\n      if (charCount + itemStr.length > maxChars) {\n        break;\n      }\n      charCount += itemStr.length;\n      includedCount++;\n    }\n\n    return {\n      items: items.slice(0, includedCount),\n      truncated: includedCount < original,\n      original,\n      returned: includedCount,\n    };\n  }\n\n  // ============================================\n  // Cell address helpers\n  // ============================================\n\n  protected a1ToRowCol(a1: string): { row: number; col: number } {\n    const match = a1.match(/^([A-Z]+)(\\d+)$/i);\n    if (!match) {\n      throw new Error(`Invalid A1 notation: ${a1}`);\n    }\n\n    const colStr = match[1]!.toUpperCase();\n    const rowStr = match[2]!;\n\n    let col = 0;\n    for (let i = 0; i < colStr.length; i++) {\n      col = col * 26 + (colStr.charCodeAt(i) - 64);\n    }\n    col -= 1; // 0-indexed\n\n    const row = parseInt(rowStr, 10) - 1; // 0-indexed\n\n    return { row, col };\n  }\n\n  protected rowColToA1(row: number, col: number): string {\n    let colStr = '';\n    let c = col + 1; // 1-indexed for conversion\n\n    while (c > 0) {\n      const remainder = (c - 1) % 26;\n      colStr = String.fromCharCode(65 + remainder) + colStr;\n      c = Math.floor((c - 1) / 26);\n    }\n\n    return `${colStr}${row + 1}`;\n  }\n\n  protected normalizeCellRef(ref: CellRef): { row: number; col: number } {\n    if (typeof ref === 'string') {\n      return this.a1ToRowCol(ref);\n    }\n    return ref;\n  }\n\n  // ============================================\n  // Internal state\n  // ============================================\n\n  setInputPath(path: string): void {\n    this.inputPath = path;\n  }\n\n  isOpen(): boolean {\n    return this.docPtr !== 0;\n  }\n}\n","// src/editor/writer.ts\nimport { OfficeEditor } from './base.js';\nimport type {\n  OperationResult,\n  WriterStructure,\n  Paragraph,\n  TextPosition,\n  TextRange,\n  TextFormat,\n} from './types.js';\n\n/**\n * Editor for Writer (text) documents\n */\nexport class WriterEditor extends OfficeEditor {\n  private cachedParagraphs: string[] | null = null;\n\n  getDocumentType(): 'writer' {\n    return 'writer';\n  }\n\n  getStructure(options?: { maxResponseChars?: number }): OperationResult<WriterStructure> {\n    try {\n      const paragraphs = this.getParagraphsInternal();\n      const maxChars = options?.maxResponseChars ?? this.options.maxResponseChars;\n\n      const paragraphInfos = paragraphs.map((text, index) => ({\n        index,\n        preview: text.slice(0, 100) + (text.length > 100 ? '...' : ''),\n        style: 'Normal', // Would need UNO query to get actual style\n        charCount: text.length,\n      }));\n\n      // Truncate if needed\n      const truncResult = this.truncateArray(\n        paragraphInfos,\n        maxChars,\n        (p) => JSON.stringify(p)\n      );\n\n      const structure: WriterStructure = {\n        type: 'writer',\n        paragraphs: truncResult.items,\n        pageCount: this.lok.documentGetParts(this.docPtr),\n        wordCount: paragraphs.join(' ').split(/\\s+/).filter(w => w.length > 0).length,\n      };\n\n      if (truncResult.truncated) {\n        return this.createResultWithTruncation(structure, {\n          original: truncResult.original,\n          returned: truncResult.returned,\n          message: `Showing ${truncResult.returned} of ${truncResult.original} paragraphs. Use getParagraphs(start, count) to paginate.`,\n        });\n      }\n\n      return this.createResult(structure);\n    } catch (error) {\n      return this.createErrorResult(`Failed to get structure: ${String(error)}`);\n    }\n  }\n\n  getParagraph(index: number): OperationResult<Paragraph> {\n    try {\n      const paragraphs = this.getParagraphsInternal();\n\n      if (index < 0 || index >= paragraphs.length) {\n        return this.createErrorResult(\n          `Paragraph index ${index} out of range (0-${paragraphs.length - 1})`,\n          `Use getStructure() to see available paragraphs`\n        );\n      }\n\n      const text = paragraphs[index]!;\n      return this.createResult({\n        index,\n        text,\n        style: 'Normal',\n        charCount: text.length,\n      });\n    } catch (error) {\n      return this.createErrorResult(`Failed to get paragraph: ${String(error)}`);\n    }\n  }\n\n  getParagraphs(start: number, count: number): OperationResult<Paragraph[]> {\n    try {\n      const paragraphs = this.getParagraphsInternal();\n\n      if (start < 0 || start >= paragraphs.length) {\n        return this.createErrorResult(\n          `Start index ${start} out of range`,\n          `Valid range: 0-${paragraphs.length - 1}`\n        );\n      }\n\n      const end = Math.min(start + count, paragraphs.length);\n      const result = paragraphs.slice(start, end).map((text, i) => ({\n        index: start + i,\n        text,\n        style: 'Normal',\n        charCount: text.length,\n      }));\n\n      return this.createResult(result);\n    } catch (error) {\n      return this.createErrorResult(`Failed to get paragraphs: ${String(error)}`);\n    }\n  }\n\n  insertParagraph(text: string, options?: {\n    afterIndex?: number;\n    style?: 'Normal' | 'Heading 1' | 'Heading 2' | 'Heading 3' | 'List';\n  }): OperationResult<{ index: number }> {\n    try {\n      const paragraphs = this.getParagraphsInternal();\n      const insertIndex = options?.afterIndex !== undefined\n        ? options.afterIndex + 1\n        : paragraphs.length;\n\n      // Move to end of target paragraph or document end\n      if (insertIndex > 0 && insertIndex <= paragraphs.length) {\n        // Navigate to position\n        this.lok.postUnoCommand(this.docPtr, '.uno:GoToEndOfDoc');\n      }\n\n      // Insert paragraph break and text\n      this.lok.postUnoCommand(this.docPtr, '.uno:InsertPara');\n\n      // Insert the text\n      const textArgs = JSON.stringify({\n        Text: { type: 'string', value: text },\n      });\n      this.lok.postUnoCommand(this.docPtr, '.uno:InsertText', textArgs);\n\n      // Apply style if specified\n      if (options?.style && options.style !== 'Normal') {\n        const styleMap: Record<string, string> = {\n          'Heading 1': 'Heading 1',\n          'Heading 2': 'Heading 2',\n          'Heading 3': 'Heading 3',\n          'List': 'List',\n        };\n        const styleName = styleMap[options.style];\n        if (styleName) {\n          const styleArgs = JSON.stringify({\n            Template: { type: 'string', value: styleName },\n            Family: { type: 'short', value: 2 }, // Paragraph styles\n          });\n          this.lok.postUnoCommand(this.docPtr, '.uno:StyleApply', styleArgs);\n        }\n      }\n\n      // Invalidate cache\n      this.cachedParagraphs = null;\n\n      // Verify by re-reading\n      const newParagraphs = this.getParagraphsInternal();\n      const verified = newParagraphs.length > paragraphs.length;\n\n      return {\n        success: true,\n        verified,\n        data: { index: insertIndex },\n      };\n    } catch (error) {\n      return this.createErrorResult(`Failed to insert paragraph: ${String(error)}`);\n    }\n  }\n\n  replaceParagraph(index: number, text: string): OperationResult<{ oldText: string }> {\n    try {\n      const paragraphs = this.getParagraphsInternal();\n\n      if (index < 0 || index >= paragraphs.length) {\n        return this.createErrorResult(\n          `Paragraph index ${index} out of range`,\n          `Valid range: 0-${paragraphs.length - 1}`\n        );\n      }\n\n      const oldText = paragraphs[index]!;\n\n      // Select the paragraph and replace\n      // This is a simplified implementation - full implementation would use cursor positioning\n      const findReplaceArgs = JSON.stringify({\n        'SearchItem.SearchString': { type: 'string', value: oldText },\n        'SearchItem.ReplaceString': { type: 'string', value: text },\n        'SearchItem.Command': { type: 'long', value: 2 }, // Replace\n      });\n      this.lok.postUnoCommand(this.docPtr, '.uno:ExecuteSearch', findReplaceArgs);\n\n      // Invalidate cache\n      this.cachedParagraphs = null;\n\n      return this.createResult({ oldText });\n    } catch (error) {\n      return this.createErrorResult(`Failed to replace paragraph: ${String(error)}`);\n    }\n  }\n\n  deleteParagraph(index: number): OperationResult<{ deletedText: string }> {\n    try {\n      const paragraphs = this.getParagraphsInternal();\n\n      if (index < 0 || index >= paragraphs.length) {\n        return this.createErrorResult(\n          `Paragraph index ${index} out of range`,\n          `Valid range: 0-${paragraphs.length - 1}`\n        );\n      }\n\n      const deletedText = paragraphs[index]!;\n\n      // Replace with empty string\n      const result = this.replaceParagraph(index, '');\n      if (!result.success) {\n        return this.createErrorResult(result.error || 'Failed to delete');\n      }\n\n      return this.createResult({ deletedText });\n    } catch (error) {\n      return this.createErrorResult(`Failed to delete paragraph: ${String(error)}`);\n    }\n  }\n\n  insertText(text: string, _position: TextPosition): OperationResult<void> {\n    try {\n      // TODO: Navigate to position using cursor before inserting\n      const textArgs = JSON.stringify({\n        Text: { type: 'string', value: text },\n      });\n      this.lok.postUnoCommand(this.docPtr, '.uno:InsertText', textArgs);\n\n      this.cachedParagraphs = null;\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Failed to insert text: ${String(error)}`);\n    }\n  }\n\n  deleteText(_start: TextPosition, _end: TextPosition): OperationResult<{ deleted: string }> {\n    try {\n      // TODO: Use start/end to select text range before deleting\n      // Get current selection\n      const selection = this.lok.getTextSelection(this.docPtr, 'text/plain');\n\n      // Delete selection\n      this.lok.postUnoCommand(this.docPtr, '.uno:Delete');\n\n      this.cachedParagraphs = null;\n      return this.createResult({ deleted: selection || '' });\n    } catch (error) {\n      return this.createErrorResult(`Failed to delete text: ${String(error)}`);\n    }\n  }\n\n  replaceText(find: string, replace: string, options?: {\n    paragraph?: number;\n    all?: boolean;\n  }): OperationResult<{ replacements: number }> {\n    try {\n      const command = options?.all ? 3 : 2; // 3 = Replace All, 2 = Replace\n\n      const searchArgs = JSON.stringify({\n        'SearchItem.SearchString': { type: 'string', value: find },\n        'SearchItem.ReplaceString': { type: 'string', value: replace },\n        'SearchItem.Command': { type: 'long', value: command },\n      });\n\n      this.lok.postUnoCommand(this.docPtr, '.uno:ExecuteSearch', searchArgs);\n\n      this.cachedParagraphs = null;\n\n      // LOK doesn't return count, we indicate success\n      return this.createResult({ replacements: -1 });\n    } catch (error) {\n      return this.createErrorResult(`Failed to replace text: ${String(error)}`);\n    }\n  }\n\n  formatText(_range: TextRange, format: TextFormat): OperationResult<void> {\n    try {\n      // TODO: Use range to select text before applying format\n      // Apply formatting commands\n      if (format.bold !== undefined) {\n        this.lok.postUnoCommand(this.docPtr, '.uno:Bold');\n      }\n      if (format.italic !== undefined) {\n        this.lok.postUnoCommand(this.docPtr, '.uno:Italic');\n      }\n      if (format.underline !== undefined) {\n        this.lok.postUnoCommand(this.docPtr, '.uno:Underline');\n      }\n      if (format.fontSize !== undefined) {\n        const args = JSON.stringify({\n          FontHeight: { type: 'float', value: format.fontSize },\n        });\n        this.lok.postUnoCommand(this.docPtr, '.uno:FontHeight', args);\n      }\n      if (format.fontName !== undefined) {\n        const args = JSON.stringify({\n          CharFontName: { type: 'string', value: format.fontName },\n        });\n        this.lok.postUnoCommand(this.docPtr, '.uno:CharFontName', args);\n      }\n\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Failed to format text: ${String(error)}`);\n    }\n  }\n\n  /**\n   * Get the text formatting at the current selection or cursor position.\n   *\n   * Uses LOK callback mechanism to retrieve STATE_CHANGED events which contain\n   * formatting state like `.uno:Bold=true`, `.uno:Italic=false`, etc.\n   *\n   * @param _position - Text position (currently unused, uses current selection)\n   * @returns TextFormat with bold, italic, underline, fontSize, fontName properties\n   */\n  getFormat(_position?: TextPosition): OperationResult<TextFormat> {\n    try {\n      // Clear any existing callback events\n      this.lok.clearCallbackQueue();\n\n      // Trigger a selection change to get current formatting state\n      // Moving cursor slightly and back triggers STATE_CHANGED callbacks\n      this.lok.postUnoCommand(this.docPtr, '.uno:CharRightSel');\n      this.lok.flushCallbacks(this.docPtr);\n      this.lok.postUnoCommand(this.docPtr, '.uno:CharLeft');\n      this.lok.flushCallbacks(this.docPtr);\n\n      // Poll STATE_CHANGED events to get formatting state\n      const states = this.lok.pollStateChanges();\n\n      // Parse the state values into TextFormat\n      const format: TextFormat = {};\n\n      // Bold: .uno:Bold=true or .uno:Bold=false\n      const boldState = states.get('.uno:Bold');\n      if (boldState !== undefined) {\n        format.bold = boldState === 'true';\n      }\n\n      // Italic: .uno:Italic=true or .uno:Italic=false\n      const italicState = states.get('.uno:Italic');\n      if (italicState !== undefined) {\n        format.italic = italicState === 'true';\n      }\n\n      // Underline: .uno:Underline=true or .uno:Underline=false\n      const underlineState = states.get('.uno:Underline');\n      if (underlineState !== undefined) {\n        format.underline = underlineState === 'true';\n      }\n\n      // Font size: .uno:FontHeight=12\n      const fontSizeState = states.get('.uno:FontHeight');\n      if (fontSizeState !== undefined) {\n        const size = parseFloat(fontSizeState);\n        if (!isNaN(size)) {\n          format.fontSize = size;\n        }\n      }\n\n      // Font name: .uno:CharFontName=Arial\n      const fontNameState = states.get('.uno:CharFontName');\n      if (fontNameState !== undefined && fontNameState.length > 0) {\n        format.fontName = fontNameState;\n      }\n\n      return this.createResult(format);\n    } catch (error) {\n      return this.createErrorResult(`Failed to get format: ${String(error)}`);\n    }\n  }\n\n  /**\n   * Get formatting state for the current selection using the callback mechanism.\n   * This is the preferred way to get character formatting as it uses LOK's\n   * STATE_CHANGED callback events.\n   *\n   * @returns Map of UNO command names to their state values\n   */\n  getSelectionFormat(): OperationResult<Map<string, string>> {\n    try {\n      // Poll any existing STATE_CHANGED events (from previous operations)\n      const existingStates = this.lok.pollStateChanges();\n\n      if (existingStates.size === 0) {\n        // No existing states, trigger a selection to get current format\n        this.lok.clearCallbackQueue();\n        this.lok.postUnoCommand(this.docPtr, '.uno:SelectWord');\n        this.lok.flushCallbacks(this.docPtr);\n        const states = this.lok.pollStateChanges();\n        return this.createResult(states);\n      }\n\n      return this.createResult(existingStates);\n    } catch (error) {\n      return this.createErrorResult(`Failed to get selection format: ${String(error)}`);\n    }\n  }\n\n  // ============================================\n  // Private helpers\n  // ============================================\n\n  private getParagraphsInternal(): string[] {\n    if (this.cachedParagraphs) {\n      return this.cachedParagraphs;\n    }\n\n    const allText = this.lok.getAllText(this.docPtr);\n    if (!allText) {\n      return [];\n    }\n\n    // Split by double newlines (paragraph breaks) or single newlines\n    this.cachedParagraphs = allText\n      .split(/\\n\\n|\\r\\n\\r\\n/)\n      .map(p => p.trim())\n      .filter(p => p.length > 0);\n\n    return this.cachedParagraphs;\n  }\n}\n","// src/editor/calc.ts\nimport { OfficeEditor } from './base.js';\nimport type {\n  OperationResult,\n  CalcStructure,\n  CellRef,\n  RangeRef,\n  SheetRef,\n  ColRef,\n  CellData,\n  CellValue,\n  CellFormat,\n  SheetInfo,\n} from './types.js';\n\n/**\n * Editor for Calc (spreadsheet) documents\n */\nexport class CalcEditor extends OfficeEditor {\n  getDocumentType(): 'calc' {\n    return 'calc';\n  }\n\n  getStructure(_options?: { maxResponseChars?: number }): OperationResult<CalcStructure> {\n    try {\n      const numSheets = this.lok.documentGetParts(this.docPtr);\n      const sheets: SheetInfo[] = [];\n\n      for (let i = 0; i < numSheets; i++) {\n        const name = this.lok.getPartName(this.docPtr, i) || `Sheet${i + 1}`;\n        const dataArea = this.lok.getDataArea(this.docPtr, i);\n\n        sheets.push({\n          index: i,\n          name,\n          usedRange: dataArea.col > 0 && dataArea.row > 0\n            ? `A1:${this.rowColToA1(dataArea.row - 1, dataArea.col - 1)}`\n            : 'A1',\n          rowCount: dataArea.row,\n          colCount: dataArea.col,\n        });\n      }\n\n      const structure: CalcStructure = {\n        type: 'calc',\n        sheets,\n      };\n\n      return this.createResult(structure);\n    } catch (error) {\n      return this.createErrorResult(`Failed to get structure: ${String(error)}`);\n    }\n  }\n\n  getSheetNames(): OperationResult<string[]> {\n    try {\n      const numSheets = this.lok.documentGetParts(this.docPtr);\n      const names: string[] = [];\n\n      for (let i = 0; i < numSheets; i++) {\n        const name = this.lok.getPartName(this.docPtr, i) || `Sheet${i + 1}`;\n        names.push(name);\n      }\n\n      return this.createResult(names);\n    } catch (error) {\n      return this.createErrorResult(`Failed to get sheet names: ${String(error)}`);\n    }\n  }\n\n  // ============================================\n  // Cell reading\n  // ============================================\n\n  getCell(cell: CellRef, sheet?: SheetRef): OperationResult<CellData> {\n    try {\n      this.selectSheet(sheet);\n      const { row, col } = this.normalizeCellRef(cell);\n      const address = this.rowColToA1(row, col);\n\n      // Navigate to cell\n      this.goToCell(address);\n\n      // Get value\n      const value = this.getCellValueInternal();\n      const formula = this.getCellFormulaInternal();\n\n      return this.createResult({\n        address,\n        value,\n        formula: formula || undefined,\n      });\n    } catch (error) {\n      return this.createErrorResult(`Failed to get cell: ${String(error)}`);\n    }\n  }\n\n  getCells(range: RangeRef, sheet?: SheetRef, options?: {\n    maxResponseChars?: number;\n  }): OperationResult<CellData[][]> {\n    try {\n      this.selectSheet(sheet);\n      const { startRow, startCol, endRow, endCol } = this.normalizeRangeRef(range);\n      const maxChars = options?.maxResponseChars ?? this.options.maxResponseChars;\n\n      const cells: CellData[][] = [];\n      let charCount = 0;\n      let truncated = false;\n\n      for (let r = startRow; r <= endRow && !truncated; r++) {\n        const rowData: CellData[] = [];\n\n        for (let c = startCol; c <= endCol && !truncated; c++) {\n          const address = this.rowColToA1(r, c);\n          this.goToCell(address);\n\n          const value = this.getCellValueInternal();\n          const cellData: CellData = { address, value };\n\n          const cellStr = JSON.stringify(cellData);\n          if (charCount + cellStr.length > maxChars) {\n            truncated = true;\n            break;\n          }\n\n          charCount += cellStr.length;\n          rowData.push(cellData);\n        }\n\n        if (rowData.length > 0) {\n          cells.push(rowData);\n        }\n      }\n\n      if (truncated) {\n        return this.createResultWithTruncation(cells, {\n          original: (endRow - startRow + 1) * (endCol - startCol + 1),\n          returned: cells.reduce((sum, row) => sum + row.length, 0),\n          message: 'Range truncated due to size. Use smaller ranges to paginate.',\n        });\n      }\n\n      return this.createResult(cells);\n    } catch (error) {\n      return this.createErrorResult(`Failed to get cells: ${String(error)}`);\n    }\n  }\n\n  // ============================================\n  // Cell writing\n  // ============================================\n\n  setCellValue(cell: CellRef, value: string | number, sheet?: SheetRef): OperationResult<{\n    oldValue: CellValue;\n    newValue: CellValue;\n  }> {\n    try {\n      this.selectSheet(sheet);\n      const { row, col } = this.normalizeCellRef(cell);\n      const address = this.rowColToA1(row, col);\n\n      // Get old value first\n      this.goToCell(address);\n      const oldValue = this.getCellValueInternal();\n\n      // Enter the new value\n      const valueStr = typeof value === 'number' ? value.toString() : value;\n      const args = JSON.stringify({\n        StringName: { type: 'string', value: valueStr },\n      });\n      this.lok.postUnoCommand(this.docPtr, '.uno:EnterString', args);\n\n      // Verify by re-reading the cell\n      const newValue = this.getCellValueInternal();\n      const expectedStr = typeof value === 'number' ? value.toString() : value;\n      const verified = newValue === expectedStr || newValue === value;\n\n      return {\n        success: true,\n        verified,\n        data: { oldValue, newValue },\n      };\n    } catch (error) {\n      return this.createErrorResult(`Failed to set cell value: ${String(error)}`);\n    }\n  }\n\n  setCellFormula(cell: CellRef, formula: string, sheet?: SheetRef): OperationResult<{\n    calculatedValue: CellValue;\n  }> {\n    try {\n      this.selectSheet(sheet);\n      const { row, col } = this.normalizeCellRef(cell);\n      const address = this.rowColToA1(row, col);\n\n      // Navigate and enter formula\n      this.goToCell(address);\n\n      const args = JSON.stringify({\n        StringName: { type: 'string', value: formula },\n      });\n      this.lok.postUnoCommand(this.docPtr, '.uno:EnterString', args);\n\n      // Get calculated value\n      const calculatedValue = this.getCellValueInternal();\n\n      return this.createResult({ calculatedValue });\n    } catch (error) {\n      return this.createErrorResult(`Failed to set formula: ${String(error)}`);\n    }\n  }\n\n  setCells(range: RangeRef, values: CellValue[][], sheet?: SheetRef): OperationResult<{\n    cellsUpdated: number;\n  }> {\n    try {\n      this.selectSheet(sheet);\n      const { startRow, startCol } = this.normalizeRangeRef(range);\n      let cellsUpdated = 0;\n\n      for (let r = 0; r < values.length; r++) {\n        const rowValues = values[r];\n        if (!rowValues) continue;\n\n        for (let c = 0; c < rowValues.length; c++) {\n          const value = rowValues[c];\n          if (value === null || value === undefined) continue;\n\n          const address = this.rowColToA1(startRow + r, startCol + c);\n          this.goToCell(address);\n\n          const valueStr = typeof value === 'number' ? value.toString() : String(value);\n          const args = JSON.stringify({\n            StringName: { type: 'string', value: valueStr },\n          });\n          this.lok.postUnoCommand(this.docPtr, '.uno:EnterString', args);\n          cellsUpdated++;\n        }\n      }\n\n      return this.createResult({ cellsUpdated });\n    } catch (error) {\n      return this.createErrorResult(`Failed to set cells: ${String(error)}`);\n    }\n  }\n\n  // ============================================\n  // Clear operations\n  // ============================================\n\n  clearCell(cell: CellRef, sheet?: SheetRef): OperationResult<{ oldValue: CellValue }> {\n    try {\n      this.selectSheet(sheet);\n      const { row, col } = this.normalizeCellRef(cell);\n      const address = this.rowColToA1(row, col);\n\n      this.goToCell(address);\n      const oldValue = this.getCellValueInternal();\n\n      this.lok.postUnoCommand(this.docPtr, '.uno:ClearContents');\n\n      return this.createResult({ oldValue });\n    } catch (error) {\n      return this.createErrorResult(`Failed to clear cell: ${String(error)}`);\n    }\n  }\n\n  clearRange(range: RangeRef, sheet?: SheetRef): OperationResult<{ cellsCleared: number }> {\n    try {\n      this.selectSheet(sheet);\n      const rangeStr = this.normalizeRangeToString(range);\n\n      // Select range and clear\n      this.goToCell(rangeStr);\n      this.lok.postUnoCommand(this.docPtr, '.uno:ClearContents');\n\n      // Count is approximate\n      const { startRow, startCol, endRow, endCol } = this.normalizeRangeRef(range);\n      const cellsCleared = (endRow - startRow + 1) * (endCol - startCol + 1);\n\n      return this.createResult({ cellsCleared });\n    } catch (error) {\n      return this.createErrorResult(`Failed to clear range: ${String(error)}`);\n    }\n  }\n\n  // ============================================\n  // Row/Column operations\n  // ============================================\n\n  insertRow(afterRow: number, sheet?: SheetRef): OperationResult<void> {\n    try {\n      this.selectSheet(sheet);\n      this.goToCell(this.rowColToA1(afterRow + 1, 0));\n      this.lok.postUnoCommand(this.docPtr, '.uno:InsertRows');\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Failed to insert row: ${String(error)}`);\n    }\n  }\n\n  insertColumn(afterCol: ColRef, sheet?: SheetRef): OperationResult<void> {\n    try {\n      this.selectSheet(sheet);\n      const colNum = typeof afterCol === 'string'\n        ? this.a1ToRowCol(afterCol + '1').col + 1\n        : afterCol + 1;\n\n      this.goToCell(this.rowColToA1(0, colNum));\n      this.lok.postUnoCommand(this.docPtr, '.uno:InsertColumns');\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Failed to insert column: ${String(error)}`);\n    }\n  }\n\n  deleteRow(row: number, sheet?: SheetRef): OperationResult<void> {\n    try {\n      this.selectSheet(sheet);\n      this.goToCell(this.rowColToA1(row, 0));\n      this.lok.postUnoCommand(this.docPtr, '.uno:DeleteRows');\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Failed to delete row: ${String(error)}`);\n    }\n  }\n\n  deleteColumn(col: ColRef, sheet?: SheetRef): OperationResult<void> {\n    try {\n      this.selectSheet(sheet);\n      const colNum = typeof col === 'string'\n        ? this.a1ToRowCol(col + '1').col\n        : col;\n\n      this.goToCell(this.rowColToA1(0, colNum));\n      this.lok.postUnoCommand(this.docPtr, '.uno:DeleteColumns');\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Failed to delete column: ${String(error)}`);\n    }\n  }\n\n  // ============================================\n  // Formatting\n  // ============================================\n\n  formatCells(range: RangeRef, format: CellFormat, sheet?: SheetRef): OperationResult<void> {\n    try {\n      this.selectSheet(sheet);\n      const rangeStr = this.normalizeRangeToString(range);\n      this.goToCell(rangeStr);\n\n      if (format.bold !== undefined) {\n        this.lok.postUnoCommand(this.docPtr, '.uno:Bold');\n      }\n      if (format.numberFormat !== undefined) {\n        const args = JSON.stringify({\n          NumberFormatValue: { type: 'string', value: format.numberFormat },\n        });\n        this.lok.postUnoCommand(this.docPtr, '.uno:NumberFormatValue', args);\n      }\n      if (format.backgroundColor !== undefined) {\n        const args = JSON.stringify({\n          BackgroundColor: { type: 'long', value: this.hexToNumber(format.backgroundColor) },\n        });\n        this.lok.postUnoCommand(this.docPtr, '.uno:BackgroundColor', args);\n      }\n\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Failed to format cells: ${String(error)}`);\n    }\n  }\n\n  // ============================================\n  // Sheet management\n  // ============================================\n\n  addSheet(name: string): OperationResult<{ index: number }> {\n    try {\n      const args = JSON.stringify({\n        Name: { type: 'string', value: name },\n      });\n      this.lok.postUnoCommand(this.docPtr, '.uno:Insert', args);\n\n      const numSheets = this.lok.documentGetParts(this.docPtr);\n      return this.createResult({ index: numSheets - 1 });\n    } catch (error) {\n      return this.createErrorResult(`Failed to add sheet: ${String(error)}`);\n    }\n  }\n\n  renameSheet(sheet: SheetRef, newName: string): OperationResult<void> {\n    try {\n      this.selectSheet(sheet);\n      const args = JSON.stringify({\n        Name: { type: 'string', value: newName },\n      });\n      this.lok.postUnoCommand(this.docPtr, '.uno:RenameTable', args);\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Failed to rename sheet: ${String(error)}`);\n    }\n  }\n\n  deleteSheet(sheet: SheetRef): OperationResult<void> {\n    try {\n      this.selectSheet(sheet);\n      this.lok.postUnoCommand(this.docPtr, '.uno:Remove');\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Failed to delete sheet: ${String(error)}`);\n    }\n  }\n\n  // ============================================\n  // Private helpers\n  // ============================================\n\n  private selectSheet(sheet?: SheetRef): void {\n    if (sheet === undefined) return;\n\n    const index = typeof sheet === 'number'\n      ? sheet\n      : this.getSheetIndexByName(sheet);\n\n    if (index >= 0) {\n      this.lok.documentSetPart(this.docPtr, index);\n    }\n  }\n\n  private getSheetIndexByName(name: string): number {\n    const numSheets = this.lok.documentGetParts(this.docPtr);\n    for (let i = 0; i < numSheets; i++) {\n      if (this.lok.getPartName(this.docPtr, i) === name) {\n        return i;\n      }\n    }\n    return -1;\n  }\n\n  private goToCell(address: string): void {\n    const args = JSON.stringify({\n      ToPoint: { type: 'string', value: address },\n    });\n    this.lok.postUnoCommand(this.docPtr, '.uno:GoToCell', args);\n  }\n\n  private getCellValueInternal(): CellValue {\n    const text = this.lok.getTextSelection(this.docPtr, 'text/plain');\n    if (!text) return null;\n\n    // Try to parse as number\n    const num = parseFloat(text);\n    if (!isNaN(num) && text.trim() === num.toString()) {\n      return num;\n    }\n\n    // Check for boolean\n    if (text.toLowerCase() === 'true') return true;\n    if (text.toLowerCase() === 'false') return false;\n\n    return text;\n  }\n\n  private getCellFormulaInternal(): string | null {\n    const result = this.lok.getCommandValues(this.docPtr, '.uno:GetFormulaBarText');\n    if (!result) return null;\n\n    try {\n      const parsed = JSON.parse(result) as { value?: string };\n      return parsed.value ?? null;\n    } catch {\n      return null;\n    }\n  }\n\n  private normalizeRangeRef(range: RangeRef): {\n    startRow: number;\n    startCol: number;\n    endRow: number;\n    endCol: number;\n  } {\n    if (typeof range === 'string') {\n      const parts = range.split(':');\n      const start = this.a1ToRowCol(parts[0]!);\n      const end = parts[1] ? this.a1ToRowCol(parts[1]) : start;\n      return {\n        startRow: start.row,\n        startCol: start.col,\n        endRow: end.row,\n        endCol: end.col,\n      };\n    }\n\n    const start = this.normalizeCellRef(range.start);\n    const end = this.normalizeCellRef(range.end);\n    return {\n      startRow: start.row,\n      startCol: start.col,\n      endRow: end.row,\n      endCol: end.col,\n    };\n  }\n\n  private normalizeRangeToString(range: RangeRef): string {\n    if (typeof range === 'string') return range;\n\n    const start = this.normalizeCellRef(range.start);\n    const end = this.normalizeCellRef(range.end);\n    return `${this.rowColToA1(start.row, start.col)}:${this.rowColToA1(end.row, end.col)}`;\n  }\n\n  private hexToNumber(hex: string): number {\n    return parseInt(hex.replace('#', ''), 16);\n  }\n}\n","// src/editor/impress.ts\nimport { OfficeEditor } from './base.js';\nimport type {\n  OperationResult,\n  ImpressStructure,\n  SlideData,\n  SlideInfo,\n  SlideLayout,\n  TextFrame,\n} from './types.js';\n\n/**\n * Editor for Impress (presentation) documents\n */\nexport class ImpressEditor extends OfficeEditor {\n  getDocumentType(): 'impress' {\n    return 'impress';\n  }\n\n  getStructure(_options?: { maxResponseChars?: number }): OperationResult<ImpressStructure> {\n    try {\n      const numSlides = this.lok.documentGetParts(this.docPtr);\n      const slides: SlideInfo[] = [];\n\n      for (let i = 0; i < numSlides; i++) {\n        const slideData = this.getSlideInfoInternal(i);\n        slides.push(slideData);\n      }\n\n      const structure: ImpressStructure = {\n        type: 'impress',\n        slides,\n        slideCount: numSlides,\n      };\n\n      return this.createResult(structure);\n    } catch (error) {\n      return this.createErrorResult(`Failed to get structure: ${String(error)}`);\n    }\n  }\n\n  // ============================================\n  // Slide reading\n  // ============================================\n\n  getSlide(index: number): OperationResult<SlideData> {\n    try {\n      const numSlides = this.lok.documentGetParts(this.docPtr);\n\n      if (index < 0 || index >= numSlides) {\n        return this.createErrorResult(\n          `Invalid slide index: ${index}. Valid range: 0-${numSlides - 1}`,\n          'Use getStructure() to see available slides'\n        );\n      }\n\n      this.lok.documentSetPart(this.docPtr, index);\n      const text = this.lok.getAllText(this.docPtr) || '';\n      const textFrames = this.parseTextFrames(text);\n\n      const slideData: SlideData = {\n        index,\n        title: textFrames.find(f => f.type === 'title')?.text,\n        textFrames,\n        hasNotes: false, // Could detect from LOK if available\n      };\n\n      return this.createResult(slideData);\n    } catch (error) {\n      return this.createErrorResult(`Failed to get slide: ${String(error)}`);\n    }\n  }\n\n  getSlideCount(): OperationResult<number> {\n    try {\n      const count = this.lok.documentGetParts(this.docPtr);\n      return this.createResult(count);\n    } catch (error) {\n      return this.createErrorResult(`Failed to get slide count: ${String(error)}`);\n    }\n  }\n\n  // ============================================\n  // Slide management\n  // ============================================\n\n  addSlide(options?: { afterSlide?: number; layout?: SlideLayout }): OperationResult<{ index: number }> {\n    try {\n      const numSlides = this.lok.documentGetParts(this.docPtr);\n\n      // Navigate to position if specified\n      if (options?.afterSlide !== undefined) {\n        this.lok.documentSetPart(this.docPtr, options.afterSlide);\n      } else {\n        // Go to last slide\n        this.lok.documentSetPart(this.docPtr, numSlides - 1);\n      }\n\n      // Insert new slide\n      this.lok.postUnoCommand(this.docPtr, '.uno:InsertPage');\n\n      // Apply layout if specified\n      if (options?.layout) {\n        this.applySlideLayout(options.layout);\n      }\n\n      const newIndex = options?.afterSlide !== undefined\n        ? options.afterSlide + 1\n        : numSlides;\n\n      // Verify by checking slide count increased\n      const newNumSlides = this.lok.documentGetParts(this.docPtr);\n      const verified = newNumSlides > numSlides;\n\n      return {\n        success: true,\n        verified,\n        data: { index: newIndex },\n      };\n    } catch (error) {\n      return this.createErrorResult(`Failed to add slide: ${String(error)}`);\n    }\n  }\n\n  deleteSlide(index: number): OperationResult<void> {\n    try {\n      const numSlides = this.lok.documentGetParts(this.docPtr);\n\n      if (numSlides <= 1) {\n        return this.createErrorResult(\n          'Cannot delete the last slide',\n          'A presentation must have at least one slide'\n        );\n      }\n\n      if (index < 0 || index >= numSlides) {\n        return this.createErrorResult(\n          `Invalid slide index: ${index}`,\n          `Valid range: 0-${numSlides - 1}`\n        );\n      }\n\n      this.lok.documentSetPart(this.docPtr, index);\n      this.lok.postUnoCommand(this.docPtr, '.uno:DeletePage');\n\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Failed to delete slide: ${String(error)}`);\n    }\n  }\n\n  duplicateSlide(index: number): OperationResult<{ newIndex: number }> {\n    try {\n      const numSlides = this.lok.documentGetParts(this.docPtr);\n\n      if (index < 0 || index >= numSlides) {\n        return this.createErrorResult(\n          `Invalid slide index: ${index}`,\n          `Valid range: 0-${numSlides - 1}`\n        );\n      }\n\n      this.lok.documentSetPart(this.docPtr, index);\n      this.lok.postUnoCommand(this.docPtr, '.uno:DuplicatePage');\n\n      return this.createResult({ newIndex: index + 1 });\n    } catch (error) {\n      return this.createErrorResult(`Failed to duplicate slide: ${String(error)}`);\n    }\n  }\n\n  moveSlide(fromIndex: number, toIndex: number): OperationResult<void> {\n    try {\n      const numSlides = this.lok.documentGetParts(this.docPtr);\n\n      if (fromIndex < 0 || fromIndex >= numSlides || toIndex < 0 || toIndex >= numSlides) {\n        return this.createErrorResult(\n          `Invalid slide indices. Valid range: 0-${numSlides - 1}`,\n          'Check slide indices are within bounds'\n        );\n      }\n\n      if (fromIndex === toIndex) {\n        return this.createErrorResult(\n          'Source and destination are the same',\n          'Provide different indices to move'\n        );\n      }\n\n      // LOK doesn't have direct slide move - we simulate via cut/paste\n      this.lok.documentSetPart(this.docPtr, fromIndex);\n\n      const args = JSON.stringify({\n        Position: { type: 'long', value: toIndex },\n      });\n      this.lok.postUnoCommand(this.docPtr, '.uno:MovePageFirst', args);\n\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Failed to move slide: ${String(error)}`);\n    }\n  }\n\n  // ============================================\n  // Slide content editing\n  // ============================================\n\n  setSlideTitle(index: number, title: string): OperationResult<{ oldTitle?: string }> {\n    try {\n      const numSlides = this.lok.documentGetParts(this.docPtr);\n\n      if (index < 0 || index >= numSlides) {\n        return this.createErrorResult(`Invalid slide index: ${index}`);\n      }\n\n      this.lok.documentSetPart(this.docPtr, index);\n\n      // Get current title\n      const text = this.lok.getAllText(this.docPtr) || '';\n      const frames = this.parseTextFrames(text);\n      const oldTitle = frames.find(f => f.type === 'title')?.text;\n\n      // Select title placeholder and replace\n      this.lok.postUnoCommand(this.docPtr, '.uno:SelectAll');\n\n      // Enter title text (this replaces first text frame typically)\n      const args = JSON.stringify({\n        Text: { type: 'string', value: title },\n      });\n      this.lok.postUnoCommand(this.docPtr, '.uno:InsertText', args);\n\n      return this.createResult({ oldTitle });\n    } catch (error) {\n      return this.createErrorResult(`Failed to set slide title: ${String(error)}`);\n    }\n  }\n\n  setSlideBody(index: number, body: string): OperationResult<{ oldBody?: string }> {\n    try {\n      const numSlides = this.lok.documentGetParts(this.docPtr);\n\n      if (index < 0 || index >= numSlides) {\n        return this.createErrorResult(`Invalid slide index: ${index}`);\n      }\n\n      this.lok.documentSetPart(this.docPtr, index);\n\n      // Get current body\n      const text = this.lok.getAllText(this.docPtr) || '';\n      const frames = this.parseTextFrames(text);\n      const oldBody = frames.find(f => f.type === 'body')?.text;\n\n      // Navigate to body and replace\n      // Using Tab to move from title to body placeholder\n      this.lok.postUnoCommand(this.docPtr, '.uno:NextObject');\n\n      const args = JSON.stringify({\n        Text: { type: 'string', value: body },\n      });\n      this.lok.postUnoCommand(this.docPtr, '.uno:InsertText', args);\n\n      return this.createResult({ oldBody });\n    } catch (error) {\n      return this.createErrorResult(`Failed to set slide body: ${String(error)}`);\n    }\n  }\n\n  setSlideNotes(index: number, notes: string): OperationResult<void> {\n    try {\n      const numSlides = this.lok.documentGetParts(this.docPtr);\n\n      if (index < 0 || index >= numSlides) {\n        return this.createErrorResult(`Invalid slide index: ${index}`);\n      }\n\n      this.lok.documentSetPart(this.docPtr, index);\n\n      // Switch to notes view and insert text\n      this.lok.postUnoCommand(this.docPtr, '.uno:NotesMode');\n\n      const args = JSON.stringify({\n        Text: { type: 'string', value: notes },\n      });\n      this.lok.postUnoCommand(this.docPtr, '.uno:InsertText', args);\n\n      // Switch back to normal view\n      this.lok.postUnoCommand(this.docPtr, '.uno:NormalViewMode');\n\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Failed to set slide notes: ${String(error)}`);\n    }\n  }\n\n  // ============================================\n  // Slide layout\n  // ============================================\n\n  setSlideLayout(index: number, layout: SlideLayout): OperationResult<void> {\n    try {\n      const numSlides = this.lok.documentGetParts(this.docPtr);\n\n      if (index < 0 || index >= numSlides) {\n        return this.createErrorResult(`Invalid slide index: ${index}`);\n      }\n\n      this.lok.documentSetPart(this.docPtr, index);\n      this.applySlideLayout(layout);\n\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Failed to set slide layout: ${String(error)}`);\n    }\n  }\n\n  // ============================================\n  // Private helpers\n  // ============================================\n\n  private getSlideInfoInternal(index: number): SlideInfo {\n    this.lok.documentSetPart(this.docPtr, index);\n\n    const text = this.lok.getAllText(this.docPtr) || '';\n    const frames = this.parseTextFrames(text);\n    const titleFrame = frames.find(f => f.type === 'title');\n\n    return {\n      index,\n      title: titleFrame?.text,\n      layout: this.detectLayout(frames),\n      textFrameCount: frames.length,\n    };\n  }\n\n  private parseTextFrames(text: string): TextFrame[] {\n    // Parse text content into frames\n    // In Impress, text is typically separated by paragraph breaks\n    const paragraphs = text.split(/\\n\\n+/).filter(p => p.trim());\n    const frames: TextFrame[] = [];\n\n    paragraphs.forEach((para, idx) => {\n      const type = idx === 0 ? 'title' : (idx === 1 ? 'body' : 'other');\n      frames.push({\n        index: idx,\n        type: type as TextFrame['type'],\n        text: para.trim(),\n        bounds: { x: 0, y: 0, width: 0, height: 0 }, // Would need LOK API for actual bounds\n      });\n    });\n\n    return frames;\n  }\n\n  private detectLayout(frames: TextFrame[]): SlideLayout {\n    if (frames.length === 0) return 'blank';\n    if (frames.length === 1 && frames[0]?.type === 'title') return 'title';\n    if (frames.length >= 2) return 'titleContent';\n    return 'blank';\n  }\n\n  private applySlideLayout(layout: SlideLayout): void {\n    // Map layout names to LOK layout IDs\n    const layoutMap: Record<SlideLayout, number> = {\n      blank: 0,\n      title: 1,\n      titleContent: 2,\n      twoColumn: 3,\n    };\n\n    const layoutId = layoutMap[layout] ?? 0;\n    const args = JSON.stringify({\n      WhatLayout: { type: 'long', value: layoutId },\n    });\n    this.lok.postUnoCommand(this.docPtr, '.uno:AssignLayout', args);\n  }\n}\n","// src/editor/draw.ts\nimport { OfficeEditor } from './base.js';\nimport type {\n  OperationResult,\n  DrawStructure,\n  PageData,\n  PageInfo,\n  ShapeData,\n  ShapeType,\n  Rectangle,\n  Size,\n  Position,\n} from './types.js';\n\n/**\n * Editor for Draw (vector graphics) documents\n * Also handles imported PDFs opened for editing\n */\nexport class DrawEditor extends OfficeEditor {\n  private isImportedPdf: boolean = false;\n\n  getDocumentType(): 'draw' {\n    return 'draw';\n  }\n\n  setImportedPdf(value: boolean): void {\n    this.isImportedPdf = value;\n  }\n\n  getStructure(_options?: { maxResponseChars?: number }): OperationResult<DrawStructure> {\n    try {\n      const numPages = this.lok.documentGetParts(this.docPtr);\n      const pages: PageInfo[] = [];\n\n      for (let i = 0; i < numPages; i++) {\n        const pageInfo = this.getPageInfoInternal(i);\n        pages.push(pageInfo);\n      }\n\n      const structure: DrawStructure = {\n        type: 'draw',\n        pages,\n        pageCount: numPages,\n        isImportedPdf: this.isImportedPdf,\n      };\n\n      return this.createResult(structure);\n    } catch (error) {\n      return this.createErrorResult(`Failed to get structure: ${String(error)}`);\n    }\n  }\n\n  // ============================================\n  // Page reading\n  // ============================================\n\n  getPage(index: number): OperationResult<PageData> {\n    try {\n      const numPages = this.lok.documentGetParts(this.docPtr);\n\n      if (index < 0 || index >= numPages) {\n        return this.createErrorResult(\n          `Invalid page index: ${index}. Valid range: 0-${numPages - 1}`,\n          'Use getStructure() to see available pages'\n        );\n      }\n\n      this.lok.documentSetPart(this.docPtr, index);\n      const size = this.lok.documentGetDocumentSize(this.docPtr);\n      const shapes = this.getShapesOnPage();\n\n      const pageData: PageData = {\n        index,\n        shapes,\n        size: { width: size.width, height: size.height },\n      };\n\n      return this.createResult(pageData);\n    } catch (error) {\n      return this.createErrorResult(`Failed to get page: ${String(error)}`);\n    }\n  }\n\n  getPageCount(): OperationResult<number> {\n    try {\n      const count = this.lok.documentGetParts(this.docPtr);\n      return this.createResult(count);\n    } catch (error) {\n      return this.createErrorResult(`Failed to get page count: ${String(error)}`);\n    }\n  }\n\n  // ============================================\n  // Page management\n  // ============================================\n\n  addPage(options?: { afterPage?: number }): OperationResult<{ index: number }> {\n    try {\n      const numPages = this.lok.documentGetParts(this.docPtr);\n\n      // Navigate to position\n      if (options?.afterPage !== undefined) {\n        this.lok.documentSetPart(this.docPtr, options.afterPage);\n      } else {\n        this.lok.documentSetPart(this.docPtr, numPages - 1);\n      }\n\n      // Insert new page\n      this.lok.postUnoCommand(this.docPtr, '.uno:InsertPage');\n\n      const newIndex = options?.afterPage !== undefined\n        ? options.afterPage + 1\n        : numPages;\n\n      return this.createResult({ index: newIndex });\n    } catch (error) {\n      return this.createErrorResult(`Failed to add page: ${String(error)}`);\n    }\n  }\n\n  deletePage(index: number): OperationResult<void> {\n    try {\n      const numPages = this.lok.documentGetParts(this.docPtr);\n\n      if (numPages <= 1) {\n        return this.createErrorResult(\n          'Cannot delete the last page',\n          'A drawing document must have at least one page'\n        );\n      }\n\n      if (index < 0 || index >= numPages) {\n        return this.createErrorResult(\n          `Invalid page index: ${index}`,\n          `Valid range: 0-${numPages - 1}`\n        );\n      }\n\n      this.lok.documentSetPart(this.docPtr, index);\n      this.lok.postUnoCommand(this.docPtr, '.uno:DeletePage');\n\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Failed to delete page: ${String(error)}`);\n    }\n  }\n\n  duplicatePage(index: number): OperationResult<{ newIndex: number }> {\n    try {\n      const numPages = this.lok.documentGetParts(this.docPtr);\n\n      if (index < 0 || index >= numPages) {\n        return this.createErrorResult(\n          `Invalid page index: ${index}`,\n          `Valid range: 0-${numPages - 1}`\n        );\n      }\n\n      this.lok.documentSetPart(this.docPtr, index);\n      this.lok.postUnoCommand(this.docPtr, '.uno:DuplicatePage');\n\n      return this.createResult({ newIndex: index + 1 });\n    } catch (error) {\n      return this.createErrorResult(`Failed to duplicate page: ${String(error)}`);\n    }\n  }\n\n  // ============================================\n  // Shape operations\n  // ============================================\n\n  addShape(\n    pageIndex: number,\n    shapeType: ShapeType,\n    bounds: Rectangle,\n    options?: { text?: string; fillColor?: string; lineColor?: string }\n  ): OperationResult<{ shapeIndex: number }> {\n    try {\n      const numPages = this.lok.documentGetParts(this.docPtr);\n\n      if (pageIndex < 0 || pageIndex >= numPages) {\n        return this.createErrorResult(`Invalid page index: ${pageIndex}`);\n      }\n\n      this.lok.documentSetPart(this.docPtr, pageIndex);\n\n      // Map shape type to UNO command\n      const shapeCommand = this.getShapeCommand(shapeType);\n\n      // Set shape bounds\n      const boundsArgs = JSON.stringify({\n        X: { type: 'long', value: bounds.x },\n        Y: { type: 'long', value: bounds.y },\n        Width: { type: 'long', value: bounds.width },\n        Height: { type: 'long', value: bounds.height },\n      });\n\n      this.lok.postUnoCommand(this.docPtr, shapeCommand, boundsArgs);\n\n      // Set optional properties\n      if (options?.text) {\n        const textArgs = JSON.stringify({\n          Text: { type: 'string', value: options.text },\n        });\n        this.lok.postUnoCommand(this.docPtr, '.uno:InsertText', textArgs);\n      }\n\n      if (options?.fillColor) {\n        const colorArgs = JSON.stringify({\n          FillColor: { type: 'long', value: this.hexToNumber(options.fillColor) },\n        });\n        this.lok.postUnoCommand(this.docPtr, '.uno:FillColor', colorArgs);\n      }\n\n      if (options?.lineColor) {\n        const colorArgs = JSON.stringify({\n          LineColor: { type: 'long', value: this.hexToNumber(options.lineColor) },\n        });\n        this.lok.postUnoCommand(this.docPtr, '.uno:XLineColor', colorArgs);\n      }\n\n      // Return approximate index (would need LOK API to get actual)\n      return this.createResult({ shapeIndex: 0 });\n    } catch (error) {\n      return this.createErrorResult(`Failed to add shape: ${String(error)}`);\n    }\n  }\n\n  addLine(\n    pageIndex: number,\n    start: Position,\n    end: Position,\n    options?: { lineColor?: string; lineWidth?: number }\n  ): OperationResult<{ shapeIndex: number }> {\n    try {\n      const numPages = this.lok.documentGetParts(this.docPtr);\n\n      if (pageIndex < 0 || pageIndex >= numPages) {\n        return this.createErrorResult(`Invalid page index: ${pageIndex}`);\n      }\n\n      this.lok.documentSetPart(this.docPtr, pageIndex);\n\n      const args = JSON.stringify({\n        StartX: { type: 'long', value: start.x },\n        StartY: { type: 'long', value: start.y },\n        EndX: { type: 'long', value: end.x },\n        EndY: { type: 'long', value: end.y },\n      });\n\n      this.lok.postUnoCommand(this.docPtr, '.uno:Line', args);\n\n      if (options?.lineColor) {\n        const colorArgs = JSON.stringify({\n          LineColor: { type: 'long', value: this.hexToNumber(options.lineColor) },\n        });\n        this.lok.postUnoCommand(this.docPtr, '.uno:XLineColor', colorArgs);\n      }\n\n      if (options?.lineWidth) {\n        const widthArgs = JSON.stringify({\n          LineWidth: { type: 'long', value: options.lineWidth },\n        });\n        this.lok.postUnoCommand(this.docPtr, '.uno:LineWidth', widthArgs);\n      }\n\n      return this.createResult({ shapeIndex: 0 });\n    } catch (error) {\n      return this.createErrorResult(`Failed to add line: ${String(error)}`);\n    }\n  }\n\n  deleteShape(pageIndex: number, shapeIndex: number): OperationResult<void> {\n    try {\n      this.lok.documentSetPart(this.docPtr, pageIndex);\n\n      // Select shape by index (simplified - real impl would use object selection)\n      this.selectShape(shapeIndex);\n      this.lok.postUnoCommand(this.docPtr, '.uno:Delete');\n\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Failed to delete shape: ${String(error)}`);\n    }\n  }\n\n  setShapeText(pageIndex: number, shapeIndex: number, text: string): OperationResult<void> {\n    try {\n      this.lok.documentSetPart(this.docPtr, pageIndex);\n      this.selectShape(shapeIndex);\n\n      // Enter edit mode for the shape\n      this.lok.postUnoCommand(this.docPtr, '.uno:EnterGroup');\n\n      // Replace text\n      this.lok.postUnoCommand(this.docPtr, '.uno:SelectAll');\n      const args = JSON.stringify({\n        Text: { type: 'string', value: text },\n      });\n      this.lok.postUnoCommand(this.docPtr, '.uno:InsertText', args);\n\n      // Exit edit mode\n      this.lok.postUnoCommand(this.docPtr, '.uno:LeaveGroup');\n\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Failed to set shape text: ${String(error)}`);\n    }\n  }\n\n  moveShape(pageIndex: number, shapeIndex: number, newPosition: Position): OperationResult<void> {\n    try {\n      this.lok.documentSetPart(this.docPtr, pageIndex);\n      this.selectShape(shapeIndex);\n\n      const args = JSON.stringify({\n        X: { type: 'long', value: newPosition.x },\n        Y: { type: 'long', value: newPosition.y },\n      });\n      this.lok.postUnoCommand(this.docPtr, '.uno:SetObjectPosition', args);\n\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Failed to move shape: ${String(error)}`);\n    }\n  }\n\n  resizeShape(pageIndex: number, shapeIndex: number, newSize: Size): OperationResult<void> {\n    try {\n      this.lok.documentSetPart(this.docPtr, pageIndex);\n      this.selectShape(shapeIndex);\n\n      const args = JSON.stringify({\n        Width: { type: 'long', value: newSize.width },\n        Height: { type: 'long', value: newSize.height },\n      });\n      this.lok.postUnoCommand(this.docPtr, '.uno:Size', args);\n\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Failed to resize shape: ${String(error)}`);\n    }\n  }\n\n  // ============================================\n  // Private helpers\n  // ============================================\n\n  private getPageInfoInternal(index: number): PageInfo {\n    this.lok.documentSetPart(this.docPtr, index);\n    const size = this.lok.documentGetDocumentSize(this.docPtr);\n    const shapes = this.getShapesOnPage();\n\n    return {\n      index,\n      shapeCount: shapes.length,\n      size: { width: size.width, height: size.height },\n    };\n  }\n\n  private getShapesOnPage(): ShapeData[] {\n    // In a real implementation, we'd enumerate shapes via LOK\n    // For now, we parse text content as a simple proxy\n    const text = this.lok.getAllText(this.docPtr) || '';\n\n    if (!text.trim()) {\n      return [];\n    }\n\n    // Return a single text shape if there's content\n    return [{\n      index: 0,\n      type: 'text',\n      text,\n      bounds: { x: 0, y: 0, width: 0, height: 0 },\n    }];\n  }\n\n  private selectShape(shapeIndex: number): void {\n    // Navigate to shape - simplified implementation\n    // Real implementation would use object enumeration\n    const args = JSON.stringify({\n      Index: { type: 'long', value: shapeIndex },\n    });\n    this.lok.postUnoCommand(this.docPtr, '.uno:SelectObject', args);\n  }\n\n  private getShapeCommand(shapeType: ShapeType): string {\n    const commands: Record<ShapeType, string> = {\n      rectangle: '.uno:Rect',\n      ellipse: '.uno:Ellipse',\n      line: '.uno:Line',\n      text: '.uno:Text',\n      image: '.uno:InsertGraphic',\n      group: '.uno:FormatGroup',\n      other: '.uno:Rect', // Default to rectangle\n    };\n    return commands[shapeType];\n  }\n\n  private hexToNumber(hex: string): number {\n    return parseInt(hex.replace('#', ''), 16);\n  }\n}\n","// src/editor/index.ts\nimport type { LOKBindings } from '../lok-bindings.js';\nimport { OfficeEditor } from './base.js';\nimport { WriterEditor } from './writer.js';\nimport { CalcEditor } from './calc.js';\nimport { ImpressEditor } from './impress.js';\nimport { DrawEditor } from './draw.js';\nimport type { OpenDocumentOptions } from './types.js';\n\n// LOK document type constants (from LibreOfficeKit)\nconst LOK_DOCTYPE_TEXT = 0;\nconst LOK_DOCTYPE_SPREADSHEET = 1;\nconst LOK_DOCTYPE_PRESENTATION = 2;\nconst LOK_DOCTYPE_DRAWING = 3;\n\n/**\n * Factory function to create the appropriate editor based on document type\n *\n * @param lok - LibreOfficeKit bindings instance\n * @param docPtr - Document pointer from lok.documentLoad()\n * @param options - Editor options (maxResponseChars, etc.)\n * @returns Typed editor instance (WriterEditor, CalcEditor, ImpressEditor, or DrawEditor)\n * @throws Error if document type is unsupported\n *\n * @example\n * ```typescript\n * const docPtr = lok.documentLoad('/tmp/document.docx');\n * const editor = createEditor(lok, docPtr);\n *\n * if (isWriterEditor(editor)) {\n *   // TypeScript knows editor has WriterEditor methods\n *   const result = editor.insertParagraph('Hello World');\n * }\n * ```\n */\nexport function createEditor(\n  lok: LOKBindings,\n  docPtr: number,\n  options?: OpenDocumentOptions\n): OfficeEditor {\n  const docType = lok.documentGetDocumentType(docPtr);\n\n  switch (docType) {\n    case LOK_DOCTYPE_TEXT:\n      return new WriterEditor(lok, docPtr, options);\n\n    case LOK_DOCTYPE_SPREADSHEET:\n      return new CalcEditor(lok, docPtr, options);\n\n    case LOK_DOCTYPE_PRESENTATION:\n      return new ImpressEditor(lok, docPtr, options);\n\n    case LOK_DOCTYPE_DRAWING:\n      return new DrawEditor(lok, docPtr, options);\n\n    default:\n      throw new Error(`Unsupported document type: ${docType}`);\n  }\n}\n\n// ============================================\n// Type Guards\n// ============================================\n\n/**\n * Type guard for WriterEditor\n */\nexport function isWriterEditor(editor: OfficeEditor): editor is WriterEditor {\n  return editor.getDocumentType() === 'writer';\n}\n\n/**\n * Type guard for CalcEditor\n */\nexport function isCalcEditor(editor: OfficeEditor): editor is CalcEditor {\n  return editor.getDocumentType() === 'calc';\n}\n\n/**\n * Type guard for ImpressEditor\n */\nexport function isImpressEditor(editor: OfficeEditor): editor is ImpressEditor {\n  return editor.getDocumentType() === 'impress';\n}\n\n/**\n * Type guard for DrawEditor\n */\nexport function isDrawEditor(editor: OfficeEditor): editor is DrawEditor {\n  return editor.getDocumentType() === 'draw';\n}\n\n// ============================================\n// Re-exports\n// ============================================\n\n// Export all types\nexport type {\n  OperationResult,\n  TruncationInfo,\n  OpenDocumentOptions,\n  TextPosition,\n  TextRange,\n  TextFormat,\n  Paragraph,\n  WriterStructure,\n  CellRef,\n  RangeRef,\n  ColRef,\n  SheetRef,\n  CellValue,\n  CellData,\n  CellFormat,\n  SheetInfo,\n  CalcStructure,\n  SlideLayout,\n  TextFrame,\n  SlideData,\n  SlideInfo,\n  ImpressStructure,\n  ShapeType,\n  ShapeData,\n  PageData,\n  PageInfo,\n  DrawStructure,\n  Rectangle,\n  Size,\n  Position,\n  DocumentMetadata,\n  DocumentStructure,\n  DocumentType,\n  SelectionRange,\n  FindOptions,\n} from './types.js';\n\n// Export all editor classes\nexport { OfficeEditor } from './base.js';\nexport { WriterEditor } from './writer.js';\nexport { CalcEditor } from './calc.js';\nexport { ImpressEditor } from './impress.js';\nexport { DrawEditor } from './draw.js';\n\n// Export LLM tool definitions\nexport {\n  // Tool collections\n  allTools,\n  toolsByName,\n  commonTools,\n  writerTools,\n  calcTools,\n  impressTools,\n  drawTools,\n  documentTools,\n  // Utility functions\n  getToolsForDocumentType,\n  toOpenAIFunction,\n  toAnthropicTool,\n  getOpenAIFunctions,\n  getAnthropicTools,\n} from './tools.js';\n\nexport type {\n  ToolDefinition,\n  CommonToolName,\n  WriterToolName,\n  CalcToolName,\n  ImpressToolName,\n  DrawToolName,\n  DocumentToolName,\n  AllToolName,\n  ToolParameters,\n} from './tools.js';\n","/**\n * LibreOfficeKit Low-Level Bindings\n *\n * This module provides direct access to the LibreOfficeKit C API\n * through the WASM module using the stable lok_* shim exports.\n *\n * Shim functions (C side) should be defined as:\n *   - lok_documentLoad(pKit, pPath)\n *   - lok_documentLoadWithOptions(pKit, pPath, pOptions)\n *   - lok_documentSaveAs(pDoc, pUrl, pFormat, pFilterOptions)\n *   - lok_documentDestroy(pDoc)\n *   - lok_getError(pKit)\n *   - lok_destroy(pKit)          <-- RECOMMENDED to add\n */\n\nimport type { EmscriptenModule } from './types.js';\n\n// Extended module type with our LOK shim exports\ninterface LOKModule extends EmscriptenModule {\n  _lok_documentLoad?: (lok: number, path: number) => number;\n  _lok_documentLoadWithOptions?: (lok: number, path: number, options: number) => number;\n  _lok_documentSaveAs?: (doc: number, url: number, format: number, opts: number) => number;\n  _lok_documentDestroy?: (doc: number) => void;\n  _lok_getError?: (lok: number) => number;\n  _lok_destroy?: (lok: number) => void;\n  // Page rendering shims\n  _lok_documentGetParts?: (doc: number) => number;\n  _lok_documentGetPart?: (doc: number) => number;\n  _lok_documentSetPart?: (doc: number, part: number) => void;\n  _lok_documentGetDocumentType?: (doc: number) => number;\n  _lok_documentGetDocumentSize?: (doc: number, widthPtr: number, heightPtr: number) => void;\n  _lok_documentInitializeForRendering?: (doc: number, args: number) => void;\n  _lok_documentPaintTile?: (\n    doc: number,\n    buffer: number,\n    canvasWidth: number,\n    canvasHeight: number,\n    tilePosX: number,\n    tilePosY: number,\n    tileWidth: number,\n    tileHeight: number\n  ) => void;\n  _lok_documentGetTileMode?: (doc: number) => number;\n  // Text selection and content shims\n  _lok_documentGetTextSelection?: (doc: number, mimeType: number, usedMimeType: number) => number;\n  _lok_documentSetTextSelection?: (doc: number, type: number, x: number, y: number) => void;\n  _lok_documentGetSelectionType?: (doc: number) => number;\n  _lok_documentResetSelection?: (doc: number) => void;\n  // Mouse and keyboard event shims\n  _lok_documentPostMouseEvent?: (doc: number, type: number, x: number, y: number, count: number, buttons: number, modifier: number) => void;\n  _lok_documentPostKeyEvent?: (doc: number, type: number, charCode: number, keyCode: number) => void;\n  // UNO command shims\n  _lok_documentPostUnoCommand?: (doc: number, command: number, args: number, notifyWhenFinished: number) => void;\n  _lok_documentGetCommandValues?: (doc: number, command: number) => number;\n  // Page/Part information shims\n  _lok_documentGetPartPageRectangles?: (doc: number) => number;\n  _lok_documentGetPartInfo?: (doc: number, part: number) => number;\n  _lok_documentGetPartName?: (doc: number, part: number) => number;\n  // Clipboard shims\n  _lok_documentPaste?: (doc: number, mimeType: number, data: number, size: number) => number;\n  // View and zoom shims\n  _lok_documentSetClientZoom?: (doc: number, tilePixelWidth: number, tilePixelHeight: number, tileTwipWidth: number, tileTwipHeight: number) => void;\n  _lok_documentSetClientVisibleArea?: (doc: number, x: number, y: number, width: number, height: number) => void;\n  // Accessibility shims\n  _lok_documentGetA11yFocusedParagraph?: (doc: number) => number;\n  _lok_documentGetA11yCaretPosition?: (doc: number) => number;\n  _lok_documentSetAccessibilityState?: (doc: number, viewId: number, enabled: number) => void;\n  // Spreadsheet-specific shims\n  _lok_documentGetDataArea?: (doc: number, part: number, colPtr: number, rowPtr: number) => void;\n  // Edit mode shim\n  _lok_documentGetEditMode?: (doc: number) => number;\n  _lok_documentSetEditMode?: (doc: number, mode: number) => void;\n  // View management shims\n  _lok_documentCreateView?: (doc: number) => number;\n  _lok_documentCreateViewWithOptions?: (doc: number, options: number) => number;\n  _lok_documentDestroyView?: (doc: number, viewId: number) => void;\n  _lok_documentSetView?: (doc: number, viewId: number) => void;\n  _lok_documentGetView?: (doc: number) => number;\n  _lok_documentGetViewsCount?: (doc: number) => number;\n  // Event loop and callback shims\n  _lok_enableSyncEvents?: () => void;\n  _lok_disableSyncEvents?: () => void;\n  _lok_runLoop?: (lok: number, pollCallback: number, wakeCallback: number, data: number) => void;\n  // Callback queue shims\n  _lok_documentRegisterCallback?: (doc: number) => void;\n  _lok_documentUnregisterCallback?: (doc: number) => void;\n  _lok_hasCallbackEvents?: () => number;\n  _lok_getCallbackEventCount?: () => number;\n  _lok_pollCallback?: (payloadBuffer: number, bufferSize: number, payloadLengthPtr: number) => number;\n  _lok_clearCallbackQueue?: () => void;\n  _lok_flushCallbacks?: (doc: number) => void;\n}\n\n// LOK Mouse Event Types\nexport const LOK_MOUSEEVENT_BUTTONDOWN = 0;\nexport const LOK_MOUSEEVENT_BUTTONUP = 1;\nexport const LOK_MOUSEEVENT_MOVE = 2;\n\n// LOK Key Event Types\nexport const LOK_KEYEVENT_KEYINPUT = 0;\nexport const LOK_KEYEVENT_KEYUP = 1;\n\n// LOK Selection Types\nexport const LOK_SELTYPE_NONE = 0;\nexport const LOK_SELTYPE_TEXT = 1;\nexport const LOK_SELTYPE_CELL = 2;\n\n// LOK Text Selection Types\nexport const LOK_SETTEXTSELECTION_START = 0;\nexport const LOK_SETTEXTSELECTION_END = 1;\nexport const LOK_SETTEXTSELECTION_RESET = 2;\n\n// LOK Document Types\nexport const LOK_DOCTYPE_TEXT = 0;\nexport const LOK_DOCTYPE_SPREADSHEET = 1;\nexport const LOK_DOCTYPE_PRESENTATION = 2;\nexport const LOK_DOCTYPE_DRAWING = 3;\nexport const LOK_DOCTYPE_OTHER = 4;\n\n// LOK Callback Types (from LibreOfficeKitEnums.h)\nexport const LOK_CALLBACK_INVALIDATE_TILES = 0;\nexport const LOK_CALLBACK_INVALIDATE_VISIBLE_CURSOR = 1;\nexport const LOK_CALLBACK_TEXT_SELECTION = 2;\nexport const LOK_CALLBACK_TEXT_SELECTION_START = 3;\nexport const LOK_CALLBACK_TEXT_SELECTION_END = 4;\nexport const LOK_CALLBACK_CURSOR_VISIBLE = 5;\nexport const LOK_CALLBACK_GRAPHIC_SELECTION = 6;\nexport const LOK_CALLBACK_HYPERLINK_CLICKED = 7;\nexport const LOK_CALLBACK_STATE_CHANGED = 8;\nexport const LOK_CALLBACK_STATUS_INDICATOR_START = 9;\nexport const LOK_CALLBACK_STATUS_INDICATOR_SET_VALUE = 10;\nexport const LOK_CALLBACK_STATUS_INDICATOR_FINISH = 11;\nexport const LOK_CALLBACK_SEARCH_NOT_FOUND = 12;\nexport const LOK_CALLBACK_DOCUMENT_SIZE_CHANGED = 13;\nexport const LOK_CALLBACK_SET_PART = 14;\nexport const LOK_CALLBACK_SEARCH_RESULT_SELECTION = 15;\nexport const LOK_CALLBACK_UNO_COMMAND_RESULT = 16;\nexport const LOK_CALLBACK_CELL_CURSOR = 17;\nexport const LOK_CALLBACK_MOUSE_POINTER = 18;\nexport const LOK_CALLBACK_CELL_FORMULA = 19;\nexport const LOK_CALLBACK_DOCUMENT_PASSWORD = 20;\nexport const LOK_CALLBACK_DOCUMENT_PASSWORD_TO_MODIFY = 21;\nexport const LOK_CALLBACK_CONTEXT_MENU = 22;\nexport const LOK_CALLBACK_INVALIDATE_VIEW_CURSOR = 23;\nexport const LOK_CALLBACK_TEXT_VIEW_SELECTION = 24;\nexport const LOK_CALLBACK_CELL_VIEW_CURSOR = 25;\nexport const LOK_CALLBACK_GRAPHIC_VIEW_SELECTION = 26;\nexport const LOK_CALLBACK_VIEW_CURSOR_VISIBLE = 27;\nexport const LOK_CALLBACK_VIEW_LOCK = 28;\nexport const LOK_CALLBACK_REDLINE_TABLE_SIZE_CHANGED = 29;\nexport const LOK_CALLBACK_REDLINE_TABLE_ENTRY_MODIFIED = 30;\nexport const LOK_CALLBACK_COMMENT = 31;\nexport const LOK_CALLBACK_INVALIDATE_HEADER = 32;\nexport const LOK_CALLBACK_CELL_ADDRESS = 33;\n\n// Callback event interface\nexport interface LOKCallbackEvent {\n  type: number;\n  typeName: string;\n  payload: string;\n}\n\n// Map callback type to name\nexport function getCallbackTypeName(type: number): string {\n  const names: Record<number, string> = {\n    [LOK_CALLBACK_INVALIDATE_TILES]: 'INVALIDATE_TILES',\n    [LOK_CALLBACK_INVALIDATE_VISIBLE_CURSOR]: 'INVALIDATE_VISIBLE_CURSOR',\n    [LOK_CALLBACK_TEXT_SELECTION]: 'TEXT_SELECTION',\n    [LOK_CALLBACK_TEXT_SELECTION_START]: 'TEXT_SELECTION_START',\n    [LOK_CALLBACK_TEXT_SELECTION_END]: 'TEXT_SELECTION_END',\n    [LOK_CALLBACK_CURSOR_VISIBLE]: 'CURSOR_VISIBLE',\n    [LOK_CALLBACK_GRAPHIC_SELECTION]: 'GRAPHIC_SELECTION',\n    [LOK_CALLBACK_HYPERLINK_CLICKED]: 'HYPERLINK_CLICKED',\n    [LOK_CALLBACK_STATE_CHANGED]: 'STATE_CHANGED',\n    [LOK_CALLBACK_STATUS_INDICATOR_START]: 'STATUS_INDICATOR_START',\n    [LOK_CALLBACK_STATUS_INDICATOR_SET_VALUE]: 'STATUS_INDICATOR_SET_VALUE',\n    [LOK_CALLBACK_STATUS_INDICATOR_FINISH]: 'STATUS_INDICATOR_FINISH',\n    [LOK_CALLBACK_SEARCH_NOT_FOUND]: 'SEARCH_NOT_FOUND',\n    [LOK_CALLBACK_DOCUMENT_SIZE_CHANGED]: 'DOCUMENT_SIZE_CHANGED',\n    [LOK_CALLBACK_SET_PART]: 'SET_PART',\n    [LOK_CALLBACK_SEARCH_RESULT_SELECTION]: 'SEARCH_RESULT_SELECTION',\n    [LOK_CALLBACK_UNO_COMMAND_RESULT]: 'UNO_COMMAND_RESULT',\n    [LOK_CALLBACK_CELL_CURSOR]: 'CELL_CURSOR',\n    [LOK_CALLBACK_MOUSE_POINTER]: 'MOUSE_POINTER',\n    [LOK_CALLBACK_CELL_FORMULA]: 'CELL_FORMULA',\n    [LOK_CALLBACK_DOCUMENT_PASSWORD]: 'DOCUMENT_PASSWORD',\n    [LOK_CALLBACK_DOCUMENT_PASSWORD_TO_MODIFY]: 'DOCUMENT_PASSWORD_TO_MODIFY',\n    [LOK_CALLBACK_CONTEXT_MENU]: 'CONTEXT_MENU',\n    [LOK_CALLBACK_INVALIDATE_VIEW_CURSOR]: 'INVALIDATE_VIEW_CURSOR',\n    [LOK_CALLBACK_TEXT_VIEW_SELECTION]: 'TEXT_VIEW_SELECTION',\n    [LOK_CALLBACK_CELL_VIEW_CURSOR]: 'CELL_VIEW_CURSOR',\n    [LOK_CALLBACK_GRAPHIC_VIEW_SELECTION]: 'GRAPHIC_VIEW_SELECTION',\n    [LOK_CALLBACK_VIEW_CURSOR_VISIBLE]: 'VIEW_CURSOR_VISIBLE',\n    [LOK_CALLBACK_VIEW_LOCK]: 'VIEW_LOCK',\n    [LOK_CALLBACK_REDLINE_TABLE_SIZE_CHANGED]: 'REDLINE_TABLE_SIZE_CHANGED',\n    [LOK_CALLBACK_REDLINE_TABLE_ENTRY_MODIFIED]: 'REDLINE_TABLE_ENTRY_MODIFIED',\n    [LOK_CALLBACK_COMMENT]: 'COMMENT',\n    [LOK_CALLBACK_INVALIDATE_HEADER]: 'INVALIDATE_HEADER',\n    [LOK_CALLBACK_CELL_ADDRESS]: 'CELL_ADDRESS',\n  };\n  return names[type] || `UNKNOWN(${type})`;\n}\n\n// Fallback offsets for WASM32 (4-byte pointers) if shims not available\nconst LOK_CLASS = {\n  nSize: 0,\n  destroy: 4,\n  documentLoad: 8,\n  getError: 12,\n  documentLoadWithOptions: 16,\n  freeError: 20,\n};\n\nconst DOC_CLASS = {\n  nSize: 0,\n  destroy: 4,\n  saveAs: 8,\n};\n\n// Reuse encoder/decoder\nconst textEncoder = new TextEncoder();\nconst textDecoder = new TextDecoder();\n\nexport class LOKBindings {\n  private module: LOKModule;\n  private lokPtr = 0;\n  private verbose: boolean;\n  private useShims: boolean;\n\n  constructor(module: EmscriptenModule, verbose = false) {\n    this.module = module as LOKModule;\n    this.verbose = verbose;\n\n    this.useShims = typeof this.module._lok_documentLoad === 'function';\n    if (this.useShims) {\n      this.log('Using direct LOK shim exports');\n    } else {\n      this.log('Using vtable traversal (shims not available)');\n    }\n  }\n\n  private log(...args: unknown[]): void {\n    if (this.verbose) {\n      console.log('[LOK]', ...args);\n    }\n  }\n\n  /**\n   * Get fresh heap views (important after memory growth!)\n   */\n  private get HEAPU8(): Uint8Array {\n    return this.module.HEAPU8;\n  }\n\n  private get HEAPU32(): Uint32Array {\n    return this.module.HEAPU32;\n  }\n\n  private get HEAP32(): Int32Array {\n    return this.module.HEAP32;\n  }\n\n  /**\n   * Allocate a null-terminated string in WASM memory\n   */\n  allocString(str: string): number {\n    const bytes = textEncoder.encode(str + '\\0');\n    const ptr = this.module._malloc(bytes.length);\n    // Always get fresh heap view after malloc (might have grown memory)\n    this.HEAPU8.set(bytes, ptr);\n    return ptr;\n  }\n\n  /**\n   * Read a null-terminated string from WASM memory\n   */\n  readString(ptr: number): string | null {\n    if (ptr === 0) return null;\n    // Always get fresh heap view\n    const heap = this.HEAPU8;\n    let end = ptr;\n    while (heap[end] !== 0) end++;\n    // Copy the data to avoid SharedArrayBuffer issues in browsers\n    // TextDecoder.decode() doesn't accept SharedArrayBuffer views in some browsers\n    const slice = heap.slice(ptr, end);\n    return textDecoder.decode(slice);\n  }\n\n  /**\n   * Read a 32-bit pointer from memory (unsigned)\n   */\n  readPtr(addr: number): number {\n    // Always get fresh heap view\n    return this.HEAPU32[addr >> 2] || 0;\n  }\n\n  /**\n   * Get a function from the WASM table (fallback for vtable traversal)\n   */\n  private getFunc<T>(ptr: number): T {\n    const wasmTable = this.module.wasmTable as WebAssembly.Table;\n    return wasmTable.get(ptr) as T;\n  }\n\n  /**\n   * Initialize LibreOfficeKit\n   */\n  initialize(installPath: string = '/instdir/program'): void {\n    this.log('Initializing with path:', installPath);\n    const pathPtr = this.allocString(installPath);\n\n    try {\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any, @typescript-eslint/no-unsafe-member-access\n      const hook = (this.module as any)._libreofficekit_hook as\n        | ((pathPtr: number) => number)\n        | undefined;\n\n      if (typeof hook !== 'function') {\n        throw new Error('libreofficekit_hook export not found on module');\n      }\n\n      this.lokPtr = hook(pathPtr);\n\n      if (this.lokPtr === 0) {\n        throw new Error('Failed to initialize LibreOfficeKit');\n      }\n\n      this.log('LOK initialized, ptr:', this.lokPtr);\n    } finally {\n      this.module._free(pathPtr);\n    }\n  }\n\n  /**\n   * Get the last error message\n   */\n  getError(): string | null {\n    if (this.lokPtr === 0) return null;\n\n    // Prefer shim\n    if (this.useShims && this.module._lok_getError) {\n      const errPtr = this.module._lok_getError(this.lokPtr);\n      return this.readString(errPtr);\n    }\n\n    // Fallback: vtable traversal\n    const lokClassPtr = this.readPtr(this.lokPtr);\n    const getErrorPtr = this.readPtr(lokClassPtr + LOK_CLASS.getError);\n    if (getErrorPtr === 0) return null;\n\n    const getError = this.getFunc<(lok: number) => number>(getErrorPtr);\n    const errPtr = getError(this.lokPtr);\n    return this.readString(errPtr);\n  }\n\n  /**\n   * Get version info\n   */\n  getVersionInfo(): string | null {\n    return 'LibreOffice WASM';\n  }\n\n  /**\n   * Convert a filesystem path to a file:// URL\n   * Required by LibreOffice's getAbsoluteURL() which uses rtl::Uri::convertRelToAbs()\n   */\n  private toFileUrl(path: string): string {\n    if (path.startsWith('file://')) return path;\n    const absolutePath = path.startsWith('/') ? path : '/' + path;\n    return 'file://' + absolutePath;\n  }\n\n  /**\n   * Load a document from the virtual filesystem\n   */\n  documentLoad(path: string): number {\n    if (this.lokPtr === 0) {\n      throw new Error('LOK not initialized');\n    }\n\n    const fileUrl = this.toFileUrl(path);\n    this.log('Loading document:', path, '->', fileUrl);\n    const pathPtr = this.allocString(fileUrl);\n\n    try {\n      const startTime = Date.now();\n      let docPtr: number;\n\n      if (this.useShims && this.module._lok_documentLoad) {\n        // Use direct shim export\n        docPtr = this.module._lok_documentLoad(this.lokPtr, pathPtr);\n      } else {\n        // Fallback: vtable traversal\n        const lokClassPtr = this.readPtr(this.lokPtr);\n        const documentLoadPtr = this.readPtr(lokClassPtr + LOK_CLASS.documentLoad);\n        const documentLoad = this.getFunc<(lok: number, path: number) => number>(documentLoadPtr);\n        docPtr = documentLoad(this.lokPtr, pathPtr);\n      }\n\n      this.log('Document loaded in', Date.now() - startTime, 'ms, ptr:', docPtr);\n\n      if (docPtr === 0) {\n        const error = this.getError();\n        throw new Error(`Failed to load document: ${error || 'unknown error'}`);\n      }\n\n      return docPtr;\n    } finally {\n      this.module._free(pathPtr);\n    }\n  }\n\n  /**\n   * Load a document with options\n   */\n  documentLoadWithOptions(path: string, options: string): number {\n    if (this.lokPtr === 0) {\n      throw new Error('LOK not initialized');\n    }\n\n    const fileUrl = this.toFileUrl(path);\n    this.log('Loading document with options:', path, '->', fileUrl, options);\n    const pathPtr = this.allocString(fileUrl);\n    const optsPtr = this.allocString(options);\n\n    try {\n      let docPtr: number;\n\n      if (this.useShims && this.module._lok_documentLoadWithOptions) {\n        // Use direct shim export\n        docPtr = this.module._lok_documentLoadWithOptions(this.lokPtr, pathPtr, optsPtr);\n      } else {\n        // Fallback: vtable traversal\n        const lokClassPtr = this.readPtr(this.lokPtr);\n        const loadWithOptsPtr = this.readPtr(lokClassPtr + LOK_CLASS.documentLoadWithOptions);\n\n        if (loadWithOptsPtr === 0) {\n          // No special method - fall back to plain load\n          return this.documentLoad(path);\n        }\n\n        const loadWithOpts = this.getFunc<\n          (lok: number, path: number, opts: number) => number\n        >(loadWithOptsPtr);\n        docPtr = loadWithOpts(this.lokPtr, pathPtr, optsPtr);\n      }\n\n      if (docPtr === 0) {\n        const error = this.getError();\n        throw new Error(`Failed to load document: ${error || 'unknown error'}`);\n      }\n\n      this.log('Document loaded, ptr:', docPtr);\n      return docPtr;\n    } finally {\n      this.module._free(pathPtr);\n      this.module._free(optsPtr);\n    }\n  }\n\n  /**\n   * Save a document to a different format\n   */\n  documentSaveAs(\n    docPtr: number,\n    outputPath: string,\n    format: string,\n    filterOptions: string = ''\n  ): void {\n    if (docPtr === 0) {\n      throw new Error('Invalid document pointer');\n    }\n\n    const fileUrl = this.toFileUrl(outputPath);\n    this.log('Saving document to:', outputPath, '->', fileUrl, 'format:', format);\n\n    const urlPtr = this.allocString(fileUrl);\n    const formatPtr = this.allocString(format);\n    const optsPtr = this.allocString(filterOptions);\n\n    try {\n      let result: number;\n\n      if (this.useShims && this.module._lok_documentSaveAs) {\n        // Use direct shim export\n        result = this.module._lok_documentSaveAs(docPtr, urlPtr, formatPtr, optsPtr);\n      } else {\n        // Fallback: vtable traversal\n        const docClassPtr = this.readPtr(docPtr);\n        const saveAsPtr = this.readPtr(docClassPtr + DOC_CLASS.saveAs);\n        const saveAs = this.getFunc<\n          (doc: number, url: number, format: number, opts: number) => number\n        >(saveAsPtr);\n        result = saveAs(docPtr, urlPtr, formatPtr, optsPtr);\n      }\n\n      this.log('Save result:', result);\n\n      if (result === 0) {\n        throw new Error('Failed to save document');\n      }\n    } finally {\n      this.module._free(urlPtr);\n      this.module._free(formatPtr);\n      this.module._free(optsPtr);\n    }\n  }\n\n  /**\n   * Destroy a document\n   */\n  documentDestroy(docPtr: number): void {\n    if (docPtr === 0) return;\n\n    if (this.useShims && this.module._lok_documentDestroy) {\n      // Use direct shim export\n      this.module._lok_documentDestroy(docPtr);\n      this.log('Document destroyed (via shim)');\n      return;\n    }\n\n    // Fallback: vtable traversal\n    const docClassPtr = this.readPtr(docPtr);\n    const destroyPtr = this.readPtr(docClassPtr + DOC_CLASS.destroy);\n\n    if (destroyPtr !== 0) {\n      const destroy = this.getFunc<(doc: number) => void>(destroyPtr);\n      destroy(docPtr);\n      this.log('Document destroyed (via vtable)');\n    }\n  }\n\n  /**\n   * Destroy the LOK instance\n   */\n  destroy(): void {\n    if (this.lokPtr === 0) return;\n\n    try {\n      // Prefer C shim if available\n      if (this.useShims && this.module._lok_destroy) {\n        this.module._lok_destroy(this.lokPtr);\n        this.log('LOK destroyed (via shim)');\n      } else {\n        // Fallback: vtable traversal\n        const lokClassPtr = this.readPtr(this.lokPtr);\n        const destroyPtr = this.readPtr(lokClassPtr + LOK_CLASS.destroy);\n\n        if (destroyPtr !== 0) {\n          const destroy = this.getFunc<(lok: number) => void>(destroyPtr);\n          destroy(this.lokPtr);\n          this.log('LOK destroyed (via vtable)');\n        }\n      }\n    } catch (error) {\n      this.log('LOK destroy error (ignored):', error);\n    }\n\n    this.lokPtr = 0;\n  }\n\n  /**\n   * Check if LOK is initialized\n   */\n  isInitialized(): boolean {\n    return this.lokPtr !== 0;\n  }\n\n  /**\n   * Check if using direct shim exports\n   */\n  isUsingShims(): boolean {\n    return this.useShims;\n  }\n\n  // ==========================================\n  // Page Rendering Methods\n  // ==========================================\n\n  /**\n   * Get the number of parts (pages/slides) in a document\n   */\n  documentGetParts(docPtr: number): number {\n    if (docPtr === 0) {\n      throw new Error('Invalid document pointer');\n    }\n\n    if (this.useShims && this.module._lok_documentGetParts) {\n      return this.module._lok_documentGetParts(docPtr);\n    }\n\n    // Fallback not implemented - would need vtable offsets\n    this.log('documentGetParts: shim not available');\n    return 0;\n  }\n\n  /**\n   * Get the current part (page/slide) index\n   */\n  documentGetPart(docPtr: number): number {\n    if (docPtr === 0) {\n      throw new Error('Invalid document pointer');\n    }\n\n    if (this.useShims && this.module._lok_documentGetPart) {\n      return this.module._lok_documentGetPart(docPtr);\n    }\n\n    this.log('documentGetPart: shim not available');\n    return 0;\n  }\n\n  /**\n   * Set the current part (page/slide) index\n   */\n  documentSetPart(docPtr: number, part: number): void {\n    if (docPtr === 0) {\n      throw new Error('Invalid document pointer');\n    }\n\n    if (this.useShims && this.module._lok_documentSetPart) {\n      this.module._lok_documentSetPart(docPtr, part);\n      return;\n    }\n\n    this.log('documentSetPart: shim not available');\n  }\n\n  /**\n   * Get document type (0=text, 1=spreadsheet, 2=presentation, 3=drawing)\n   */\n  documentGetDocumentType(docPtr: number): number {\n    if (docPtr === 0) {\n      throw new Error('Invalid document pointer');\n    }\n\n    if (this.useShims && this.module._lok_documentGetDocumentType) {\n      return this.module._lok_documentGetDocumentType(docPtr);\n    }\n\n    this.log('documentGetDocumentType: shim not available');\n    return 0;\n  }\n\n  /**\n   * Get document size in twips (1/1440 inch)\n   */\n  documentGetDocumentSize(docPtr: number): { width: number; height: number } {\n    this.log(`documentGetDocumentSize called with docPtr: ${docPtr}`);\n    if (docPtr === 0) {\n      throw new Error('Invalid document pointer');\n    }\n\n    if (this.useShims && this.module._lok_documentGetDocumentSize) {\n      // Allocate space for two longs (32-bit on WASM)\n      const sizePtr = this.module._malloc(8);\n      try {\n        this.module._lok_documentGetDocumentSize(docPtr, sizePtr, sizePtr + 4);\n        const width = this.HEAP32[sizePtr >> 2] ?? 0;\n        const height = this.HEAP32[(sizePtr + 4) >> 2] ?? 0;\n        this.log(`documentGetDocumentSize: ${width}x${height} twips`);\n        return { width, height };\n      } finally {\n        this.module._free(sizePtr);\n      }\n    }\n\n    this.log('documentGetDocumentSize: shim not available');\n    return { width: 0, height: 0 };\n  }\n\n  /**\n   * Initialize document for rendering\n   */\n  documentInitializeForRendering(docPtr: number, options: string = ''): void {\n    if (docPtr === 0) {\n      throw new Error('Invalid document pointer');\n    }\n\n    if (this.useShims && this.module._lok_documentInitializeForRendering) {\n      const optsPtr = this.allocString(options);\n      try {\n        this.module._lok_documentInitializeForRendering(docPtr, optsPtr);\n      } finally {\n        this.module._free(optsPtr);\n      }\n      return;\n    }\n\n    this.log('documentInitializeForRendering: shim not available');\n  }\n\n  /**\n   * Paint a tile of the document to a buffer\n   * @param docPtr Document pointer\n   * @param canvasWidth Output width in pixels\n   * @param canvasHeight Output height in pixels\n   * @param tilePosX X position in twips\n   * @param tilePosY Y position in twips\n   * @param tileWidth Width in twips\n   * @param tileHeight Height in twips\n   * @returns RGBA pixel data\n   */\n  documentPaintTile(\n    docPtr: number,\n    canvasWidth: number,\n    canvasHeight: number,\n    tilePosX: number,\n    tilePosY: number,\n    tileWidth: number,\n    tileHeight: number\n  ): Uint8Array {\n    if (docPtr === 0) {\n      throw new Error('Invalid document pointer');\n    }\n\n    if (this.useShims && this.module._lok_documentPaintTile) {\n      // Allocate RGBA buffer (4 bytes per pixel)\n      const bufferSize = canvasWidth * canvasHeight * 4;\n      const bufferPtr = this.module._malloc(bufferSize);\n\n      if (bufferPtr === 0) {\n        throw new Error(`Failed to allocate ${bufferSize} bytes for tile buffer`);\n      }\n\n      try {\n        this.module._lok_documentPaintTile(\n          docPtr,\n          bufferPtr,\n          canvasWidth,\n          canvasHeight,\n          tilePosX,\n          tilePosY,\n          tileWidth,\n          tileHeight\n        );\n\n        // Copy data out of WASM memory\n        const result = new Uint8Array(bufferSize);\n        result.set(this.HEAPU8.subarray(bufferPtr, bufferPtr + bufferSize));\n        return result;\n      } finally {\n        this.module._free(bufferPtr);\n      }\n    }\n\n    this.log('documentPaintTile: shim not available');\n    return new Uint8Array(0);\n  }\n\n  /**\n   * Get tile mode (0=RGBA, 1=BGRA)\n   */\n  documentGetTileMode(docPtr: number): number {\n    if (docPtr === 0) {\n      throw new Error('Invalid document pointer');\n    }\n\n    if (this.useShims && this.module._lok_documentGetTileMode) {\n      return this.module._lok_documentGetTileMode(docPtr);\n    }\n\n    this.log('documentGetTileMode: shim not available');\n    return 0; // Default to RGBA\n  }\n\n  /**\n   * Render a page/slide to an image\n   * @param docPtr Document pointer\n   * @param pageIndex Page/slide index (0-based)\n   * @param width Output width in pixels\n   * @param height Output height in pixels (0 = auto based on aspect ratio)\n   * @returns RGBA pixel data and dimensions\n   */\n  renderPage(\n    docPtr: number,\n    pageIndex: number,\n    width: number,\n    height: number = 0,\n    editMode: boolean = false\n  ): { data: Uint8Array; width: number; height: number } {\n    // Initialize for rendering if not already done\n    this.documentInitializeForRendering(docPtr);\n\n    // Get document type to determine rendering strategy\n    const docType = this.documentGetDocumentType(docPtr);\n\n    // For presentations and drawings, use setPart to select the slide/page\n    // For text documents, we need to use page rectangles\n    if (docType === 2 || docType === 3) { // PRESENTATION or DRAWING\n      console.log(`[LOK] Setting part to ${pageIndex} for presentation/drawing`);\n      this.documentSetPart(docPtr, pageIndex);\n      const currentPart = this.documentGetPart(docPtr);\n      console.log(`[LOK] Current part after setPart: ${currentPart}`);\n\n      // Set view mode (0) for presentations to avoid showing edit UI elements\n      // unless explicitly requested\n      if (!editMode) {\n        this.setEditMode(docPtr, 0);\n        console.log(`[LOK] Set edit mode to 0 (view mode) for presentation rendering`);\n      }\n    }\n\n    // Get document/page size in twips\n    const docSize = this.documentGetDocumentSize(docPtr);\n    this.log('Document size (twips):', docSize);\n\n    if (docSize.width === 0 || docSize.height === 0) {\n      throw new Error('Failed to get document size');\n    }\n\n    // For text documents, get page rectangles to find the specific page\n    let tilePosX = 0;\n    let tilePosY = 0;\n    let tileWidth = docSize.width;\n    let tileHeight = docSize.height;\n\n    if (docType === 0 || docType === 1) { // TEXT or SPREADSHEET\n      // Get page rectangles to find the Y offset for this page\n      const pageRectsStr = this.getPartPageRectangles(docPtr);\n      if (pageRectsStr) {\n        const pageRects = this.parsePageRectangles(pageRectsStr);\n        const pageRect = pageRects[pageIndex];\n        if (pageRect) {\n          tilePosX = pageRect.x;\n          tilePosY = pageRect.y;\n          tileWidth = pageRect.width;\n          tileHeight = pageRect.height;\n          this.log(`Page ${pageIndex} rectangle:`, pageRect);\n        }\n      }\n    }\n\n    // Calculate output dimensions maintaining aspect ratio\n    const aspectRatio = tileHeight / tileWidth;\n    const outputWidth = width;\n    const outputHeight = height > 0 ? height : Math.round(width * aspectRatio);\n\n    console.log(`[LOK] Calling paintTile: ${outputWidth}x${outputHeight} from tile pos (${tilePosX}, ${tilePosY}) size (${tileWidth}x${tileHeight})`);\n\n    // Paint the tile for this specific page\n    const data = this.documentPaintTile(\n      docPtr,\n      outputWidth,\n      outputHeight,\n      tilePosX,\n      tilePosY,\n      tileWidth,\n      tileHeight\n    );\n\n    console.log(`[LOK] paintTile returned ${data.length} bytes`);\n    return { data, width: outputWidth, height: outputHeight };\n  }\n\n  /**\n   * Render a page/slide at full quality (native resolution based on DPI)\n   *\n   * Unlike renderPage which scales to a fixed width, this method renders\n   * at the document's native resolution converted to pixels at the specified DPI.\n   *\n   * @param docPtr Document pointer\n   * @param pageIndex Page/slide index (0-based)\n   * @param dpi Dots per inch for rendering (default 150, use 300 for print quality)\n   * @param maxDimension Optional maximum dimension (width or height) to prevent memory issues\n   * @returns RGBA pixel data and dimensions\n   *\n   * @example\n   * // Render at 150 DPI (good for screen)\n   * const preview = lokBindings.renderPageFullQuality(docPtr, 0, 150);\n   *\n   * // Render at 300 DPI (print quality)\n   * const highRes = lokBindings.renderPageFullQuality(docPtr, 0, 300);\n   *\n   * // Render with max dimension cap to prevent memory issues\n   * const capped = lokBindings.renderPageFullQuality(docPtr, 0, 300, 4096);\n   */\n  renderPageFullQuality(\n    docPtr: number,\n    pageIndex: number,\n    dpi: number = 150,\n    maxDimension?: number,\n    editMode: boolean = false\n  ): { data: Uint8Array; width: number; height: number; dpi: number } {\n    // Initialize for rendering if not already done\n    this.documentInitializeForRendering(docPtr);\n\n    // Get document type to determine rendering strategy\n    const docType = this.documentGetDocumentType(docPtr);\n\n    // For presentations and drawings, use setPart to select the slide/page\n    if (docType === 2 || docType === 3) { // PRESENTATION or DRAWING\n      this.log(`Setting part to ${pageIndex} for presentation/drawing`);\n      this.documentSetPart(docPtr, pageIndex);\n\n      // Set view mode (0) for presentations to avoid showing edit UI elements\n      // unless explicitly requested\n      if (!editMode) {\n        this.setEditMode(docPtr, 0);\n        this.log(`Set edit mode to 0 (view mode) for presentation rendering`);\n      }\n    }\n\n    // Get document/page size in twips\n    const docSize = this.documentGetDocumentSize(docPtr);\n    this.log('Document size (twips):', docSize);\n\n    if (docSize.width === 0 || docSize.height === 0) {\n      throw new Error('Failed to get document size');\n    }\n\n    // For text documents, get page rectangles to find the specific page\n    let tilePosX = 0;\n    let tilePosY = 0;\n    let tileWidth = docSize.width;\n    let tileHeight = docSize.height;\n\n    if (docType === 0 || docType === 1) { // TEXT or SPREADSHEET\n      const pageRectsStr = this.getPartPageRectangles(docPtr);\n      if (pageRectsStr) {\n        const pageRects = this.parsePageRectangles(pageRectsStr);\n        const pageRect = pageRects[pageIndex];\n        if (pageRect) {\n          tilePosX = pageRect.x;\n          tilePosY = pageRect.y;\n          tileWidth = pageRect.width;\n          tileHeight = pageRect.height;\n          this.log(`Page ${pageIndex} rectangle:`, pageRect);\n        }\n      }\n    }\n\n    // Convert twips to pixels at the specified DPI\n    // 1 inch = 1440 twips, so pixels = twips * dpi / 1440\n    const TWIPS_PER_INCH = 1440;\n    let outputWidth = Math.round(tileWidth * dpi / TWIPS_PER_INCH);\n    let outputHeight = Math.round(tileHeight * dpi / TWIPS_PER_INCH);\n    let effectiveDpi = dpi;\n\n    // Apply max dimension cap if specified\n    if (maxDimension && (outputWidth > maxDimension || outputHeight > maxDimension)) {\n      const scale = maxDimension / Math.max(outputWidth, outputHeight);\n      outputWidth = Math.round(outputWidth * scale);\n      outputHeight = Math.round(outputHeight * scale);\n      effectiveDpi = Math.round(dpi * scale);\n      this.log(`Capped dimensions to ${outputWidth}x${outputHeight} (effective DPI: ${effectiveDpi})`);\n    }\n\n    console.log(`[LOK] renderPageFullQuality: ${outputWidth}x${outputHeight} at ${effectiveDpi} DPI from tile (${tilePosX}, ${tilePosY}) size (${tileWidth}x${tileHeight}) twips`);\n\n    // Paint the tile\n    const data = this.documentPaintTile(\n      docPtr,\n      outputWidth,\n      outputHeight,\n      tilePosX,\n      tilePosY,\n      tileWidth,\n      tileHeight\n    );\n\n    console.log(`[LOK] renderPageFullQuality returned ${data.length} bytes`);\n    return { data, width: outputWidth, height: outputHeight, dpi: effectiveDpi };\n  }\n\n  // ==========================================\n  // Text Selection and Content Methods\n  // ==========================================\n\n  /**\n   * Get currently selected text\n   * @param docPtr Document pointer\n   * @param mimeType Desired MIME type. Must include charset, e.g., 'text/plain;charset=utf-8'\n   *                 Note: 'text/plain' without charset is NOT supported by LOK\n   * @returns Selected text or null\n   */\n  getTextSelection(docPtr: number, mimeType: string = 'text/plain;charset=utf-8'): string | null {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentGetTextSelection) {\n      const mimePtr = this.allocString(mimeType);\n      const usedMimePtr = this.module._malloc(4); // pointer to char*\n      try {\n        const resultPtr = this.module._lok_documentGetTextSelection(docPtr, mimePtr, usedMimePtr);\n        if (resultPtr === 0) return null;\n        const result = this.readString(resultPtr);\n        this.module._free(resultPtr);\n        return result;\n      } finally {\n        this.module._free(mimePtr);\n        this.module._free(usedMimePtr);\n      }\n    }\n\n    this.log('getTextSelection: shim not available');\n    return null;\n  }\n\n  /**\n   * Set text selection at coordinates\n   * @param docPtr Document pointer\n   * @param type Selection type (LOK_SETTEXTSELECTION_START, END, or RESET)\n   * @param x X coordinate in twips\n   * @param y Y coordinate in twips\n   */\n  setTextSelection(docPtr: number, type: number, x: number, y: number): void {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentSetTextSelection) {\n      this.module._lok_documentSetTextSelection(docPtr, type, x, y);\n      return;\n    }\n\n    this.log('setTextSelection: shim not available');\n  }\n\n  /**\n   * Get current selection type\n   * @param docPtr Document pointer\n   * @returns Selection type (LOK_SELTYPE_NONE, TEXT, or CELL)\n   */\n  getSelectionType(docPtr: number): number {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentGetSelectionType) {\n      return this.module._lok_documentGetSelectionType(docPtr);\n    }\n\n    this.log('getSelectionType: shim not available');\n    return 0;\n  }\n\n  /**\n   * Reset/clear current selection\n   * @param docPtr Document pointer\n   */\n  resetSelection(docPtr: number): void {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentResetSelection) {\n      this.module._lok_documentResetSelection(docPtr);\n      return;\n    }\n\n    this.log('resetSelection: shim not available');\n  }\n\n  // ==========================================\n  // Mouse and Keyboard Event Methods\n  // ==========================================\n\n  /**\n   * Post a mouse event to the document\n   * @param docPtr Document pointer\n   * @param type Event type (LOK_MOUSEEVENT_BUTTONDOWN, BUTTONUP, MOVE)\n   * @param x X coordinate in twips\n   * @param y Y coordinate in twips\n   * @param count Click count (1 for single, 2 for double click)\n   * @param buttons Button mask (1=left, 2=middle, 4=right)\n   * @param modifier Modifier keys mask\n   */\n  postMouseEvent(\n    docPtr: number,\n    type: number,\n    x: number,\n    y: number,\n    count: number = 1,\n    buttons: number = 1,\n    modifier: number = 0\n  ): void {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentPostMouseEvent) {\n      this.module._lok_documentPostMouseEvent(docPtr, type, x, y, count, buttons, modifier);\n      return;\n    }\n\n    this.log('postMouseEvent: shim not available');\n  }\n\n  /**\n   * Post a keyboard event to the document\n   * @param docPtr Document pointer\n   * @param type Event type (LOK_KEYEVENT_KEYINPUT, KEYUP)\n   * @param charCode Character code\n   * @param keyCode Key code\n   */\n  postKeyEvent(docPtr: number, type: number, charCode: number, keyCode: number): void {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentPostKeyEvent) {\n      this.module._lok_documentPostKeyEvent(docPtr, type, charCode, keyCode);\n      return;\n    }\n\n    this.log('postKeyEvent: shim not available');\n  }\n\n  // ==========================================\n  // UNO Command Methods\n  // ==========================================\n\n  /**\n   * Execute a UNO command\n   * @param docPtr Document pointer\n   * @param command UNO command (e.g., '.uno:SelectAll', '.uno:Copy')\n   * @param args JSON arguments string\n   * @param notifyWhenFinished Whether to notify when command completes\n   */\n  postUnoCommand(\n    docPtr: number,\n    command: string,\n    args: string = '{}',\n    notifyWhenFinished: boolean = false\n  ): void {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentPostUnoCommand) {\n      const cmdPtr = this.allocString(command);\n      const argsPtr = this.allocString(args);\n      try {\n        this.module._lok_documentPostUnoCommand(docPtr, cmdPtr, argsPtr, notifyWhenFinished ? 1 : 0);\n      } finally {\n        this.module._free(cmdPtr);\n        this.module._free(argsPtr);\n      }\n      return;\n    }\n\n    this.log('postUnoCommand: shim not available');\n  }\n\n  /**\n   * Get command values (query document state)\n   * @param docPtr Document pointer\n   * @param command Command to query (e.g., '.uno:CharFontName')\n   * @returns JSON string with command values\n   */\n  getCommandValues(docPtr: number, command: string): string | null {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentGetCommandValues) {\n      const cmdPtr = this.allocString(command);\n      try {\n        const resultPtr = this.module._lok_documentGetCommandValues(docPtr, cmdPtr);\n        if (resultPtr === 0) return null;\n        const result = this.readString(resultPtr);\n        this.module._free(resultPtr);\n        return result;\n      } finally {\n        this.module._free(cmdPtr);\n      }\n    }\n\n    this.log('getCommandValues: shim not available');\n    return null;\n  }\n\n  // ==========================================\n  // Page/Part Information Methods\n  // ==========================================\n\n  /**\n   * Get bounding rectangles for all pages\n   * @param docPtr Document pointer\n   * @returns String with rectangles \"x,y,width,height;x,y,width,height;...\"\n   */\n  getPartPageRectangles(docPtr: number): string | null {\n    this.log(`getPartPageRectangles called with docPtr: ${docPtr}`);\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentGetPartPageRectangles) {\n      this.log('getPartPageRectangles: using shim');\n      const resultPtr = this.module._lok_documentGetPartPageRectangles(docPtr);\n      this.log(`getPartPageRectangles: resultPtr=${resultPtr}`);\n      if (resultPtr === 0) return null;\n      const result = this.readString(resultPtr);\n      this.log(`getPartPageRectangles: result=\"${result?.slice(0, 100)}...\"`);\n      this.module._free(resultPtr);\n      return result;\n    }\n\n    this.log('getPartPageRectangles: shim not available');\n    return null;\n  }\n\n  /**\n   * Get information about a page/slide\n   * @param docPtr Document pointer\n   * @param part Part index\n   * @returns JSON string with part info\n   */\n  getPartInfo(docPtr: number, part: number): string | null {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentGetPartInfo) {\n      const resultPtr = this.module._lok_documentGetPartInfo(docPtr, part);\n      if (resultPtr === 0) return null;\n      const result = this.readString(resultPtr);\n      this.module._free(resultPtr);\n      return result;\n    }\n\n    this.log('getPartInfo: shim not available');\n    return null;\n  }\n\n  /**\n   * Get name of a page/slide\n   * @param docPtr Document pointer\n   * @param part Part index\n   * @returns Part name\n   */\n  getPartName(docPtr: number, part: number): string | null {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentGetPartName) {\n      const resultPtr = this.module._lok_documentGetPartName(docPtr, part);\n      if (resultPtr === 0) return null;\n      const result = this.readString(resultPtr);\n      this.module._free(resultPtr);\n      return result;\n    }\n\n    this.log('getPartName: shim not available');\n    return null;\n  }\n\n  // ==========================================\n  // Clipboard Methods\n  // ==========================================\n\n  /**\n   * Paste content at current cursor position\n   * @param docPtr Document pointer\n   * @param mimeType MIME type of data\n   * @param data Data to paste\n   * @returns true if successful\n   */\n  paste(docPtr: number, mimeType: string, data: string | Uint8Array): boolean {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentPaste) {\n      const mimePtr = this.allocString(mimeType);\n      let dataPtr: number;\n      let dataSize: number;\n\n      if (typeof data === 'string') {\n        const bytes = new TextEncoder().encode(data);\n        dataSize = bytes.length;\n        dataPtr = this.module._malloc(dataSize);\n        this.HEAPU8.set(bytes, dataPtr);\n      } else {\n        dataSize = data.length;\n        dataPtr = this.module._malloc(dataSize);\n        this.HEAPU8.set(data, dataPtr);\n      }\n\n      try {\n        return this.module._lok_documentPaste(docPtr, mimePtr, dataPtr, dataSize) !== 0;\n      } finally {\n        this.module._free(mimePtr);\n        this.module._free(dataPtr);\n      }\n    }\n\n    this.log('paste: shim not available');\n    return false;\n  }\n\n  // ==========================================\n  // View and Zoom Methods\n  // ==========================================\n\n  /**\n   * Set client zoom level\n   * @param docPtr Document pointer\n   * @param tilePixelWidth Tile width in pixels\n   * @param tilePixelHeight Tile height in pixels\n   * @param tileTwipWidth Tile width in twips\n   * @param tileTwipHeight Tile height in twips\n   */\n  setClientZoom(\n    docPtr: number,\n    tilePixelWidth: number,\n    tilePixelHeight: number,\n    tileTwipWidth: number,\n    tileTwipHeight: number\n  ): void {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentSetClientZoom) {\n      this.module._lok_documentSetClientZoom(docPtr, tilePixelWidth, tilePixelHeight, tileTwipWidth, tileTwipHeight);\n      return;\n    }\n\n    this.log('setClientZoom: shim not available');\n  }\n\n  /**\n   * Set visible area for the client\n   * @param docPtr Document pointer\n   * @param x X position in twips\n   * @param y Y position in twips\n   * @param width Width in twips\n   * @param height Height in twips\n   */\n  setClientVisibleArea(docPtr: number, x: number, y: number, width: number, height: number): void {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentSetClientVisibleArea) {\n      this.module._lok_documentSetClientVisibleArea(docPtr, x, y, width, height);\n      return;\n    }\n\n    this.log('setClientVisibleArea: shim not available');\n  }\n\n  // ==========================================\n  // Accessibility Methods\n  // ==========================================\n\n  /**\n   * Get the currently focused paragraph text\n   * @param docPtr Document pointer\n   * @returns Focused paragraph text\n   */\n  getA11yFocusedParagraph(docPtr: number): string | null {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentGetA11yFocusedParagraph) {\n      const resultPtr = this.module._lok_documentGetA11yFocusedParagraph(docPtr);\n      if (resultPtr === 0) return null;\n      const result = this.readString(resultPtr);\n      this.module._free(resultPtr);\n      return result;\n    }\n\n    this.log('getA11yFocusedParagraph: shim not available');\n    return null;\n  }\n\n  /**\n   * Get caret position in focused paragraph\n   * @param docPtr Document pointer\n   * @returns Caret position or -1\n   */\n  getA11yCaretPosition(docPtr: number): number {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentGetA11yCaretPosition) {\n      return this.module._lok_documentGetA11yCaretPosition(docPtr);\n    }\n\n    this.log('getA11yCaretPosition: shim not available');\n    return -1;\n  }\n\n  /**\n   * Enable/disable accessibility features\n   * @param docPtr Document pointer\n   * @param viewId View ID\n   * @param enabled Whether to enable accessibility\n   */\n  setAccessibilityState(docPtr: number, viewId: number, enabled: boolean): void {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentSetAccessibilityState) {\n      this.module._lok_documentSetAccessibilityState(docPtr, viewId, enabled ? 1 : 0);\n      return;\n    }\n\n    this.log('setAccessibilityState: shim not available');\n  }\n\n  // ==========================================\n  // Spreadsheet-Specific Methods\n  // ==========================================\n\n  /**\n   * Get data area for a spreadsheet (last used row/column)\n   * @param docPtr Document pointer\n   * @param part Sheet index\n   * @returns Object with col and row counts\n   */\n  getDataArea(docPtr: number, part: number): { col: number; row: number } {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentGetDataArea) {\n      const colPtr = this.module._malloc(8);\n      const rowPtr = this.module._malloc(8);\n      try {\n        this.module._lok_documentGetDataArea(docPtr, part, colPtr, rowPtr);\n        const col = this.HEAP32[colPtr >> 2] ?? 0;\n        const row = this.HEAP32[rowPtr >> 2] ?? 0;\n        return { col, row };\n      } finally {\n        this.module._free(colPtr);\n        this.module._free(rowPtr);\n      }\n    }\n\n    this.log('getDataArea: shim not available');\n    return { col: 0, row: 0 };\n  }\n\n  // ==========================================\n  // Edit Mode Methods\n  // ==========================================\n\n  /**\n   * Get current edit mode\n   * @param docPtr Document pointer\n   * @returns Edit mode value\n   */\n  getEditMode(docPtr: number): number {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentGetEditMode) {\n      return this.module._lok_documentGetEditMode(docPtr);\n    }\n\n    this.log('getEditMode: shim not available');\n    return 0;\n  }\n\n  /**\n   * Set edit mode for the document\n   * @param docPtr Document pointer\n   * @param mode 0 for view mode, 1 for edit mode\n   */\n  setEditMode(docPtr: number, mode: number): void {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentSetEditMode) {\n      this.log(`setEditMode: setting mode to ${mode}`);\n      this.module._lok_documentSetEditMode(docPtr, mode);\n      return;\n    }\n\n    this.log('setEditMode: shim not available');\n  }\n\n  // ==========================================\n  // View Management Methods\n  // ==========================================\n\n  /**\n   * Create a new view for the document\n   * @param docPtr Document pointer\n   * @returns View ID\n   */\n  createView(docPtr: number): number {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentCreateView) {\n      const viewId = this.module._lok_documentCreateView(docPtr);\n      this.log(`createView: created view ${viewId}`);\n      return viewId;\n    }\n\n    this.log('createView: shim not available');\n    return -1;\n  }\n\n  /**\n   * Create a new view with options\n   * @param docPtr Document pointer\n   * @param options Options string (JSON)\n   * @returns View ID\n   */\n  createViewWithOptions(docPtr: number, options: string): number {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentCreateViewWithOptions) {\n      const optionsPtr = this.allocString(options);\n      try {\n        const viewId = this.module._lok_documentCreateViewWithOptions(docPtr, optionsPtr);\n        this.log(`createViewWithOptions: created view ${viewId}`);\n        return viewId;\n      } finally {\n        this.module._free(optionsPtr);\n      }\n    }\n\n    this.log('createViewWithOptions: shim not available');\n    return -1;\n  }\n\n  /**\n   * Destroy a view\n   * @param docPtr Document pointer\n   * @param viewId View ID to destroy\n   */\n  destroyView(docPtr: number, viewId: number): void {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentDestroyView) {\n      this.log(`destroyView: destroying view ${viewId}`);\n      this.module._lok_documentDestroyView(docPtr, viewId);\n      return;\n    }\n\n    this.log('destroyView: shim not available');\n  }\n\n  /**\n   * Set the current active view\n   * @param docPtr Document pointer\n   * @param viewId View ID to make active\n   */\n  setView(docPtr: number, viewId: number): void {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentSetView) {\n      this.log(`setView: setting active view to ${viewId}`);\n      this.module._lok_documentSetView(docPtr, viewId);\n      return;\n    }\n\n    this.log('setView: shim not available');\n  }\n\n  /**\n   * Get the current active view ID\n   * @param docPtr Document pointer\n   * @returns Current view ID\n   */\n  getView(docPtr: number): number {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentGetView) {\n      return this.module._lok_documentGetView(docPtr);\n    }\n\n    this.log('getView: shim not available');\n    return -1;\n  }\n\n  /**\n   * Get the number of views\n   * @param docPtr Document pointer\n   * @returns Number of views\n   */\n  getViewsCount(docPtr: number): number {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentGetViewsCount) {\n      return this.module._lok_documentGetViewsCount(docPtr);\n    }\n\n    this.log('getViewsCount: shim not available');\n    return 0;\n  }\n\n  // ==========================================\n  // Event Loop and Callback Methods\n  // ==========================================\n\n  /**\n   * Enable synchronous event dispatch (Unipoll mode).\n   * This must be called before using postKeyEvent, postMouseEvent, etc.\n   * to ensure events are processed immediately instead of being queued.\n   *\n   * Without this, events posted via postKeyEvent/postMouseEvent are queued\n   * via Application::PostUserEvent() and never processed in headless mode.\n   */\n  enableSyncEvents(): void {\n    if (this.useShims && this.module._lok_enableSyncEvents) {\n      this.module._lok_enableSyncEvents();\n      this.log('enableSyncEvents: Unipoll mode enabled');\n    } else {\n      this.log('enableSyncEvents: shim not available');\n    }\n  }\n\n  /**\n   * Disable synchronous event dispatch.\n   * Call this when done with event-based operations.\n   */\n  disableSyncEvents(): void {\n    if (this.useShims && this.module._lok_disableSyncEvents) {\n      this.module._lok_disableSyncEvents();\n      this.log('disableSyncEvents: Unipoll mode disabled');\n    } else {\n      this.log('disableSyncEvents: shim not available');\n    }\n  }\n\n  // ==========================================\n  // Callback Queue Methods\n  // ==========================================\n\n  /**\n   * Register a callback handler for the document.\n   * Events are queued and can be retrieved via pollCallback().\n   * @param docPtr Document pointer\n   */\n  registerCallback(docPtr: number): void {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentRegisterCallback) {\n      this.module._lok_documentRegisterCallback(docPtr);\n      this.log('registerCallback: callback registered');\n    } else {\n      this.log('registerCallback: shim not available');\n    }\n  }\n\n  /**\n   * Unregister the callback handler for the document.\n   * @param docPtr Document pointer\n   */\n  unregisterCallback(docPtr: number): void {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentUnregisterCallback) {\n      this.module._lok_documentUnregisterCallback(docPtr);\n      this.log('unregisterCallback: callback unregistered');\n    } else {\n      this.log('unregisterCallback: shim not available');\n    }\n  }\n\n  /**\n   * Check if there are any pending callback events.\n   * @returns true if events are pending\n   */\n  hasCallbackEvents(): boolean {\n    if (this.useShims && this.module._lok_hasCallbackEvents) {\n      return this.module._lok_hasCallbackEvents() !== 0;\n    }\n    return false;\n  }\n\n  /**\n   * Get the number of pending callback events.\n   * @returns Number of events in the queue\n   */\n  getCallbackEventCount(): number {\n    if (this.useShims && this.module._lok_getCallbackEventCount) {\n      return this.module._lok_getCallbackEventCount();\n    }\n    return 0;\n  }\n\n  /**\n   * Poll and retrieve the next callback event from the queue.\n   * @returns The next event, or null if queue is empty\n   */\n  pollCallback(): LOKCallbackEvent | null {\n    if (!this.useShims || !this.module._lok_pollCallback) {\n      return null;\n    }\n\n    const bufferSize = 4096;\n    const payloadBuffer = this.module._malloc(bufferSize);\n    const payloadLengthPtr = this.module._malloc(4);\n\n    try {\n      const eventType = this.module._lok_pollCallback(payloadBuffer, bufferSize, payloadLengthPtr);\n\n      if (eventType === -1) {\n        return null; // Queue is empty\n      }\n\n      // Read the payload length\n      const payloadLength = this.module.HEAP32[payloadLengthPtr >> 2] ?? 0;\n\n      // Read the payload string\n      let payload = '';\n      if (payloadLength > 0) {\n        // Copy bytes from HEAPU8 to avoid SharedArrayBuffer issues in browsers\n        // TextDecoder.decode() doesn't accept SharedArrayBuffer views in some browsers\n        const len = Math.min(payloadLength, bufferSize - 1);\n        const bytes = this.module.HEAPU8.slice(payloadBuffer, payloadBuffer + len);\n        payload = textDecoder.decode(bytes);\n      }\n\n      return {\n        type: eventType,\n        typeName: getCallbackTypeName(eventType),\n        payload,\n      };\n    } finally {\n      this.module._free(payloadBuffer);\n      this.module._free(payloadLengthPtr);\n    }\n  }\n\n  /**\n   * Poll all pending callback events.\n   * @returns Array of all pending events\n   */\n  pollAllCallbacks(): LOKCallbackEvent[] {\n    const events: LOKCallbackEvent[] = [];\n    let event = this.pollCallback();\n    while (event !== null) {\n      events.push(event);\n      event = this.pollCallback();\n    }\n    return events;\n  }\n\n  /**\n   * Clear all pending callback events.\n   */\n  clearCallbackQueue(): void {\n    if (this.useShims && this.module._lok_clearCallbackQueue) {\n      this.module._lok_clearCallbackQueue();\n      this.log('clearCallbackQueue: queue cleared');\n    }\n  }\n\n  /**\n   * Force flush pending LOK callbacks for a document.\n   * This is needed in WASM because callbacks are queued via PostUserEvent\n   * but the event loop doesn't run automatically.\n   * Call this after operations that trigger callbacks (e.g., postUnoCommand)\n   * to ensure the callback queue is populated.\n   * @param docPtr Document pointer\n   */\n  flushCallbacks(docPtr: number): void {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    const hasShim = !!this.module._lok_flushCallbacks;\n    this.log(`flushCallbacks: useShims=${this.useShims}, _lok_flushCallbacks exists=${hasShim}`);\n\n    if (this.useShims && this.module._lok_flushCallbacks) {\n      this.module._lok_flushCallbacks(docPtr);\n      this.log('flushCallbacks: callbacks flushed');\n    } else {\n      this.log('flushCallbacks: shim not available');\n    }\n  }\n\n  /**\n   * Poll for STATE_CHANGED callbacks and parse them into a map.\n   * STATE_CHANGED payloads are in format: \".uno:CommandName=value\"\n   * @returns Map of command names to values\n   */\n  pollStateChanges(): Map<string, string> {\n    const states = new Map<string, string>();\n    const events = this.pollAllCallbacks();\n\n    for (const event of events) {\n      if (event.type === LOK_CALLBACK_STATE_CHANGED) {\n        // Parse \".uno:Bold=true\" format\n        const eqIndex = event.payload.indexOf('=');\n        if (eqIndex !== -1) {\n          const key = event.payload.substring(0, eqIndex);\n          const value = event.payload.substring(eqIndex + 1);\n          states.set(key, value);\n        } else {\n          // Some state changes are just the command name (enabled/disabled toggle)\n          states.set(event.payload, '');\n        }\n      }\n    }\n\n    return states;\n  }\n\n  // ==========================================\n  // High-Level Convenience Methods\n  // ==========================================\n\n  /**\n   * Click at a position and get text at that location\n   * @param docPtr Document pointer\n   * @param x X coordinate in twips\n   * @param y Y coordinate in twips\n   * @returns Text at the clicked position\n   */\n  clickAndGetText(docPtr: number, x: number, y: number): string | null {\n    // Click down and up to select\n    this.postMouseEvent(docPtr, LOK_MOUSEEVENT_BUTTONDOWN, x, y, 1, 1, 0);\n    this.postMouseEvent(docPtr, LOK_MOUSEEVENT_BUTTONUP, x, y, 1, 1, 0);\n\n    // Get selected text\n    return this.getTextSelection(docPtr, 'text/plain;charset=utf-8');\n  }\n\n  /**\n   * Double-click to select a word and get it\n   * @param docPtr Document pointer\n   * @param x X coordinate in twips\n   * @param y Y coordinate in twips\n   * @returns Selected word\n   */\n  doubleClickAndGetWord(docPtr: number, x: number, y: number): string | null {\n    // Double click to select word\n    this.postMouseEvent(docPtr, LOK_MOUSEEVENT_BUTTONDOWN, x, y, 2, 1, 0);\n    this.postMouseEvent(docPtr, LOK_MOUSEEVENT_BUTTONUP, x, y, 2, 1, 0);\n\n    // Get selected text\n    return this.getTextSelection(docPtr, 'text/plain;charset=utf-8');\n  }\n\n  /**\n   * Select all content in the document\n   * @param docPtr Document pointer\n   */\n  selectAll(docPtr: number): void {\n    this.postUnoCommand(docPtr, '.uno:SelectAll');\n  }\n\n  /**\n   * Get all text content from the document\n   * @param docPtr Document pointer\n   * @returns All text content\n   */\n  getAllText(docPtr: number): string | null {\n    this.log(`getAllText called with docPtr: ${docPtr}`);\n    this.selectAll(docPtr);\n    const text = this.getTextSelection(docPtr, 'text/plain;charset=utf-8');\n    this.log(`getAllText: text=\"${text?.slice(0, 100)}...\"`);\n    this.resetSelection(docPtr);\n    return text;\n  }\n\n  /**\n   * Parse page rectangles string into array of objects\n   * @param rectanglesStr String from getPartPageRectangles\n   * @returns Array of rectangle objects\n   */\n  parsePageRectangles(rectanglesStr: string): Array<{ x: number; y: number; width: number; height: number }> {\n    if (!rectanglesStr) return [];\n    \n    return rectanglesStr.split(';').filter(s => s.trim()).map(rect => {\n      const parts = rect.split(',').map(Number);\n      return { \n        x: parts[0] ?? 0, \n        y: parts[1] ?? 0, \n        width: parts[2] ?? 0, \n        height: parts[3] ?? 0 \n      };\n    });\n  }\n}\n","/**\n * LibreOffice WASM Document Converter - Browser Version\n *\n * This is the browser-specific version that doesn't include Node.js dependencies.\n * For Node.js usage, use converter-node.ts instead (imported via /server entry point).\n */\n\nimport {\n  ConversionError,\n  ConversionErrorCode,\n  ConversionOptions,\n  ConversionResult,\n  DocumentInfo,\n  EditorOperationResult,\n  EditorSession,\n  EmscriptenModule,\n  EXTENSION_TO_FORMAT,\n  FORMAT_FILTERS,\n  FORMAT_MIME_TYPES,\n  FORMAT_FILTER_OPTIONS,\n  FullQualityPagePreview,\n  FullQualityRenderOptions,\n  ILibreOfficeConverter,\n  InputFormatOptions,\n  LibreOfficeWasmOptions,\n  LOKDocumentType,\n  OUTPUT_FORMAT_TO_LOK,\n  OutputFormat,\n  PagePreview,\n  ProgressInfo,\n  RenderOptions,\n  isConversionValid,\n  getConversionErrorMessage,\n  getValidOutputFormats,\n  InputFormat,\n  getOutputFormatsForDocType,\n  buildLoadOptions,\n} from './types.js';\nimport { LOKBindings } from './lok-bindings.js';\n\n// Declare the module factory type\ntype ModuleFactory = (config: Partial<EmscriptenModule>) => Promise<EmscriptenModule>;\n\n/** Emscripten worker interface */\ninterface EmscriptenWorker {\n  terminate?: () => void;\n}\n\n/** Emscripten PThread interface for pthread cleanup */\ninterface EmscriptenPThread {\n  terminateAllThreads?: () => void;\n  runningWorkers?: EmscriptenWorker[];\n  unusedWorkers?: EmscriptenWorker[];\n}\n\n/** Emscripten module with PThread support */\ninterface EmscriptenModuleWithPThread extends EmscriptenModule {\n  PThread?: EmscriptenPThread;\n}\n\n\n/**\n * LibreOffice WASM Document Converter\n *\n * A headless document conversion toolkit that uses LibreOffice\n * compiled to WebAssembly for browser and Node.js environments.\n */\nexport class LibreOfficeConverter implements ILibreOfficeConverter {\n  private module: EmscriptenModule | null = null;\n  private lokBindings: LOKBindings | null = null;\n  private initialized = false;\n  private initializing = false;\n  private options: LibreOfficeWasmOptions;\n  private corrupted = false;\n  private fsTracked = false;\n\n  constructor(options: LibreOfficeWasmOptions = {}) {\n    this.options = {\n      wasmPath: './wasm',\n      verbose: false,\n      ...options,\n    };\n  }\n\n  /**\n   * Check if an error indicates LOK corruption requiring reinitialization\n   */\n  private isCorruptionError(error: Error | string): boolean {\n    const msg = error instanceof Error ? error.message : error;\n    return msg.includes('memory access out of bounds') ||\n           msg.includes('ComponentContext is not avail') ||\n           msg.includes('unreachable') ||\n           msg.includes('table index is out of bounds') ||\n           msg.includes('null function');\n  }\n\n  /**\n   * Force reinitialization of the converter (for recovery from errors)\n   */\n  async reinitialize(): Promise<void> {\n    if (this.options.verbose) {\n      console.log('[LibreOfficeConverter] Reinitializing due to corruption...');\n    }\n\n    // Clean up existing state\n    if (this.lokBindings) {\n      try {\n        this.lokBindings.destroy();\n      } catch {\n        // Ignore errors during cleanup\n      }\n      this.lokBindings = null;\n    }\n    this.module = null;\n    this.initialized = false;\n    this.corrupted = false;\n\n    // Reinitialize\n    await this.initialize();\n  }\n\n  /**\n   * Initialize with a pre-loaded Emscripten module\n   * This is useful for environments like Web Workers that have their own\n   * WASM loading mechanism (e.g., importScripts with progress tracking)\n   */\n  async initializeWithModule(module: EmscriptenModule): Promise<void> {\n    if (this.initialized) {\n      return;\n    }\n\n    if (this.initializing) {\n      while (this.initializing) {\n        await new Promise((resolve) => setTimeout(resolve, 100));\n      }\n      return;\n    }\n\n    this.initializing = true;\n\n    try {\n      this.module = module;\n\n      // Set up filesystem\n      this.setupFileSystem();\n\n      // Initialize LibreOfficeKit\n      this.initializeLibreOfficeKit();\n\n      this.initialized = true;\n      this.options.onReady?.();\n    } catch (error) {\n      console.error('[LibreOfficeConverter] Initialization error:', error);\n      const convError =\n        error instanceof ConversionError\n          ? error\n          : new ConversionError(\n              ConversionErrorCode.WASM_NOT_INITIALIZED,\n              `Failed to initialize with module: ${String(error)}`\n            );\n      this.options.onError?.(convError);\n      throw convError;\n    } finally {\n      this.initializing = false;\n    }\n  }\n\n  /**\n   * Initialize the LibreOffice WASM module\n   */\n  async initialize(): Promise<void> {\n    if (this.initialized) {\n      return;\n    }\n\n    if (this.initializing) {\n      while (this.initializing) {\n        await new Promise((resolve) => setTimeout(resolve, 100));\n      }\n      return;\n    }\n\n    this.initializing = true;\n    this.emitProgress('loading', 0, 'Loading LibreOffice WASM module...');\n\n    try {\n      // Load WASM module (progress 0-45% handled by loader)\n      this.module = await this.loadModule();\n      \n      this.emitProgress('initializing', 50, 'Setting up virtual filesystem...');\n\n      // Create directories in virtual filesystem\n      this.setupFileSystem();\n      \n      this.emitProgress('initializing', 60, 'Initializing LibreOfficeKit...');\n\n      // Initialize LibreOfficeKit\n      this.initializeLibreOfficeKit();\n\n      this.emitProgress('initializing', 90, 'LibreOfficeKit ready');\n\n      this.initialized = true;\n      this.emitProgress('complete', 100, 'LibreOffice ready');\n      this.options.onReady?.();\n    } catch (error) {\n      console.error('[LibreOfficeConverter] Initialization error:', error);\n      const convError =\n        error instanceof ConversionError\n          ? error\n          : new ConversionError(\n              ConversionErrorCode.WASM_NOT_INITIALIZED,\n              `Failed to initialize WASM module: ${String(error)}`\n            );\n      this.options.onError?.(convError);\n      throw convError;\n    } finally {\n      this.initializing = false;\n    }\n  }\n\n  /**\n   * Load the Emscripten WASM module (browser only)\n   */\n  private async loadModule(): Promise<EmscriptenModule> {\n    const wasmPath = this.options.wasmPath || './wasm';\n    const moduleUrl = `${wasmPath}/soffice.js`;\n\n    const config: Partial<EmscriptenModule> = {\n      locateFile: (path: string) => {\n        if (path.endsWith('.wasm')) {\n          return `${wasmPath}/soffice.wasm`;\n        }\n        if (path.endsWith('.data')) {\n          return `${wasmPath}/soffice.data`;\n        }\n        return `${wasmPath}/${path}`;\n      },\n      print: this.options.verbose ? console.log : () => {},\n      printErr: this.options.verbose ? console.error : () => {},\n    };\n\n    // Create a script element to load the module\n    const script = document.createElement('script');\n    script.src = moduleUrl;\n\n    await new Promise<void>((resolve, reject) => {\n      script.onload = () => resolve();\n      script.onerror = () => reject(new Error(`Failed to load ${moduleUrl}`));\n      document.head.appendChild(script);\n    });\n\n    // The module factory should now be available globally\n    const createModule = (window as Window & { createSofficeModule?: ModuleFactory }).createSofficeModule;\n\n    if (!createModule) {\n      throw new ConversionError(\n        ConversionErrorCode.WASM_NOT_INITIALIZED,\n        'WASM module factory not found. Make sure soffice.js is loaded.'\n      );\n    }\n\n    return new Promise((resolve, reject) => {\n      const moduleWithCallback: Partial<EmscriptenModule> = {\n        ...config,\n        onRuntimeInitialized: () => {\n          resolve(moduleWithCallback as EmscriptenModule);\n        },\n      };\n\n      createModule(moduleWithCallback).catch(reject);\n    });\n  }\n\n  /**\n   * Set up the virtual filesystem\n   */\n  private setupFileSystem(): void {\n    if (!this.module?.FS) {\n      throw new ConversionError(\n        ConversionErrorCode.WASM_NOT_INITIALIZED,\n        'Filesystem not available'\n      );\n    }\n\n    const fs = this.module.FS;\n\n    const tryMkdir = (path: string) => {\n      try {\n        fs.mkdir(path);\n      } catch {\n        // Directory may already exist\n      }\n    };\n\n    tryMkdir('/tmp');\n    tryMkdir('/tmp/input');\n    tryMkdir('/tmp/output');\n  }\n\n  /**\n   * Initialize LibreOfficeKit\n   */\n  private initializeLibreOfficeKit(): void {\n    if (!this.module) {\n      throw new ConversionError(\n        ConversionErrorCode.WASM_NOT_INITIALIZED,\n        'Module not loaded'\n      );\n    }\n\n    // Debug filesystem contents before LOK init\n    if (this.options.verbose && this.module.FS) {\n      const fs = this.module.FS as typeof this.module.FS & {\n        trackingDelegate?: Record<string, unknown>;\n        open: (...args: unknown[]) => unknown;\n      };\n\n      if (!this.fsTracked) {\n        this.fsTracked = true;\n\n        if (!fs.trackingDelegate) {\n          fs.trackingDelegate = {\n            onOpen: (path: string) => {\n              console.log('[FS OPEN]', path);\n            },\n            onOpenFile: (path: string) => {\n              console.log('[FS OPEN FILE]', path);\n            },\n          };\n        }\n\n        if (typeof fs.open === 'function') {\n          const originalOpen = fs.open.bind(fs);\n          fs.open = ((path: string, flags?: unknown, mode?: unknown) => {\n            console.log('[FS OPEN CALL]', path);\n            try {\n              return originalOpen(path, flags as never, mode as never);\n            } catch (err) {\n              const error = err as { code?: string; message?: string };\n              if (error?.code === 'ENOENT') {\n                console.log('[FS ENOENT]', path);\n              }\n              throw err;\n            }\n          }) as typeof fs.open;\n        }\n      }\n\n      const logDir = (label: string, path: string) => {\n        try {\n          console.log(`[FS] ${label}:`, fs.readdir(path));\n        } catch (e) {\n          console.log(`[FS] ${label}: ERROR -`, (e as Error).message);\n        }\n      };\n\n      logDir('ROOT', '/');\n      logDir('PROGRAM DIR', '/instdir/program');\n      logDir('SHARE DIR', '/instdir/share');\n      logDir('REGISTRY DIR', '/instdir/share/registry');\n      logDir('FILTER DIR', '/instdir/share/filter');\n      logDir('CONFIG DIR', '/instdir/share/config/soffice.cfg');\n      logDir('CONFIG FILTER', '/instdir/share/config/soffice.cfg/filter');\n      logDir('IMPRESS MODULES', '/instdir/share/config/soffice.cfg/modules/simpress');\n    }\n\n    // Create LOK bindings wrapper\n    this.lokBindings = new LOKBindings(this.module, this.options.verbose);\n\n    try {\n      // Initialize LibreOfficeKit through the bindings\n      this.lokBindings.initialize('/instdir/program');\n\n      if (this.options.verbose) {\n        const versionInfo = this.lokBindings.getVersionInfo();\n        if (versionInfo) {\n          console.log('[LOK] Version:', versionInfo);\n        }\n      }\n    } catch (error) {\n      throw new ConversionError(\n        ConversionErrorCode.WASM_NOT_INITIALIZED,\n        `Failed to initialize LibreOfficeKit: ${String(error)}`\n      );\n    }\n  }\n\n  /**\n   * Convert a document to a different format\n   */\n  async convert(\n    input: Uint8Array | ArrayBuffer | Buffer,\n    options: ConversionOptions,\n    filename = 'document'\n  ): Promise<ConversionResult> {\n    // Check if we need to reinitialize due to previous corruption\n    if (this.corrupted) {\n      await this.reinitialize();\n    }\n\n    if (!this.initialized || !this.module) {\n      throw new ConversionError(\n        ConversionErrorCode.WASM_NOT_INITIALIZED,\n        'LibreOffice WASM not initialized. Call initialize() first.'\n      );\n    }\n\n    const startTime = Date.now();\n    const inputData = this.normalizeInput(input);\n\n    if (inputData.length === 0) {\n      throw new ConversionError(\n        ConversionErrorCode.INVALID_INPUT,\n        'Empty document provided'\n      );\n    }\n\n    const inputExt = options.inputFormat || this.getExtensionFromFilename(filename) || 'docx';\n    const outputExt = options.outputFormat;\n\n    if (!FORMAT_FILTERS[outputExt]) {\n      throw new ConversionError(\n        ConversionErrorCode.UNSUPPORTED_FORMAT,\n        `Unsupported output format: ${outputExt}`\n      );\n    }\n\n    // Validate that this conversion path is supported\n    if (!isConversionValid(inputExt, outputExt)) {\n      throw new ConversionError(\n        ConversionErrorCode.UNSUPPORTED_FORMAT,\n        getConversionErrorMessage(inputExt, outputExt)\n      );\n    }\n\n    const inputPath = `/tmp/input/doc.${inputExt}`;\n    const outputPath = `/tmp/output/doc.${outputExt}`;\n\n    try {\n      this.emitProgress('converting', 10, 'Writing input document...');\n\n      // Write input file to virtual filesystem\n      this.module.FS.writeFile(inputPath, inputData);\n\n      this.emitProgress('converting', 30, 'Converting document...');\n\n      // Perform conversion\n      const result = await this.performConversion(inputPath, outputPath, options);\n\n      this.emitProgress('complete', 100, 'Conversion complete');\n\n      const baseName = this.getBasename(filename);\n      const outputFilename = `${baseName}.${outputExt}`;\n\n      return {\n        data: result,\n        mimeType: FORMAT_MIME_TYPES[outputExt],\n        filename: outputFilename,\n        duration: Date.now() - startTime,\n      };\n    } catch (error) {\n      // Check if this error indicates corruption\n      if (error instanceof Error && this.isCorruptionError(error)) {\n        this.corrupted = true;\n        if (this.options.verbose) {\n          console.log('[LibreOfficeConverter] Corruption detected, will reinitialize on next convert');\n        }\n      }\n      throw error;\n    } finally {\n      // Cleanup temporary files\n      try {\n        this.module?.FS.unlink(inputPath);\n      } catch {\n        // Ignore\n      }\n      try {\n        this.module?.FS.unlink(outputPath);\n      } catch {\n        // Ignore\n      }\n    }\n  }\n\n  /**\n   * Perform the actual conversion using LibreOfficeKit\n   */\n  private async performConversion(\n    inputPath: string,\n    outputPath: string,\n    options: ConversionOptions\n  ): Promise<Uint8Array> {\n    if (!this.module || !this.lokBindings) {\n      throw new ConversionError(\n        ConversionErrorCode.WASM_NOT_INITIALIZED,\n        'Module not loaded'\n      );\n    }\n\n    this.emitProgress('converting', 40, 'Loading document...');\n\n    let docPtr = 0;\n\n    try {\n      // Build load options (e.g., for CSV import filter or password-protected documents)\n      const loadOptions = buildLoadOptions(options.inputFormat, options.password);\n\n      // Debug: verify file exists before LOK load\n      if (this.options.verbose) {\n        try {\n          const stat = this.module.FS.stat(inputPath);\n          console.log('[Convert] File exists before LOK load:', inputPath, 'size:', stat.size);\n        } catch (e) {\n          console.log('[Convert] File NOT found before LOK load:', inputPath, (e as Error).message);\n        }\n        if (loadOptions) {\n          console.log('[Convert] Using load options:', loadOptions);\n        }\n      }\n\n      // Load the document using LibreOfficeKit\n      if (loadOptions) {\n        docPtr = this.lokBindings.documentLoadWithOptions(inputPath, loadOptions);\n      } else {\n        docPtr = this.lokBindings.documentLoad(inputPath);\n      }\n\n      if (docPtr === 0) {\n        throw new ConversionError(\n          ConversionErrorCode.LOAD_FAILED,\n          'Failed to load document'\n        );\n      }\n\n      this.emitProgress('converting', 60, 'Converting format...');\n\n      // Determine the output format string for LOK\n      const lokFormat = OUTPUT_FORMAT_TO_LOK[options.outputFormat];\n      \n      // Get filter options for the format\n      let filterOptions = FORMAT_FILTER_OPTIONS[options.outputFormat] || '';\n      \n      // Add PDF-specific options if applicable\n      if (options.outputFormat === 'pdf' && options.pdf) {\n        const pdfOpts: string[] = [];\n        if (options.pdf.pdfaLevel) {\n          const levelMap: Record<string, number> = {\n            'PDF/A-1b': 1,\n            'PDF/A-2b': 2,\n            'PDF/A-3b': 3,\n          };\n          pdfOpts.push(`SelectPdfVersion=${levelMap[options.pdf.pdfaLevel] || 0}`);\n        }\n        if (options.pdf.quality !== undefined) {\n          pdfOpts.push(`Quality=${options.pdf.quality}`);\n        }\n        if (pdfOpts.length > 0) {\n          filterOptions = pdfOpts.join(',');\n        }\n      }\n\n      // Add page selection for image exports (png, jpg, svg)\n      if (['png', 'jpg', 'svg'].includes(options.outputFormat) && options.image?.pageIndex !== undefined) {\n        // PageRange is 1-indexed\n        const pageNum = options.image.pageIndex + 1;\n        if (filterOptions) {\n          filterOptions += `;PageRange=${pageNum}-${pageNum}`;\n        } else {\n          filterOptions = `PageRange=${pageNum}-${pageNum}`;\n        }\n      }\n\n      this.emitProgress('converting', 70, 'Saving document...');\n\n      // Save the document in the new format\n      this.lokBindings.documentSaveAs(docPtr, outputPath, lokFormat, filterOptions);\n\n      this.emitProgress('converting', 90, 'Reading output...');\n\n      // Read the converted output file\n      try {\n        const outputData = this.module.FS.readFile(outputPath) as Uint8Array;\n        \n        if (outputData.length === 0) {\n          throw new ConversionError(\n            ConversionErrorCode.CONVERSION_FAILED,\n            'Conversion produced empty output'\n          );\n        }\n        \n        return outputData;\n      } catch (fsError) {\n        throw new ConversionError(\n          ConversionErrorCode.CONVERSION_FAILED,\n          `Failed to read converted file: ${String(fsError)}`\n        );\n      }\n    } catch (error) {\n      if (error instanceof ConversionError) {\n        throw error;\n      }\n      throw new ConversionError(\n        ConversionErrorCode.CONVERSION_FAILED,\n        `Conversion failed: ${String(error)}`\n      );\n    } finally {\n      // Always clean up the document\n      if (docPtr !== 0 && this.lokBindings) {\n        try {\n          this.lokBindings.documentDestroy(docPtr);\n        } catch {\n          // Ignore cleanup errors\n        }\n      }\n    }\n  }\n\n  /**\n   * Render page previews (thumbnails) for a document\n   * @param input Document data\n   * @param options Options with inputFormat\n   * @param renderOptions Render settings (width, height, pageIndices)\n   * @returns Array of page preview data with RGBA pixels\n   */\n  async renderPagePreviews(\n    input: Uint8Array | ArrayBuffer | Buffer,\n    options: InputFormatOptions,\n    renderOptions: RenderOptions = {}\n  ): Promise<PagePreview[]> {\n    if (!this.initialized || !this.module || !this.lokBindings) {\n      throw new ConversionError(\n        ConversionErrorCode.WASM_NOT_INITIALIZED,\n        'Converter not initialized'\n      );\n    }\n\n    const data = this.normalizeInput(input);\n    const inputFormat = (options.inputFormat || 'docx').toLowerCase();\n    const width = renderOptions.width ?? 256;\n    const height = renderOptions.height ?? 0;\n    const pageIndices = renderOptions.pageIndices ?? [];\n\n    // Write input file to virtual FS\n    const inputPath = `/tmp/preview/doc.${inputFormat}`;\n    const fs = this.module.FS;\n\n    try {\n      // Create directory\n      try {\n        fs.mkdir('/tmp/preview');\n      } catch {\n        // Directory might exist\n      }\n\n      // Write file\n      fs.writeFile(inputPath, data);\n\n      // Load document\n      const docPtr = this.lokBindings.documentLoad(inputPath);\n      if (docPtr === 0) {\n        throw new ConversionError(\n          ConversionErrorCode.LOAD_FAILED,\n          'Failed to load document for preview'\n        );\n      }\n\n      try {\n        // Get number of pages/parts\n        const numParts = this.lokBindings.documentGetParts(docPtr);\n        if (this.options.verbose) {\n          console.log(`[Preview] Document has ${numParts} pages/parts`);\n        }\n\n        // Determine which pages to render\n        const pagesToRender =\n          pageIndices.length > 0\n            ? pageIndices.filter((i) => i >= 0 && i < numParts)\n            : Array.from({ length: numParts }, (_, i) => i);\n\n        const results: PagePreview[] = [];\n\n        // Render each page (editMode defaults to false for clean presentation rendering)\n        const editMode = renderOptions.editMode ?? false;\n        for (const pageIndex of pagesToRender) {\n          if (this.options.verbose) {\n            console.log(`[Preview] Rendering page ${pageIndex + 1}/${numParts}`);\n          }\n\n          const preview = this.lokBindings.renderPage(docPtr, pageIndex, width, height, editMode);\n          results.push({\n            page: pageIndex,\n            data: preview.data,\n            width: preview.width,\n            height: preview.height,\n          });\n        }\n\n        return results;\n      } finally {\n        // Clean up document\n        this.lokBindings.documentDestroy(docPtr);\n      }\n    } finally {\n      // Clean up input file\n      try {\n        fs.unlink(inputPath);\n      } catch {\n        // Ignore\n      }\n      try {\n        fs.rmdir('/tmp/preview');\n      } catch {\n        // Ignore\n      }\n    }\n  }\n\n  /**\n   * Render a page at full quality (native resolution based on DPI)\n   * @param input Document data\n   * @param options Options with inputFormat\n   * @param pageIndex Zero-based page index to render\n   * @param renderOptions DPI and max dimension settings\n   * @returns Full quality page preview with RGBA data and DPI info\n   */\n  async renderPageFullQuality(\n    input: Uint8Array | ArrayBuffer | Buffer,\n    options: InputFormatOptions,\n    pageIndex: number,\n    renderOptions: FullQualityRenderOptions = {}\n  ): Promise<FullQualityPagePreview> {\n    if (!this.initialized || !this.module || !this.lokBindings) {\n      throw new ConversionError(\n        ConversionErrorCode.WASM_NOT_INITIALIZED,\n        'Converter not initialized'\n      );\n    }\n\n    const data = this.normalizeInput(input);\n    const inputFormat = (options.inputFormat || 'docx').toLowerCase();\n    const dpi = renderOptions.dpi ?? 150;\n    const maxDimension = renderOptions.maxDimension;\n\n    // Write input file to virtual FS\n    const inputPath = `/tmp/fullquality/doc.${inputFormat}`;\n    const fs = this.module.FS;\n\n    try {\n      // Create directory\n      try {\n        fs.mkdir('/tmp/fullquality');\n      } catch {\n        // Directory might exist\n      }\n\n      // Write file\n      fs.writeFile(inputPath, data);\n\n      // Load document\n      const docPtr = this.lokBindings.documentLoad(inputPath);\n      if (docPtr === 0) {\n        throw new ConversionError(\n          ConversionErrorCode.LOAD_FAILED,\n          'Failed to load document for full quality render'\n        );\n      }\n\n      try {\n        // Validate page index\n        const numParts = this.lokBindings.documentGetParts(docPtr);\n        if (pageIndex < 0 || pageIndex >= numParts) {\n          throw new ConversionError(\n            ConversionErrorCode.CONVERSION_FAILED,\n            `Page index ${pageIndex} out of range (0-${numParts - 1})`\n          );\n        }\n\n        if (this.options.verbose) {\n          console.log(`[FullQuality] Rendering page ${pageIndex + 1}/${numParts} at ${dpi} DPI`);\n        }\n\n        // Render at full quality (editMode defaults to false for clean presentation rendering)\n        const editMode = renderOptions.editMode ?? false;\n        const preview = this.lokBindings.renderPageFullQuality(docPtr, pageIndex, dpi, maxDimension, editMode);\n\n        return {\n          page: pageIndex,\n          data: preview.data,\n          width: preview.width,\n          height: preview.height,\n          dpi: preview.dpi,\n        };\n      } finally {\n        // Clean up document\n        this.lokBindings.documentDestroy(docPtr);\n      }\n    } finally {\n      // Clean up input file\n      try {\n        fs.unlink(inputPath);\n      } catch {\n        // Ignore\n      }\n      try {\n        fs.rmdir('/tmp/fullquality');\n      } catch {\n        // Ignore\n      }\n    }\n  }\n\n  /**\n   * Get the number of pages/parts in a document\n   */\n  async getPageCount(\n    input: Uint8Array | ArrayBuffer | Buffer,\n    options: InputFormatOptions\n  ): Promise<number> {\n    if (!this.initialized || !this.module || !this.lokBindings) {\n      throw new ConversionError(\n        ConversionErrorCode.WASM_NOT_INITIALIZED,\n        'Converter not initialized'\n      );\n    }\n\n    const data = this.normalizeInput(input);\n    const inputFormat = (options.inputFormat || 'docx').toLowerCase();\n\n    const inputPath = `/tmp/pagecount/doc.${inputFormat}`;\n    const fs = this.module.FS;\n\n    try {\n      try {\n        fs.mkdir('/tmp/pagecount');\n      } catch {\n        // Directory might exist\n      }\n\n      fs.writeFile(inputPath, data);\n      const docPtr = this.lokBindings.documentLoad(inputPath);\n\n      if (docPtr === 0) {\n        throw new ConversionError(\n          ConversionErrorCode.LOAD_FAILED,\n          'Failed to load document'\n        );\n      }\n\n      try {\n        return this.lokBindings.documentGetParts(docPtr);\n      } finally {\n        this.lokBindings.documentDestroy(docPtr);\n      }\n    } finally {\n      try {\n        fs.unlink(inputPath);\n      } catch {\n        // Ignore\n      }\n      try {\n        fs.rmdir('/tmp/pagecount');\n      } catch {\n        // Ignore\n      }\n    }\n  }\n\n  /**\n   * Get valid output formats for a document by loading it and checking its type\n   * This is more accurate than static validation as it uses LibreOffice's actual document type detection\n   * @param input Document data\n   * @param options Options with inputFormat\n   * @returns Object with document type and valid output formats\n   */\n  async getDocumentInfo(\n    input: Uint8Array | ArrayBuffer | Buffer,\n    options: InputFormatOptions\n  ): Promise<DocumentInfo> {\n    if (!this.initialized || !this.module || !this.lokBindings) {\n      throw new ConversionError(\n        ConversionErrorCode.WASM_NOT_INITIALIZED,\n        'Converter not initialized'\n      );\n    }\n\n    const data = this.normalizeInput(input);\n    const inputFormat = (options.inputFormat || 'docx').toLowerCase();\n\n    const inputPath = `/tmp/docinfo/doc.${inputFormat}`;\n    const fs = this.module.FS;\n\n    try {\n      try {\n        fs.mkdir('/tmp/docinfo');\n      } catch {\n        // Directory might exist\n      }\n\n      fs.writeFile(inputPath, data);\n      const docPtr = this.lokBindings.documentLoad(inputPath);\n\n      if (docPtr === 0) {\n        throw new ConversionError(\n          ConversionErrorCode.LOAD_FAILED,\n          'Failed to load document'\n        );\n      }\n\n      try {\n        const docType = this.lokBindings.documentGetDocumentType(docPtr) as LOKDocumentType;\n        const pageCount = this.lokBindings.documentGetParts(docPtr);\n        const validOutputFormats = getOutputFormatsForDocType(docType);\n\n        const docTypeNames: Record<LOKDocumentType, string> = {\n          [LOKDocumentType.TEXT]: 'Text Document',\n          [LOKDocumentType.SPREADSHEET]: 'Spreadsheet',\n          [LOKDocumentType.PRESENTATION]: 'Presentation',\n          [LOKDocumentType.DRAWING]: 'Drawing',\n          [LOKDocumentType.OTHER]: 'Other',\n        };\n\n        return {\n          documentType: docType,\n          documentTypeName: docTypeNames[docType] || 'Unknown',\n          validOutputFormats,\n          pageCount,\n        };\n      } finally {\n        this.lokBindings.documentDestroy(docPtr);\n      }\n    } finally {\n      try {\n        fs.unlink(inputPath);\n      } catch {\n        // Ignore\n      }\n      try {\n        fs.rmdir('/tmp/docinfo');\n      } catch {\n        // Ignore\n      }\n    }\n  }\n\n  // ============================================================\n  // Document Inspection Methods\n  // ============================================================\n\n  /**\n   * Get all text content from a document\n   * @param input Document data\n   * @param options Conversion options with inputFormat\n   * @returns All text content from the document\n   */\n  async getDocumentText(\n    input: Uint8Array | ArrayBuffer | Buffer,\n    options: ConversionOptions\n  ): Promise<string | null> {\n    if (!this.initialized || !this.module || !this.lokBindings) {\n      throw new ConversionError(\n        ConversionErrorCode.WASM_NOT_INITIALIZED,\n        'Converter not initialized'\n      );\n    }\n\n    const data = this.normalizeInput(input);\n    const inputFormat = options.inputFormat?.toLowerCase();\n\n    if (!inputFormat) {\n      throw new ConversionError(\n        ConversionErrorCode.INVALID_INPUT,\n        'Input format is required'\n      );\n    }\n\n    const inputPath = `/tmp/inspect/doc.${inputFormat}`;\n    const fs = this.module.FS;\n\n    try {\n      try {\n        fs.mkdir('/tmp/inspect');\n      } catch {\n        // Directory might exist\n      }\n\n      fs.writeFile(inputPath, data);\n      const docPtr = this.lokBindings.documentLoad(inputPath);\n\n      if (docPtr === 0) {\n        throw new ConversionError(\n          ConversionErrorCode.LOAD_FAILED,\n          'Failed to load document'\n        );\n      }\n\n      try {\n        return this.lokBindings.getAllText(docPtr);\n      } finally {\n        this.lokBindings.documentDestroy(docPtr);\n      }\n    } finally {\n      try {\n        fs.unlink(inputPath);\n      } catch {\n        // Ignore\n      }\n      try {\n        fs.rmdir('/tmp/inspect');\n      } catch {\n        // Ignore\n      }\n    }\n  }\n\n  /**\n   * Get page/slide names from a document\n   * @param input Document data\n   * @param options Conversion options with inputFormat\n   * @returns Array of page/slide names\n   */\n  async getPageNames(\n    input: Uint8Array | ArrayBuffer | Buffer,\n    options: ConversionOptions\n  ): Promise<string[]> {\n    if (!this.initialized || !this.module || !this.lokBindings) {\n      throw new ConversionError(\n        ConversionErrorCode.WASM_NOT_INITIALIZED,\n        'Converter not initialized'\n      );\n    }\n\n    const data = this.normalizeInput(input);\n    const inputFormat = options.inputFormat?.toLowerCase();\n\n    if (!inputFormat) {\n      throw new ConversionError(\n        ConversionErrorCode.INVALID_INPUT,\n        'Input format is required'\n      );\n    }\n\n    const inputPath = `/tmp/names/doc.${inputFormat}`;\n    const fs = this.module.FS;\n\n    try {\n      try {\n        fs.mkdir('/tmp/names');\n      } catch {\n        // Directory might exist\n      }\n\n      fs.writeFile(inputPath, data);\n      const docPtr = this.lokBindings.documentLoad(inputPath);\n\n      if (docPtr === 0) {\n        throw new ConversionError(\n          ConversionErrorCode.LOAD_FAILED,\n          'Failed to load document'\n        );\n      }\n\n      try {\n        const numParts = this.lokBindings.documentGetParts(docPtr);\n        const names: string[] = [];\n        \n        for (let i = 0; i < numParts; i++) {\n          const name = this.lokBindings.getPartName(docPtr, i);\n          names.push(name || `Page ${i + 1}`);\n        }\n        \n        return names;\n      } finally {\n        this.lokBindings.documentDestroy(docPtr);\n      }\n    } finally {\n      try {\n        fs.unlink(inputPath);\n      } catch {\n        // Ignore\n      }\n      try {\n        fs.rmdir('/tmp/names');\n      } catch {\n        // Ignore\n      }\n    }\n  }\n\n  /**\n   * Get page bounding rectangles from a document\n   * @param input Document data\n   * @param options Conversion options with inputFormat\n   * @returns Array of page rectangles in twips\n   */\n  async getPageRectangles(\n    input: Uint8Array | ArrayBuffer | Buffer,\n    options: ConversionOptions\n  ): Promise<Array<{ x: number; y: number; width: number; height: number }>> {\n    if (!this.initialized || !this.module || !this.lokBindings) {\n      throw new ConversionError(\n        ConversionErrorCode.WASM_NOT_INITIALIZED,\n        'Converter not initialized'\n      );\n    }\n\n    const data = this.normalizeInput(input);\n    const inputFormat = options.inputFormat?.toLowerCase();\n\n    if (!inputFormat) {\n      throw new ConversionError(\n        ConversionErrorCode.INVALID_INPUT,\n        'Input format is required'\n      );\n    }\n\n    const inputPath = `/tmp/rects/doc.${inputFormat}`;\n    const fs = this.module.FS;\n\n    try {\n      try {\n        fs.mkdir('/tmp/rects');\n      } catch {\n        // Directory might exist\n      }\n\n      fs.writeFile(inputPath, data);\n      const docPtr = this.lokBindings.documentLoad(inputPath);\n\n      if (docPtr === 0) {\n        throw new ConversionError(\n          ConversionErrorCode.LOAD_FAILED,\n          'Failed to load document'\n        );\n      }\n\n      try {\n        const rectsStr = this.lokBindings.getPartPageRectangles(docPtr);\n        return this.lokBindings.parsePageRectangles(rectsStr || '');\n      } finally {\n        this.lokBindings.documentDestroy(docPtr);\n      }\n    } finally {\n      try {\n        fs.unlink(inputPath);\n      } catch {\n        // Ignore\n      }\n      try {\n        fs.rmdir('/tmp/rects');\n      } catch {\n        // Ignore\n      }\n    }\n  }\n\n  /**\n   * Get spreadsheet data area (last used row/column)\n   * @param input Document data\n   * @param options Conversion options with inputFormat\n   * @param sheetIndex Sheet index (0-based)\n   * @returns Object with col and row counts\n   */\n  async getSpreadsheetDataArea(\n    input: Uint8Array | ArrayBuffer | Buffer,\n    options: ConversionOptions,\n    sheetIndex: number = 0\n  ): Promise<{ col: number; row: number }> {\n    if (!this.initialized || !this.module || !this.lokBindings) {\n      throw new ConversionError(\n        ConversionErrorCode.WASM_NOT_INITIALIZED,\n        'Converter not initialized'\n      );\n    }\n\n    const data = this.normalizeInput(input);\n    const inputFormat = options.inputFormat?.toLowerCase();\n\n    if (!inputFormat) {\n      throw new ConversionError(\n        ConversionErrorCode.INVALID_INPUT,\n        'Input format is required'\n      );\n    }\n\n    const inputPath = `/tmp/dataarea/doc.${inputFormat}`;\n    const fs = this.module.FS;\n\n    try {\n      try {\n        fs.mkdir('/tmp/dataarea');\n      } catch {\n        // Directory might exist\n      }\n\n      fs.writeFile(inputPath, data);\n      const docPtr = this.lokBindings.documentLoad(inputPath);\n\n      if (docPtr === 0) {\n        throw new ConversionError(\n          ConversionErrorCode.LOAD_FAILED,\n          'Failed to load document'\n        );\n      }\n\n      try {\n        return this.lokBindings.getDataArea(docPtr, sheetIndex);\n      } finally {\n        this.lokBindings.documentDestroy(docPtr);\n      }\n    } finally {\n      try {\n        fs.unlink(inputPath);\n      } catch {\n        // Ignore\n      }\n      try {\n        fs.rmdir('/tmp/dataarea');\n      } catch {\n        // Ignore\n      }\n    }\n  }\n\n  /**\n   * Execute a UNO command on a document\n   * @param input Document data\n   * @param options Conversion options with inputFormat\n   * @param command UNO command (e.g., '.uno:SelectAll')\n   * @param args JSON arguments string\n   * @returns Command result (if any)\n   */\n  async executeUnoCommand(\n    input: Uint8Array | ArrayBuffer | Buffer,\n    options: ConversionOptions,\n    command: string,\n    args: string = '{}'\n  ): Promise<void> {\n    if (!this.initialized || !this.module || !this.lokBindings) {\n      throw new ConversionError(\n        ConversionErrorCode.WASM_NOT_INITIALIZED,\n        'Converter not initialized'\n      );\n    }\n\n    const data = this.normalizeInput(input);\n    const inputFormat = options.inputFormat?.toLowerCase();\n\n    if (!inputFormat) {\n      throw new ConversionError(\n        ConversionErrorCode.INVALID_INPUT,\n        'Input format is required'\n      );\n    }\n\n    const inputPath = `/tmp/uno/doc.${inputFormat}`;\n    const fs = this.module.FS;\n\n    try {\n      try {\n        fs.mkdir('/tmp/uno');\n      } catch {\n        // Directory might exist\n      }\n\n      fs.writeFile(inputPath, data);\n      const docPtr = this.lokBindings.documentLoad(inputPath);\n\n      if (docPtr === 0) {\n        throw new ConversionError(\n          ConversionErrorCode.LOAD_FAILED,\n          'Failed to load document'\n        );\n      }\n\n      try {\n        this.lokBindings.postUnoCommand(docPtr, command, args);\n      } finally {\n        this.lokBindings.documentDestroy(docPtr);\n      }\n    } finally {\n      try {\n        fs.unlink(inputPath);\n      } catch {\n        // Ignore\n      }\n      try {\n        fs.rmdir('/tmp/uno');\n      } catch {\n        // Ignore\n      }\n    }\n  }\n\n  // ============================================\n  // ILibreOfficeConverter Interface Methods\n  // ============================================\n\n  /**\n   * Render a single page as an image\n   * @param input Document data\n   * @param options Options with inputFormat\n   * @param pageIndex Zero-based page index to render\n   * @param width Target width for rendered page\n   * @param height Optional target height (0 = auto based on aspect ratio)\n   * @returns Page preview with RGBA data\n   */\n  async renderPage(\n    input: Uint8Array | ArrayBuffer | Buffer,\n    options: InputFormatOptions,\n    pageIndex: number,\n    width: number,\n    height = 0\n  ): Promise<PagePreview> {\n    if (!this.initialized || !this.module || !this.lokBindings) {\n      throw new ConversionError(\n        ConversionErrorCode.WASM_NOT_INITIALIZED,\n        'Converter not initialized'\n      );\n    }\n\n    const data = this.normalizeInput(input);\n    const inputFormat = (options.inputFormat || 'docx').toLowerCase();\n\n    const inputPath = `/tmp/renderpage/doc.${inputFormat}`;\n    const fs = this.module.FS;\n\n    try {\n      try {\n        fs.mkdir('/tmp/renderpage');\n      } catch {\n        // Directory might exist\n      }\n\n      fs.writeFile(inputPath, data);\n      const docPtr = this.lokBindings.documentLoad(inputPath);\n\n      if (docPtr === 0) {\n        throw new ConversionError(\n          ConversionErrorCode.LOAD_FAILED,\n          'Failed to load document'\n        );\n      }\n\n      try {\n        const preview = this.lokBindings.renderPage(docPtr, pageIndex, width, height);\n        return {\n          page: pageIndex,\n          data: preview.data,\n          width: preview.width,\n          height: preview.height,\n        };\n      } finally {\n        this.lokBindings.documentDestroy(docPtr);\n      }\n    } finally {\n      try {\n        fs.unlink(inputPath);\n      } catch {\n        // Ignore\n      }\n      try {\n        fs.rmdir('/tmp/renderpage');\n      } catch {\n        // Ignore\n      }\n    }\n  }\n\n  /**\n   * Open a document for editing\n   * Note: This low-level converter does not support persistent editor sessions.\n   * Use WorkerConverter or WorkerBrowserConverter for editor operations.\n   * @throws ConversionError Always throws - editor sessions not supported\n   */\n  openDocument(\n    _input: Uint8Array | ArrayBuffer,\n    _options: InputFormatOptions\n  ): Promise<EditorSession> {\n    return Promise.reject(new ConversionError(\n      ConversionErrorCode.CONVERSION_FAILED,\n      'Editor sessions not supported by LibreOfficeConverter. Use WorkerConverter or WorkerBrowserConverter.'\n    ));\n  }\n\n  /**\n   * Execute an editor operation on an open document\n   * Note: This low-level converter does not support editor operations.\n   * @throws ConversionError Always throws - editor operations not supported\n   */\n  editorOperation<T = unknown>(\n    _sessionId: string,\n    _method: string,\n    _args?: unknown[]\n  ): Promise<EditorOperationResult<T>> {\n    return Promise.reject(new ConversionError(\n      ConversionErrorCode.CONVERSION_FAILED,\n      'Editor operations not supported by LibreOfficeConverter. Use WorkerConverter or WorkerBrowserConverter.'\n    ));\n  }\n\n  /**\n   * Close an editor session\n   * Note: This low-level converter does not support editor sessions.\n   * @throws ConversionError Always throws - editor sessions not supported\n   */\n  closeDocument(_sessionId: string): Promise<Uint8Array | undefined> {\n    return Promise.reject(new ConversionError(\n      ConversionErrorCode.CONVERSION_FAILED,\n      'Editor sessions not supported by LibreOfficeConverter. Use WorkerConverter or WorkerBrowserConverter.'\n    ));\n  }\n\n  /**\n   * Get LOK bindings for advanced operations\n   * Use with caution - this exposes low-level API\n   * @returns LOK bindings instance or null\n   */\n  getLokBindings(): typeof this.lokBindings {\n    return this.lokBindings;\n  }\n\n  /**\n   * Destroy the LibreOffice instance and free resources\n   */\n  destroy(): Promise<void> {\n    if (this.lokBindings) {\n      try {\n        this.lokBindings.destroy();\n      } catch {\n        // Ignore cleanup errors\n      }\n      this.lokBindings = null;\n    }\n\n    // Terminate Emscripten pthread workers\n    if (this.module) {\n      try {\n        const mod = this.module as EmscriptenModuleWithPThread;\n\n        // Try to terminate all pthread workers\n        if (mod.PThread?.terminateAllThreads) {\n          mod.PThread.terminateAllThreads();\n        }\n\n        // Terminate any running workers\n        if (mod.PThread?.runningWorkers) {\n          for (const worker of mod.PThread.runningWorkers) {\n            if (worker?.terminate) {\n              worker.terminate();\n            }\n          }\n          mod.PThread.runningWorkers = [];\n        }\n\n        // Also check unusedWorkers\n        if (mod.PThread?.unusedWorkers) {\n          for (const worker of mod.PThread.unusedWorkers) {\n            if (worker?.terminate) {\n              worker.terminate();\n            }\n          }\n          mod.PThread.unusedWorkers = [];\n        }\n      } catch {\n        // Ignore pthread cleanup errors\n      }\n    }\n\n    this.module = null;\n    this.initialized = false;\n    return Promise.resolve();\n  }\n\n  /**\n   * Check if the converter is ready\n   */\n  isReady(): boolean {\n    return this.initialized;\n  }\n\n  /**\n   * Get the Emscripten module for advanced operations\n   * This is useful for direct filesystem or module access\n   */\n  getModule(): EmscriptenModule | null {\n    return this.module;\n  }\n\n  /**\n   * Get supported input formats\n   */\n  static getSupportedInputFormats(): string[] {\n    return Object.keys(EXTENSION_TO_FORMAT);\n  }\n\n  /**\n   * Get supported output formats\n   */\n  static getSupportedOutputFormats(): OutputFormat[] {\n    return Object.keys(FORMAT_FILTERS) as OutputFormat[];\n  }\n\n  /**\n   * Get valid output formats for a given input format\n   * @param inputFormat The input document format (e.g., 'pdf', 'docx', 'xlsx')\n   * @returns Array of valid output formats for this input\n   */\n  static getValidOutputFormats(inputFormat: string): OutputFormat[] {\n    return getValidOutputFormats(inputFormat as InputFormat);\n  }\n\n  /**\n   * Check if a conversion from input format to output format is supported\n   * @param inputFormat The input document format\n   * @param outputFormat The desired output format\n   * @returns true if the conversion is supported\n   */\n  static isConversionSupported(inputFormat: string, outputFormat: string): boolean {\n    return isConversionValid(inputFormat, outputFormat);\n  }\n\n  // ============================================================\n  // Private helper methods\n  // ============================================================\n\n  private normalizeInput(input: Uint8Array | ArrayBuffer | Buffer): Uint8Array {\n    if (input instanceof Uint8Array) {\n      return input;\n    }\n    if (input instanceof ArrayBuffer) {\n      return new Uint8Array(input);\n    }\n    return new Uint8Array(input);\n  }\n\n  private getExtensionFromFilename(filename: string): string | null {\n    const parts = filename.split('.');\n    if (parts.length > 1) {\n      return parts.pop()?.toLowerCase() || null;\n    }\n    return null;\n  }\n\n  private getBasename(filename: string): string {\n    const lastDot = filename.lastIndexOf('.');\n    if (lastDot > 0) {\n      return filename.substring(0, lastDot);\n    }\n    return filename;\n  }\n\n  private emitProgress(\n    phase: ProgressInfo['phase'],\n    percent: number,\n    message: string\n  ): void {\n    this.options.onProgress?.({ phase, percent, message });\n  }\n}\n","/**\n * Browser Web Worker for LibreOffice WASM conversions\n *\n * This worker runs the WASM module off the main thread to avoid blocking the UI.\n * Communication is via postMessage.\n */\n\nimport type { EditorOperationResult, EmscriptenModule, WasmLoadPhase, WasmLoadProgress } from './types.js';\nimport { LOKBindings } from './lok-bindings.js';\nimport { FORMAT_FILTER_OPTIONS, OUTPUT_FORMAT_TO_LOK, buildLoadOptions } from './types.js';\nimport { createEditor, OfficeEditor } from './editor/index.js';\nimport type { OperationResult } from './editor/types.js';\nimport { LibreOfficeConverter } from './converter.js';\n\n// ============================================\n// WASM Loading Progress System\n// ============================================\n\n/**\n * Cumulative progress tracking - each step adds to the total\n * This ensures progress always increases even if events arrive out of order\n *\n * Weight distribution (sums to 100):\n * - download-wasm: 50 points (largest file ~142MB)\n * - download-data: 30 points (~96MB)\n * - compile: 5 points\n * - filesystem: 7 points\n * - lok-init: 7 points\n * - ready: 1 point (final)\n */\nconst PHASE_WEIGHTS: Record<WasmLoadPhase, number> = {\n  'download-wasm': 50,\n  'download-data': 30,\n  'compile': 5,\n  'filesystem': 7,\n  'lok-init': 7,\n  'ready': 1,\n  'starting': 0,\n  'loading': 0,\n  'initializing': 0,\n  'converting': 0,\n  'complete': 0,\n};\n\n/** Track completed progress for each phase */\nconst phaseProgress: Record<WasmLoadPhase, number> = {\n  'download-wasm': 0,\n  'download-data': 0,\n  'compile': 0,\n  'filesystem': 0,\n  'lok-init': 0,\n  'ready': 0,\n  'starting': 0,\n  'loading': 0,\n  'initializing': 0,\n  'converting': 0,\n  'complete': 0,\n};\n\n/** Current request ID for progress messages */\nlet currentInitRequestId: number = 0;\n\n/** Last emitted percentage - ensures monotonic progress */\nlet lastEmittedPercent: number = 0;\n\n/** Calculate total progress as sum of all phase progress */\nfunction calculateTotalProgress(): number {\n  let total = 0;\n  for (const phase of Object.keys(phaseProgress) as WasmLoadPhase[]) {\n    total += phaseProgress[phase];\n  }\n  const percent = Math.min(100, Math.round(total));\n  // Ensure we never emit a lower percentage than before\n  if (percent > lastEmittedPercent) {\n    lastEmittedPercent = percent;\n  }\n  return lastEmittedPercent;\n}\n\n/** Format bytes as human-readable MB */\nfunction formatBytes(bytes: number): string {\n  const mb = bytes / (1024 * 1024);\n  return `${mb.toFixed(1)} MB`;\n}\n\n/** Emit download progress with bytes info */\nfunction emitDownloadProgress(phase: WasmLoadPhase, loaded: number, total: number) {\n  const weight = PHASE_WEIGHTS[phase];\n  const phasePercent = total > 0 ? loaded / total : 0;\n  const newProgress = weight * phasePercent;\n\n  // Only update if progress increased (never go backwards)\n  if (newProgress > phaseProgress[phase]) {\n    phaseProgress[phase] = newProgress;\n  }\n\n  const message = phase === 'download-wasm'\n    ? `Downloading WebAssembly... ${formatBytes(loaded)} / ${formatBytes(total)}`\n    : `Downloading filesystem... ${formatBytes(loaded)} / ${formatBytes(total)}`;\n\n  emitProgress({ percent: calculateTotalProgress(), message, phase, bytesLoaded: loaded, bytesTotal: total });\n}\n\n/** Emit phase progress (marks phase as complete) */\nfunction emitPhaseProgress(phase: WasmLoadPhase, message: string) {\n  // Only update if this is an increase\n  const newProgress = PHASE_WEIGHTS[phase];\n  if (newProgress > phaseProgress[phase]) {\n    phaseProgress[phase] = newProgress;\n  }\n  emitProgress({ percent: calculateTotalProgress(), message, phase });\n}\n\n/** Send progress to main thread */\nfunction emitProgress(progress: WasmLoadProgress) {\n  self.postMessage({ type: 'progress', id: currentInitRequestId, progress });\n}\n\n/**\n * Install fetch interceptor to track WASM file downloads\n * Must be called BEFORE importScripts() loads Emscripten\n *\n * Modern Emscripten uses fetch() API for downloading .wasm and .data files\n */\nfunction installProgressInterceptors() {\n  const originalFetch = self.fetch;\n\n  // Intercept fetch for progress tracking\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  (self).fetch = async function (input: RequestInfo | URL, init?: RequestInit): Promise<Response> {\n    const url = typeof input === 'string' ? input : input instanceof URL ? input.href : input.url;\n\n    // Identify which file is being downloaded\n    let phase: WasmLoadPhase | null = null;\n    if (url.includes('soffice.wasm')) {\n      phase = 'download-wasm';\n      console.log('[Worker] Starting fetch download: soffice.wasm');\n    } else if (url.includes('soffice.data')) {\n      phase = 'download-data';\n      console.log('[Worker] Starting fetch download: soffice.data');\n    }\n\n    const response = await originalFetch(input, init);\n\n    // If not a tracked file, return original response\n    if (!phase) {\n      return response;\n    }\n\n    // CRITICAL: Do NOT wrap .wasm file responses!\n    // WebAssembly.instantiateStreaming() requires the raw Response with its original body stream.\n    // Wrapping it in a custom ReadableStream breaks streaming compilation with:\n    // \"WebAssembly compilation aborted: Network error: Failed to read from a ReadableStream\"\n    // For .wasm files, just log that we're downloading and return the original response.\n    if (phase === 'download-wasm') {\n      console.log(`[Worker] Returning original response for soffice.wasm (streaming compile requires raw Response)`);\n      // We can't track byte-level progress for .wasm, but we mark it complete when compile phase starts\n      return response;\n    }\n\n    // For .data files, we can safely wrap with progress tracking\n    // Get content length for progress calculation\n    const contentLength = response.headers.get('Content-Length');\n    const total = contentLength ? parseInt(contentLength, 10) : 0;\n\n    // If no content length or no body, return original response\n    if (!total || !response.body) {\n      console.log(`[Worker] No content-length for ${url}, skipping progress tracking`);\n      return response;\n    }\n\n    // Create a new response with progress tracking (only for .data files now)\n    const reader = response.body.getReader();\n    let loaded = 0;\n\n    const stream = new ReadableStream({\n      async start(controller) {\n        while (true) {\n          const { done, value } = await reader.read();\n\n          if (done) {\n            console.log(`[Worker] Finished fetch download: soffice.data`);\n            controller.close();\n            break;\n          }\n\n          loaded += value.length;\n          emitDownloadProgress(phase, loaded, total);\n          controller.enqueue(value);\n        }\n      }\n    });\n\n    return new Response(stream, {\n      headers: response.headers,\n      status: response.status,\n      statusText: response.statusText\n    });\n  };\n\n  console.log('[Worker] Installed progress-tracking fetch interceptor');\n\n  // Also intercept XHR as fallback (some Emscripten configurations use it)\n  const OriginalXHR = self.XMLHttpRequest;\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  const ProgressXMLHttpRequest = function (this: XMLHttpRequest) {\n    const xhr = new OriginalXHR();\n    let requestUrl = '';\n\n    const originalOpen = xhr.open.bind(xhr);\n    (xhr).open = function (method: string, url: string | URL, async?: boolean, username?: string | null, password?: string | null) {\n      requestUrl = String(url);\n      return originalOpen(method, url, async ?? true, username, password);\n    };\n\n    const originalSend = xhr.send.bind(xhr);\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    (xhr).send = function (body?: any) {\n      let phase: WasmLoadPhase | null = null;\n      if (requestUrl.includes('soffice.wasm')) {\n        phase = 'download-wasm';\n        console.log('[Worker] Starting XHR download: soffice.wasm');\n      } else if (requestUrl.includes('soffice.data')) {\n        phase = 'download-data';\n        console.log('[Worker] Starting XHR download: soffice.data');\n      }\n\n      if (phase) {\n        const downloadPhase = phase;\n        xhr.addEventListener('progress', (e: ProgressEvent) => {\n          if (e.lengthComputable) {\n            emitDownloadProgress(downloadPhase, e.loaded, e.total);\n          }\n        });\n\n        xhr.addEventListener('load', () => {\n          console.log(`[Worker] Finished XHR download: ${downloadPhase === 'download-wasm' ? 'soffice.wasm' : 'soffice.data'}`);\n        });\n      }\n\n      return originalSend(body);\n    };\n\n    return xhr;\n  };\n\n  Object.defineProperty(ProgressXMLHttpRequest, 'prototype', {\n    value: OriginalXHR.prototype,\n    writable: false,\n  });\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any, @typescript-eslint/no-unsafe-member-access\n  (self as any).XMLHttpRequest = ProgressXMLHttpRequest;\n\n  console.log('[Worker] Installed progress-tracking XHR interceptor');\n}\n\ninterface WorkerMessage {\n  type: 'init' | 'convert' | 'destroy' | 'getPageCount' | 'renderPreviews' | 'renderSinglePage' | 'renderPageViaConvert' | 'renderPageFullQuality' | 'getDocumentInfo' | 'getLokInfo' | 'editText' | 'renderPageRectangles' | 'testLokOperations' | 'openDocument' | 'editorOperation' | 'closeDocument';\n  id: number;\n  // Explicit WASM file paths (required for init)\n  sofficeJs?: string;\n  sofficeWasm?: string;\n  sofficeData?: string;\n  sofficeWorkerJs?: string;\n  enableProgressTracking?: boolean;  // Opt-in: enable download progress tracking (disabled by default)\n  verbose?: boolean;\n  inputData?: Uint8Array;\n  inputExt?: string;\n  outputFormat?: string;\n  filterOptions?: string;\n  password?: string;\n  maxWidth?: number;\n  pageIndex?: number; // For renderSinglePage / renderPageViaConvert / renderPageFullQuality\n  // Full quality rendering parameters\n  dpi?: number;           // DPI for renderPageFullQuality\n  maxDimension?: number;  // Max dimension cap for renderPageFullQuality\n  editMode?: boolean;     // Render in edit mode (shows placeholders, cursors) - default false\n  // Text editing parameters\n  findText?: string;      // Text to find for replacement\n  replaceText?: string;   // Text to replace with\n  insertText?: string;    // Text to insert at cursor\n  // LOK operations testing\n  operations?: string[];  // List of operations to test\n  // Editor session parameters\n  sessionId?: string;\n  editorMethod?: string;\n  editorArgs?: unknown[];\n}\n\ninterface PagePreview {\n  page: number;\n  data: Uint8Array;\n  width: number;\n  height: number;\n}\n\ninterface FullQualityPagePreview extends PagePreview {\n  dpi: number;\n}\n\ninterface DocumentInfo {\n  documentType: number;\n  documentTypeName: string;\n  validOutputFormats: string[];\n  pageCount: number;\n}\n\ninterface PartInfo {\n  visible: string;\n  selected: string;\n  masterPageCount?: string;\n  mode: string;\n}\n\ninterface A11yFocusedParagraph {\n  content: string;\n  position: string;\n  start: string;\n  end: string;\n}\n\ninterface LokInfo {\n  pageRectangles: string | null;\n  documentSize: { width: number; height: number };\n  partInfo: PartInfo | null;\n  a11yFocusedParagraph: A11yFocusedParagraph | null;\n  a11yCaretPosition: number;\n  editMode: number;\n  allText: string | null;\n}\n\ninterface EditResult {\n  success: boolean;\n  editMode: number;\n  message: string;\n  modifiedDocument?: Uint8Array;  // The modified document as a new file\n}\n\ninterface PageRectangle {\n  index: number;\n  x: number;      // X position in twips\n  y: number;      // Y position in twips\n  width: number;  // Width in twips\n  height: number; // Height in twips\n  imageData: Uint8Array;  // RGBA pixel data\n  imageWidth: number;     // Rendered width in pixels\n  imageHeight: number;    // Rendered height in pixels\n}\n\ninterface LokOperationResult {\n  operation: string;\n  success: boolean;\n  result?: unknown;\n  error?: string;\n}\n\ninterface TestLokOperationsResult {\n  operations: LokOperationResult[];\n  summary: string;\n}\n\n// Editor session info returned from openDocument\ninterface EditorSessionInfo {\n  sessionId: string;\n  documentType: 'writer' | 'calc' | 'impress' | 'draw';\n  pageCount: number;\n}\n\n\ninterface WorkerResponse {\n  type: 'ready' | 'progress' | 'result' | 'error' | 'pageCount' | 'previews' | 'singlePagePreview' | 'documentInfo' | 'lokInfo' | 'editResult' | 'pageRectangles' | 'testLokOperations' | 'editorSession' | 'editorOperationResult' | 'documentClosed';\n  id: number;\n  data?: Uint8Array;\n  error?: string;\n  progress?: { percent: number; message: string };\n  pageCount?: number;\n  previews?: PagePreview[];\n  preview?: PagePreview; // Single page preview\n  documentInfo?: DocumentInfo;\n  lokInfo?: LokInfo;\n  editResult?: EditResult;\n  pageRectangles?: PageRectangle[];\n  testLokOperationsResult?: TestLokOperationsResult;\n  editorSession?: EditorSessionInfo;\n  editorOperationResult?: EditorOperationResult;\n}\n\n/** Web Worker global scope with Module property */\n/** Extended EmscriptenModule with pthread worker config */\ninterface EmscriptenModuleConfig extends Partial<EmscriptenModule> {\n  mainScriptUrlOrBlob?: string;\n}\n\ninterface WorkerGlobalScopeWithModule {\n  Module?: EmscriptenModuleConfig;\n  XMLHttpRequest: typeof XMLHttpRequest;\n  fetch: typeof fetch;\n  postMessage: (message: unknown, transfer?: Transferable[]) => void;\n  onmessage: ((event: MessageEvent) => void) | null;\n  close: () => void;\n}\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\ndeclare const self: WorkerGlobalScopeWithModule & Record<string, any>;\ndeclare function importScripts(...urls: string[]): void;\n\nlet module: EmscriptenModule | null = null;\nlet lokBindings: LOKBindings | null = null;\nlet converter: LibreOfficeConverter | null = null;\nlet initialized = false;\n\n// Document cache for efficient multi-page rendering\nlet cachedDoc: {\n  docPtr: number;\n  inputHash: string;\n  filePath: string;\n  pageCount: number;  // Cache page count since getting it requires a view\n} | null = null;\n\n// Editor session storage - keeps documents open for editing\ninterface EditorSession {\n  sessionId: string;\n  docPtr: number;\n  filePath: string;\n  editor: OfficeEditor;\n  documentType: 'writer' | 'calc' | 'impress' | 'draw';\n}\n\nconst editorSessions = new Map<string, EditorSession>();\nlet sessionCounter = 0;\n\n// Simple hash function for input data\nfunction hashInput(data: Uint8Array): string {\n  let hash = 0;\n  const step = Math.max(1, Math.floor(data.length / 1000)); // Sample ~1000 bytes\n  for (let i = 0; i < data.length; i += step) {\n    const byte = data[i];\n    if (byte !== undefined) {\n      hash = ((hash << 5) - hash + byte) | 0;\n    }\n  }\n  return `${hash}_${data.length}`;\n}\n\n// Get page count for a document, handling different document types correctly\nfunction getDocumentPageCount(docPtr: number): number {\n  const docType = lokBindings!.documentGetDocumentType(docPtr);\n\n  // For Text Documents (type 0), getParts returns 0 or 1 (representing \"parts\" not pages)\n  // We need to use getPartPageRectangles to get actual page count\n  if (docType === 0) { // TEXT document\n    const pageRectsStr = lokBindings!.getPartPageRectangles(docPtr);\n    if (pageRectsStr) {\n      const pageRects = lokBindings!.parsePageRectangles(pageRectsStr);\n      console.log(`[Worker] getDocumentPageCount: TEXT doc has ${pageRects.length} pages from rectangles`);\n      return pageRects.length;\n    }\n    // Fallback: if no page rectangles, assume at least 1 page\n    console.log(`[Worker] getDocumentPageCount: TEXT doc has no page rectangles, assuming 1 page`);\n    return 1;\n  }\n\n  // For Presentations, Drawings, Spreadsheets - getParts returns slide/page/sheet count\n  const parts = lokBindings!.documentGetParts(docPtr);\n  console.log(`[Worker] getDocumentPageCount: docType=${docType} has ${parts} parts`);\n  return parts;\n}\n\n// Get or load a document (reuses cached document if same input)\nfunction getOrLoadDocument(inputData: Uint8Array, inputExt: string): { docPtr: number; pageCount: number } {\n  const inputHash = hashInput(inputData);\n\n  // Check if we already have this document loaded\n  if (cachedDoc && cachedDoc.inputHash === inputHash && lokBindings) {\n    console.log(`[Worker] getOrLoadDocument: reusing cached doc ptr=${cachedDoc.docPtr}, pageCount=${cachedDoc.pageCount}`);\n    return { docPtr: cachedDoc.docPtr, pageCount: cachedDoc.pageCount };\n  }\n\n  // Close previous document if any\n  console.log(`[Worker] getOrLoadDocument: loading new document (hash=${inputHash})`);\n  closeCachedDocument();\n\n  // Load new document\n  const filePath = `/tmp/input/cached_doc.${inputExt || 'docx'}`;\n  module!.FS.writeFile(filePath, inputData);\n  \n  // Build load options for CSV import filter\n  const loadOptions = buildLoadOptions(inputExt);\n  let docPtr: number;\n  if (loadOptions) {\n    docPtr = lokBindings!.documentLoadWithOptions(filePath, loadOptions);\n  } else {\n    docPtr = lokBindings!.documentLoad(filePath);\n  }\n\n  if (docPtr === 0) {\n    const error = lokBindings!.getError();\n    throw new Error(error || 'Failed to load document');\n  }\n\n  const pageCount = getDocumentPageCount(docPtr);\n  console.log(`[Worker] getOrLoadDocument: loaded doc ptr=${docPtr}, pageCount=${pageCount}`);\n\n  // Cache the document with page count (page count requires a view to calculate correctly,\n  // so we cache it here when the document is first loaded)\n  cachedDoc = { docPtr, inputHash, filePath, pageCount };\n\n  return { docPtr, pageCount };\n}\n\n// Close cached document\nfunction closeCachedDocument() {\n  if (cachedDoc && lokBindings && module) {\n    console.log(`[Worker] closeCachedDocument: closing cached doc ptr=${cachedDoc.docPtr}`);\n    try { lokBindings.documentDestroy(cachedDoc.docPtr); } catch { /* ignore */ }\n    try { module.FS.unlink(cachedDoc.filePath); } catch { /* ignore */ }\n    cachedDoc = null;\n  }\n}\n\nfunction postResponse(response: WorkerResponse) {\n  if (response.data) {\n    // Transfer the ArrayBuffer for efficiency\n    self.postMessage(response, [response.data.buffer]);\n  } else {\n    self.postMessage(response);\n  }\n}\n\nfunction postProgress(id: number, percent: number, message: string) {\n  postResponse({ type: 'progress', id, progress: { percent, message } });\n}\n\nasync function handleInit(msg: WorkerMessage) {\n  if (initialized) {\n    postResponse({ type: 'ready', id: msg.id });\n    return;\n  }\n\n  // Require explicit paths\n  const { sofficeJs, sofficeWasm, sofficeData, sofficeWorkerJs } = msg;\n  if (!sofficeJs || !sofficeWasm || !sofficeData || !sofficeWorkerJs) {\n    postResponse({ type: 'error', id: msg.id, error: 'Missing required WASM paths (sofficeJs, sofficeWasm, sofficeData, sofficeWorkerJs)' });\n    return;\n  }\n\n  const verbose = msg.verbose || false;\n\n  // Store request ID for progress emission\n  currentInitRequestId = msg.id;\n\n  // Reset progress tracking for fresh initialization\n  for (const phase of Object.keys(phaseProgress) as WasmLoadPhase[]) {\n    phaseProgress[phase] = 0;\n  }\n  lastEmittedPercent = 0;\n\n  // Only install progress interceptors if explicitly enabled\n  // Default is OFF because wrapping fetch responses can break WebAssembly streaming compilation\n  if (msg.enableProgressTracking) {\n    console.log('[Worker] Progress tracking enabled, installing interceptors...');\n    installProgressInterceptors();\n  } else {\n    console.log('[Worker] Progress tracking disabled (default)');\n  }\n\n  // Emit initial progress\n  emitPhaseProgress('download-wasm', 'Preparing to download WebAssembly...');\n\n  try {\n    // Configure global Module for Emscripten\n    console.log('[Worker] Setting up Module with explicit paths:', { sofficeJs, sofficeWasm, sofficeData, sofficeWorkerJs });\n    self.Module = {\n      // Tell pthread workers where to load the main module from\n      mainScriptUrlOrBlob: sofficeJs,\n      locateFile: (path: string, _scriptDir?: string) => {\n        let result: string;\n        if (path.endsWith('.wasm')) result = sofficeWasm;\n        else if (path.endsWith('.data')) result = sofficeData;\n        // Handle both .worker.js and .worker.cjs requests\n        else if (path.includes('.worker.')) result = sofficeWorkerJs;\n        else {\n          // Fallback: derive from sofficeJs path for any other files\n          const baseUrl = sofficeJs.substring(0, sofficeJs.lastIndexOf('/') + 1);\n          result = `${baseUrl}${path}`;\n        }\n        console.log('[Worker] locateFile called:', path, 'scriptDir:', _scriptDir, '-> result:', result);\n        return result;\n      },\n      // Always print LibreOffice output to console for debugging\n      print: console.log,\n      printErr: console.error,\n    };\n\n    // Load the soffice.js script using importScripts\n    // This triggers the .wasm download (tracked by XHR interceptor)\n    importScripts(sofficeJs);\n\n    // Wait for runtime to be ready\n    // .data file download and WebAssembly compilation happen here\n    emitPhaseProgress('compile', 'Compiling WebAssembly module...');\n\n    await new Promise<void>((resolve, reject) => {\n      const checkReady = () => {\n        if (self.Module && self.Module.calledRun) {\n          resolve();\n        } else if (self.Module?.onRuntimeInitialized) {\n          // Already has a callback, chain it\n          const orig = self.Module.onRuntimeInitialized;\n          self.Module.onRuntimeInitialized = () => {\n            orig?.();\n            resolve();\n          };\n        } else if (self.Module) {\n          self.Module.onRuntimeInitialized = resolve;\n        }\n\n        // Timeout\n        setTimeout(() => reject(new Error('WASM initialization timeout')), 120000);\n      };\n\n      // Check if already ready\n      if (self.Module && self.Module.calledRun) {\n        resolve();\n      } else {\n        checkReady();\n      }\n    });\n\n    module = self.Module as EmscriptenModule;\n    emitPhaseProgress('filesystem', 'Setting up filesystem...');\n\n    // Set SAL_LOG environment variable for LibreOffice logging\n    // Must be done before LOK initialization\n    // Options: +ALL (everything), +lok (LibreOfficeKit), +vcl (rendering), +lok.shim (our shims)\n    try {\n      const mod = module as unknown as { ENV?: Record<string, string> };\n      if (mod.ENV) {\n        mod.ENV['SAL_LOG'] = '+ALL';\n        mod.ENV['MAX_CONCURRENCY'] = '1';\n        console.log('[Worker] Set SAL_LOG to +ALL');\n      } else {\n        console.log('[Worker] ENV not available');\n      }\n    } catch (e) {\n      console.log('[Worker] Could not set SAL_LOG:', e);\n    }\n\n    // Setup filesystem\n    const fs = module.FS;\n\n    // Add FS tracking for debugging (sends logs to main thread)\n    if (verbose) {\n      const originalOpen = fs.open.bind(fs);\n      fs.open = (path: string, flags: unknown, mode?: unknown) => {\n        console.log('[FS OPEN CALL]', path);\n        try {\n          return originalOpen(path, flags, mode);\n        } catch (err: unknown) {\n          const error = err as { code?: string };\n          if (error?.code === 'ENOENT') {\n            console.log('[FS ENOENT]', path);\n          }\n          throw err;\n        }\n      };\n    }\n    try { fs.mkdir('/tmp'); } catch { /* exists */ }\n    try { fs.mkdir('/tmp/input'); } catch { /* exists */ }\n    try { fs.mkdir('/tmp/output'); } catch { /* exists */ }\n\n    emitPhaseProgress('lok-init', 'Initializing LibreOfficeKit...');\n\n    // Initialize LibreOfficeConverter with the pre-loaded module\n    // This reuses the same LOK initialization logic as the Node.js converter\n    converter = new LibreOfficeConverter({ verbose });\n    await converter.initializeWithModule(module);\n\n    // Get LOK bindings from converter for direct access (needed for browser-specific features)\n    lokBindings = converter.getLokBindings();\n\n    if (!lokBindings) {\n      throw new Error('Failed to get LOK bindings from converter');\n    }\n\n    // Enable synchronous event dispatch (Unipoll mode) globally\n    // Without this, postKeyEvent/postMouseEvent events are queued but never processed\n    lokBindings.enableSyncEvents();\n    console.log('[LOK Worker] Enabled synchronous event dispatch (Unipoll mode)');\n\n    initialized = true;\n    emitPhaseProgress('ready', 'Ready');\n    postResponse({ type: 'ready', id: msg.id });\n\n  } catch (error) {\n    postResponse({\n      type: 'error',\n      id: msg.id,\n      error: error instanceof Error ? error.message : String(error)\n    });\n  }\n}\n\n// Image formats that need multi-page handling\nconst IMAGE_FORMATS = ['png', 'jpg', 'jpeg', 'svg'];\n\nfunction handleConvert(msg: WorkerMessage) {\n  if (!initialized || !module || !lokBindings) {\n    postResponse({ type: 'error', id: msg.id, error: 'Worker not initialized' });\n    return;\n  }\n\n  const { inputData, inputExt, outputFormat, filterOptions, password } = msg;\n\n  if (!inputData || !outputFormat) {\n    postResponse({ type: 'error', id: msg.id, error: 'Missing input data or output format' });\n    return;\n  }\n\n  // Check if this is an image format that might need multi-page export\n  const isImageFormat = IMAGE_FORMATS.includes(outputFormat.toLowerCase());\n\n  const inPath = `/tmp/input/doc.${inputExt || 'docx'}`;\n  const outPath = `/tmp/output/doc.${outputFormat}`;\n  let docPtr = 0;\n  const outputFiles: string[] = []; // Track files to clean up\n\n  try {\n    postProgress(msg.id, 10, 'Writing input file...');\n    module.FS.writeFile(inPath, inputData);\n\n    postProgress(msg.id, 30, 'Loading document...');\n    // Build load options for CSV import filter and/or password\n    const loadOptions = buildLoadOptions(inputExt, password);\n    if (loadOptions) {\n      docPtr = lokBindings.documentLoadWithOptions(inPath, loadOptions);\n    } else {\n      docPtr = lokBindings.documentLoad(inPath);\n    }\n\n    if (docPtr === 0) {\n      const error = lokBindings.getError();\n      throw new Error(error || 'Failed to load document');\n    }\n\n    // Get page count for multi-page image export\n    const pageCount = lokBindings.documentGetParts(docPtr);\n    const docType = lokBindings.documentGetDocumentType(docPtr);\n\n    // For image formats with multiple pages, export each page separately and zip\n    if (isImageFormat && pageCount > 1) {\n      postProgress(msg.id, 40, `Exporting ${pageCount} pages as ${outputFormat.toUpperCase()}...`);\n\n      const lokFormat = OUTPUT_FORMAT_TO_LOK[outputFormat as keyof typeof OUTPUT_FORMAT_TO_LOK];\n      const baseOpts = filterOptions || FORMAT_FILTER_OPTIONS[outputFormat as keyof typeof FORMAT_FILTER_OPTIONS] || '';\n\n      // Export each page\n      const pageFiles: Array<{ name: string; data: Uint8Array }> = [];\n\n      // Get document size for calculating export dimensions (for image formats)\n      const { width: docWidth, height: docHeight } = lokBindings.documentGetDocumentSize(docPtr);\n      const aspectRatio = docHeight / docWidth;\n      const exportWidth = 1024; // High quality export\n      const exportHeight = Math.round(exportWidth * aspectRatio);\n\n      for (let i = 0; i < pageCount; i++) {\n        const progress = 40 + Math.round((i / pageCount) * 40);\n        postProgress(msg.id, progress, `Exporting page ${i + 1}/${pageCount}...`);\n\n        const pageOutPath = `/tmp/output/page_${i + 1}.${outputFormat}`;\n        outputFiles.push(pageOutPath);\n\n        // For presentations/drawings, we need to set the part AND use PixelWidth/PixelHeight\n        // for PNG/JPG export to work correctly (same approach as handleRenderPageViaConvert)\n        if (docType === 2 || docType === 3) { // PRESENTATION or DRAWING\n          lokBindings.documentSetPart(docPtr, i);\n\n          // For image formats, include pixel dimensions in filter options\n          let pageOpts = baseOpts;\n          if (outputFormat === 'png' || outputFormat === 'jpg' || outputFormat === 'jpeg') {\n            pageOpts = `PixelWidth=${exportWidth};PixelHeight=${exportHeight}`;\n            if (baseOpts) pageOpts = `${baseOpts};${pageOpts}`;\n          }\n\n          lokBindings.documentSaveAs(docPtr, pageOutPath, lokFormat, pageOpts);\n          console.log(`[Worker] Page ${i + 1} (presentation) exported with opts: ${pageOpts}`);\n        } else {\n          // For text documents, use PageRange filter option (1-indexed)\n          let pageOpts = `PageRange=${i + 1}-${i + 1}`;\n\n          // For image formats, also include pixel dimensions\n          if (outputFormat === 'png' || outputFormat === 'jpg' || outputFormat === 'jpeg') {\n            pageOpts += `;PixelWidth=${exportWidth};PixelHeight=${exportHeight}`;\n          }\n\n          if (baseOpts) pageOpts = `${baseOpts};${pageOpts}`;\n\n          lokBindings.documentSaveAs(docPtr, pageOutPath, lokFormat, pageOpts);\n          console.log(`[Worker] Page ${i + 1} (text) exported with opts: ${pageOpts}`);\n        }\n\n        const pageData = module.FS.readFile(pageOutPath) as Uint8Array;\n        console.log(`[Worker] Page ${i + 1} exported: ${pageData.length} bytes`);\n\n        if (pageData.length > 0) {\n          const pageCopy = new Uint8Array(pageData.length);\n          pageCopy.set(pageData);\n          pageFiles.push({ name: `page_${i + 1}.${outputFormat}`, data: pageCopy });\n        } else {\n          console.warn(`[Worker] Page ${i + 1} export produced empty file`);\n        }\n      }\n\n      postProgress(msg.id, 85, 'Creating ZIP archive...');\n\n      // Create a simple ZIP file (no compression for images)\n      const zipData = createSimpleZip(pageFiles);\n\n      postProgress(msg.id, 100, 'Complete');\n      postResponse({ type: 'result', id: msg.id, data: zipData });\n\n    } else {\n      // Single page or non-image format: standard export\n      postProgress(msg.id, 50, 'Converting...');\n\n      const lokFormat = OUTPUT_FORMAT_TO_LOK[outputFormat as keyof typeof OUTPUT_FORMAT_TO_LOK];\n      const opts = filterOptions || FORMAT_FILTER_OPTIONS[outputFormat as keyof typeof FORMAT_FILTER_OPTIONS] || '';\n\n      postProgress(msg.id, 70, 'Saving...');\n      lokBindings.documentSaveAs(docPtr, outPath, lokFormat, opts);\n      outputFiles.push(outPath);\n\n      postProgress(msg.id, 90, 'Reading output...');\n      const sharedResult = module.FS.readFile(outPath) as Uint8Array;\n\n      if (sharedResult.length === 0) {\n        throw new Error('Conversion produced empty output');\n      }\n\n      // Copy from SharedArrayBuffer to regular ArrayBuffer for transfer\n      const result = new Uint8Array(sharedResult.length);\n      result.set(sharedResult);\n\n      postProgress(msg.id, 100, 'Complete');\n      postResponse({ type: 'result', id: msg.id, data: result });\n    }\n\n  } catch (error) {\n    postResponse({\n      type: 'error',\n      id: msg.id,\n      error: error instanceof Error ? error.message : String(error)\n    });\n  } finally {\n    // Cleanup\n    if (docPtr !== 0) {\n      try { lokBindings.documentDestroy(docPtr); } catch { /* ignore */ }\n    }\n    try { module.FS.unlink(inPath); } catch { /* ignore */ }\n    for (const path of outputFiles) {\n      try { module.FS.unlink(path); } catch { /* ignore */ }\n    }\n  }\n}\n\n/**\n * Create a simple ZIP file from an array of files\n * This is a minimal ZIP implementation without compression (STORE method)\n */\nfunction createSimpleZip(files: Array<{ name: string; data: Uint8Array }>): Uint8Array {\n  const chunks: Uint8Array[] = [];\n  const centralDirectory: Uint8Array[] = [];\n  let offset = 0;\n\n  for (const file of files) {\n    const nameBytes = new TextEncoder().encode(file.name);\n\n    // Local file header\n    const localHeader = new Uint8Array(30 + nameBytes.length);\n    const view = new DataView(localHeader.buffer);\n\n    view.setUint32(0, 0x04034b50, true);  // Local file header signature\n    view.setUint16(4, 20, true);           // Version needed\n    view.setUint16(6, 0, true);            // General purpose flags\n    view.setUint16(8, 0, true);            // Compression method (STORE)\n    view.setUint16(10, 0, true);           // Mod time\n    view.setUint16(12, 0, true);           // Mod date\n    view.setUint32(14, crc32(file.data), true); // CRC-32\n    view.setUint32(18, file.data.length, true); // Compressed size\n    view.setUint32(22, file.data.length, true); // Uncompressed size\n    view.setUint16(26, nameBytes.length, true); // File name length\n    view.setUint16(28, 0, true);           // Extra field length\n    localHeader.set(nameBytes, 30);\n\n    chunks.push(localHeader);\n    chunks.push(file.data);\n\n    // Central directory entry\n    const cdEntry = new Uint8Array(46 + nameBytes.length);\n    const cdView = new DataView(cdEntry.buffer);\n\n    cdView.setUint32(0, 0x02014b50, true);  // Central directory signature\n    cdView.setUint16(4, 20, true);           // Version made by\n    cdView.setUint16(6, 20, true);           // Version needed\n    cdView.setUint16(8, 0, true);            // General purpose flags\n    cdView.setUint16(10, 0, true);           // Compression method\n    cdView.setUint16(12, 0, true);           // Mod time\n    cdView.setUint16(14, 0, true);           // Mod date\n    cdView.setUint32(16, crc32(file.data), true); // CRC-32\n    cdView.setUint32(20, file.data.length, true); // Compressed size\n    cdView.setUint32(24, file.data.length, true); // Uncompressed size\n    cdView.setUint16(28, nameBytes.length, true); // File name length\n    cdView.setUint16(30, 0, true);           // Extra field length\n    cdView.setUint16(32, 0, true);           // Comment length\n    cdView.setUint16(34, 0, true);           // Disk number start\n    cdView.setUint16(36, 0, true);           // Internal attributes\n    cdView.setUint32(38, 0, true);           // External attributes\n    cdView.setUint32(42, offset, true);      // Offset of local header\n    cdEntry.set(nameBytes, 46);\n\n    centralDirectory.push(cdEntry);\n    offset += localHeader.length + file.data.length;\n  }\n\n  const cdOffset = offset;\n  let cdSize = 0;\n  for (const entry of centralDirectory) {\n    chunks.push(entry);\n    cdSize += entry.length;\n  }\n\n  // End of central directory\n  const eocd = new Uint8Array(22);\n  const eocdView = new DataView(eocd.buffer);\n  eocdView.setUint32(0, 0x06054b50, true);  // EOCD signature\n  eocdView.setUint16(4, 0, true);            // Disk number\n  eocdView.setUint16(6, 0, true);            // Disk with CD\n  eocdView.setUint16(8, files.length, true); // Entries on this disk\n  eocdView.setUint16(10, files.length, true);// Total entries\n  eocdView.setUint32(12, cdSize, true);      // CD size\n  eocdView.setUint32(16, cdOffset, true);    // CD offset\n  eocdView.setUint16(20, 0, true);           // Comment length\n\n  chunks.push(eocd);\n\n  // Combine all chunks\n  const totalSize = chunks.reduce((sum, chunk) => sum + chunk.length, 0);\n  const result = new Uint8Array(totalSize);\n  let pos = 0;\n  for (const chunk of chunks) {\n    result.set(chunk, pos);\n    pos += chunk.length;\n  }\n\n  return result;\n}\n\n/**\n * CRC-32 calculation for ZIP files\n */\nfunction crc32(data: Uint8Array): number {\n  let crc = 0xFFFFFFFF;\n  for (let i = 0; i < data.length; i++) {\n    const byte = data[i]!;\n    crc ^= byte;\n    for (let j = 0; j < 8; j++) {\n      crc = (crc >>> 1) ^ (crc & 1 ? 0xEDB88320 : 0);\n    }\n  }\n  return (crc ^ 0xFFFFFFFF) >>> 0;\n}\n\nasync function handleGetPageCount(msg: WorkerMessage) {\n  if (!initialized || !module || !lokBindings) {\n    postResponse({ type: 'error', id: msg.id, error: 'Worker not initialized' });\n    return;\n  }\n\n  const { inputData, inputExt } = msg;\n\n  if (!inputData) {\n    postResponse({ type: 'error', id: msg.id, error: 'Missing input data' });\n    return;\n  }\n\n  try {\n    // Use cached document\n    const { pageCount } = getOrLoadDocument(inputData, inputExt || 'docx');\n    postResponse({ type: 'pageCount', id: msg.id, pageCount });\n    // Document stays cached\n\n  } catch (error) {\n    postResponse({\n      type: 'error',\n      id: msg.id,\n      error: error instanceof Error ? error.message : String(error)\n    });\n    closeCachedDocument();\n  }\n}\n\nasync function handleRenderPreviews(msg: WorkerMessage) {\n  if (!initialized || !module || !lokBindings) {\n    postResponse({ type: 'error', id: msg.id, error: 'Worker not initialized' });\n    return;\n  }\n\n  const { inputData, inputExt, maxWidth = 256 } = msg;\n\n  if (!inputData) {\n    postResponse({ type: 'error', id: msg.id, error: 'Missing input data' });\n    return;\n  }\n\n  try {\n    postProgress(msg.id, 10, 'Loading document for preview...');\n\n    // Use cached document\n    const { docPtr, pageCount } = getOrLoadDocument(inputData, inputExt || 'docx');\n    postProgress(msg.id, 20, `Rendering ${pageCount} pages...`);\n\n    const previews: PagePreview[] = [];\n\n    for (let i = 0; i < pageCount; i++) {\n      const progress = 20 + Math.round((i / pageCount) * 70);\n      postProgress(msg.id, progress, `Rendering page ${i + 1}/${pageCount}...`);\n\n      // Render the page - let renderPage handle page selection and sizing\n      const rendered = lokBindings.renderPage(docPtr, i, maxWidth);\n\n      // Copy from SharedArrayBuffer to regular ArrayBuffer\n      const dataCopy = new Uint8Array(rendered.data.length);\n      dataCopy.set(rendered.data);\n\n      previews.push({\n        page: i + 1,\n        data: dataCopy,\n        width: rendered.width,\n        height: rendered.height\n      });\n    }\n\n    postProgress(msg.id, 100, 'Preview complete');\n\n    // Transfer all preview buffers\n    const transfers = previews.map(p => p.data.buffer);\n    self.postMessage({ type: 'previews', id: msg.id, previews }, transfers);\n    // Document stays cached\n\n  } catch (error) {\n    postResponse({\n      type: 'error',\n      id: msg.id,\n      error: error instanceof Error ? error.message : String(error)\n    });\n    closeCachedDocument();\n  }\n}\n\n/**\n * Render a single page preview - reuses cached document for efficiency\n */\nasync function handleRenderSinglePage(msg: WorkerMessage) {\n  if (!initialized || !module || !lokBindings) {\n    postResponse({ type: 'error', id: msg.id, error: 'Worker not initialized' });\n    return;\n  }\n\n  const { inputData, inputExt, maxWidth = 256, pageIndex = 0 } = msg;\n\n  if (!inputData) {\n    postResponse({ type: 'error', id: msg.id, error: 'Missing input data' });\n    return;\n  }\n\n  let viewId = -1;\n  let docPtr = 0;\n\n  try {\n    // Get or reuse cached document\n    const result = getOrLoadDocument(inputData, inputExt || 'docx');\n    docPtr = result.docPtr;\n    const pageCount = result.pageCount;\n\n    if (pageIndex < 0 || pageIndex >= pageCount) {\n      throw new Error(`Page index ${pageIndex} out of range (0-${pageCount - 1})`);\n    }\n\n    // Create a view before rendering for all document types.\n    // Without a view, LOK returns empty page rectangles and incorrect document sizes,\n    // causing paintTile to crash with \"memory access out of bounds\".\n    // The warning \"No Frame-Controller created\" indicates no view exists.\n    const docType = lokBindings.documentGetDocumentType(docPtr);\n    const docTypeNames = ['TEXT', 'SPREADSHEET', 'PRESENTATION', 'DRAWING'];\n    console.log(`[Worker] handleRenderSinglePage: ${docTypeNames[docType] || 'UNKNOWN'} document - creating view for rendering`);\n    viewId = lokBindings.createView(docPtr);\n    if (viewId >= 0) {\n      lokBindings.setView(docPtr, viewId);\n      console.log(`[Worker] handleRenderSinglePage: Created and set view ${viewId}`);\n    }\n\n    // Render the page - let renderPage handle page-specific sizing\n    // We just pass maxWidth and let it calculate the correct height based on the page's aspect ratio\n    console.log(`[Worker] handleRenderSinglePage: calling renderPage for page ${pageIndex} at maxWidth=${maxWidth}...`);\n    const rendered = lokBindings.renderPage(docPtr, pageIndex, maxWidth);\n    console.log(`[Worker] handleRenderSinglePage: renderPage returned ${rendered.data.length} bytes (${rendered.width}x${rendered.height})`);\n\n    // Copy from SharedArrayBuffer to regular ArrayBuffer\n    const dataCopy = new Uint8Array(rendered.data.length);\n    dataCopy.set(rendered.data);\n\n    const preview: PagePreview = {\n      page: pageIndex + 1,\n      data: dataCopy,\n      width: rendered.width,\n      height: rendered.height\n    };\n\n    // Cleanup view if we created one (for Drawing documents)\n    if (viewId >= 0 && docPtr !== 0) {\n      try { lokBindings.destroyView(docPtr, viewId); } catch { /* ignore */ }\n      console.log(`[Worker] handleRenderSinglePage: Destroyed view ${viewId}`);\n    }\n\n    // Transfer the buffer\n    self.postMessage({ type: 'singlePagePreview', id: msg.id, preview }, [dataCopy.buffer]);\n\n  } catch (error) {\n    // Cleanup view if we created one (for Drawing documents)\n    if (viewId >= 0 && docPtr !== 0) {\n      try { lokBindings.destroyView(docPtr, viewId); } catch { /* ignore */ }\n      console.log(`[Worker] handleRenderSinglePage: Destroyed view ${viewId} (on error)`);\n    }\n\n    // Convert error message to a regular string (not SharedArrayBuffer-backed)\n    const errorMsg = error instanceof Error ? String(error.message) : String(error);\n    postResponse({\n      type: 'error',\n      id: msg.id,\n      error: errorMsg\n    });\n    // On error, close the cached document to allow retry\n    closeCachedDocument();\n  }\n  // Note: We don't close the document here - it stays cached for subsequent page renders\n}\n\n/**\n * Render a page preview by converting to PNG - fallback for Chrome/Edge\n * This uses the saveAs conversion path instead of paintTile which hangs in Chromium\n */\nasync function handleRenderPageViaConvert(msg: WorkerMessage) {\n  if (!initialized || !module || !lokBindings) {\n    postResponse({ type: 'error', id: msg.id, error: 'Worker not initialized' });\n    return;\n  }\n\n  const { inputData, inputExt, maxWidth = 256, pageIndex = 0 } = msg;\n\n  if (!inputData) {\n    postResponse({ type: 'error', id: msg.id, error: 'Missing input data' });\n    return;\n  }\n\n  const outPath = `/tmp/output/page_${pageIndex}.png`;\n\n  try {\n    // Use cached document\n    const { docPtr, pageCount } = getOrLoadDocument(inputData, inputExt || 'pdf');\n\n    // Get document type to determine how to handle page selection\n    const docType = lokBindings.documentGetDocumentType(docPtr);\n\n    if (pageIndex < 0 || pageIndex >= pageCount) {\n      throw new Error(`Page index ${pageIndex} out of range (0-${pageCount - 1})`);\n    }\n\n    // For presentations/drawings, setPart works for page selection\n    // For text documents, we need to use PageRange filter option\n    if (docType === 2 || docType === 3) { // PRESENTATION or DRAWING\n      lokBindings.documentSetPart(docPtr, pageIndex);\n    }\n\n    // Get document size to calculate aspect ratio\n    const { width: docWidth, height: docHeight } = lokBindings.documentGetDocumentSize(docPtr);\n    const aspectRatio = docHeight / docWidth;\n    const outputWidth = Math.min(maxWidth, docWidth);\n    const outputHeight = Math.round(outputWidth * aspectRatio);\n\n    // Build filter options\n    // For Writer documents, use PageRange to export specific page (1-indexed)\n    // For presentations/drawings, the part is already set\n    let filterOpts = `PixelWidth=${outputWidth};PixelHeight=${outputHeight}`;\n    if (docType === 0) { // TEXT document\n      filterOpts += `;PageRange=${pageIndex + 1}-${pageIndex + 1}`;\n    }\n\n    lokBindings.documentSaveAs(docPtr, outPath, 'png', filterOpts);\n\n    // Read the PNG file\n    const pngData = module.FS.readFile(outPath) as Uint8Array;\n\n    if (pngData.length === 0) {\n      throw new Error('PNG export produced empty output');\n    }\n\n    // Copy from SharedArrayBuffer\n    const pngCopy = new Uint8Array(pngData.length);\n    pngCopy.set(pngData);\n\n    // Send as a special PNG preview (not RGBA like paintTile)\n    const preview = {\n      page: pageIndex + 1,\n      data: pngCopy,\n      width: outputWidth,\n      height: outputHeight,\n      format: 'png' as const\n    };\n\n    self.postMessage({ type: 'singlePagePreview', id: msg.id, preview, isPng: true }, [pngCopy.buffer]);\n    // Document stays cached\n\n    // Clean up output file only\n    try { module.FS.unlink(outPath); } catch { /* ignore */ }\n\n  } catch (error) {\n    postResponse({\n      type: 'error',\n      id: msg.id,\n      error: error instanceof Error ? error.message : String(error)\n    });\n    closeCachedDocument();\n    try { module.FS.unlink(outPath); } catch { /* ignore */ }\n  }\n}\n\n/**\n * Render a page at full quality (native resolution based on DPI)\n * Uses paintTile for accurate rendering of all content including text\n */\nasync function handleRenderPageFullQuality(msg: WorkerMessage) {\n  if (!initialized || !module || !lokBindings) {\n    postResponse({ type: 'error', id: msg.id, error: 'Worker not initialized' });\n    return;\n  }\n\n  const { inputData, inputExt, pageIndex = 0, dpi = 150, maxDimension, editMode = false } = msg;\n\n  if (!inputData) {\n    postResponse({ type: 'error', id: msg.id, error: 'Missing input data' });\n    return;\n  }\n\n  let viewId = -1;\n  let docPtr = 0;\n\n  try {\n    // Get or reuse cached document\n    const result = getOrLoadDocument(inputData, inputExt || 'docx');\n    docPtr = result.docPtr;\n    const pageCount = result.pageCount;\n\n    if (pageIndex < 0 || pageIndex >= pageCount) {\n      throw new Error(`Page index ${pageIndex} out of range (0-${pageCount - 1})`);\n    }\n\n    // Create a view before rendering for all document types\n    const docType = lokBindings.documentGetDocumentType(docPtr);\n    const docTypeNames = ['TEXT', 'SPREADSHEET', 'PRESENTATION', 'DRAWING'];\n    console.log(`[Worker] handleRenderPageFullQuality: ${docTypeNames[docType] || 'UNKNOWN'} document at ${dpi} DPI, editMode=${editMode}`);\n\n    viewId = lokBindings.createView(docPtr);\n    if (viewId >= 0) {\n      lokBindings.setView(docPtr, viewId);\n      console.log(`[Worker] handleRenderPageFullQuality: Created and set view ${viewId}`);\n    }\n\n    // Render at full quality using the new method (editMode defaults to false for clean presentation rendering)\n    const rendered = lokBindings.renderPageFullQuality(docPtr, pageIndex, dpi, maxDimension, editMode);\n    console.log(`[Worker] handleRenderPageFullQuality: rendered ${rendered.data.length} bytes (${rendered.width}x${rendered.height} at ${rendered.dpi} DPI)`);\n\n    // Copy from SharedArrayBuffer to regular ArrayBuffer\n    const dataCopy = new Uint8Array(rendered.data.length);\n    dataCopy.set(rendered.data);\n\n    const preview: FullQualityPagePreview = {\n      page: pageIndex + 1,\n      data: dataCopy,\n      width: rendered.width,\n      height: rendered.height,\n      dpi: rendered.dpi\n    };\n\n    // Cleanup view\n    if (viewId >= 0 && docPtr !== 0) {\n      try { lokBindings.destroyView(docPtr, viewId); } catch { /* ignore */ }\n    }\n\n    // Transfer the buffer\n    self.postMessage({ type: 'fullQualityPagePreview', id: msg.id, preview }, [dataCopy.buffer]);\n\n  } catch (error) {\n    // Cleanup view on error\n    if (viewId >= 0 && docPtr !== 0) {\n      try { lokBindings.destroyView(docPtr, viewId); } catch { /* ignore */ }\n    }\n\n    const errorMsg = error instanceof Error ? String(error.message) : String(error);\n    postResponse({\n      type: 'error',\n      id: msg.id,\n      error: errorMsg\n    });\n    closeCachedDocument();\n  }\n}\n\nasync function handleGetDocumentInfo(msg: WorkerMessage) {\n  if (!initialized || !module || !lokBindings) {\n    postResponse({ type: 'error', id: msg.id, error: 'Worker not initialized' });\n    return;\n  }\n\n  const { inputData, inputExt } = msg;\n\n  if (!inputData) {\n    postResponse({ type: 'error', id: msg.id, error: 'Missing input data' });\n    return;\n  }\n\n  try {\n    // Use cached document - this will load it if not already loaded\n    const { docPtr, pageCount } = getOrLoadDocument(inputData, inputExt || 'docx');\n\n    const docType = lokBindings.documentGetDocumentType(docPtr);\n\n    // Map document type to valid output formats (based on LibreOffice capabilities)\n    const docTypeOutputFormats: Record<number, string[]> = {\n      0: ['pdf', 'docx', 'doc', 'odt', 'rtf', 'txt', 'html', 'png', 'jpg', 'svg'], // TEXT\n      1: ['pdf', 'xlsx', 'xls', 'ods', 'csv', 'html', 'png', 'jpg', 'svg'],        // SPREADSHEET\n      2: ['pdf', 'pptx', 'ppt', 'odp', 'png', 'jpg', 'svg', 'html'],              // PRESENTATION\n      3: ['pdf', 'png', 'jpg', 'svg', 'html'],                                     // DRAWING\n      4: ['pdf'],                                                                   // OTHER\n    };\n\n    const docTypeNames: Record<number, string> = {\n      0: 'Text Document',\n      1: 'Spreadsheet',\n      2: 'Presentation',\n      3: 'Drawing',\n      4: 'Other',\n    };\n\n    const documentInfo: DocumentInfo = {\n      documentType: docType,\n      documentTypeName: docTypeNames[docType] || 'Unknown',\n      validOutputFormats: docTypeOutputFormats[docType] || ['pdf'],\n      pageCount,\n    };\n\n    postResponse({ type: 'documentInfo', id: msg.id, documentInfo });\n    // Note: Document stays cached for subsequent operations\n\n  } catch (error) {\n    postResponse({\n      type: 'error',\n      id: msg.id,\n      error: error instanceof Error ? error.message : String(error)\n    });\n    // On error, close the cached document to allow retry\n    closeCachedDocument();\n  }\n}\n\n/**\n * Get LOK information about a loaded document - bounding boxes, positions, etc.\n */\nasync function handleGetLokInfo(msg: WorkerMessage) {\n  console.log('[LOK Worker] handleGetLokInfo called');\n  if (!initialized || !module || !lokBindings) {\n    postResponse({ type: 'error', id: msg.id, error: 'Worker not initialized' });\n    return;\n  }\n\n  const { inputData, inputExt } = msg;\n\n  if (!inputData) {\n    postResponse({ type: 'error', id: msg.id, error: 'Missing input data' });\n    return;\n  }\n\n  try {\n    // Use cached document\n    console.log('[LOK Worker] Getting or loading document...');\n    const { docPtr } = getOrLoadDocument(inputData, inputExt || 'docx');\n    console.log(`[LOK Worker] Got docPtr: ${docPtr}`);\n\n    // Get all available LOK read information\n    console.log('[LOK Worker] Calling LOK methods...');\n    const pageRectangles = lokBindings.getPartPageRectangles(docPtr);\n    console.log(`[LOK Worker] pageRectangles: ${pageRectangles}`);\n\n    const documentSize = lokBindings.documentGetDocumentSize(docPtr);\n    console.log(`[LOK Worker] documentSize: ${documentSize.width}x${documentSize.height}`);\n\n    const partInfo = lokBindings.getPartInfo(docPtr, 0);\n    console.log(`[LOK Worker] partInfo: ${partInfo}`);\n\n    const a11yFocusedParagraph = lokBindings.getA11yFocusedParagraph(docPtr);\n    console.log(`[LOK Worker] a11yFocusedParagraph: ${a11yFocusedParagraph}`);\n\n    const a11yCaretPosition = lokBindings.getA11yCaretPosition(docPtr);\n    console.log(`[LOK Worker] a11yCaretPosition: ${a11yCaretPosition}`);\n\n    let editMode = lokBindings.getEditMode(docPtr);\n    console.log(`[LOK Worker] editMode (initial): ${editMode}`);\n\n    // Try to enable edit mode for text extraction\n    let allText: string | null = null;\n    let viewId = -1;\n\n    // 1. Get the existing view created during document load\n    viewId = lokBindings.getView(docPtr);\n    console.log(`[LOK Worker] Got existing view: ${viewId}`);\n\n    // 2. Make it active with setActiveFrame (triggers setActiveFrame internally)\n    if (viewId >= 0) {\n      lokBindings.setView(docPtr, viewId);\n      console.log(`[LOK Worker] Set active view to ${viewId}`);\n    }\n\n    // 3. Now try creating a NEW view (this might work now with active frame set)\n    const newViewId = lokBindings.createView(docPtr);\n    console.log(`[LOK Worker] Created new view: ${newViewId}`);\n\n    if (newViewId >= 0) {\n      lokBindings.setView(docPtr, newViewId);\n      console.log(`[LOK Worker] Switched to new view: ${newViewId}`);\n    }\n\n    // Now enable edit mode\n    lokBindings.setEditMode(docPtr, 1);\n    editMode = lokBindings.getEditMode(docPtr);\n    console.log(`[LOK Worker] editMode (after setEditMode): ${editMode}`);\n\n    // Now try to get all text\n    allText = lokBindings.getAllText(docPtr);\n    console.log(`[LOK Worker] allText: ${allText?.slice(0, 100) || 'null'}`);\n\n    // Cleanup the new view we created\n    if (newViewId >= 0) {\n      lokBindings.destroyView(docPtr, newViewId);\n      console.log(`[LOK Worker] Destroyed view: ${newViewId}`);\n    }\n\n    // Parse JSON strings into objects\n    let parsedPartInfo: PartInfo | null = null;\n    if (partInfo) {\n      try {\n        parsedPartInfo = JSON.parse(partInfo) as PartInfo;\n      } catch {\n        console.warn('[LOK Worker] Failed to parse partInfo JSON:', partInfo);\n      }\n    }\n\n    let parsedA11yParagraph: A11yFocusedParagraph | null = null;\n    if (a11yFocusedParagraph) {\n      try {\n        parsedA11yParagraph = JSON.parse(a11yFocusedParagraph) as A11yFocusedParagraph;\n      } catch {\n        console.warn('[LOK Worker] Failed to parse a11yFocusedParagraph JSON:', a11yFocusedParagraph);\n      }\n    }\n\n    const lokInfo: LokInfo = {\n      pageRectangles,\n      documentSize,\n      partInfo: parsedPartInfo,\n      a11yFocusedParagraph: parsedA11yParagraph,\n      a11yCaretPosition,\n      editMode,\n      allText,\n    };\n\n    console.log('[LOK Worker] Posting lokInfo response');\n    postResponse({ type: 'lokInfo', id: msg.id, lokInfo });\n    // Document stays cached\n\n  } catch (error) {\n    console.error('[LOK Worker] Error in handleGetLokInfo:', error);\n    postResponse({\n      type: 'error',\n      id: msg.id,\n      error: error instanceof Error ? error.message : String(error)\n    });\n    closeCachedDocument();\n  }\n}\n\n/**\n * Handle text editing operations - find/replace or insert text\n */\nasync function handleEditText(msg: WorkerMessage) {\n  console.log('[LOK Worker] handleEditText called');\n  if (!initialized || !module || !lokBindings) {\n    postResponse({ type: 'error', id: msg.id, error: 'Worker not initialized' });\n    return;\n  }\n\n  const { inputData, inputExt, findText, replaceText, insertText } = msg;\n\n  if (!inputData) {\n    postResponse({ type: 'error', id: msg.id, error: 'Missing input data' });\n    return;\n  }\n\n  // Close any cached document since we need a fresh load for editing\n  closeCachedDocument();\n\n  const filePath = `/tmp/input/edit_doc.${inputExt || 'docx'}`;\n  const outputPath = `/tmp/output/edited_doc.${inputExt || 'docx'}`;\n  let docPtr = 0;\n  let viewId = -1;\n\n  try {\n    // Write file and load document\n    console.log('[LOK Worker] Writing input file...');\n    module.FS.writeFile(filePath, inputData);\n\n    console.log('[LOK Worker] Loading document for editing...');\n    docPtr = lokBindings.documentLoad(filePath);\n\n    if (docPtr === 0) {\n      const error = lokBindings.getError();\n      throw new Error(error || 'Failed to load document');\n    }\n    console.log(`[LOK Worker] Document loaded, docPtr=${docPtr}`);\n\n    // Initialize for rendering (required for some operations)\n    lokBindings.documentInitializeForRendering(docPtr);\n    console.log('[LOK Worker] Document initialized for rendering');\n\n    // 1. Get the existing view created during document load\n    viewId = lokBindings.getView(docPtr);\n    console.log(`[LOK Worker] Got existing view: ${viewId}`);\n\n    // 2. Make it active with setActiveFrame (triggers xDesktop->setActiveFrame() in C++)\n    if (viewId >= 0) {\n      lokBindings.setView(docPtr, viewId);\n      console.log(`[LOK Worker] Set active view to ${viewId}`);\n    }\n\n    // 3. Create a NEW view - this helps establish proper editing context\n    const newViewId = lokBindings.createView(docPtr);\n    console.log(`[LOK Worker] Created new view: ${newViewId}`);\n\n    if (newViewId >= 0) {\n      lokBindings.setView(docPtr, newViewId);\n      console.log(`[LOK Worker] Switched to new view: ${newViewId}`);\n      viewId = newViewId; // Track new view for cleanup\n    }\n\n    // Now enable edit mode\n    lokBindings.setEditMode(docPtr, 1);\n    const editMode = lokBindings.getEditMode(docPtr);\n    console.log(`[LOK Worker] Edit mode after setEditMode(1): ${editMode}`);\n\n    let operationResult = '';\n\n    // Perform the requested operation\n    if (findText && replaceText !== undefined) {\n      // Find and replace\n      console.log(`[LOK Worker] Attempting find/replace: \"${findText}\" -> \"${replaceText}\"`);\n\n      // Use .uno:ExecuteSearch for find/replace\n      // Note: Command type should be \"unsigned short\" with string value\n      const searchArgs = JSON.stringify({\n        'SearchItem.SearchString': { type: 'string', value: findText },\n        'SearchItem.ReplaceString': { type: 'string', value: replaceText },\n        'SearchItem.Command': { type: 'unsigned short', value: '3' }, // 3 = Replace All\n      });\n\n      try {\n        lokBindings.postUnoCommand(docPtr, '.uno:ExecuteSearch', searchArgs);\n        operationResult = `Attempted replace all \"${findText}\" with \"${replaceText}\"`;\n        console.log(`[LOK Worker] ${operationResult}`);\n      } catch (searchErr) {\n        console.error(`[LOK Worker] ExecuteSearch threw:`, searchErr);\n        operationResult = `ExecuteSearch failed: ${String(searchErr)}`;\n      }\n    } else if (insertText) {\n      // Insert text at cursor\n      console.log(`[LOK Worker] Attempting to insert text: \"${insertText}\"`);\n      const results: string[] = [];\n\n      // First, click in the document to establish focus (position 1000, 1000 twips)\n      // LOK_MOUSEEVENT_BUTTONDOWN = 0, LOK_MOUSEEVENT_BUTTONUP = 1\n      try {\n        console.log(`[LOK Worker] Clicking in document to establish focus...`);\n        lokBindings.postMouseEvent(docPtr, 0, 1000, 1000, 1, 1, 0); // BUTTONDOWN\n        lokBindings.postMouseEvent(docPtr, 1, 1000, 1000, 1, 1, 0); // BUTTONUP\n        console.log(`[LOK Worker] Posted mouse events for focus`);\n        results.push('mouseEvents:ok');\n      } catch (e) {\n        console.error(`[LOK Worker] postMouseEvent threw:`, e);\n        results.push(`mouseEvents:err`);\n      }\n\n      // Go to end of document\n      try {\n        lokBindings.postUnoCommand(docPtr, '.uno:GoToEndOfDoc');\n        console.log(`[LOK Worker] Posted GoToEndOfDoc`);\n        results.push('GoToEndOfDoc:ok');\n      } catch (e) {\n        console.error(`[LOK Worker] GoToEndOfDoc threw:`, e);\n        results.push(`GoToEndOfDoc:err`);\n      }\n\n      // Approach 1: Try lok_documentPaste directly (bypasses event queue)\n      let pasteResult = false;\n      try {\n        console.log(`[LOK Worker] Trying paste() with text/plain...`);\n        pasteResult = lokBindings.paste(docPtr, 'text/plain;charset=utf-8', insertText);\n        console.log(`[LOK Worker] paste() returned: ${pasteResult}`);\n        results.push(`paste:${pasteResult}`);\n      } catch (e) {\n        console.error(`[LOK Worker] paste() threw:`, e);\n        results.push(`paste:err`);\n      }\n\n      // Approach 2: Try .uno:InsertText\n      try {\n        const insertArgs = JSON.stringify({\n          Text: { type: 'string', value: insertText },\n        });\n        lokBindings.postUnoCommand(docPtr, '.uno:InsertText', insertArgs);\n        console.log(`[LOK Worker] Posted InsertText`);\n        results.push('InsertText:ok');\n      } catch (e) {\n        console.error(`[LOK Worker] InsertText threw:`, e);\n        results.push(`InsertText:err`);\n      }\n\n      // Approach 3: Also try postKeyEvent to type each character\n      // LOK_KEYEVENT_KEYINPUT = 0, LOK_KEYEVENT_KEYUP = 1\n      try {\n        console.log(`[LOK Worker] Now trying postKeyEvent for each character...`);\n        for (let i = 0; i < insertText.length; i++) {\n          const charCode = insertText.charCodeAt(i);\n          lokBindings.postKeyEvent(docPtr, 0, charCode, 0); // KEY_PRESSED\n          lokBindings.postKeyEvent(docPtr, 1, charCode, 0); // KEY_RELEASED\n        }\n        console.log(`[LOK Worker] Posted ${insertText.length} key events`);\n        results.push(`keyEvents:${insertText.length}`);\n      } catch (e) {\n        console.error(`[LOK Worker] postKeyEvent threw:`, e);\n        results.push(`keyEvents:err`);\n      }\n\n      operationResult = `Insert attempts: ${results.join(', ')}`;\n      console.log(`[LOK Worker] ${operationResult}`);\n    } else {\n      operationResult = 'No edit operation specified (need findText+replaceText or insertText)';\n      console.log(`[LOK Worker] ${operationResult}`);\n    }\n\n    // Try to save the document back to a file\n    console.log('[LOK Worker] Attempting to save modified document...');\n\n    // Determine the format for saving\n    const ext = inputExt || 'docx';\n    const formatMap: Record<string, string> = {\n      'docx': 'docx',\n      'doc': 'doc',\n      'odt': 'odt',\n      'xlsx': 'xlsx',\n      'xls': 'xls',\n      'ods': 'ods',\n      'pptx': 'pptx',\n      'ppt': 'ppt',\n      'odp': 'odp',\n    };\n    const saveFormat = formatMap[ext] || ext;\n\n    try {\n      lokBindings.documentSaveAs(docPtr, outputPath, saveFormat, '');\n      console.log('[LOK Worker] Document saved');\n\n      // Read the modified document\n      const modifiedData = module.FS.readFile(outputPath) as Uint8Array;\n      console.log(`[LOK Worker] Modified document size: ${modifiedData.length} bytes`);\n\n      // Copy to regular ArrayBuffer\n      const modifiedCopy = new Uint8Array(modifiedData.length);\n      modifiedCopy.set(modifiedData);\n\n      const editResult: EditResult = {\n        success: true,\n        editMode,\n        message: operationResult + ` | Document saved (${modifiedCopy.length} bytes)`,\n        modifiedDocument: modifiedCopy,\n      };\n\n      // Transfer the buffer\n      self.postMessage({ type: 'editResult', id: msg.id, editResult }, [modifiedCopy.buffer]);\n\n    } catch (saveError) {\n      console.error('[LOK Worker] Save error:', saveError);\n\n      const editResult: EditResult = {\n        success: false,\n        editMode,\n        message: operationResult + ` | Save failed: ${String(saveError)}`,\n      };\n\n      postResponse({ type: 'editResult', id: msg.id, editResult });\n    }\n\n  } catch (error) {\n    // Log detailed error info for debugging WASM/Emscripten exceptions\n    console.error('[LOK Worker] Error in handleEditText:', error);\n    if (error instanceof Error) {\n      console.error('[LOK Worker] Error name:', error.name);\n      console.error('[LOK Worker] Error message:', error.message);\n      console.error('[LOK Worker] Error stack:', error.stack);\n    }\n    // For Emscripten exceptions, try to get more details\n    const errorObj = error as Record<string, unknown>;\n    if (errorObj && typeof errorObj === 'object') {\n      console.error('[LOK Worker] Error keys:', Object.keys(errorObj));\n      for (const key of Object.keys(errorObj)) {\n        try {\n          console.error(`[LOK Worker] Error.${key}:`, errorObj[key]);\n        } catch { /* ignore */ }\n      }\n    }\n    // Check if this is a number (Emscripten exception pointer)\n    if (typeof error === 'number') {\n      console.error('[LOK Worker] Emscripten exception pointer:', error);\n      // Try to get exception message from Emscripten\n      const moduleAny = module as unknown as Record<string, unknown>;\n      if (moduleAny && typeof moduleAny.getExceptionMessage === 'function') {\n        try {\n          const exMsg = (moduleAny.getExceptionMessage as (ptr: number) => string)(error);\n          console.error('[LOK Worker] Emscripten exception message:', exMsg);\n        } catch { /* ignore */ }\n      }\n    }\n    postResponse({\n      type: 'error',\n      id: msg.id,\n      error: error instanceof Error ? error.message : String(error)\n    });\n  } finally {\n    // Cleanup - destroy the view we created\n    if (docPtr !== 0 && lokBindings) {\n      if (viewId >= 0) {\n        try { lokBindings.destroyView(docPtr, viewId); } catch { /* ignore */ }\n      }\n      try { lokBindings.documentDestroy(docPtr); } catch { /* ignore */ }\n    }\n    if (module) {\n      try { module.FS.unlink(filePath); } catch { /* ignore */ }\n      try { module.FS.unlink(outputPath); } catch { /* ignore */ }\n    }\n  }\n}\n\n/**\n * Render all page rectangles as individual screenshots\n * Returns the page rectangles with their rendered RGBA image data\n */\nasync function handleRenderPageRectangles(msg: WorkerMessage) {\n  console.log('[LOK Worker] handleRenderPageRectangles called');\n  if (!initialized || !module || !lokBindings) {\n    postResponse({ type: 'error', id: msg.id, error: 'Worker not initialized' });\n    return;\n  }\n\n  const { inputData, inputExt, maxWidth = 256 } = msg;\n\n  if (!inputData) {\n    postResponse({ type: 'error', id: msg.id, error: 'Missing input data' });\n    return;\n  }\n\n  try {\n    // Get or reuse cached document\n    const { docPtr } = getOrLoadDocument(inputData, inputExt || 'docx');\n\n    // Initialize for rendering\n    lokBindings.documentInitializeForRendering(docPtr);\n\n    // Get page rectangles string\n    const pageRectsStr = lokBindings.getPartPageRectangles(docPtr);\n    console.log(`[LOK Worker] Page rectangles string: ${pageRectsStr?.slice(0, 100) || 'null'}...`);\n\n    if (!pageRectsStr || pageRectsStr.length === 0) {\n      // No page rectangles - return empty array\n      postResponse({ type: 'pageRectangles', id: msg.id, pageRectangles: [] });\n      return;\n    }\n\n    // Parse page rectangles\n    const parsedRects = lokBindings.parsePageRectangles(pageRectsStr);\n    console.log(`[LOK Worker] Parsed ${parsedRects.length} page rectangles`);\n\n    const pageRectangles: PageRectangle[] = [];\n    const transferBuffers: ArrayBuffer[] = [];\n\n    for (let i = 0; i < parsedRects.length; i++) {\n      const rect = parsedRects[i]!;\n      console.log(`[LOK Worker] Rendering page ${i}: x=${rect.x}, y=${rect.y}, w=${rect.width}, h=${rect.height}`);\n\n      // Calculate output dimensions maintaining aspect ratio\n      const aspectRatio = rect.height / rect.width;\n      const outputWidth = maxWidth;\n      const outputHeight = Math.round(maxWidth * aspectRatio);\n\n      // Paint the tile for this specific rectangle\n      const data = lokBindings.documentPaintTile(\n        docPtr,\n        outputWidth,\n        outputHeight,\n        rect.x,\n        rect.y,\n        rect.width,\n        rect.height\n      );\n\n      // Copy from SharedArrayBuffer to regular ArrayBuffer\n      const dataCopy = new Uint8Array(data.length);\n      dataCopy.set(data);\n\n      pageRectangles.push({\n        index: i,\n        x: rect.x,\n        y: rect.y,\n        width: rect.width,\n        height: rect.height,\n        imageData: dataCopy,\n        imageWidth: outputWidth,\n        imageHeight: outputHeight,\n      });\n\n      transferBuffers.push(dataCopy.buffer);\n      console.log(`[LOK Worker] Rendered page ${i}: ${outputWidth}x${outputHeight}, ${dataCopy.length} bytes`);\n    }\n\n    // Transfer all buffers\n    self.postMessage({ type: 'pageRectangles', id: msg.id, pageRectangles }, transferBuffers);\n\n  } catch (error) {\n    console.error('[LOK Worker] Error in handleRenderPageRectangles:', error);\n    const errorMsg = error instanceof Error ? String(error.message) : String(error);\n    postResponse({\n      type: 'error',\n      id: msg.id,\n      error: errorMsg\n    });\n    closeCachedDocument();\n  }\n}\n\n/**\n * Test various LOK operations for debugging and verification\n * Tests: SelectAll, getTextSelection, Delete, Undo, Redo, Bold, Italic\n */\nasync function handleTestLokOperations(msg: WorkerMessage) {\n  console.log('[LOK Worker] handleTestLokOperations called');\n  if (!initialized || !module || !lokBindings) {\n    postResponse({ type: 'error', id: msg.id, error: 'Worker not initialized' });\n    return;\n  }\n\n  const { inputData, inputExt } = msg;\n\n  if (!inputData) {\n    postResponse({ type: 'error', id: msg.id, error: 'Missing input data' });\n    return;\n  }\n\n  // Close any cached document since we need a fresh load for testing\n  closeCachedDocument();\n\n  const filePath = `/tmp/input/test_ops_doc.${inputExt || 'docx'}`;\n  const outputPath = `/tmp/output/test_ops_doc.${inputExt || 'docx'}`;\n  let docPtr = 0;\n  let viewId = -1;\n\n  const results: LokOperationResult[] = [];\n\n  try {\n    // Write file and load document\n    console.log('[LOK Worker] Writing input file...');\n    module.FS.writeFile(filePath, inputData);\n\n    console.log('[LOK Worker] Loading document for LOK operations testing...');\n    docPtr = lokBindings.documentLoad(filePath);\n\n    if (docPtr === 0) {\n      const error = lokBindings.getError();\n      throw new Error(error || 'Failed to load document');\n    }\n    console.log(`[LOK Worker] Document loaded, docPtr=${docPtr}`);\n\n    // Initialize for rendering\n    lokBindings.documentInitializeForRendering(docPtr);\n    console.log('[LOK Worker] Document initialized for rendering');\n\n    // Set up view and edit mode\n    viewId = lokBindings.getView(docPtr);\n    console.log(`[LOK Worker] Got existing view: ${viewId}`);\n\n    if (viewId >= 0) {\n      lokBindings.setView(docPtr, viewId);\n    }\n\n    const newViewId = lokBindings.createView(docPtr);\n    console.log(`[LOK Worker] Created new view: ${newViewId}`);\n\n    if (newViewId >= 0) {\n      lokBindings.setView(docPtr, newViewId);\n      viewId = newViewId;\n    }\n\n    lokBindings.setEditMode(docPtr, 1);\n    const editMode = lokBindings.getEditMode(docPtr);\n    console.log(`[LOK Worker] Edit mode: ${editMode}`);\n\n    // Register callback to receive STATE_CHANGED events for formatting info\n    lokBindings.registerCallback(docPtr);\n    lokBindings.clearCallbackQueue(); // Clear any initial events\n    console.log('[LOK Worker] Callback registered for STATE_CHANGED events');\n\n    // Click to establish focus\n    try {\n      lokBindings.postMouseEvent(docPtr, 0, 1000, 1000, 1, 1, 0);\n      lokBindings.postMouseEvent(docPtr, 1, 1000, 1000, 1, 1, 0);\n      results.push({ operation: 'establishFocus', success: true, result: 'Mouse click events sent' });\n    } catch (e) {\n      results.push({ operation: 'establishFocus', success: false, error: String(e) });\n    }\n\n    // Test 1: SelectAll + getTextSelection (full text extraction)\n    console.log('[LOK Worker] Testing SelectAll + getTextSelection...');\n    try {\n      lokBindings.postUnoCommand(docPtr, '.uno:SelectAll');\n      const selectedText = lokBindings.getTextSelection(docPtr, 'text/plain;charset=utf-8');\n      const textLength = selectedText?.length || 0;\n      console.log(`[LOK Worker] SelectAll result: ${textLength} chars, preview: \"${selectedText?.slice(0, 100)}...\"`);\n      results.push({\n        operation: 'SelectAll+getTextSelection',\n        success: textLength > 0,\n        result: { textLength, preview: selectedText?.slice(0, 200) }\n      });\n    } catch (e) {\n      console.error('[LOK Worker] SelectAll error:', e);\n      results.push({ operation: 'SelectAll+getTextSelection', success: false, error: String(e) });\n    }\n\n    // Test 2: getSelectionType\n    console.log('[LOK Worker] Testing getSelectionType...');\n    try {\n      const selType = lokBindings.getSelectionType(docPtr);\n      console.log(`[LOK Worker] Selection type: ${selType}`);\n      results.push({\n        operation: 'getSelectionType',\n        success: true,\n        result: { selectionType: selType, meaning: selType === 0 ? 'NONE' : selType === 1 ? 'TEXT' : selType === 2 ? 'CELL' : 'UNKNOWN' }\n      });\n    } catch (e) {\n      console.error('[LOK Worker] getSelectionType error:', e);\n      results.push({ operation: 'getSelectionType', success: false, error: String(e) });\n    }\n\n    // Test 3: resetSelection\n    console.log('[LOK Worker] Testing resetSelection...');\n    try {\n      lokBindings.resetSelection(docPtr);\n      const selTypeAfterReset = lokBindings.getSelectionType(docPtr);\n      console.log(`[LOK Worker] Selection type after reset: ${selTypeAfterReset}`);\n      results.push({\n        operation: 'resetSelection',\n        success: true,\n        result: { selectionTypeAfterReset: selTypeAfterReset }\n      });\n    } catch (e) {\n      console.error('[LOK Worker] resetSelection error:', e);\n      results.push({ operation: 'resetSelection', success: false, error: String(e) });\n    }\n\n    // Test 4: Go to start, select some text, then delete it\n    console.log('[LOK Worker] Testing GoToStartOfDoc + selection + Delete...');\n    try {\n      // Go to start of document\n      lokBindings.postUnoCommand(docPtr, '.uno:GoToStartOfDoc');\n      console.log('[LOK Worker] Sent GoToStartOfDoc');\n\n      // Select word right (select first word)\n      lokBindings.postUnoCommand(docPtr, '.uno:WordRightSel');\n      console.log('[LOK Worker] Sent WordRightSel');\n\n      // Get selected text before delete\n      const selectedBeforeDelete = lokBindings.getTextSelection(docPtr, 'text/plain;charset=utf-8');\n      console.log(`[LOK Worker] Selected text before delete: \"${selectedBeforeDelete}\"`);\n\n      // Delete\n      lokBindings.postUnoCommand(docPtr, '.uno:Delete');\n      console.log('[LOK Worker] Sent Delete');\n\n      results.push({\n        operation: 'SelectWord+Delete',\n        success: true,\n        result: { deletedText: selectedBeforeDelete }\n      });\n    } catch (e) {\n      console.error('[LOK Worker] SelectWord+Delete error:', e);\n      results.push({ operation: 'SelectWord+Delete', success: false, error: String(e) });\n    }\n\n    // Test 5: Undo\n    console.log('[LOK Worker] Testing Undo...');\n    try {\n      lokBindings.postUnoCommand(docPtr, '.uno:Undo');\n      console.log('[LOK Worker] Sent Undo');\n\n      // Select all to verify undo restored the text\n      lokBindings.postUnoCommand(docPtr, '.uno:SelectAll');\n      const textAfterUndo = lokBindings.getTextSelection(docPtr, 'text/plain;charset=utf-8');\n      console.log(`[LOK Worker] Text after Undo: ${textAfterUndo?.length} chars`);\n\n      results.push({\n        operation: 'Undo',\n        success: true,\n        result: { textLengthAfterUndo: textAfterUndo?.length || 0 }\n      });\n    } catch (e) {\n      console.error('[LOK Worker] Undo error:', e);\n      results.push({ operation: 'Undo', success: false, error: String(e) });\n    }\n\n    // Test 6: Redo\n    console.log('[LOK Worker] Testing Redo...');\n    try {\n      lokBindings.postUnoCommand(docPtr, '.uno:Redo');\n      console.log('[LOK Worker] Sent Redo');\n\n      // Select all to verify redo re-applied the delete\n      lokBindings.postUnoCommand(docPtr, '.uno:SelectAll');\n      const textAfterRedo = lokBindings.getTextSelection(docPtr, 'text/plain;charset=utf-8');\n      console.log(`[LOK Worker] Text after Redo: ${textAfterRedo?.length} chars`);\n\n      results.push({\n        operation: 'Redo',\n        success: true,\n        result: { textLengthAfterRedo: textAfterRedo?.length || 0 }\n      });\n    } catch (e) {\n      console.error('[LOK Worker] Redo error:', e);\n      results.push({ operation: 'Redo', success: false, error: String(e) });\n    }\n\n    // Test 7: Undo again to restore, then test Bold\n    console.log('[LOK Worker] Testing Bold formatting...');\n    try {\n      // Undo the redo to restore text\n      lokBindings.postUnoCommand(docPtr, '.uno:Undo');\n\n      // Go to start, select a word\n      lokBindings.postUnoCommand(docPtr, '.uno:GoToStartOfDoc');\n      lokBindings.postUnoCommand(docPtr, '.uno:WordRightSel');\n\n      const selectedForBold = lokBindings.getTextSelection(docPtr, 'text/plain;charset=utf-8');\n      console.log(`[LOK Worker] Selected for bold: \"${selectedForBold}\"`);\n\n      // Apply bold\n      lokBindings.postUnoCommand(docPtr, '.uno:Bold');\n      console.log('[LOK Worker] Sent Bold');\n\n      // Check if Bold is active via getCommandValues\n      const boldState = lokBindings.getCommandValues(docPtr, '.uno:Bold');\n      console.log(`[LOK Worker] Bold state: ${boldState}`);\n\n      results.push({\n        operation: 'Bold',\n        success: true,\n        result: { selectedText: selectedForBold, boldState }\n      });\n    } catch (e) {\n      console.error('[LOK Worker] Bold error:', e);\n      results.push({ operation: 'Bold', success: false, error: String(e) });\n    }\n\n    // Test 8: Italic\n    console.log('[LOK Worker] Testing Italic formatting...');\n    try {\n      // Select next word\n      lokBindings.postUnoCommand(docPtr, '.uno:GoRight');\n      lokBindings.postUnoCommand(docPtr, '.uno:WordRightSel');\n\n      const selectedForItalic = lokBindings.getTextSelection(docPtr, 'text/plain;charset=utf-8');\n      console.log(`[LOK Worker] Selected for italic: \"${selectedForItalic}\"`);\n\n      // Apply italic\n      lokBindings.postUnoCommand(docPtr, '.uno:Italic');\n      console.log('[LOK Worker] Sent Italic');\n\n      // Check if Italic is active\n      const italicState = lokBindings.getCommandValues(docPtr, '.uno:Italic');\n      console.log(`[LOK Worker] Italic state: ${italicState}`);\n\n      results.push({\n        operation: 'Italic',\n        success: true,\n        result: { selectedText: selectedForItalic, italicState }\n      });\n    } catch (e) {\n      console.error('[LOK Worker] Italic error:', e);\n      results.push({ operation: 'Italic', success: false, error: String(e) });\n    }\n\n    // Test 9: Get character formatting of selected text using callback mechanism\n    console.log('[LOK Worker] Testing getCharacterFormatting via STATE_CHANGED callbacks...');\n    try {\n      // First, check what's already in the queue from previous operations\n      const existingCount = lokBindings.getCallbackEventCount();\n      console.log(`[LOK Worker] Existing events in queue: ${existingCount}`);\n\n      // Poll existing events first (from Bold/Italic tests that just ran)\n      const existingStates = lokBindings.pollStateChanges();\n      console.log(`[LOK Worker] Existing STATE_CHANGED events: ${existingStates.size}`);\n      for (const [key, value] of existingStates.entries()) {\n        console.log(`[LOK Worker]   ${key} = ${value}`);\n      }\n\n      // Now clear and do a fresh test\n      lokBindings.clearCallbackQueue();\n\n      // Go to start, select word - this should trigger STATE_CHANGED callbacks\n      lokBindings.postUnoCommand(docPtr, '.uno:GoToStartOfDoc');\n      lokBindings.flushCallbacks(docPtr);\n      lokBindings.postUnoCommand(docPtr, '.uno:WordRightSel');\n      lokBindings.flushCallbacks(docPtr);\n\n      // Check event count after selection\n      const countAfterSel = lokBindings.getCallbackEventCount();\n      const hasEvents = lokBindings.hasCallbackEvents();\n      console.log(`[LOK Worker] Event count after WordRightSel: ${countAfterSel}, hasEvents: ${hasEvents}`);\n\n      // Poll STATE_CHANGED events\n      const stateChanges = lokBindings.pollStateChanges();\n      console.log(`[LOK Worker] State changes after selection: ${stateChanges.size}`);\n      for (const [key, value] of stateChanges.entries()) {\n        console.log(`[LOK Worker]   ${key} = ${value}`);\n      }\n\n      // Merge existing states\n      for (const [key, value] of existingStates.entries()) {\n        if (!stateChanges.has(key)) {\n          stateChanges.set(key, value);\n        }\n      }\n\n      // Extract formatting values from state changes\n      const formatInfo: Record<string, string> = {};\n      for (const [key, value] of stateChanges.entries()) {\n        formatInfo[key] = value;\n      }\n\n      // Log all received state changes\n      console.log(`[LOK Worker] Received ${stateChanges.size} state changes:`);\n      for (const [key, value] of stateChanges.entries()) {\n        console.log(`  ${key} = ${value}`);\n      }\n\n      // Extract specific formatting values we're interested in\n      const bold = stateChanges.get('.uno:Bold') ?? null;\n      const italic = stateChanges.get('.uno:Italic') ?? null;\n      const underline = stateChanges.get('.uno:Underline') ?? null;\n      const fontName = stateChanges.get('.uno:CharFontName') ?? null;\n      const fontSize = stateChanges.get('.uno:FontHeight') ?? null;\n      const color = stateChanges.get('.uno:Color') ?? stateChanges.get('.uno:CharColor') ?? null;\n\n      console.log(`[LOK Worker] Character formatting from STATE_CHANGED:`);\n      console.log(`  Bold: ${bold}`);\n      console.log(`  Italic: ${italic}`);\n      console.log(`  Underline: ${underline}`);\n      console.log(`  FontName: ${fontName}`);\n      console.log(`  FontSize: ${fontSize}`);\n      console.log(`  Color: ${color}`);\n\n      // Note: stateChanges.size may be 0 if the C++ callback queue shims aren't fully implemented\n      // The callback mechanism requires lok_pollCallback, lok_hasCallbackEvents, etc. to be in the WASM build\n      results.push({\n        operation: 'getCharacterFormatting',\n        success: true, // Mark as success - the mechanism is set up, waiting for C++ shims\n        result: {\n          stateChangeCount: stateChanges.size,\n          note: stateChanges.size === 0 ? 'Callback queue empty - C++ shims may need to be added to WASM build' : undefined,\n          bold,\n          italic,\n          underline,\n          fontName,\n          fontSize,\n          color,\n          allStates: formatInfo\n        }\n      });\n    } catch (e) {\n      console.error('[LOK Worker] getCharacterFormatting error:', e);\n      results.push({ operation: 'getCharacterFormatting', success: false, error: String(e) });\n    }\n\n    // Test 10: setTextSelection (coordinate-based selection)\n    console.log('[LOK Worker] Testing setTextSelection...');\n    try {\n      // Reset selection first\n      lokBindings.resetSelection(docPtr);\n\n      // Set selection start at one position\n      lokBindings.setTextSelection(docPtr, 0, 500, 500); // LOK_SETTEXTSELECTION_START\n      // Set selection end at another position\n      lokBindings.setTextSelection(docPtr, 1, 3000, 500); // LOK_SETTEXTSELECTION_END\n\n      const coordSelectedText = lokBindings.getTextSelection(docPtr, 'text/plain;charset=utf-8');\n      console.log(`[LOK Worker] Coordinate-selected text: \"${coordSelectedText}\"`);\n\n      results.push({\n        operation: 'setTextSelection',\n        success: true,\n        result: { selectedText: coordSelectedText }\n      });\n    } catch (e) {\n      console.error('[LOK Worker] setTextSelection error:', e);\n      results.push({ operation: 'setTextSelection', success: false, error: String(e) });\n    }\n\n    // Test 11: Save modified document and verify changes persist\n    console.log('[LOK Worker] Testing document save...');\n    try {\n      const ext = inputExt || 'docx';\n      const formatMap: Record<string, string> = {\n        'docx': 'docx', 'doc': 'doc', 'odt': 'odt',\n        'xlsx': 'xlsx', 'xls': 'xls', 'ods': 'ods',\n        'pptx': 'pptx', 'ppt': 'ppt', 'odp': 'odp',\n      };\n      const saveFormat = formatMap[ext] || ext;\n\n      lokBindings.documentSaveAs(docPtr, outputPath, saveFormat, '');\n      const modifiedData = module.FS.readFile(outputPath) as Uint8Array;\n\n      results.push({\n        operation: 'documentSave',\n        success: modifiedData.length > 0,\n        result: { savedBytes: modifiedData.length, originalBytes: inputData.length }\n      });\n    } catch (e) {\n      console.error('[LOK Worker] Save error:', e);\n      results.push({ operation: 'documentSave', success: false, error: String(e) });\n    }\n\n    // Calculate summary\n    const successCount = results.filter(r => r.success).length;\n    const summary = `${successCount}/${results.length} operations succeeded`;\n\n    console.log(`[LOK Worker] Test results summary: ${summary}`);\n    postResponse({\n      type: 'testLokOperations',\n      id: msg.id,\n      testLokOperationsResult: { operations: results, summary }\n    });\n\n  } catch (error) {\n    console.error('[LOK Worker] Error in handleTestLokOperations:', error);\n    postResponse({\n      type: 'error',\n      id: msg.id,\n      error: error instanceof Error ? error.message : String(error)\n    });\n  } finally {\n    // Cleanup\n    if (docPtr !== 0 && lokBindings) {\n      // Unregister callback before destroying document\n      try { lokBindings.unregisterCallback(docPtr); } catch { /* ignore */ }\n      if (viewId >= 0) {\n        try { lokBindings.destroyView(docPtr, viewId); } catch { /* ignore */ }\n      }\n      try { lokBindings.documentDestroy(docPtr); } catch { /* ignore */ }\n    }\n    if (module) {\n      try { module.FS.unlink(filePath); } catch { /* ignore */ }\n      try { module.FS.unlink(outputPath); } catch { /* ignore */ }\n    }\n  }\n}\n\n// ============================================\n// Editor Session Handlers\n// ============================================\n\n/**\n * Open a document and create an editor session\n */\nasync function handleOpenDocument(msg: WorkerMessage) {\n  if (!initialized || !module || !lokBindings) {\n    postResponse({ type: 'error', id: msg.id, error: 'Worker not initialized' });\n    return;\n  }\n\n  const inputData = msg.inputData;\n  const inputExt = msg.inputExt || 'docx';\n\n  if (!inputData || inputData.length === 0) {\n    postResponse({ type: 'error', id: msg.id, error: 'No input data provided' });\n    return;\n  }\n\n  try {\n    // Generate unique session ID\n    const sessionId = `session_${++sessionCounter}_${Date.now()}`;\n    const filePath = `/tmp/edit_${sessionId}.${inputExt}`;\n\n    // Write file to virtual FS\n    module.FS.writeFile(filePath, inputData);\n\n    // Load document\n    const docPtr = lokBindings.documentLoad(filePath);\n    if (docPtr === 0) {\n      const error = lokBindings.getError();\n      module.FS.unlink(filePath);\n      postResponse({ type: 'error', id: msg.id, error: `Failed to load document: ${String(error)}` });\n      return;\n    }\n\n    // Initialize for rendering/editing\n    lokBindings.documentInitializeForRendering(docPtr);\n\n    // Create a view and register callback\n    const viewId = lokBindings.createView(docPtr);\n    lokBindings.setView(docPtr, viewId);\n    lokBindings.registerCallback(docPtr);\n\n    // Enable edit mode\n    lokBindings.postUnoCommand(docPtr, '.uno:Edit');\n\n    // Create the appropriate editor using factory\n    const editor = createEditor(lokBindings, docPtr);\n    const documentType = editor.getDocumentType();\n\n    // Get page count\n    const pageCount = lokBindings.documentGetParts(docPtr);\n\n    // Store session\n    editorSessions.set(sessionId, {\n      sessionId,\n      docPtr,\n      filePath,\n      editor,\n      documentType,\n    });\n\n    console.log(`[LOK Worker] Opened document session: ${sessionId}, type: ${documentType}, pages: ${pageCount}`);\n\n    postResponse({\n      type: 'editorSession',\n      id: msg.id,\n      editorSession: {\n        sessionId,\n        documentType,\n        pageCount,\n      },\n    });\n  } catch (error) {\n    console.error('[LOK Worker] Error in handleOpenDocument:', error);\n    postResponse({\n      type: 'error',\n      id: msg.id,\n      error: error instanceof Error ? error.message : String(error),\n    });\n  }\n}\n\n/**\n * Execute an editor operation on an open session\n */\nasync function handleEditorOperation(msg: WorkerMessage) {\n  const { sessionId, editorMethod, editorArgs } = msg;\n\n  if (!sessionId || !editorMethod) {\n    postResponse({ type: 'error', id: msg.id, error: 'Missing sessionId or editorMethod' });\n    return;\n  }\n\n  const session = editorSessions.get(sessionId);\n  if (!session) {\n    postResponse({ type: 'error', id: msg.id, error: `Session not found: ${sessionId}` });\n    return;\n  }\n\n  try {\n    const { editor } = session;\n    const args = editorArgs || [];\n\n    // Call the method on the editor (dynamic dispatch requires any cast)\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any, @typescript-eslint/no-unsafe-member-access\n    const method = (editor as any)[editorMethod] as ((...methodArgs: unknown[]) => OperationResult<unknown>) | undefined;\n    if (typeof method !== 'function') {\n      postResponse({\n        type: 'error',\n        id: msg.id,\n        error: `Unknown editor method: ${editorMethod}`,\n      });\n      return;\n    }\n\n    // Execute the method\n    const result = method.apply(editor, args);\n\n    // Convert Map to object for serialization if needed\n    let serializedData = result.data;\n    if (result.data instanceof Map) {\n      serializedData = Object.fromEntries(result.data);\n    }\n\n    postResponse({\n      type: 'editorOperationResult',\n      id: msg.id,\n      editorOperationResult: {\n        success: result.success,\n        verified: result.verified,\n        data: serializedData,\n        error: result.error,\n        suggestion: result.suggestion,\n      },\n    });\n  } catch (error) {\n    console.error(`[LOK Worker] Error in handleEditorOperation (${editorMethod}):`, error);\n    postResponse({\n      type: 'error',\n      id: msg.id,\n      error: error instanceof Error ? error.message : String(error),\n    });\n  }\n}\n\n/**\n * Close an editor session and optionally save the document\n */\nasync function handleCloseDocument(msg: WorkerMessage) {\n  const { sessionId } = msg;\n\n  if (!sessionId) {\n    postResponse({ type: 'error', id: msg.id, error: 'Missing sessionId' });\n    return;\n  }\n\n  const session = editorSessions.get(sessionId);\n  if (!session) {\n    postResponse({ type: 'error', id: msg.id, error: `Session not found: ${sessionId}` });\n    return;\n  }\n\n  try {\n    const { docPtr, filePath } = session;\n\n    // Get the modified document data before closing\n    let modifiedData: Uint8Array | undefined;\n    if (module) {\n      try {\n        // Save to original path first\n        const ext = filePath.split('.').pop() || 'docx';\n        lokBindings?.documentSaveAs(docPtr, filePath, ext, '');\n        modifiedData = module.FS.readFile(filePath) as Uint8Array;\n      } catch (e) {\n        console.warn('[LOK Worker] Could not save document:', e);\n      }\n    }\n\n    // Cleanup\n    if (lokBindings && docPtr !== 0) {\n      try { lokBindings.unregisterCallback(docPtr); } catch { /* ignore */ }\n      try { lokBindings.documentDestroy(docPtr); } catch { /* ignore */ }\n    }\n    if (module) {\n      try { module.FS.unlink(filePath); } catch { /* ignore */ }\n    }\n\n    // Remove session\n    editorSessions.delete(sessionId);\n\n    console.log(`[LOK Worker] Closed document session: ${sessionId}`);\n\n    postResponse({\n      type: 'documentClosed',\n      id: msg.id,\n      data: modifiedData,\n    });\n  } catch (error) {\n    console.error('[LOK Worker] Error in handleCloseDocument:', error);\n    postResponse({\n      type: 'error',\n      id: msg.id,\n      error: error instanceof Error ? error.message : String(error),\n    });\n  }\n}\n\nfunction handleDestroy(msg: WorkerMessage) {\n  console.log('handleDestroy');\n\n  // Close all editor sessions first\n  for (const [, session] of editorSessions) {\n    try {\n      if (lokBindings && session.docPtr !== 0) {\n        try { lokBindings.unregisterCallback(session.docPtr); } catch { /* ignore */ }\n        try { lokBindings.documentDestroy(session.docPtr); } catch { /* ignore */ }\n      }\n      if (module) {\n        try { module.FS.unlink(session.filePath); } catch { /* ignore */ }\n      }\n    } catch { /* ignore */ }\n  }\n  editorSessions.clear();\n\n  // Close any cached document\n  closeCachedDocument();\n\n  // Destroy the converter (which also destroys lokBindings)\n  if (converter) {\n    try { converter.destroy(); } catch { /* ignore */ }\n    converter = null;\n    lokBindings = null; // Already destroyed by converter\n  } else if (lokBindings) {\n    try { lokBindings.destroy(); } catch { /* ignore */ }\n    lokBindings = null;\n  }\n\n  // Terminate any Emscripten pthread workers\n  if (module && (module as unknown as { PThread?: { terminateAllThreads?: () => void } }).PThread?.terminateAllThreads) {\n    try {\n      (module as unknown as { PThread: { terminateAllThreads: () => void } }).PThread.terminateAllThreads();\n    } catch { /* ignore */ }\n  }\n\n  module = null;\n  initialized = false;\n  postResponse({ type: 'ready', id: msg.id });\n\n  // Close this worker after a short delay to ensure response is sent\n  setTimeout(() => self.close(), 100);\n}\n\n// Message handler\nself.onmessage = async (event: MessageEvent<WorkerMessage>) => {\n  const msg = event.data;\n\n  switch (msg.type) {\n    case 'init':\n      await handleInit(msg);\n      break;\n    case 'convert':\n      await handleConvert(msg);\n      break;\n    case 'getPageCount':\n      await handleGetPageCount(msg);\n      break;\n    case 'renderPreviews':\n      await handleRenderPreviews(msg);\n      break;\n    case 'renderSinglePage':\n      await handleRenderSinglePage(msg);\n      break;\n    case 'renderPageViaConvert':\n      await handleRenderPageViaConvert(msg);\n      break;\n    case 'renderPageFullQuality':\n      await handleRenderPageFullQuality(msg);\n      break;\n    case 'getDocumentInfo':\n      await handleGetDocumentInfo(msg);\n      break;\n    case 'getLokInfo':\n      await handleGetLokInfo(msg);\n      break;\n    case 'editText':\n      await handleEditText(msg);\n      break;\n    case 'renderPageRectangles':\n      await handleRenderPageRectangles(msg);\n      break;\n    case 'testLokOperations':\n      await handleTestLokOperations(msg);\n      break;\n    case 'openDocument':\n      await handleOpenDocument(msg);\n      break;\n    case 'editorOperation':\n      await handleEditorOperation(msg);\n      break;\n    case 'closeDocument':\n      await handleCloseDocument(msg);\n      break;\n    case 'destroy':\n      handleDestroy(msg);\n      break;\n  }\n};\n\n// Signal worker is loaded\nself.postMessage({ type: 'loaded' });\n"]}